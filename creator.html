<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <meta http-equiv="Content-Security-Policy" content="default-src 'self' 'unsafe-inline' 'unsafe-eval' https://cdn.tailwindcss.com https://telegram.org https://fonts.googleapis.com https://fonts.gstatic.com https://cdn4.telesco.pe https://cdn*.telesco.pe https://*.telesco.pe data:; img-src 'self' data: https: http: blob:; script-src 'self' 'unsafe-inline' 'unsafe-eval' https://cdn.tailwindcss.com https://telegram.org; style-src 'self' 'unsafe-inline' https://cdn.tailwindcss.com https://fonts.googleapis.com;">
  <title>üéÅ –ü–∞–Ω–µ–ª—å –°–æ–∑–¥–∞—Ç–µ–ª—è</title>
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- Telegram WebApp -->
  <script>
    document.addEventListener("DOMContentLoaded", () => {
      if (window.Telegram?.WebApp) {
        Telegram.WebApp.expand();
        Telegram.WebApp.ready();
      }
    });
  </script>

  <style>
    /* üíß Ripple —ç—Ñ—Ñ–µ–∫—Ç */
    .ripple {
      position: absolute;
      border-radius: 50%;
      transform: scale(0);
      animation: ripple 0.6s linear;
      background: rgba(255, 255, 255, 0.4);
      pointer-events: none;
    }

    @keyframes ripple {
      to {
        transform: scale(4);
        opacity: 0;
      }
    }

    /* üéØ –ö—Ä—É—Ç–∏–ª–∫–∞ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –ø–æ–±–µ–¥–∏—Ç–µ–ª–µ–π */
    @keyframes spinUp {
      from { transform: translateY(80px); opacity: 0; }
      to { transform: translateY(0); opacity: 1; }
    }
    
    @keyframes spinDown {
      from { transform: translateY(-80px); opacity: 0; }
      to { transform: translateY(0); opacity: 1; }
    }
    
    .number-spin-up {
      animation: spinUp 0.3s ease-out;
    }
    
    .number-spin-down {
      animation: spinDown 0.3s ease-out;
    }
    
    /* üîÑ –ê–Ω–∏–º–∞—Ü–∏—è –≤—Ä–∞—â–µ–Ω–∏—è –¥–ª—è –∫–Ω–æ–ø–∫–∏ —Ä–µ—Ä–æ–ª–ª–∞ */
    @keyframes spin {
      from { transform: rotate(0deg); }
      to { transform: rotate(360deg); }
    }
    
    .animate-spin {
      animation: spin 1s linear infinite;
    }
    
    /* –°—Ç–∏–ª–∏ –¥–ª—è –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–Ω—ã—Ö –∫–æ–Ω–∫—É—Ä—Å–æ–≤ */
    .contest-confirmed {
      opacity: 0.8;
      pointer-events: none;
    }

    /* üì± –°—Ç–∏–ª–∏ –¥–ª—è –º–æ–¥–∞–ª—å–Ω—ã—Ö –æ–∫–æ–Ω –Ω–∞ –º–æ–±–∏–ª—å–Ω—ã—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞—Ö */
    #contest-modal,
    #edit-contest-modal,
    #prizes-modal,
    #admin-modal,
    #edit-admin-modal,
    #messages-modal,
    #message-detail-modal {
      /* –û–±–µ—Å–ø–µ—á–∏–≤–∞–µ–º —Å–∫—Ä–æ–ª–ª –¥–∞–∂–µ –ø—Ä–∏ –æ—Ç–∫—Ä—ã—Ç–æ–π –∫–ª–∞–≤–∏–∞—Ç—É—Ä–µ */
      -webkit-overflow-scrolling: touch;
      overscroll-behavior: contain;
      /* –ó–∞–ø—Ä–µ—â–∞–µ–º –≥–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω—ã–π —Å–∫—Ä–æ–ª–ª */
      overflow-x: hidden !important;
      overflow-y: auto !important;
      /* –†–∞–∑—Ä–µ—à–∞–µ–º –∫–ª–∏–∫–∏ –∏ –∂–µ—Å—Ç—ã */
      pointer-events: auto !important;
      touch-action: pan-y pinch-zoom;
      /* –§–∏–∫—Å–∏—Ä—É–µ–º —à–∏—Ä–∏–Ω—É –∏ –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ–º –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ */
      max-width: 100vw;
      width: 100%;
      z-index: 30 !important;
    }
    
    #contest-modal > div,
    #edit-contest-modal > div,
    #prizes-modal > div,
    #admin-modal > div,
    #edit-admin-modal > div,
    #messages-modal > div,
    #message-detail-modal > div {
      /* –ü–æ–∑–≤–æ–ª—è–µ–º —Å–∫—Ä–æ–ª–ª–∏—Ç—å —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ –≤–Ω—É—Ç—Ä–∏ –º–æ–¥–∞–ª–∫–∏ —Ç–æ–ª—å–∫–æ –≤–µ—Ä—Ç–∏–∫–∞–ª—å–Ω–æ */
      overscroll-behavior: contain;
      overflow-x: hidden !important;
      overflow-y: auto !important;
      /* –†–∞–∑—Ä–µ—à–∞–µ–º –∫–ª–∏–∫–∏ */
      pointer-events: auto !important;
      touch-action: pan-y pinch-zoom;
      /* –§–∏–∫—Å–∏—Ä—É–µ–º –º–∞–∫—Å–∏–º–∞–ª—å–Ω—É—é —à–∏—Ä–∏–Ω—É */
      max-width: 100%;
      width: 100%;
      position: relative;
      z-index: 1;
    }
    
    /* –£–±–µ–∂–¥–∞–µ–º—Å—è, —á—Ç–æ –≤—Å–µ –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã–µ —ç–ª–µ–º–µ–Ω—Ç—ã –≤–Ω—É—Ç—Ä–∏ –º–æ–¥–∞–ª–æ–∫ –∫–ª–∏–∫–∞–±–µ–ª—å–Ω—ã */
    #contest-modal button,
    #contest-modal input,
    #contest-modal textarea,
    #contest-modal select,
    #edit-contest-modal button,
    #edit-contest-modal input,
    #edit-contest-modal textarea,
    #edit-contest-modal select,
    #prizes-modal button,
    #prizes-modal input,
    #prizes-modal textarea,
    #admin-modal button,
    #admin-modal input,
    #admin-modal textarea,
    #edit-admin-modal button,
    #edit-admin-modal input,
    #edit-admin-modal textarea,
    #messages-modal button,
    #messages-modal input,
    #message-detail-modal button,
    #message-detail-modal input {
      pointer-events: auto !important;
      cursor: pointer;
      position: relative;
      z-index: 10;
    }
    
    @media (max-height: 600px) {
      /* –ö–æ–≥–¥–∞ –∫–ª–∞–≤–∏–∞—Ç—É—Ä–∞ –æ—Ç–∫—Ä—ã—Ç–∞, —É–º–µ–Ω—å—à–∞–µ–º –º–∞–∫—Å–∏–º–∞–ª—å–Ω—É—é –≤—ã—Å–æ—Ç—É */
      #contest-modal > div,
      #edit-contest-modal > div {
        max-height: calc(100vh - 2rem);
      }
    }
    
    /* –ó–∞–ø—Ä–µ—Ç zoom –¥–ª—è –≤—Å–µ–≥–æ body –ø—Ä–∏ –æ—Ç–∫—Ä—ã—Ç—ã—Ö –º–æ–¥–∞–ª–∫–∞—Ö */
    body.modal-open {
      overflow: hidden;
      touch-action: pan-y;
      position: fixed;
      width: 100%;
      height: 100%;
    }

    /* üåô –¢–µ–º—ã */
    .theme-default { background-color: #111827; color: white; }
    .theme-newyear { background: linear-gradient(180deg, #002b5c, #0077ff); color: #fff; }
    .theme-halloween { background: linear-gradient(180deg, #2b0000, #ff6a00); color: #fff; }

    /* üü£ Black + Neon Purple global theme */
    :root {
      --neon-purple-1: #7c3aed; /* violet-600 */
      --neon-purple-2: #8b5cf6; /* violet-500 */
      --neon-purple-3: #a78bfa; /* violet-400 */
      --neon-pink: #ec4899;     /* pink-500 */
      --neon-white: #ffffff;
      --neon-bg: #000000;
      --text-primary: #e5e7eb;
    }

    .page-dark { background-color: var(--neon-bg); color: var(--text-primary); }

    @keyframes neonFlow {
      0% { background-position: 0% 50%; }
      50% { background-position: 100% 50%; }
      100% { background-position: 0% 50%; }
    }

    /* Liquid flow animations for multi-layer backgrounds */
    @keyframes liquidDown {
      0%   { background-position: center 0%, center 100%, center 50%; }
      50%  { background-position: center 100%, center 0%, center 0%; }
      100% { background-position: center 0%, center 100%, center 50%; }
    }
    @keyframes liquidUp {
      0%   { background-position: center 100%, center 0%, center 50%; }
      50%  { background-position: center 0%, center 100%, center 100%; }
      100% { background-position: center 100%, center 0%, center 50%; }
    }
    @keyframes liquidHorizontal {
      0%   { background-position: 0% center, 100% center, 50% center; }
      50%  { background-position: 100% center, 0% center, 0% center; }
      100% { background-position: 0% center, 100% center, 50% center; }
    }

    /* Text-flow like gradient for side bars */
    @keyframes sideflow {
      from { background-position: center 0%; }
      to { background-position: center 200%; }
    }
    @keyframes sideflowReverse {
      from { background-position: center 200%; }
      to { background-position: center 0%; }
    }

    /* ‚ú® Neon side stripes */
    .neon-sides::before,
    .neon-sides::after {
      content: "";
      position: fixed;
      top: 3vh;
      bottom: 96px; /* extend and connect with lifted bottom bar */
      width: 4px; /* even thinner */
      border-radius: 9999px;
      background: linear-gradient(180deg,
        var(--neon-purple-1) 0%,
        var(--neon-purple-1) 25%,
        var(--neon-pink) 55%,
        var(--neon-white) 85%,
        var(--neon-purple-1) 100%
      );
      background-size: 100% 250%;
      box-shadow:
        0 0 12px rgba(167, 139, 250, 0.6),
        0 0 28px rgba(139, 92, 246, 0.45),
        inset 0 0 16px rgba(167, 139, 250, 0.35);
      z-index: 5;
      pointer-events: none;
    }

    .neon-sides::before { left: 10px; animation: sideflow 5s linear infinite; }
    .neon-sides::after { right: 10px; animation: sideflowReverse 5s linear infinite; }

    /* üîª Bottom neon shimmer bar */
    .neon-bottom {
      position: fixed;
      left: 0;
      right: 0;
      bottom: 0;
      height: 86px;
      display: flex;
      align-items: center;
      justify-content: center;
      background:
        radial-gradient(60% 140% at 50% 100%, rgba(139, 92, 246, 0.16), rgba(0, 0, 0, 0) 60%),
        radial-gradient(25% 100% at 0% 100%, rgba(236, 72, 153, 0.18), transparent 70%),
        radial-gradient(25% 100% at 100% 100%, rgba(255, 255, 255, 0.08), transparent 70%);
      z-index: 4;
      pointer-events: none;
    }

    .neon-bottom::before {
      content: "";
      position: absolute;
      bottom: 24px;
      left: 50%;
      transform: translateX(-50%);
      width: min(560px, 92vw);
      height: 13px;
      border-radius: 9999px;
      background:
        /* liquid bands */
        repeating-linear-gradient(to right,
          rgba(255,255,255,0.85) 0 18px,
          transparent 18px 34px
        ),
        repeating-linear-gradient(to right,
          rgba(236,72,153,0.6) 0 14px,
          transparent 14px 30px
        ),
        repeating-linear-gradient(to right,
          rgba(139,92,246,0.6) 0 16px,
          transparent 16px 32px
        );
      background-blend-mode: screen;
      animation: liquidHorizontal 9s linear infinite;
      box-shadow:
        0 0 22px rgba(167, 139, 250, 0.75),
        0 0 44px rgba(139, 92, 246, 0.65),
        inset 0 0 10px rgba(167, 139, 250, 0.55);
    }

    /* Smooth connectors from sides to bottom bar */
    .neon-bottom::after {
      content: "";
      position: absolute;
      bottom: 24px;
      left: 10px;
      right: 10px;
      height: 18px;
      border-bottom-left-radius: 9999px;
      border-bottom-right-radius: 9999px;
      background: linear-gradient(90deg, transparent, rgba(167,139,250,0.25), rgba(236,72,153,0.25), rgba(255,255,255,0.18), rgba(167,139,250,0.25), transparent);
      filter: blur(8px);
      pointer-events: none;
    }

    /* üß≠ Neon nav */
    .neon-nav {
      background: rgba(10, 10, 16, 0.85) !important;
      backdrop-filter: blur(6px);
      border-bottom: 1px solid rgba(167, 139, 250, 0.25);
      box-shadow: 0 0 24px rgba(139, 92, 246, 0.25);
    }

    .nav-button {
      color: var(--text-primary);
      padding: 0.35rem 0.5rem; /* smaller */
      border-radius: 0.5rem;
      transition: transform .15s ease, box-shadow .2s ease;
      box-shadow: inset 0 0 0 1px rgba(167, 139, 250, 0.35);
      font-size: 0.875rem; /* text-sm */
    }

    .nav-button.active,
    .nav-button:hover {
      box-shadow:
        0 0 12px rgba(167, 139, 250, 0.55),
        inset 0 0 0 1px rgba(167, 139, 250, 0.65);
      transform: translateY(-1px);
    }

    /* üîò Neon buttons */
    .neon-button {
      position: relative;
      background: #0b0b0f !important;
      color: #ffffff !important;
      border: 1px solid rgba(167, 139, 250, 0.45) !important;
      box-shadow:
        0 0 16px rgba(139, 92, 246, 0.35),
        inset 0 0 18px rgba(139, 92, 246, 0.2);
      transition: transform .15s ease, box-shadow .2s ease, border-color .2s ease;
      overflow: hidden;
    }

    .neon-button::before {
      content: "";
      position: absolute;
      inset: -1px;
      border-radius: inherit;
      background: linear-gradient(120deg, transparent 0%, rgba(167, 139, 250, 0.35) 40%, rgba(167, 139, 250, 0.6) 50%, rgba(167, 139, 250, 0.35) 60%, transparent 100%);
      background-size: 300% 100%;
      animation: neonFlow 6s linear infinite;
      z-index: 0;
      pointer-events: none;
      mask: linear-gradient(#000 0 0) content-box, linear-gradient(#000 0 0);
      -webkit-mask-composite: xor;
              mask-composite: exclude;
      padding: 1px;
    }

    .neon-button > * { position: relative; z-index: 1; }

    .neon-button:hover {
      box-shadow:
        0 0 22px rgba(139, 92, 246, 0.55),
        inset 0 0 24px rgba(139, 92, 246, 0.28);
      transform: translateY(-1px);
      border-color: rgba(167, 139, 250, 0.75) !important;
    }

    .neon-button:active { transform: translateY(0); }

    /* üìù Inputs */
    .input-field {
      background: #0f0f16 !important;
      border: 1px solid rgba(148, 163, 184, 0.15);
      color: var(--text-primary) !important;
      box-shadow: inset 0 0 0 1px rgba(167, 139, 250, 0.15);
      transition: box-shadow .2s ease, border-color .2s ease;
    }

    .input-field:focus {
      outline: none;
      border-color: rgba(167, 139, 250, 0.55);
      box-shadow:
        0 0 0 3px rgba(167, 139, 250, 0.25),
        inset 0 0 0 1px rgba(167, 139, 250, 0.55);
    }

    /* üóëÔ∏è Delete button styles - Button Concept #12 style */
    .deletable-item {
      position: relative;
      transition: transform 0.2s ease;
      user-select: none;
      -webkit-user-select: none;
      -moz-user-select: none;
      -ms-user-select: none;
    }

    .deletable-item.deleting-mode {
      animation: shake 0.4s ease infinite;
    }

    @keyframes shake {
      0%, 100% { 
        transform: translateX(0) translateY(0);
      }
      10%, 30%, 50%, 70%, 90% { 
        transform: translateX(-3px) translateY(-2px);
      }
      20%, 40%, 60%, 80% { 
        transform: translateX(3px) translateY(2px);
      }
    }

    /* –°—Ç–∏–ª–∏ –∫–Ω–æ–ø–∫–∏ —É–¥–∞–ª–µ–Ω–∏—è –Ω–µ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è - –¥–æ–ª–≥–æ–µ –Ω–∞–∂–∞—Ç–∏–µ —Å—Ä–∞–∑—É –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ */

    /* Backdrop blur –¥–ª—è —Ñ–æ–Ω–∞ –ø—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏ */
    .backdrop-blur-active {
      backdrop-filter: blur(4px);
      -webkit-backdrop-filter: blur(4px);
    }

    /* Prevent text selection on buttons */
    .neon-button,
    .nav-button,
    button {
      user-select: none;
      -webkit-user-select: none;
      -moz-user-select: none;
      -ms-user-select: none;
      -webkit-touch-callout: none;
    }

    /* Message item styles */
    .message-item {
      transition: all 0.3s ease;
    }

    .message-item:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(139, 92, 246, 0.3);
    }

    .line-clamp-3 {
      display: -webkit-box;
      -webkit-line-clamp: 3;
      line-clamp: 3;
      -webkit-box-orient: vertical;
      overflow: hidden;
    }

    /* –ò—Å–ø–∞—Ä–µ–Ω–∏–µ –∫—Ä–∞—Å–Ω—ã–º —Ü–≤–µ—Ç–æ–º - –∞–Ω–∏–º–∞—Ü–∏—è —É–¥–∞–ª–µ–Ω–∏—è */
    .evaporating-item {
      position: relative;
      overflow: hidden;
      z-index: 1000;
    }

    @keyframes evaporate-red {
      0% {
        opacity: 1;
        transform: scale(1);
        filter: blur(0px) hue-rotate(0deg);
        background-color: transparent;
      }
      20% {
        opacity: 0.9;
        transform: scale(1.02);
        filter: blur(1px) hue-rotate(10deg);
      }
      40% {
        opacity: 0.7;
        transform: scale(1.05);
        filter: blur(3px) hue-rotate(20deg);
        background-color: rgba(239, 68, 68, 0.2);
      }
      60% {
        opacity: 0.4;
        transform: scale(1.1);
        filter: blur(6px) hue-rotate(30deg);
        background-color: rgba(239, 68, 68, 0.4);
      }
      80% {
        opacity: 0.2;
        transform: scale(1.15);
        filter: blur(10px) hue-rotate(40deg);
        background-color: rgba(239, 68, 68, 0.6);
      }
      100% {
        opacity: 0;
        transform: scale(1.2);
        filter: blur(15px) hue-rotate(50deg);
        background-color: rgba(239, 68, 68, 0.8);
      }
    }

    @keyframes evaporate-red-glow {
      0%, 100% {
        box-shadow: 
          0 0 0 rgba(239, 68, 68, 0),
          inset 0 0 0 rgba(239, 68, 68, 0);
      }
      30% {
        box-shadow: 
          0 0 20px rgba(239, 68, 68, 0.6),
          inset 0 0 30px rgba(239, 68, 68, 0.3);
      }
      60% {
        box-shadow: 
          0 0 40px rgba(239, 68, 68, 0.8),
          inset 0 0 50px rgba(239, 68, 68, 0.5);
      }
      100% {
        box-shadow: 
          0 0 60px rgba(239, 68, 68, 1),
          inset 0 0 70px rgba(239, 68, 68, 0.7);
      }
    }

    .evaporating-item.evaporating-now {
      animation: 
        evaporate-red 1.5s cubic-bezier(0.4, 0, 0.6, 1) forwards,
        evaporate-red-glow 1.5s ease-in-out forwards;
      pointer-events: none;
    }

    .evaporating-item.evaporating-now::before {
      content: '';
      position: absolute;
      inset: 0;
      background: radial-gradient(circle at center,
        rgba(239, 68, 68, 0) 0%,
        rgba(239, 68, 68, 0.3) 50%,
        rgba(239, 68, 68, 0.6) 100%);
      opacity: 0;
      animation: evaporate-glow-in 1.5s ease-out forwards;
      z-index: -1;
    }

    @keyframes evaporate-glow-in {
      0% {
        opacity: 0;
      }
      50% {
        opacity: 1;
      }
      100% {
        opacity: 0;
      }
    }
  </style>
</head>
<body class="page-dark text-white min-h-screen flex flex-col neon-sides">

  <!-- üîÑ –ó–∞–≥—Ä—É–∑–∫–∞ -->
  <div id="loading-spinner" class="relative w-full h-screen flex flex-col items-center justify-center" style="background: #000; position: fixed; top: 0; left: 0; width: 100vw; height: 100vh; z-index: 9999; pointer-events: auto;">
    <div class="flex flex-col items-center">
      <div class="animate-spin rounded-full h-12 w-12 border-t-4 border-white mb-4"></div>
      <p class="text-white text-lg font-semibold">–ó–∞–≥—Ä—É–∑–∫–∞ –ø–∞–Ω–µ–ª–∏...</p>
    </div>
  </div>

  <!-- –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–π —Å–∫—Ä–∏–ø—Ç –¥–ª—è –Ω–µ–º–µ–¥–ª–µ–Ω–Ω–æ–≥–æ —Å–∫—Ä—ã—Ç–∏—è —Å–ø–∏–Ω–Ω–µ—Ä–∞ -->
  <script>
    (function() {
      // –°–∫—Ä—ã–≤–∞–µ–º —Å–ø–∏–Ω–Ω–µ—Ä —á–µ—Ä–µ–∑ 100ms –ø–æ—Å–ª–µ –∑–∞–≥—Ä—É–∑–∫–∏ DOM –≤ –ª—é–±–æ–º —Å–ª—É—á–∞–µ
      function forceHideSpinner() {
        var spinner = document.getElementById('loading-spinner');
        var nav = document.getElementById('admin-nav');
        var main = document.querySelector('main');
        
        if (spinner) {
          spinner.style.display = 'none';
          spinner.style.visibility = 'hidden';
          spinner.style.opacity = '0';
          spinner.style.pointerEvents = 'none'; // –ö–†–ò–¢–ò–ß–ù–û: –æ—Ç–∫–ª—é—á–∞–µ–º pointer events
          spinner.style.zIndex = '-1'; // –£–±–∏—Ä–∞–µ–º –≤—ã—Å–æ–∫–∏–π z-index
          spinner.classList.add('hidden');
        }
        if (nav) {
          nav.style.display = 'flex';
          nav.style.pointerEvents = 'auto'; // –í–∫–ª—é—á–∞–µ–º –∫–ª–∏–∫–∏ –Ω–∞ –Ω–∞–≤–∏–≥–∞—Ü–∏—é
          nav.style.zIndex = '10';
          nav.classList.remove('hidden');
        }
        if (main) {
          main.style.display = 'block';
          main.style.pointerEvents = 'auto'; // –í–∫–ª—é—á–∞–µ–º –∫–ª–∏–∫–∏ –Ω–∞ –æ—Å–Ω–æ–≤–Ω–æ–π –∫–æ–Ω—Ç–µ–Ω—Ç
          main.classList.remove('hidden');
        }
      }
      
      if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', function() {
          setTimeout(forceHideSpinner, 100);
        });
      } else {
        setTimeout(forceHideSpinner, 100);
      }
    })();
  </script>

  <!-- üöÄ –ù–∞–≤–∏–≥–∞—Ü–∏—è (–ø–µ—Ä–µ–Ω–µ—Å–µ–Ω–∞ –≤–Ω–∏–∑) -->
  <nav id="admin-nav" class="hidden neon-nav fixed left-0 right-0 z-10 flex justify-around items-center px-2 pb-2 pt-3" style="bottom: 18px;">
    <button class="nav-button active relative" data-section="contests-section">üèÜ –ö–æ–Ω–∫—É—Ä—Å—ã</button>
    <button class="nav-button relative" data-section="admins-section">üë• –ê–¥–º–∏–Ω—ã</button>
    <button class="nav-button relative" data-section="rating-section">‚≠ê –†–µ–π—Ç–∏–Ω–≥</button>
    <button class="nav-button relative" data-section="settings-section">‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∏</button>
    <button class="nav-button relative" data-section="profile-section">üë§ –ü—Ä–æ—Ñ–∏–ª—å</button>
  </nav>

  <!-- üì¶ –û—Å–Ω–æ–≤–Ω–æ–µ —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ -->
  <main class="flex-1 p-6 space-y-6 pb-24">

    <!-- üèÜ –ö–æ–Ω–∫—É—Ä—Å—ã -->
    <section id="contests-section" class="content-section">
      <h2 class="text-xl font-bold mb-4">–ê–∫—Ç–∏–≤–Ω—ã–µ –∫–æ–Ω–∫—É—Ä—Å—ã</h2>
      <button id="create-contest-btn" class="neon-button w-full py-3 rounded-lg mb-6">‚ûï –°–æ–∑–¥–∞—Ç—å –∫–æ–Ω–∫—É—Ä—Å</button>
      <div id="contest-list" class="space-y-4"></div>
    </section>

    <!-- üë• –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—ã -->
    <section id="admins-section" class="content-section hidden">
      <div class="flex items-center justify-between mb-4">
        <h2 class="text-xl font-bold">–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—ã</h2>
        <button id="open-add-admin" class="neon-button px-4 py-2 rounded-lg">‚ûï –î–æ–±–∞–≤–∏—Ç—å –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞</button>
      </div>
      <div id="admins-list" class="space-y-3"></div>
    </section>

    <!-- ‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∏ -->
    <section id="settings-section" class="content-section hidden">
      <h2 class="text-xl font-bold mb-4">–ù–∞—Å—Ç—Ä–æ–π–∫–∏</h2>
      <div class="flex flex-col space-y-3">
        <button id="toggle-bot-btn" class="neon-button bg-yellow-600 hover:bg-yellow-700 py-3 rounded-lg">üõ†Ô∏è –í—ã–∫–ª—é—á–∏—Ç—å –±–æ—Ç–∞</button>
        <select id="theme-select" class="bg-gray-700 p-2 rounded text-white">
          <option value="default">–°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–∞—è —Ç–µ–º–∞</option>
          <option value="newyear">–ù–æ–≤–æ–≥–æ–¥–Ω—è—è</option>
          <option value="halloween">–•—ç–ª–ª–æ—É–∏–Ω</option>
        </select>
      </div>
    </section>

    <!-- ‚≠ê –†–µ–π—Ç–∏–Ω–≥ -->
    <section id="rating-section" class="content-section hidden">
      <h2 class="text-xl font-bold mb-4">–†–µ–π—Ç–∏–Ω–≥</h2>
      
      <!-- –ü–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª—å –º–µ–∂–¥—É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏ –∏ –∞–¥–º–∏–Ω–∞–º–∏ -->
      <div class="flex gap-2 mb-4">
        <button id="rating-users-btn" class="nav-button active px-4 py-2 rounded-lg" data-role="user">–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏</button>
        <button id="rating-admins-btn" class="nav-button px-4 py-2 rounded-lg" data-role="admin">–ê–¥–º–∏–Ω—ã</button>
      </div>
      
      <!-- –°–ø–∏—Å–æ–∫ —Ä–µ–π—Ç–∏–Ω–≥–∞ -->
      <div id="rating-list" class="space-y-2">
        <div class="text-center text-gray-400 py-8">–ó–∞–≥—Ä—É–∑–∫–∞ —Ä–µ–π—Ç–∏–Ω–≥–∞...</div>
      </div>
    </section>

    <!-- üë§ –ü—Ä–æ—Ñ–∏–ª—å -->
    <section id="profile-section" class="content-section hidden">
      <div class="flex items-center justify-between mb-6">
        <h2 class="text-xl font-bold">–ü—Ä–æ—Ñ–∏–ª—å</h2>
        <button id="messages-btn" class="neon-button relative px-4 py-2 rounded-lg flex items-center gap-2">
          <span>üí¨ –°–æ–æ–±—â–µ–Ω–∏—è</span>
          <span id="messages-count" class="hidden bg-red-500 text-white text-xs rounded-full px-2 py-1 min-w-[20px] text-center">0</span>
        </button>
      </div>
      
      <div class="rounded-lg border border-violet-400/30 p-6 bg-black/30 space-y-4">
        <div class="flex items-center gap-3">
          <div class="w-16 h-16 rounded-full bg-gradient-to-br from-violet-500 to-pink-500 flex items-center justify-center text-2xl font-bold">
            <span id="profile-avatar">üë§</span>
          </div>
          <div>
            <div class="text-lg font-semibold" id="profile-username">MONKEY BOSS</div>
            <div class="text-sm text-gray-400">ID: <span id="profile-id" class="text-violet-400"></span></div>
          </div>
        </div>
        
        <div class="pt-4 border-t border-violet-400/20 space-y-3">
          <div class="flex justify-between items-center">
            <span class="text-gray-400">–ü–µ—Ä–≤—ã–π –≤—Ö–æ–¥:</span>
            <span id="profile-first-login" class="text-blue-400"></span>
          </div>
          <div class="flex justify-between items-center">
            <span class="text-gray-400">–°—Ç–∞—Ç—É—Å:</span>
            <span id="profile-status" class="text-green-400 font-semibold"></span>
          </div>
        </div>
      </div>
    </section>
    
    <!-- üí¨ –ú–æ–¥–∞–ª–∫–∞: –°–æ–æ–±—â–µ–Ω–∏—è -->
    <div id="messages-modal" class="hidden fixed inset-0 z-30 flex items-center justify-center bg-black/70 backdrop-blur-sm">
      <div class="relative w-full sm:w-[600px] max-h-[90vh] bg-[#0b0b10] rounded-2xl border border-violet-500/30 shadow-2xl p-6 mx-4 flex flex-col">
        <button id="close-messages-modal" class="absolute -top-3 -right-3 bg-black text-white border border-violet-400/50 rounded-full w-9 h-9 neon-button" aria-label="–ó–∞–∫—Ä—ã—Ç—å">‚úï</button>
        <h3 class="text-lg font-semibold mb-4">üí¨ –°–æ–æ–±—â–µ–Ω–∏—è</h3>
        <div id="messages-list" class="flex-1 overflow-y-auto space-y-3 pr-2">
          <!-- –°–æ–æ–±—â–µ–Ω–∏—è –±—É–¥—É—Ç –∑–¥–µ—Å—å -->
        </div>
      </div>
    </div>
    
    <!-- üìù –ú–æ–¥–∞–ª–∫–∞: –î–µ—Ç–∞–ª–∏ —Å–æ–æ–±—â–µ–Ω–∏—è -->
    <div id="message-detail-modal" class="hidden fixed inset-0 z-40 flex items-center justify-center bg-black/80 backdrop-blur-sm">
      <div class="relative w-full sm:w-[500px] bg-[#0b0b10] rounded-2xl border border-violet-500/30 shadow-2xl p-6 mx-4">
        <button id="close-message-detail-modal" class="absolute -top-3 -right-3 bg-black text-white border border-violet-400/50 rounded-full w-9 h-9 neon-button" aria-label="–ó–∞–∫—Ä—ã—Ç—å">‚úï</button>
        <h3 class="text-lg font-semibold mb-4">üì® –°–æ–æ–±—â–µ–Ω–∏–µ</h3>
        <div class="space-y-4">
          <div>
            <div class="text-sm text-gray-400 mb-1">ID –æ—Ç–ø—Ä–∞–≤–∏—Ç–µ–ª—è:</div>
            <div id="message-sender-id" class="text-violet-400 font-semibold"></div>
          </div>
          <div>
            <div class="text-sm text-gray-400 mb-2">–¢–µ–∫—Å—Ç —Å–æ–æ–±—â–µ–Ω–∏—è:</div>
            <div id="message-full-text" class="text-gray-200 p-3 rounded bg-black/40 border border-violet-400/20 min-h-[120px]"></div>
          </div>
          <div class="flex gap-3 pt-4">
            <button id="approve-message-btn" class="flex-1 neon-button bg-green-600 hover:bg-green-700 py-3 rounded-lg font-semibold">‚úÖ –û–¥–æ–±—Ä–∏—Ç—å</button>
            <button id="reject-message-btn" class="flex-1 bg-red-600 hover:bg-red-700 text-white py-3 rounded-lg font-semibold">‚ùå –û—Ç–∫–ª–æ–Ω–∏—Ç—å</button>
          </div>
        </div>
      </div>
    </div>

  </main>

  <!-- üë• –ü–∞–Ω–µ–ª—å –æ–±—ã—á–Ω–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è -->
  <div id="user-view" class="hidden flex flex-col items-center justify-center h-screen">
    <h2 class="text-2xl font-semibold mb-2">–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å!</h2>
    <p id="user-welcome-name" class="text-gray-300"></p>
  </div>

  <!-- üü£ Bottom neon shimmer backdrop for buttons -->
  <div class="neon-bottom"></div>

  <!-- ü™Ñ –ú–æ–¥–∞–ª–∫–∞: –°–æ–∑–¥–∞—Ç—å –∫–æ–Ω–∫—É—Ä—Å -->
  <div id="contest-modal" class="hidden fixed inset-0 z-20 flex items-end sm:items-center justify-center bg-black/60 p-4" style="pointer-events: auto; overflow-x: hidden; overflow-y: auto; touch-action: pan-y;">
    <div class="relative w-full max-w-[520px] max-h-[90vh] sm:max-h-[85vh] bg-[#0b0b10] rounded-t-2xl sm:rounded-2xl border border-violet-500/30 shadow-2xl p-5 my-auto" style="pointer-events: auto; overflow-x: hidden; overflow-y: auto; touch-action: pan-y; width: 100%; max-width: 520px;">
      <button id="close-contest-modal" class="absolute -top-3 -right-3 bg-black text-white border border-violet-400/50 rounded-full w-9 h-9 neon-button z-10" aria-label="–ó–∞–∫—Ä—ã—Ç—å">‚úï</button>
      <h3 class="text-lg font-semibold mb-3 sticky top-0 bg-[#0b0b10] pb-2 z-0" style="pointer-events: auto;">–°–æ–∑–¥–∞—Ç—å –∫–æ–Ω–∫—É—Ä—Å</h3>
      <div class="space-y-3" style="pointer-events: auto;">
        <div>
          <label class="block text-sm text-gray-400 mb-1">–°—Å—ã–ª–∫–∞ –Ω–∞ –ø–æ—Å—Ç</label>
          <input id="contest-post-link" type="text" class="input-field w-full p-2 rounded" placeholder="https://t.me/channel/123" style="pointer-events: auto; position: relative; z-index: 1;" />
          <p class="text-xs text-gray-500 mt-1">–ü—Ä–∏–º–µ—Ä: https://t.me/monkeys_giveaways/25</p>
        </div>
        
        <div>
          <label class="block text-sm text-gray-400 mb-1">–£—Å–ª–æ–≤–∏—è —É—á–∞—Å—Ç–∏—è</label>
          <textarea id="contest-conditions" class="input-field w-full p-2 rounded" rows="3" placeholder="üìã –£—Å–ª–æ–≤–∏—è —É—á–∞—Å—Ç–∏—è –≤ –∫–æ–Ω–∫—É—Ä—Å–µ (–Ω–∞–ø—Ä–∏–º–µ—Ä: –ø–æ–¥–ø–∏—Å–∫–∞, —Ä–µ–ø–æ—Å—Ç, —Ç–µ–≥ –¥—Ä—É–∑–µ–π)" style="pointer-events: auto; position: relative; z-index: 1;"></textarea>
        </div>
        
        <div>
          <label class="block text-sm text-gray-400 mb-1">üèÜ –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–æ–±–µ–¥–∏—Ç–µ–ª–µ–π</label>
          <div class="flex items-center gap-3">
            <button id="winners-count-decrease" class="w-10 h-10 rounded-full bg-violet-600 hover:bg-violet-700 text-white font-bold text-xl flex items-center justify-center transition-colors">‚àí</button>
            <div class="flex-1 relative overflow-hidden" style="height: 80px;">
              <div id="winners-count-picker" class="absolute inset-0 flex flex-col items-center justify-center">
                <div id="winners-count-value" class="text-4xl font-bold text-violet-400 transition-transform duration-300" style="line-height: 80px;">1</div>
              </div>
            </div>
            <button id="winners-count-increase" class="w-10 h-10 rounded-full bg-violet-600 hover:bg-violet-700 text-white font-bold text-xl flex items-center justify-center transition-colors">+</button>
          </div>
          <input type="hidden" id="contest-winners-count" value="1" />
        </div>
        
        <div class="p-3 rounded-md bg-violet-900/20 border border-violet-400/30 text-sm text-gray-300">
          ‚è± –í—Ä–µ–º—è –±–æ–ª—å—à–µ –Ω–µ —Ç—Ä–µ–±—É–µ—Ç—Å—è ‚Äî –∏—Ç–æ–≥ –º–æ–∂–Ω–æ –ø–æ–¥–≤–æ–¥–∏—Ç—å –≤—Ä—É—á–Ω—É—é, –∫–æ–≥–¥–∞ —Ö–æ—Ç–∏—Ç–µ.
        </div>
      </div>
      <button id="submit-contest" class="neon-button w-full mt-4 py-3 rounded-lg">–î–æ–±–∞–≤–∏—Ç—å –¥–∞–Ω–Ω—ã–µ</button>
    </div>
  </div>

  <!-- üéÅ –ú–æ–¥–∞–ª–∫–∞: –î–æ–±–∞–≤–∏—Ç—å –ø—Ä–∏–∑—ã -->
  <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–ª—è –∏—Ç–æ–≥–æ–≤ –∫–æ–Ω–∫—É—Ä—Å–∞ —Ä–∏—Å—É–Ω–∫–æ–≤ -->
  <div id="drawing-results-modal" class="hidden fixed inset-0 z-30 flex items-end sm:items-center justify-center bg-black/60 p-4 overflow-y-auto" style="pointer-events: auto;">
    <div class="relative w-full max-w-2xl bg-gradient-to-br from-gray-900 via-purple-900/20 to-gray-900 border border-violet-400/40 rounded-2xl shadow-2xl p-6 max-h-[90vh] overflow-y-auto">
      <div class="flex items-center justify-between mb-4">
        <h2 class="text-2xl font-bold text-white">üèÜ –ò—Ç–æ–≥–∏ –∫–æ–Ω–∫—É—Ä—Å–∞</h2>
        <button onclick="document.getElementById('drawing-results-modal').classList.add('hidden'); document.body.classList.remove('modal-open');" class="bg-black text-white border border-violet-400/50 rounded-full w-9 h-9 neon-button flex items-center justify-center" aria-label="–ó–∞–∫—Ä—ã—Ç—å">‚úï</button>
      </div>
      <div id="drawing-results-content" class="space-y-4">
        <!-- –°–æ–¥–µ—Ä–∂–∏–º–æ–µ –±—É–¥–µ—Ç –¥–æ–±–∞–≤–ª–µ–Ω–æ –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
      </div>
    </div>
  </div>

  <div id="prizes-modal" class="hidden fixed inset-0 z-30 flex items-end sm:items-center justify-center bg-black/60 p-4 overflow-y-auto" style="pointer-events: auto;">
    <div class="relative w-full max-w-[520px] max-h-[90vh] sm:max-h-[85vh] bg-[#0b0b10] rounded-t-2xl sm:rounded-2xl border border-violet-500/30 shadow-2xl p-5 my-auto overflow-y-auto" style="pointer-events: auto;">
      <button id="close-prizes-modal" class="absolute -top-3 -right-3 bg-black text-white border border-violet-400/50 rounded-full w-9 h-9 neon-button z-10" aria-label="–ó–∞–∫—Ä—ã—Ç—å" style="pointer-events: auto;">‚úï</button>
      <h3 class="text-lg font-semibold mb-3 sticky top-0 bg-[#0b0b10] pb-2 z-0" style="pointer-events: auto;">–î–æ–±–∞–≤–∏—Ç—å –ø—Ä–∏–∑—ã</h3>
      <p class="text-sm text-gray-400 mb-4">–í–≤–µ–¥–∏—Ç–µ —Å—Å—ã–ª–∫–∏ –Ω–∞ –ø—Ä–∏–∑—ã –≤ —Ñ–æ—Ä–º–∞—Ç–µ: t.me/nft/–Ω–∞–∑–≤–∞–Ω–∏–µ-–∫–æ–ª–ª–µ–∫—Ü–∏–∏-–Ω–æ–º–µ—Ä</p>
      <p class="text-xs text-gray-500 mb-4">–ü—Ä–∏–º–µ—Ä: t.me/nft/SnoopDogg-119754</p>
      <div id="prizes-list" class="space-y-3 mb-4" style="pointer-events: auto;">
        <!-- –ü—Ä–∏–∑—ã –±—É–¥—É—Ç –¥–æ–±–∞–≤–ª—è—Ç—å—Å—è –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
      </div>
      
      <!-- –°–µ–∫—Ü–∏—è –∂—é—Ä–∏ (–µ—Å–ª–∏ –≤–∫–ª—é—á–µ–Ω–æ) -->
      <div id="prizes-modal-jury-section" class="hidden border-t border-violet-500/30 pt-4 mt-4">
        <h4 class="text-sm font-semibold text-gray-300 mb-3">üë®‚Äç‚öñÔ∏è –î–∞–Ω–Ω—ã–µ —á–ª–µ–Ω–æ–≤ –∂—é—Ä–∏</h4>
        <div id="prizes-modal-jury-members" class="space-y-3 mb-4">
          <!-- –ß–ª–µ–Ω—ã –∂—é—Ä–∏ –±—É–¥—É—Ç –¥–æ–±–∞–≤–ª—è—Ç—å—Å—è –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
        </div>
      </div>
      
      <button id="add-prize-btn" class="neon-button w-full py-2 rounded-lg mb-4" style="pointer-events: auto;">‚ûï –î–æ–±–∞–≤–∏—Ç—å –ø—Ä–∏–∑</button>
      <button id="submit-prizes" class="neon-button w-full py-3 rounded-lg" style="pointer-events: auto;">‚úÖ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –ø—Ä–∏–∑—ã</button>
    </div>
  </div>

  <!-- ‚úèÔ∏è –ú–æ–¥–∞–ª–∫–∞: –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –∫–æ–Ω–∫—É—Ä—Å -->
  <div id="edit-contest-modal" class="hidden fixed inset-0 z-20 flex items-end sm:items-center justify-center bg-black/60 p-4 overflow-y-auto">
    <div class="relative w-full max-w-[520px] max-h-[90vh] sm:max-h-[85vh] bg-[#0b0b10] rounded-t-2xl sm:rounded-2xl border border-violet-500/30 shadow-2xl p-5 my-auto overflow-y-auto">
      <button id="close-edit-contest-modal" class="absolute -top-3 -right-3 bg-black text-white border border-violet-400/50 rounded-full w-9 h-9 neon-button z-10" aria-label="–ó–∞–∫—Ä—ã—Ç—å">‚úï</button>
      <h3 class="text-lg font-semibold mb-3">–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –∫–æ–Ω–∫—É—Ä—Å</h3>
      <div class="space-y-3">
        <div>
          <label class="block text-sm text-gray-400 mb-1">–ù–∞–∑–≤–∞–Ω–∏–µ –∫–æ–Ω–∫—É—Ä—Å–∞</label>
          <input id="edit-contest-title" class="input-field w-full p-2 rounded" placeholder="–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ" />
        </div>
        
        <div>
          <label class="block text-sm text-gray-400 mb-1">–°—Å—ã–ª–∫–∞ –Ω–∞ –ø–æ—Å—Ç</label>
          <input id="edit-contest-post-link" type="url" class="input-field w-full p-2 rounded" placeholder="https://t.me/channel/123" pattern="https?://t\.me/[a-zA-Z0-9_]+/\d+" />
          <p class="text-xs text-gray-500 mt-1">–ü—Ä–∏–º–µ—Ä: https://t.me/monkeys_giveaways/25</p>
        </div>
        
        <div>
          <label class="block text-sm text-gray-400 mb-1">–£—Å–ª–æ–≤–∏—è —É—á–∞—Å—Ç–∏—è</label>
          <textarea id="edit-contest-conditions" class="input-field w-full p-2 rounded" rows="3" placeholder="üìã –£—Å–ª–æ–≤–∏—è —É—á–∞—Å—Ç–∏—è"></textarea>
        </div>
        
        <div id="edit-contest-prize-container" class="hidden">
          <label class="block text-sm text-gray-400 mb-1">üéÅ –ü—Ä–∏–∑</label>
          <input id="edit-contest-prize" class="input-field w-full p-2 rounded" placeholder="–ß—Ç–æ –º–æ–∂–Ω–æ –≤—ã–∏–≥—Ä–∞—Ç—å" />
        </div>
        <div class="p-3 rounded-md bg-violet-900/20 border border-violet-400/30 text-sm text-gray-300">
          –í—Ä–µ–º—è –Ω–∞—á–∞–ª–∞/–æ–∫–æ–Ω—á–∞–Ω–∏—è –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è. –í—ã –º–æ–∂–µ—Ç–µ –ø–æ–¥–≤–µ—Å—Ç–∏ –∏—Ç–æ–≥–∏ –≤ –ª—é–±–æ–π –º–æ–º–µ–Ω—Ç.
        </div>
      </div>
      <button id="update-contest" class="neon-button w-full mt-4 py-3 rounded-lg">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è</button>
    </div>
  </div>

  <!-- ‚úèÔ∏è –ú–æ–¥–∞–ª–∫–∞: –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞ -->
  <div id="edit-admin-modal" class="hidden fixed inset-0 z-20 flex items-end sm:items-center justify-center bg-black/60">
    <div class="relative w-full sm:w-[520px] bg-[#0b0b10] rounded-t-2xl sm:rounded-2xl border border-violet-500/30 shadow-2xl p-5">
      <button id="close-edit-admin-modal" class="absolute -top-3 -right-3 bg-black text-white border border-violet-400/50 rounded-full w-9 h-9 neon-button" aria-label="–ó–∞–∫—Ä—ã—Ç—å">‚úï</button>
      <h3 class="text-lg font-semibold mb-3">–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞</h3>
      <div class="space-y-2">
        <input id="edit-modal-admin-id" class="input-field w-full p-2 rounded" placeholder="ID" disabled />
        <input id="edit-modal-admin-username" class="input-field w-full p-2 rounded" placeholder="Username (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)" />
        <input id="edit-modal-admin-channel" class="input-field w-full p-2 rounded" placeholder="üîó –°—Å—ã–ª–∫–∞ –Ω–∞ –∫–∞–Ω–∞–ª" />
        <input id="edit-modal-admin-chat" class="input-field w-full p-2 rounded" placeholder="üí¨ –°—Å—ã–ª–∫–∞ –Ω–∞ —á–∞—Ç" />
      </div>
      <button id="update-admin" class="neon-button w-full mt-4 py-3 rounded-lg">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è</button>
    </div>
  </div>

  <!-- üßë‚Äçüíº –ú–æ–¥–∞–ª–∫–∞: –î–æ–±–∞–≤–∏—Ç—å –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞ -->
  <div id="admin-modal" class="hidden fixed inset-0 z-20 flex items-end sm:items-center justify-center bg-black/60">
    <div class="relative w-full sm:w-[520px] bg-[#0b0b10] rounded-t-2xl sm:rounded-2xl border border-violet-500/30 shadow-2xl p-5">
      <button id="close-admin-modal" class="absolute -top-3 -right-3 bg-black text-white border border-violet-400/50 rounded-full w-9 h-9 neon-button" aria-label="–ó–∞–∫—Ä—ã—Ç—å">‚úï</button>
      <h3 class="text-lg font-semibold mb-3">–î–æ–±–∞–≤–∏—Ç—å –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞</h3>
      <div class="space-y-2">
        <input id="modal-admin-id" class="input-field w-full p-2 rounded" placeholder="ID" />
        <input id="modal-admin-username" class="input-field w-full p-2 rounded" placeholder="Username" />
        <input id="modal-admin-channel" class="input-field w-full p-2 rounded" placeholder="–°—Å—ã–ª–∫–∞ –Ω–∞ –∫–∞–Ω–∞–ª" />
        <input id="modal-admin-chat" class="input-field w-full p-2 rounded" placeholder="–°—Å—ã–ª–∫–∞ –Ω–∞ —á–∞—Ç (–Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)" />
      </div>
      <button id="submit-admin" class="neon-button w-full mt-4 py-3 rounded-lg">–î–æ–±–∞–≤–∏—Ç—å</button>
    </div>
  </div>

  <!-- üéØ –ú–æ–¥–∞–ª–∫–∞: –í—ã–±–æ—Ä —Ç–∏–ø–∞ –∫–æ–Ω–∫—É—Ä—Å–∞ -->
  <div id="contest-type-selection-modal" class="hidden fixed inset-0 z-25 flex items-end sm:items-center justify-center bg-black/60 p-4" style="pointer-events: auto;">
    <div class="relative w-full max-w-[520px] max-h-[90vh] sm:max-h-[85vh] bg-[#0b0b10] rounded-t-2xl sm:rounded-2xl border border-violet-500/30 shadow-2xl p-5 my-auto" style="pointer-events: auto;">
      <button id="close-contest-type-selection-modal" class="absolute -top-3 -right-3 bg-black text-white border border-violet-400/50 rounded-full w-9 h-9 neon-button z-10" aria-label="–ó–∞–∫—Ä—ã—Ç—å">‚úï</button>
      <h3 class="text-lg font-semibold mb-4 sticky top-0 bg-[#0b0b10] pb-2 z-0">–í—ã–±–µ—Ä–∏—Ç–µ —Ç–∏–ø –∫–æ–Ω–∫—É—Ä—Å–∞</h3>
      <div class="space-y-3" style="pointer-events: auto;">
        <button id="select-random-comment-contest" class="w-full neon-button py-4 rounded-lg text-left px-4 flex items-center justify-between">
          <div>
            <div class="font-semibold text-lg">üé≤ –†–∞–Ω–¥–æ–º –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π</div>
            <div class="text-sm text-gray-400 mt-1">–ö–æ–Ω–∫—É—Ä—Å –Ω–∞ –æ—Å–Ω–æ–≤–µ —Å–ª—É—á–∞–π–Ω–æ–≥–æ –≤—ã–±–æ—Ä–∞ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤ –∏–∑ –ø–æ—Å—Ç–∞</div>
          </div>
          <span class="text-2xl">‚Üí</span>
        </button>
        <button id="select-drawing-contest" class="w-full neon-button py-4 rounded-lg text-left px-4 flex items-center justify-between">
          <div>
            <div class="font-semibold text-lg">üé® –ö–æ–Ω–∫—É—Ä—Å —Ä–∏—Å—É–Ω–∫–æ–≤</div>
            <div class="text-sm text-gray-400 mt-1">–ö–æ–Ω–∫—É—Ä—Å –Ω–∞ –ª—É—á—à–∏–π —Ä–∏—Å—É–Ω–æ–∫ –ø–æ –∑–∞–¥–∞–Ω–Ω–æ–π —Ç–µ–º–µ</div>
          </div>
          <span class="text-2xl">‚Üí</span>
        </button>
        <button id="select-collection-contest" class="w-full neon-button py-4 rounded-lg text-left px-4 flex items-center justify-between">
          <div>
            <div class="font-semibold text-lg">üñºÔ∏è –ö–æ–Ω–∫—É—Ä—Å –∫–æ–ª–ª–µ–∫—Ü–∏–π</div>
            <div class="text-sm text-gray-400 mt-1">–ö–æ–Ω–∫—É—Ä—Å –Ω–∞ –ª—É—á—à—É—é –∫–æ–ª–ª–µ–∫—Ü–∏—é NFT (9 —à—Ç—É–∫)</div>
          </div>
          <span class="text-2xl">‚Üí</span>
        </button>
      </div>
    </div>
  </div>

  <!-- üé® –ú–æ–¥–∞–ª–∫–∞: –°–æ–∑–¥–∞—Ç—å –∫–æ–Ω–∫—É—Ä—Å —Ä–∏—Å—É–Ω–∫–æ–≤ -->
  <div id="drawing-contest-modal" class="hidden fixed inset-0 z-20 flex items-end sm:items-center justify-center bg-black/60 p-4" style="pointer-events: auto; overflow-x: hidden; overflow-y: auto; touch-action: pan-y;">
    <div class="relative w-full max-w-[520px] max-h-[90vh] sm:max-h-[85vh] bg-[#0b0b10] rounded-t-2xl sm:rounded-2xl border border-violet-500/30 shadow-2xl p-5 my-auto" style="pointer-events: auto; overflow-x: hidden; overflow-y: auto; touch-action: pan-y; width: 100%; max-width: 520px;">
      <button id="close-drawing-contest-modal" class="absolute -top-3 -right-3 bg-black text-white border border-violet-400/50 rounded-full w-9 h-9 neon-button z-10" aria-label="–ó–∞–∫—Ä—ã—Ç—å">‚úï</button>
      <h3 id="drawing-contest-modal-title" class="text-lg font-semibold mb-3 sticky top-0 bg-[#0b0b10] pb-2 z-0" style="pointer-events: auto;">–°–æ–∑–¥–∞—Ç—å –∫–æ–Ω–∫—É—Ä—Å —Ä–∏—Å—É–Ω–∫–æ–≤</h3>
      <div class="space-y-3" style="pointer-events: auto;">
        <div>
          <label class="block text-sm text-gray-400 mb-1">–¢–µ–º–∞ —Ä–∏—Å—É–Ω–∫–æ–≤</label>
          <input id="drawing-contest-theme" class="input-field w-full p-2 rounded" placeholder="–í–≤–µ–¥–∏—Ç–µ —Ç–µ–º—É –∫–æ–Ω–∫—É—Ä—Å–∞ (–Ω–∞–ø—Ä–∏–º–µ—Ä: –ö–æ—Å–º–æ—Å)" />
        </div>
        
        <div>
          <label class="block text-sm text-gray-400 mb-1">–£—Å–ª–æ–≤–∏—è —É—á–∞—Å—Ç–∏—è</label>
          <div class="space-y-2">
            <textarea id="drawing-contest-conditions-base" class="input-field w-full p-2 rounded" rows="3" readonly style="pointer-events: auto; position: relative; z-index: 1; background-color: #1a1a2e; resize: none; cursor: not-allowed;"></textarea>
            <div>
              <label class="block text-xs text-gray-500 mb-1">–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —É—Å–ª–æ–≤–∏—è (–Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)</label>
              <textarea id="drawing-contest-conditions-additional" class="input-field w-full p-2 rounded" rows="2" placeholder="–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —É—Å–ª–æ–≤–∏—è —É—á–∞—Å—Ç–∏—è..." style="pointer-events: auto; position: relative; z-index: 1;"></textarea>
            </div>
          </div>
          <p class="text-xs text-gray-500 mt-1">–£—Å–ª–æ–≤–∏—è –ø–æ–¥–ø–∏—Å–∫–∏ –∑–∞—â–∏—â–µ–Ω—ã –æ—Ç –∏–∑–º–µ–Ω–µ–Ω–∏—è. –í—ã –º–æ–∂–µ—Ç–µ –¥–æ–±–∞–≤–∏—Ç—å –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —É—Å–ª–æ–≤–∏—è –Ω–∏–∂–µ.</p>
        </div>
        
        <div>
          <label class="block text-sm text-gray-400 mb-1">üèÜ –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–æ–±–µ–¥–∏—Ç–µ–ª–µ–π</label>
          <div class="flex items-center gap-3">
            <button id="drawing-winners-count-decrease" class="w-10 h-10 rounded-full bg-violet-600 hover:bg-violet-700 text-white font-bold text-xl flex items-center justify-center transition-colors">‚àí</button>
            <div class="flex-1 relative overflow-hidden" style="height: 80px;">
              <div id="drawing-winners-count-picker" class="absolute inset-0 flex flex-col items-center justify-center">
                <div id="drawing-winners-count-value" class="text-4xl font-bold text-violet-400 transition-transform duration-300" style="line-height: 80px;">1</div>
              </div>
            </div>
            <button id="drawing-winners-count-increase" class="w-10 h-10 rounded-full bg-violet-600 hover:bg-violet-700 text-white font-bold text-xl flex items-center justify-center transition-colors">+</button>
          </div>
          <input type="hidden" id="drawing-contest-winners-count" value="1" />
        </div>
        
        <div>
          <label class="block text-sm text-gray-400 mb-1">‚è∞ –í—Ä–µ–º—è –æ–∫–æ–Ω—á–∞–Ω–∏—è –ø—Ä–∏–µ–º–∞ —Ä–∞–±–æ—Ç</label>
          <input id="drawing-contest-submission-end" type="datetime-local" class="input-field w-full p-2 rounded" />
        </div>
        
        <div>
          <label class="block text-sm text-gray-400 mb-1">‚è∞ –í—Ä–µ–º—è –æ–∫–æ–Ω—á–∞–Ω–∏—è –≥–æ–ª–æ—Å–æ–≤–∞–Ω–∏—è</label>
          <input id="drawing-contest-voting-end" type="datetime-local" class="input-field w-full p-2 rounded" />
          <p class="text-xs text-gray-500 mt-1">–ú–µ–∂–¥—É –æ–∫–æ–Ω—á–∞–Ω–∏–µ–º –ø—Ä–∏–µ–º–∞ –∏ –æ–∫–æ–Ω—á–∞–Ω–∏–µ–º –≥–æ–ª–æ—Å–æ–≤–∞–Ω–∏—è –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –º–∏–Ω–∏–º—É–º 10 –º–∏–Ω—É—Ç</p>
        </div>
        
        <!-- –°–µ–∫—Ü–∏—è –∂—é—Ä–∏ -->
        <div class="border-t border-violet-500/30 pt-3 mt-3">
          <div class="flex items-center justify-between mb-3">
            <label class="block text-sm text-gray-400">üë®‚Äç‚öñÔ∏è –ñ—é—Ä–∏</label>
            <label class="relative inline-flex items-center cursor-pointer">
              <input type="checkbox" id="drawing-contest-jury-enabled" class="sr-only peer" />
              <div class="w-11 h-6 bg-gray-700 peer-focus:outline-none peer-focus:ring-2 peer-focus:ring-violet-500 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-violet-600"></div>
            </label>
          </div>
          
          <div id="drawing-contest-jury-settings" class="hidden space-y-3">
            <div>
              <label class="block text-sm text-gray-400 mb-1">–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —á–ª–µ–Ω–æ–≤ –∂—é—Ä–∏</label>
              <div class="flex items-center gap-3">
                <button type="button" id="drawing-jury-count-decrease" class="w-10 h-10 rounded-full bg-violet-600 hover:bg-violet-700 text-white font-bold text-xl flex items-center justify-center transition-colors">‚àí</button>
                <div class="flex-1 relative overflow-hidden" style="height: 60px;">
                  <div class="absolute inset-0 flex flex-col items-center justify-center">
                    <div id="drawing-jury-count-value" class="text-3xl font-bold text-violet-400 transition-transform duration-300" style="line-height: 60px;">1</div>
                  </div>
                </div>
                <button type="button" id="drawing-jury-count-increase" class="w-10 h-10 rounded-full bg-violet-600 hover:bg-violet-700 text-white font-bold text-xl flex items-center justify-center transition-colors">+</button>
              </div>
              <input type="hidden" id="drawing-contest-jury-count" value="1" />
            </div>
            <p class="text-xs text-gray-500">–î–∞–Ω–Ω—ã–µ —á–ª–µ–Ω–æ–≤ –∂—é—Ä–∏ (ID –∏ –∫–∞–Ω–∞–ª) –Ω—É–∂–Ω–æ –±—É–¥–µ—Ç –≤–≤–µ—Å—Ç–∏ –ø–æ—Å–ª–µ —Å–æ–∑–¥–∞–Ω–∏—è –∫–æ–Ω–∫—É—Ä—Å–∞</p>
          </div>
        </div>
      </div>
      <button id="submit-drawing-contest" class="neon-button w-full mt-4 py-3 rounded-lg">–î–æ–±–∞–≤–∏—Ç—å –¥–∞–Ω–Ω—ã–µ</button>
      <button id="update-drawing-contest" class="neon-button w-full mt-4 py-3 rounded-lg hidden">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è</button>
    </div>
  </div>

  <!-- üñºÔ∏è –ú–æ–¥–∞–ª–∫–∞: –°–æ–∑–¥–∞—Ç—å/–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –∫–æ–Ω–∫—É—Ä—Å –∫–æ–ª–ª–µ–∫—Ü–∏–π -->
  <div id="collection-contest-modal" class="hidden fixed inset-0 z-20 flex items-end sm:items-center justify-center bg-black/60 p-4" style="pointer-events: auto; overflow-x: hidden; overflow-y: auto; touch-action: pan-y;">
    <div class="relative w-full max-w-[520px] max-h-[90vh] sm:max-h-[85vh] bg-[#0b0b10] rounded-t-2xl sm:rounded-2xl border border-violet-500/30 shadow-2xl p-5 my-auto" style="pointer-events: auto; overflow-x: hidden; overflow-y: auto; touch-action: pan-y; width: 100%; max-width: 520px;">
      <button id="close-collection-contest-modal" class="absolute -top-3 -right-3 bg-black text-white border border-violet-400/50 rounded-full w-9 h-9 neon-button z-10" aria-label="–ó–∞–∫—Ä—ã—Ç—å">‚úï</button>
      <h3 id="collection-contest-modal-title" class="text-lg font-semibold mb-3 sticky top-0 bg-[#0b0b10] pb-2 z-0" style="pointer-events: auto;">–°–æ–∑–¥–∞—Ç—å –∫–æ–Ω–∫—É—Ä—Å –∫–æ–ª–ª–µ–∫—Ü–∏–π</h3>
      <div class="space-y-3" style="pointer-events: auto;">
        <div>
          <label class="block text-sm text-gray-400 mb-1">–¢–µ–º–∞ –∫–æ–ª–ª–µ–∫—Ü–∏–π</label>
          <input id="collection-contest-theme" class="input-field w-full p-2 rounded" placeholder="–í–≤–µ–¥–∏—Ç–µ —Ç–µ–º—É –∫–æ–Ω–∫—É—Ä—Å–∞ (–Ω–∞–ø—Ä–∏–º–µ—Ä: –ö–æ—Å–º–æ—Å)" />
        </div>
        
        <div>
          <label class="block text-sm text-gray-400 mb-1">–£—Å–ª–æ–≤–∏—è —É—á–∞—Å—Ç–∏—è</label>
          <div class="space-y-2">
            <textarea id="collection-contest-conditions-base" class="input-field w-full p-2 rounded" rows="3" readonly style="pointer-events: auto; position: relative; z-index: 1; background-color: #1a1a2e; resize: none; cursor: not-allowed;"></textarea>
            <div>
              <label class="block text-xs text-gray-500 mb-1">–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —É—Å–ª–æ–≤–∏—è (–Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)</label>
              <textarea id="collection-contest-conditions-additional" class="input-field w-full p-2 rounded" rows="2" placeholder="–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —É—Å–ª–æ–≤–∏—è —É—á–∞—Å—Ç–∏—è..." style="pointer-events: auto; position: relative; z-index: 1;"></textarea>
            </div>
          </div>
          <p class="text-xs text-gray-500 mt-1">–£—Å–ª–æ–≤–∏—è –ø–æ–¥–ø–∏—Å–∫–∏ –∑–∞—â–∏—â–µ–Ω—ã –æ—Ç –∏–∑–º–µ–Ω–µ–Ω–∏—è. –í—ã –º–æ–∂–µ—Ç–µ –¥–æ–±–∞–≤–∏—Ç—å –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —É—Å–ª–æ–≤–∏—è –Ω–∏–∂–µ.</p>
        </div>
        
        <div>
          <label class="block text-sm text-gray-400 mb-1">üèÜ –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–æ–±–µ–¥–∏—Ç–µ–ª–µ–π</label>
          <div class="flex items-center gap-3">
            <button id="collection-winners-count-decrease" class="w-10 h-10 rounded-full bg-violet-600 hover:bg-violet-700 text-white font-bold text-xl flex items-center justify-center transition-colors">‚àí</button>
            <div class="flex-1 relative overflow-hidden" style="height: 80px;">
              <div id="collection-winners-count-picker" class="absolute inset-0 flex flex-col items-center justify-center">
                <div id="collection-winners-count-value" class="text-4xl font-bold text-violet-400 transition-transform duration-300" style="line-height: 80px;">1</div>
              </div>
            </div>
            <button id="collection-winners-count-increase" class="w-10 h-10 rounded-full bg-violet-600 hover:bg-violet-700 text-white font-bold text-xl flex items-center justify-center transition-colors">+</button>
          </div>
          <input type="hidden" id="collection-contest-winners-count" value="1" />
        </div>
        
        <div>
          <label class="block text-sm text-gray-400 mb-1">‚è∞ –í—Ä–µ–º—è –æ–∫–æ–Ω—á–∞–Ω–∏—è –ø—Ä–∏–µ–º–∞ —Ä–∞–±–æ—Ç</label>
          <input id="collection-contest-submission-end" type="datetime-local" class="input-field w-full p-2 rounded" />
        </div>
        
        <div>
          <label class="block text-sm text-gray-400 mb-1">‚è∞ –í—Ä–µ–º—è –æ–∫–æ–Ω—á–∞–Ω–∏—è –≥–æ–ª–æ—Å–æ–≤–∞–Ω–∏—è</label>
          <input id="collection-contest-voting-end" type="datetime-local" class="input-field w-full p-2 rounded" />
          <p class="text-xs text-gray-500 mt-1">–ú–µ–∂–¥—É –æ–∫–æ–Ω—á–∞–Ω–∏–µ–º –ø—Ä–∏–µ–º–∞ –∏ –æ–∫–æ–Ω—á–∞–Ω–∏–µ–º –≥–æ–ª–æ—Å–æ–≤–∞–Ω–∏—è –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –º–∏–Ω–∏–º—É–º 10 –º–∏–Ω—É—Ç</p>
        </div>
      </div>
      <button id="submit-collection-contest" class="neon-button w-full mt-4 py-3 rounded-lg">–î–æ–±–∞–≤–∏—Ç—å –¥–∞–Ω–Ω—ã–µ</button>
      <button id="update-collection-contest" class="neon-button w-full mt-4 py-3 rounded-lg hidden">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è</button>
    </div>
  </div>

  <!-- üèÜ –ú–æ–¥–∞–ª–∫–∞: –ò—Ç–æ–≥–∏ –∫–æ–Ω–∫—É—Ä—Å–∞ –∫–æ–ª–ª–µ–∫—Ü–∏–π -->
  <div id="collection-results-modal" class="hidden fixed inset-0 z-30 flex items-end sm:items-center justify-center bg-black/60 p-4 overflow-y-auto" style="pointer-events: auto;">
    <div class="relative w-full max-w-2xl bg-gradient-to-br from-gray-900 via-purple-900/20 to-gray-900 border border-violet-400/40 rounded-2xl shadow-2xl p-6 max-h-[90vh] overflow-y-auto">
      <div class="flex items-center justify-between mb-4">
        <h2 class="text-2xl font-bold text-white">üèÜ –ò—Ç–æ–≥–∏ –∫–æ–Ω–∫—É—Ä—Å–∞</h2>
        <button onclick="document.getElementById('collection-results-modal').classList.add('hidden'); document.body.classList.remove('modal-open');" class="bg-black text-white border border-violet-400/50 rounded-full w-9 h-9 neon-button flex items-center justify-center" aria-label="–ó–∞–∫—Ä—ã—Ç—å">‚úï</button>
      </div>
      <div id="collection-results-content" class="space-y-4">
        <!-- –°–æ–¥–µ—Ä–∂–∏–º–æ–µ –±—É–¥–µ—Ç –¥–æ–±–∞–≤–ª–µ–Ω–æ –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
      </div>
    </div>
  </div>

  <!-- üóëÔ∏è –ú–æ–¥–∞–ª–∫–∞: –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ —É–¥–∞–ª–µ–Ω–∏—è -->
  <div id="delete-confirm-modal" class="hidden fixed inset-0 z-30 flex items-center justify-center bg-black/70 backdrop-blur-sm">
    <div class="relative w-full sm:w-[400px] bg-[#0b0b10] rounded-2xl border border-red-500/50 shadow-2xl p-6 mx-4">
      <h3 class="text-lg font-semibold mb-4 text-center">‚ö†Ô∏è –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ —É–¥–∞–ª–µ–Ω–∏—è</h3>
      <p id="delete-confirm-text" class="text-gray-300 text-center mb-6"></p>
      <div class="flex gap-3">
        <button id="delete-confirm-cancel" class="neon-button flex-1 py-3 rounded-lg border-gray-500">–û—Ç–º–µ–Ω–∞</button>
        <button id="delete-confirm-ok" class="bg-red-600 hover:bg-red-700 text-white flex-1 py-3 rounded-lg font-semibold">–£–¥–∞–ª–∏—Ç—å</button>
      </div>
    </div>
  </div>

  <!-- üß† –í—Å—Ç—Ä–æ–µ–Ω–Ω–∞—è –ª–æ–≥–∏–∫–∞ UI/–∑–∞–≥—Ä—É–∑–∫–∞ -->
  <script>
    (function() {
      let currentUserId = null; // ID —Ç–µ–∫—É—â–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (creator)
      window.currentUserId = null; // –ì–ª–æ–±–∞–ª—å–Ω–∞—è –ø–µ—Ä–µ–º–µ–Ω–Ω–∞—è –¥–ª—è –¥–æ—Å—Ç—É–ø–∞ –∏–∑ –¥—Ä—É–≥–∏—Ö —Ñ—É–Ω–∫—Ü–∏–π
      let spinner, topNav, main, userView, contentSections, topNavButtons;

      // Loading control: hide spinner once we detect readiness or timeout fallback
      function hideSpinnerAndShowPanel() {
        try {
          console.log('üîÑ –°–∫—Ä—ã–≤–∞–µ–º —Å–ø–∏–Ω–Ω–µ—Ä –∏ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –ø–∞–Ω–µ–ª—å');
          
          // –ü–æ–ª—É—á–∞–µ–º —ç–ª–µ–º–µ–Ω—Ç—ã –∑–∞–Ω–æ–≤–æ, –Ω–∞ —Å–ª—É—á–∞–π –µ—Å–ª–∏ –æ–Ω–∏ –µ—â–µ –Ω–µ –±—ã–ª–∏ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω—ã
          if (!spinner) spinner = document.getElementById('loading-spinner');
          if (!topNav) topNav = document.getElementById('admin-nav');
          if (!main) main = document.querySelector('main');
          
          if (spinner) {
            spinner.classList.add('hidden');
            spinner.style.display = 'none';
            spinner.style.visibility = 'hidden';
            spinner.style.opacity = '0';
            spinner.style.pointerEvents = 'none'; // –ö–†–ò–¢–ò–ß–ù–û: –æ—Ç–∫–ª—é—á–∞–µ–º pointer events
            spinner.style.zIndex = '-1'; // –£–±–∏—Ä–∞–µ–º –≤—ã—Å–æ–∫–∏–π z-index
            console.log('‚úÖ –°–ø–∏–Ω–Ω–µ—Ä —Å–∫—Ä—ã—Ç –∏ pointer-events –æ—Ç–∫–ª—é—á–µ–Ω—ã');
          } else {
            console.error('‚ùå –≠–ª–µ–º–µ–Ω—Ç spinner –Ω–µ –Ω–∞–π–¥–µ–Ω!');
          }
          
          if (topNav) {
            topNav.classList.remove('hidden');
            topNav.style.display = 'flex';
            topNav.style.visibility = 'visible';
            topNav.style.pointerEvents = 'auto'; // –í–∫–ª—é—á–∞–µ–º –∫–ª–∏–∫–∏
            topNav.style.zIndex = '10';
            console.log('‚úÖ –ù–∞–≤–∏–≥–∞—Ü–∏—è –ø–æ–∫–∞–∑–∞–Ω–∞, pointer-events –≤–∫–ª—é—á–µ–Ω—ã');
          } else {
            console.error('‚ùå –≠–ª–µ–º–µ–Ω—Ç topNav –Ω–µ –Ω–∞–π–¥–µ–Ω!');
          }
          
          if (main) {
            main.classList.remove('hidden');
            main.style.display = 'block';
            main.style.visibility = 'visible';
            main.style.pointerEvents = 'auto'; // –í–∫–ª—é—á–∞–µ–º –∫–ª–∏–∫–∏
            console.log('‚úÖ –û—Å–Ω–æ–≤–Ω–æ–π –∫–æ–Ω—Ç–µ–Ω—Ç –ø–æ–∫–∞–∑–∞–Ω, pointer-events –≤–∫–ª—é—á–µ–Ω—ã');
          } else {
            console.error('‚ùå –≠–ª–µ–º–µ–Ω—Ç main –Ω–µ –Ω–∞–π–¥–µ–Ω!');
          }
          
          console.log('‚úÖ –ü–∞–Ω–µ–ª—å –ø–æ–ª–Ω–æ—Å—Ç—å—é –ø–æ–∫–∞–∑–∞–Ω–∞');
        } catch (error) {
          console.error('‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–∫—Ä—ã—Ç–∏–∏ —Å–ø–∏–Ω–Ω–µ—Ä–∞:', error);
          // –ü—ã—Ç–∞–µ–º—Å—è —Å–∫—Ä—ã—Ç—å —Å–ø–∏–Ω–Ω–µ—Ä –Ω–∞–ø—Ä—è–º—É—é —á–µ—Ä–µ–∑ style, –µ—Å–ª–∏ –∫–ª–∞—Å—Å—ã –Ω–µ —Ä–∞–±–æ—Ç–∞—é—Ç
          if (spinner) {
            spinner.style.display = 'none';
            spinner.style.visibility = 'hidden';
            spinner.style.opacity = '0';
          }
        }
      }

      function showSection(id) {
        console.log('üîò showSection –≤—ã–∑–≤–∞–Ω–∞ —Å id:', id);
        
        // –ó–∞–≥—Ä—É–∂–∞–µ–º —Ä–µ–π—Ç–∏–Ω–≥ –ø—Ä–∏ –ø–æ–∫–∞–∑–µ —Å–µ–∫—Ü–∏–∏
        if (id === 'rating-section') {
          setTimeout(() => {
            if (typeof window.loadRating === 'function') {
              window.loadRating(currentRatingRole || 'user');
            }
          }, 100);
        }
        try {
          if (!contentSections || contentSections.length === 0) {
            contentSections = document.querySelectorAll('.content-section');
          }
          if (!topNavButtons || topNavButtons.length === 0) {
            if (!topNav) topNav = document.getElementById('admin-nav');
            topNavButtons = topNav ? topNav.querySelectorAll('.nav-button') : [];
          }
          
          console.log('üîò –ù–∞–π–¥–µ–Ω–æ —Å–µ–∫—Ü–∏–π:', contentSections.length, '–∫–Ω–æ–ø–æ–∫:', topNavButtons.length);
          
          contentSections.forEach(s => {
            if (s.id === id) {
              s.classList.remove('hidden');
              s.style.display = 'block';
            } else {
              s.classList.add('hidden');
              s.style.display = 'none';
            }
          });
          
          topNavButtons.forEach(b => {
            if (b.dataset.section === id) {
              b.classList.add('active');
            } else {
              b.classList.remove('active');
            }
          });
          
          console.log('‚úÖ –°–µ–∫—Ü–∏—è', id, '–ø–æ–∫–∞–∑–∞–Ω–∞');
        } catch (error) {
          console.error('‚ùå –û—à–∏–±–∫–∞ –≤ showSection:', error);
        }
      }

      // Utilities: —Ñ–æ—Ä–º–∞—Ç–∏—Ä—É–µ–º –¥–∞—Ç—É, –∫–æ—Ç–æ—Ä—É—é –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤–≤–æ–¥–∏—Ç —É–∂–µ –≤ –ú–°–ö
      function toMoscowDateTime(value) {
        if (!value) return '';
        if (value instanceof Date) {
          return new Intl.DateTimeFormat('ru-RU', {
            timeZone: 'Europe/Moscow',
            year: 'numeric',
            month: '2-digit',
            day: '2-digit',
            hour: '2-digit',
            minute: '2-digit'
          }).format(value);
        }
        if (typeof value === 'string') {
          const trimmed = value.trim();
          if (!trimmed) return '';
          if (trimmed.includes('Z') || trimmed.match(/[+-]\d{2}:\d{2}$/)) {
            const d = new Date(trimmed);
            if (Number.isNaN(d.getTime())) return trimmed;
            return new Intl.DateTimeFormat('ru-RU', {
              timeZone: 'Europe/Moscow',
              year: 'numeric',
              month: '2-digit',
              day: '2-digit',
              hour: '2-digit',
              minute: '2-digit'
            }).format(d);
          }
          return trimmed.length > 19 ? trimmed.slice(0, 19) : trimmed;
        }
        const d = new Date(value);
        if (Number.isNaN(d.getTime())) return '';
        return new Intl.DateTimeFormat('ru-RU', {
          timeZone: 'Europe/Moscow',
          year: 'numeric',
          month: '2-digit',
          day: '2-digit',
          hour: '2-digit',
          minute: '2-digit'
        }).format(d);
      }

      function toDatetimeLocalValue(value) {
        if (!value) return '';
        if (value instanceof Date) {
          return Number.isNaN(value.getTime()) ? '' : value.toISOString().slice(0, 16);
        }
        if (typeof value === 'string') {
          const trimmed = value.trim();
          if (!trimmed) return '';
          if (/^\d{4}-\d{2}-\d{2}T\d{2}:\d{2}/.test(trimmed)) {
            return trimmed.slice(0, 16);
          }
          const d = new Date(trimmed);
          return Number.isNaN(d.getTime()) ? trimmed.slice(0, 16) : d.toISOString().slice(0, 16);
        }
        const d = new Date(value);
        return Number.isNaN(d.getTime()) ? '' : d.toISOString().slice(0, 16);
      }

      // Data fetching helpers (adjust endpoints to your backend)
      async function fetchJSON(url, options = {}) {
        // –î–ª—è –∑–∞–ø—Ä–æ—Å–æ–≤ –Ω–∞ –≤—ã–±–æ—Ä –ø–æ–±–µ–¥–∏—Ç–µ–ª–µ–π –∏—Å–ø–æ–ª—å–∑—É–µ–º –±–æ–ª—å—à–∏–π —Ç–∞–π–º–∞—É—Ç, –µ—Å–ª–∏ –æ–Ω –Ω–µ —É–∫–∞–∑–∞–Ω
        const defaultTimeout = url.includes('/select-winners') ? 60000 : 10000; // 60 —Å–µ–∫ –¥–ª—è select-winners, 10 —Å–µ–∫ –¥–ª—è –æ—Å—Ç–∞–ª—å–Ω—ã—Ö
        const timeout = options.timeout || defaultTimeout;
        
        // –ï—Å–ª–∏ signal —É–∂–µ –µ—Å—Ç—å –≤ options, –∏—Å–ø–æ–ª—å–∑—É–µ–º –µ–≥–æ, –∏–Ω–∞—á–µ —Å–æ–∑–¥–∞–µ–º –Ω–æ–≤—ã–π
        let controller = options.signal?.signal ? options.signal : new AbortController();
        const timeoutId = setTimeout(() => {
          if (!options.signal) {
            controller.abort();
          }
        }, timeout);
        
        try {
          const res = await fetch(url, {
            ...options,
            signal: controller.signal
          });
          clearTimeout(timeoutId);
          
          if (!res.ok) {
            let errorMessage = `HTTP error! status: ${res.status}`;
            try {
              const errorData = await res.json();
              if (errorData.detail) {
                errorMessage = errorData.detail;
              } else if (errorData.message) {
                errorMessage = errorData.message;
              }
            } catch (e) {
              // –ï—Å–ª–∏ –Ω–µ —É–¥–∞–ª–æ—Å—å —Ä–∞—Å–ø–∞—Ä—Å–∏—Ç—å JSON, –∏—Å–ø–æ–ª—å–∑—É–µ–º —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ
            }
            const error = new Error(errorMessage);
            error.status = res.status;
            error.response = res;
            throw error;
          }
          return res.json();
        } catch (error) {
          clearTimeout(timeoutId);
          if (error.name === 'AbortError') {
            const timeoutError = new Error('–ü—Ä–µ–≤—ã—à–µ–Ω–æ –≤—Ä–µ–º—è –æ–∂–∏–¥–∞–Ω–∏—è –æ—Ç–≤–µ—Ç–∞ –æ—Ç —Å–µ—Ä–≤–µ—Ä–∞');
            timeoutError.status = 408;
            throw timeoutError;
          }
          throw error;
        }
      }

      // –§—É–Ω–∫—Ü–∏—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ - –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è —Å—Ä–∞–∑—É –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
      function init() {
        console.log('üöÄ –ù–∞—á–∞–ª–æ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ creator.html');
        
        // –ü–æ–ª—É—á–∞–µ–º —ç–ª–µ–º–µ–Ω—Ç—ã
        spinner = document.getElementById('loading-spinner');
        topNav = document.getElementById('admin-nav');
        main = document.querySelector('main');
        userView = document.getElementById('user-view');
        contentSections = document.querySelectorAll('.content-section');
        topNavButtons = topNav ? topNav.querySelectorAll('.nav-button') : [];
        
        console.log('–≠–ª–µ–º–µ–Ω—Ç—ã –Ω–∞–π–¥–µ–Ω—ã:', {
          spinner: !!spinner,
          topNav: !!topNav,
          main: !!main,
          contentSections: contentSections.length,
          topNavButtons: topNavButtons.length
        });
        
        // –ü–æ–ª—É—á–∞–µ–º tg_id –∏–∑ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ URL
        const params = new URLSearchParams(window.location.search);
        const tgIdFromUrl = params.get('tg_id');
        
        if (!tgIdFromUrl) {
          console.error('‚ùå tg_id –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç –≤ URL');
          if (spinner) {
            spinner.innerHTML = '<div class="text-red-500 text-lg font-semibold">‚ùå –û—à–∏–±–∫–∞: –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç tg_id</div>';
          }
          return;
        }
        
        // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º currentUserId —Å—Ä–∞–∑—É –∏–∑ URL
        currentUserId = parseInt(tgIdFromUrl);
        window.currentUserId = currentUserId;
        console.log('‚úÖ currentUserId —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω:', currentUserId);
        
        // –ù–ê–°–¢–û–Ø–©–ï–ï –°–ö–†–´–¢–ò–ï –°–ü–ò–ù–ù–ï–†–ê - –í–´–ü–û–õ–ù–Ø–ï–ú –°–†–ê–ó–£
        console.log('üîÑ –°–∫—Ä—ã–≤–∞–µ–º —Å–ø–∏–Ω–Ω–µ—Ä –ù–ï–ú–ï–î–õ–ï–ù–ù–û');
        hideSpinnerAndShowPanel();
        
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º –Ω–∞–≤–∏–≥–∞—Ü–∏—é - –ö–†–ò–¢–ò–ß–ù–û!
        console.log('üîò –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –Ω–∞–≤–∏–≥–∞—Ü–∏–∏, –Ω–∞–π–¥–µ–Ω–æ –∫–Ω–æ–ø–æ–∫:', topNavButtons.length);
        if (topNavButtons && topNavButtons.length > 0) {
          topNavButtons.forEach((btn, index) => {
            console.log(`üîò –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –¥–ª—è –∫–Ω–æ–ø–∫–∏ ${index}:`, btn.dataset.section);
            btn.addEventListener('click', (e) => {
              e.preventDefault();
              e.stopPropagation();
              console.log('üîò –ö–ª–∏–∫ –ø–æ –∫–Ω–æ–ø–∫–µ –Ω–∞–≤–∏–≥–∞—Ü–∏–∏:', btn.dataset.section);
              showSection(btn.dataset.section);
            });
            // –£–±–µ–∂–¥–∞–µ–º—Å—è, —á—Ç–æ –∫–Ω–æ–ø–∫–∏ –∫–ª–∏–∫–∞–±–µ–ª—å–Ω—ã
            btn.style.pointerEvents = 'auto';
            btn.style.cursor = 'pointer';
          });
        } else {
          console.error('‚ùå –ö–Ω–æ–ø–∫–∏ –Ω–∞–≤–∏–≥–∞—Ü–∏–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã!');
        }
        
        // Telegram WebApp initialization
        if (window.Telegram?.WebApp) {
          Telegram.WebApp.ready();
          Telegram.WebApp.onEvent('themeChanged', () => {});
          const tgUser = window.Telegram.WebApp.initDataUnsafe?.user;
          if (tgUser) {
            currentUserId = tgUser.id || parseInt(tgIdFromUrl);
            window.currentUserId = currentUserId;
            const usernameEl = document.getElementById('profile-username');
            if (usernameEl) {
              // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º username –∏–∑ Telegram WebApp –µ—Å–ª–∏ –µ—Å—Ç—å, –∏–Ω–∞—á–µ first_name, –∏–Ω–∞—á–µ MONKEY BOSS
              const displayName = tgUser.username || tgUser.first_name || 'MONKEY BOSS';
              usernameEl.textContent = displayName;
              
              // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º username –Ω–∞ —Å–µ—Ä–≤–µ—Ä –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è
              if (tgUser.username) {
                fetch(`/api/profile/update-username?tg_id=${currentUserId}&username=${encodeURIComponent(tgUser.username)}`, {
                  method: 'POST'
                }).catch(() => {});
              }
            }
            const profileIdEl = document.getElementById('profile-id');
            if (profileIdEl) {
              profileIdEl.textContent = tgUser.id || tgIdFromUrl;
            }
          }
        }
        
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º —ç–ª–µ–º–µ–Ω—Ç—ã –¥–ª—è –∫–æ–Ω–∫—É—Ä—Å–æ–≤ –∏ –¥—Ä—É–≥–∏—Ö —Ñ—É–Ω–∫—Ü–∏–π
        contestList = document.getElementById('contest-list');
        openContestBtn = document.getElementById('create-contest-btn');
        contestModal = document.getElementById('contest-modal');
        closeContestModal = document.getElementById('close-contest-modal');
        submitContest = document.getElementById('submit-contest');
        
        console.log('üîò –≠–ª–µ–º–µ–Ω—Ç—ã –∫–æ–Ω–∫—É—Ä—Å–æ–≤:', {
          contestList: !!contestList,
          openContestBtn: !!openContestBtn,
          contestModal: !!contestModal,
          submitContest: !!submitContest
        });
        
        // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Å–æ–±—ã—Ç–∏–π –¥–ª—è –∫–æ–Ω–∫—É—Ä—Å–æ–≤
        if (openContestBtn) {
          console.log('üîò –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –¥–ª—è –∫–Ω–æ–ø–∫–∏ —Å–æ–∑–¥–∞–Ω–∏—è –∫–æ–Ω–∫—É—Ä—Å–∞');
          openContestBtn.addEventListener('click', (e) => {
            e.preventDefault();
            e.stopPropagation();
            console.log('üîò –ö–ª–∏–∫ –ø–æ –∫–Ω–æ–ø–∫–µ —Å–æ–∑–¥–∞–Ω–∏—è –∫–æ–Ω–∫—É—Ä—Å–∞');
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –º–æ–¥–∞–ª–∫—É –≤—ã–±–æ—Ä–∞ —Ç–∏–ø–∞ –∫–æ–Ω–∫—É—Ä—Å–∞
            const contestTypeSelectionModal = document.getElementById('contest-type-selection-modal');
            if (contestTypeSelectionModal) {
              openModal(contestTypeSelectionModal);
            } else {
              console.error('‚ùå –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –≤—ã–±–æ—Ä–∞ —Ç–∏–ø–∞ –∫–æ–Ω–∫—É—Ä—Å–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ!');
            }
          });
          openContestBtn.style.pointerEvents = 'auto';
          openContestBtn.style.cursor = 'pointer';
        } else {
          console.error('‚ùå –ö–Ω–æ–ø–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è –∫–æ–Ω–∫—É—Ä—Å–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω–∞!');
        }
        
        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –¥–ª—è –º–æ–¥–∞–ª–∫–∏ –≤—ã–±–æ—Ä–∞ —Ç–∏–ø–∞ –∫–æ–Ω–∫—É—Ä—Å–∞
        const contestTypeSelectionModal = document.getElementById('contest-type-selection-modal');
        const closeContestTypeSelectionModal = document.getElementById('close-contest-type-selection-modal');
        const selectRandomCommentContest = document.getElementById('select-random-comment-contest');
        const selectDrawingContest = document.getElementById('select-drawing-contest');
        
        if (closeContestTypeSelectionModal && contestTypeSelectionModal) {
          closeContestTypeSelectionModal.addEventListener('click', (e) => {
            e.preventDefault();
            e.stopPropagation();
            closeModal(contestTypeSelectionModal);
          });
        }
        
        if (selectRandomCommentContest) {
          selectRandomCommentContest.addEventListener('click', (e) => {
            e.preventDefault();
            e.stopPropagation();
            closeModal(contestTypeSelectionModal);
            if (contestModal) {
              openModal(contestModal);
            }
          });
        }
        
        if (selectDrawingContest) {
          selectDrawingContest.addEventListener('click', async (e) => {
            e.preventDefault();
            e.stopPropagation();
            closeModal(contestTypeSelectionModal);
            const drawingContestModal = document.getElementById('drawing-contest-modal');
            if (drawingContestModal) {
              // –ó–∞–≥—Ä—É–∂–∞–µ–º –¥–∞–Ω–Ω—ã–µ –ø—Ä–æ—Ñ–∏–ª—è –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –∑–∞–ø–æ–ª–Ω–µ–Ω–∏—è —É—Å–ª–æ–≤–∏–π
              try {
                const profileResponse = await fetchJSON(`/api/profile?tg_id=${currentUserId}`);
                const userRole = profileResponse.status || 'user';
                const adminChannelLink = profileResponse.channel_link || '';
                const adminChatLink = profileResponse.chat_link || '';
                const creatorChannelLink = 't.me/monkeys_giveaways';
                
                // –§–æ—Ä–º–∏—Ä—É–µ–º –±–∞–∑–æ–≤—ã–µ —É—Å–ª–æ–≤–∏—è —É—á–∞—Å—Ç–∏—è –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Ä–æ–ª–∏
                let baseConditionsText = '–î–ª—è —É—á–∞—Å—Ç–∏—è –≤ –∫–æ–Ω–∫—É—Ä—Å–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ:\n';
                
                // –ï—Å–ª–∏ —ç—Ç–æ –∞–¥–º–∏–Ω, –¥–æ–±–∞–≤–ª—è–µ–º –∫–∞–Ω–∞–ª –∏ —á–∞—Ç –∞–¥–º–∏–Ω–∞
                if (userRole === 'admin') {
                  if (adminChannelLink) {
                    baseConditionsText += `- –ü–æ–¥–ø–∏—Å–∞—Ç—å—Å—è –Ω–∞ –∫–∞–Ω–∞–ª –∞–¥–º–∏–Ω–∞: ${adminChannelLink}\n`;
                  }
                  if (adminChatLink) {
                    baseConditionsText += `- –ü–æ–¥–ø–∏—Å–∞—Ç—å—Å—è –Ω–∞ —á–∞—Ç –∞–¥–º–∏–Ω–∞: ${adminChatLink}\n`;
                  }
                }
                
                // –ö–∞–Ω–∞–ª –∫—Ä–µ–∞—Ç–æ—Ä–∞ –≤—Å–µ–≥–¥–∞ –æ–±—è–∑–∞—Ç–µ–ª–µ–Ω
                baseConditionsText += `- –ü–æ–¥–ø–∏—Å–∞—Ç—å—Å—è –Ω–∞ –∫–∞–Ω–∞–ª —Å–æ–∑–¥–∞—Ç–µ–ª—è: ${creatorChannelLink}\n`;
                baseConditionsText += '- –û—Ç–ø—Ä–∞–≤–∏—Ç—å —Ä–∏—Å—É–Ω–æ–∫ –Ω–∞ –∑–∞–¥–∞–Ω–Ω—É—é —Ç–µ–º—É';
                
                // –°–æ—Ö—Ä–∞–Ω—è–µ–º –±–∞–∑–æ–≤—ã–µ —É—Å–ª–æ–≤–∏—è –≤ –æ—Ç–¥–µ–ª—å–Ω–æ–µ –ø–æ–ª–µ (readonly)
                const baseConditionsTextarea = document.getElementById('drawing-contest-conditions-base');
                if (baseConditionsTextarea) {
                  baseConditionsTextarea.value = baseConditionsText;
                  // –û–±–Ω–æ–≤–ª—è–µ–º –∑–∞—â–∏—â–µ–Ω–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ
                  originalBaseValue = baseConditionsText;
                }
                
                // –û—á–∏—â–∞–µ–º –ø–æ–ª–µ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã—Ö —É—Å–ª–æ–≤–∏–π
                const additionalConditionsTextarea = document.getElementById('drawing-contest-conditions-additional');
                if (additionalConditionsTextarea) {
                  additionalConditionsTextarea.value = '';
                }
              } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö –ø—Ä–æ—Ñ–∏–ª—è:', error);
                // –ò—Å–ø–æ–ª—å–∑—É–µ–º –±–∞–∑–æ–≤—ã–µ —É—Å–ª–æ–≤–∏—è
                const baseConditionsText = '–î–ª—è —É—á–∞—Å—Ç–∏—è –≤ –∫–æ–Ω–∫—É—Ä—Å–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ:\n- –ü–æ–¥–ø–∏—Å–∞—Ç—å—Å—è –Ω–∞ –∫–∞–Ω–∞–ª —Å–æ–∑–¥–∞—Ç–µ–ª—è: t.me/monkeys_giveaways\n- –û—Ç–ø—Ä–∞–≤–∏—Ç—å —Ä–∏—Å—É–Ω–æ–∫ –Ω–∞ –∑–∞–¥–∞–Ω–Ω—É—é —Ç–µ–º—É';
                const baseConditionsTextarea = document.getElementById('drawing-contest-conditions-base');
                if (baseConditionsTextarea) {
                  baseConditionsTextarea.value = baseConditionsText;
                  // –û–±–Ω–æ–≤–ª—è–µ–º –∑–∞—â–∏—â–µ–Ω–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ
                  originalBaseValue = baseConditionsText;
                }
                const additionalConditionsTextarea = document.getElementById('drawing-contest-conditions-additional');
                if (additionalConditionsTextarea) {
                  additionalConditionsTextarea.value = '';
                }
              }
              // –°–±—Ä–∞—Å—ã–≤–∞–µ–º —Ä–µ–∂–∏–º —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –Ω–æ–≤–æ–≥–æ –∫–æ–Ω–∫—É—Ä—Å–∞
              currentEditContestId = null;
              const submitBtn = document.getElementById('submit-drawing-contest');
              const updateBtn = document.getElementById('update-drawing-contest');
              if (submitBtn) submitBtn.classList.remove('hidden');
              if (updateBtn) updateBtn.classList.add('hidden');
              const modalTitle = document.getElementById('drawing-contest-modal-title');
              if (modalTitle) modalTitle.textContent = '–°–æ–∑–¥–∞—Ç—å –∫–æ–Ω–∫—É—Ä—Å —Ä–∏—Å—É–Ω–∫–æ–≤';
              
              // –û—á–∏—â–∞–µ–º –ø–æ–ª—è –ø–µ—Ä–µ–¥ –æ—Ç–∫—Ä—ã—Ç–∏–µ–º –º–æ–¥–∞–ª–∫–∏
              document.getElementById('drawing-contest-theme').value = '';
              document.getElementById('drawing-contest-submission-end').value = '';
              document.getElementById('drawing-contest-voting-end').value = '';
              document.getElementById('drawing-contest-conditions-additional').value = '';
              currentDrawingWinnersCount = 1;
              const drawingWinnersCountValueEl = document.getElementById('drawing-winners-count-value');
              const drawingWinnersCountInputEl = document.getElementById('drawing-contest-winners-count');
              if (drawingWinnersCountValueEl) drawingWinnersCountValueEl.textContent = '1';
              if (drawingWinnersCountInputEl) drawingWinnersCountInputEl.value = '1';
              
              openModal(drawingContestModal);
            }
          });
        }
        
        const selectCollectionContest = document.getElementById('select-collection-contest');
        if (selectCollectionContest) {
          selectCollectionContest.addEventListener('click', async (e) => {
            e.preventDefault();
            e.stopPropagation();
            closeModal(contestTypeSelectionModal);
            const collectionContestModal = document.getElementById('collection-contest-modal');
            if (collectionContestModal) {
              // –ó–∞–≥—Ä—É–∂–∞–µ–º –¥–∞–Ω–Ω—ã–µ –ø—Ä–æ—Ñ–∏–ª—è –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –∑–∞–ø–æ–ª–Ω–µ–Ω–∏—è —É—Å–ª–æ–≤–∏–π
              try {
                const profileResponse = await fetchJSON(`/api/profile?tg_id=${currentUserId}`);
                const userRole = profileResponse.status || 'user';
                const adminChannelLink = profileResponse.channel_link || '';
                const adminChatLink = profileResponse.chat_link || '';
                const creatorChannelLink = 't.me/monkeys_giveaways';
                
                // –§–æ—Ä–º–∏—Ä—É–µ–º –±–∞–∑–æ–≤—ã–µ —É—Å–ª–æ–≤–∏—è —É—á–∞—Å—Ç–∏—è
                let baseConditionsText = '–î–ª—è —É—á–∞—Å—Ç–∏—è –≤ –∫–æ–Ω–∫—É—Ä—Å–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ:\n';
                
                if (userRole === 'admin') {
                  if (adminChannelLink) {
                    baseConditionsText += `- –ü–æ–¥–ø–∏—Å–∞—Ç—å—Å—è –Ω–∞ –∫–∞–Ω–∞–ª –∞–¥–º–∏–Ω–∞: ${adminChannelLink}\n`;
                  }
                  if (adminChatLink) {
                    baseConditionsText += `- –ü–æ–¥–ø–∏—Å–∞—Ç—å—Å—è –Ω–∞ —á–∞—Ç –∞–¥–º–∏–Ω–∞: ${adminChatLink}\n`;
                  }
                }
                
                baseConditionsText += `- –ü–æ–¥–ø–∏—Å–∞—Ç—å—Å—è –Ω–∞ –∫–∞–Ω–∞–ª —Å–æ–∑–¥–∞—Ç–µ–ª—è: ${creatorChannelLink}\n`;
                baseConditionsText += '- –û—Ç–ø—Ä–∞–≤–∏—Ç—å –∫–æ–ª–ª–µ–∫—Ü–∏—é –∏–∑ 9 NFT';
                
                // –°–æ—Ö—Ä–∞–Ω—è–µ–º –±–∞–∑–æ–≤—ã–µ —É—Å–ª–æ–≤–∏—è –≤ –æ—Ç–¥–µ–ª—å–Ω–æ–µ –ø–æ–ª–µ (readonly)
                const baseConditionsTextarea = document.getElementById('collection-contest-conditions-base');
                if (baseConditionsTextarea) {
                  baseConditionsTextarea.value = baseConditionsText;
                  originalBaseValue = baseConditionsText;
                }
                
                // –û—á–∏—â–∞–µ–º –ø–æ–ª–µ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã—Ö —É—Å–ª–æ–≤–∏–π
                const additionalConditionsTextarea = document.getElementById('collection-contest-conditions-additional');
                if (additionalConditionsTextarea) {
                  additionalConditionsTextarea.value = '';
                }
              } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö –ø—Ä–æ—Ñ–∏–ª—è:', error);
                alert('‚ö†Ô∏è –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö –ø—Ä–æ—Ñ–∏–ª—è. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ —É –≤–∞—Å –Ω–∞–∑–Ω–∞—á–µ–Ω—ã –∫–∞–Ω–∞–ª –∏ —á–∞—Ç.');
                return;
              }
              
              // –°–±—Ä–∞—Å—ã–≤–∞–µ–º —Ä–µ–∂–∏–º —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
              currentEditContestId = null;
              const submitBtn = document.getElementById('submit-collection-contest');
              const updateBtn = document.getElementById('update-collection-contest');
              if (submitBtn) submitBtn.classList.remove('hidden');
              if (updateBtn) updateBtn.classList.add('hidden');
              const modalTitle = document.getElementById('collection-contest-modal-title');
              if (modalTitle) modalTitle.textContent = '–°–æ–∑–¥–∞—Ç—å –∫–æ–Ω–∫—É—Ä—Å –∫–æ–ª–ª–µ–∫—Ü–∏–π';
              
              // –û—á–∏—â–∞–µ–º –ø–æ–ª—è –ø–µ—Ä–µ–¥ –æ—Ç–∫—Ä—ã—Ç–∏–µ–º –º–æ–¥–∞–ª–∫–∏
              document.getElementById('collection-contest-theme').value = '';
              document.getElementById('collection-contest-submission-end').value = '';
              document.getElementById('collection-contest-voting-end').value = '';
              document.getElementById('collection-contest-conditions-additional').value = '';
              currentCollectionWinnersCount = 1;
              const collectionWinnersCountValueEl = document.getElementById('collection-winners-count-value');
              const collectionWinnersCountInputEl = document.getElementById('collection-contest-winners-count');
              if (collectionWinnersCountValueEl) collectionWinnersCountValueEl.textContent = '1';
              if (collectionWinnersCountInputEl) collectionWinnersCountInputEl.value = '1';
              
              openModal(collectionContestModal);
            }
          });
        }
        
        if (closeContestModal && contestModal) {
          closeContestModal.addEventListener('click', (e) => {
            e.preventDefault();
            e.stopPropagation();
            closeModal(contestModal);
          });
        }
        
        // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –¥–ª—è submitContest
        if (submitContest) {
          console.log('üîò –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –¥–ª—è submit-contest');
          submitContest.addEventListener('click', async () => {
            const postLink = document.getElementById('contest-post-link')?.value.trim();
            const conditions = document.getElementById('contest-conditions')?.value.trim();
            const winnersCount = parseInt(document.getElementById('contest-winners-count')?.value) || 1;

            // –î–ª—è —Ä–∞–Ω–¥–æ–º –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤ –ø–æ—Å—Ç –∏ —É—Å–ª–æ–≤–∏—è –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã, –≤—Ä–µ–º—è –±–æ–ª—å—à–µ –Ω–µ —Ç—Ä–µ–±—É–µ—Ç—Å—è
            if (!postLink || !conditions) {
              alert('‚ö†Ô∏è –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –∑–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –ø–æ–ª—è');
              return;
            }
            
            // –í–∞–ª–∏–¥–∞—Ü–∏—è —Ñ–æ—Ä–º–∞—Ç–∞ —Å—Å—ã–ª–∫–∏ –Ω–∞ –ø–æ—Å—Ç
            if (postLink && !/^https?:\/\/t\.me\/[a-zA-Z0-9_]+\/\d+$/.test(postLink)) {
              alert('‚ö†Ô∏è –ù–µ–≤–µ—Ä–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç —Å—Å—ã–ª–∫–∏ –Ω–∞ –ø–æ—Å—Ç!\n\n–ü—Ä–∏–º–µ—Ä –ø—Ä–∞–≤–∏–ª—å–Ω–æ–π —Å—Å—ã–ª–∫–∏:\nhttps://t.me/monkeys_giveaways/25');
              return;
            }

            // –î–ª—è —Ä–∞–Ω–¥–æ–º –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤ –Ω–∞–∑–≤–∞–Ω–∏–µ –≤—Å–µ–≥–¥–∞ "–†–∞–Ω–¥–æ–º–Ω—ã–π –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π"
            const title = "–†–∞–Ω–¥–æ–º–Ω—ã–π –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π";

            const payload = {
              title: title,
              name: title,
              post_link: postLink,
              conditions: conditions,
              prize: '',
              start_at: null,
              end_at: null,
              winners_count: winnersCount,
              created_by: currentUserId,
              contest_type: 'random_comment'
            };

            try {
              const response = await fetchJSON('/api/contests', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(payload)
              });
              closeModal(contestModal);
              
              // –°–æ—Ö—Ä–∞–Ω—è–µ–º ID —Å–æ–∑–¥–∞–Ω–Ω–æ–≥–æ –∫–æ–Ω–∫—É—Ä—Å–∞ –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –ø—Ä–∏–∑–æ–≤
              if (response.id) {
                window.currentContestId = response.id;
                window.currentWinnersCount = winnersCount;
                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –º–æ–¥–∞–ª–∫—É –¥–ª—è –≤–≤–æ–¥–∞ –ø—Ä–∏–∑–æ–≤
                if (typeof openPrizesModal === 'function') {
                  openPrizesModal();
                } else {
                  console.error('–§—É–Ω–∫—Ü–∏—è openPrizesModal –Ω–µ –Ω–∞–π–¥–µ–Ω–∞!');
                  const prizesModal = document.getElementById('prizes-modal');
                  if (prizesModal) {
                    const prizesList = document.getElementById('prizes-list');
                    if (prizesList) {
                      prizesList.innerHTML = '';
                      for (let i = 0; i < winnersCount; i++) {
                        const prizeDiv = document.createElement('div');
                        prizeDiv.className = 'flex gap-2 items-center';
                        prizeDiv.style.pointerEvents = 'auto';
                        prizeDiv.innerHTML = `
                          <label class="text-sm text-gray-400 w-20">–ü—Ä–∏–∑ ${i + 1}:</label>
                          <input type="text" class="prize-input input-field flex-1 p-2 rounded" placeholder="t.me/nft/–Ω–∞–∑–≤–∞–Ω–∏–µ-–Ω–æ–º–µ—Ä" data-index="${i + 1}" style="pointer-events: auto; position: relative; z-index: 1;" />
                        `;
                        prizesList.appendChild(prizeDiv);
                      }
                      openModal(prizesModal);
                    }
                  }
                }
              } else {
                await loadContests();
                showSection('contests-section');
              }
            } catch (e) {
              console.error('–û—à–∏–±–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è –∫–æ–Ω–∫—É—Ä—Å–∞:', e);
              alert('‚ö†Ô∏è –û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –∫–æ–Ω–∫—É—Ä—Å–∞: ' + (e.message || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞'));
            }
          });
        }
        
        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –¥–ª—è –º–æ–¥–∞–ª–∫–∏ –∫–æ–Ω–∫—É—Ä—Å–∞ —Ä–∏—Å—É–Ω–∫–æ–≤
        const drawingContestModal = document.getElementById('drawing-contest-modal');
        const closeDrawingContestModal = document.getElementById('close-drawing-contest-modal');
        const submitDrawingContest = document.getElementById('submit-drawing-contest');
        const drawingWinnersCountDecrease = document.getElementById('drawing-winners-count-decrease');
        const drawingWinnersCountIncrease = document.getElementById('drawing-winners-count-increase');
        
        let currentDrawingWinnersCount = 1;
        let currentCollectionWinnersCount = 1; // –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–æ–±–µ–¥–∏—Ç–µ–ª–µ–π –¥–ª—è –∫–æ–Ω–∫—É—Ä—Å–∞ –∫–æ–ª–ª–µ–∫—Ü–∏–π
        
        if (closeDrawingContestModal && drawingContestModal) {
          closeDrawingContestModal.addEventListener('click', (e) => {
            e.preventDefault();
            e.stopPropagation();
            
            // –°–±—Ä–∞—Å—ã–≤–∞–µ–º —Ä–µ–∂–∏–º —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –ø—Ä–∏ –∑–∞–∫—Ä—ã—Ç–∏–∏
            currentEditContestId = null;
            const submitBtn = document.getElementById('submit-drawing-contest');
            const updateBtn = document.getElementById('update-drawing-contest');
            if (submitBtn) submitBtn.classList.remove('hidden');
            if (updateBtn) updateBtn.classList.add('hidden');
            const modalTitle = document.getElementById('drawing-contest-modal-title');
            if (modalTitle) modalTitle.textContent = '–°–æ–∑–¥–∞—Ç—å –∫–æ–Ω–∫—É—Ä—Å —Ä–∏—Å—É–Ω–∫–æ–≤';
            // –°–±—Ä–∞—Å—ã–≤–∞–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ –∂—é—Ä–∏
            if (juryEnabledCheckbox) juryEnabledCheckbox.checked = false;
            if (jurySettingsDiv) jurySettingsDiv.classList.add('hidden');
            currentJuryCount = 1;
            updateJuryMembers(1);
            
            closeModal(drawingContestModal);
          });
        }
        
        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –¥–ª—è –∏–∑–º–µ–Ω–µ–Ω–∏—è –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –ø–æ–±–µ–¥–∏—Ç–µ–ª–µ–π –≤ –∫–æ–Ω–∫—É—Ä—Å–µ —Ä–∏—Å—É–Ω–∫–æ–≤
        function updateDrawingWinnersCount(newValue, direction) {
          const minCount = 1;
          const maxCount = 50;
          if (newValue < minCount) newValue = minCount;
          if (newValue > maxCount) newValue = maxCount;
          
          if (newValue !== currentDrawingWinnersCount) {
            currentDrawingWinnersCount = newValue;
            
            const drawingWinnersCountValueEl = document.getElementById('drawing-winners-count-value');
            const drawingWinnersCountInputEl = document.getElementById('drawing-contest-winners-count');
            
            if (drawingWinnersCountValueEl) {
              drawingWinnersCountValueEl.classList.remove('number-spin-up', 'number-spin-down');
              void drawingWinnersCountValueEl.offsetWidth;
              
              if (direction === 'up') {
                drawingWinnersCountValueEl.classList.add('number-spin-up');
              } else if (direction === 'down') {
                drawingWinnersCountValueEl.classList.add('number-spin-down');
              }
              
              drawingWinnersCountValueEl.textContent = currentDrawingWinnersCount;
            }
            
            if (drawingWinnersCountInputEl) {
              drawingWinnersCountInputEl.value = currentDrawingWinnersCount;
            }
          }
        }
        
        if (drawingWinnersCountDecrease) {
          drawingWinnersCountDecrease.addEventListener('click', () => {
            updateDrawingWinnersCount(currentDrawingWinnersCount - 1, 'down');
          });
        }
        
        if (drawingWinnersCountIncrease) {
          drawingWinnersCountIncrease.addEventListener('click', () => {
            updateDrawingWinnersCount(currentDrawingWinnersCount + 1, 'up');
          });
        }
        
        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –¥–ª—è –∂—é—Ä–∏
        let currentJuryCount = 1;
        const juryEnabledCheckbox = document.getElementById('drawing-contest-jury-enabled');
        const jurySettingsDiv = document.getElementById('drawing-contest-jury-settings');
        const juryCountDecrease = document.getElementById('drawing-jury-count-decrease');
        const juryCountIncrease = document.getElementById('drawing-jury-count-increase');
        
        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ —á–ª–µ–Ω–æ–≤ –∂—é—Ä–∏ (–±–µ–∑ –ø–æ–ª–µ–π –≤–≤–æ–¥–∞)
        function updateJuryMembers(count) {
          const minCount = 1;
          const maxCount = 20;
          if (count < minCount) count = minCount;
          if (count > maxCount) count = maxCount;
          
          currentJuryCount = count;
          const countInput = document.getElementById('drawing-contest-jury-count');
          if (countInput) countInput.value = count;
          
          const countValueEl = document.getElementById('drawing-jury-count-value');
          if (countValueEl) countValueEl.textContent = count;
        }
        
        // –ü–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª—å –∂—é—Ä–∏
        if (juryEnabledCheckbox && jurySettingsDiv) {
          juryEnabledCheckbox.addEventListener('change', (e) => {
            if (e.target.checked) {
              jurySettingsDiv.classList.remove('hidden');
              updateJuryMembers(currentJuryCount);
            } else {
              jurySettingsDiv.classList.add('hidden');
            }
          });
        }
        
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∂—é—Ä–∏ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
        updateJuryMembers(currentJuryCount);
        
        // –ö–Ω–æ–ø–∫–∏ –∏–∑–º–µ–Ω–µ–Ω–∏—è –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ —á–ª–µ–Ω–æ–≤ –∂—é—Ä–∏
        if (juryCountDecrease) {
          juryCountDecrease.addEventListener('click', () => {
            updateJuryMembers(currentJuryCount - 1);
          });
        }
        
        if (juryCountIncrease) {
          juryCountIncrease.addEventListener('click', () => {
            updateJuryMembers(currentJuryCount + 1);
          });
        }
        
        // –ó–∞—â–∏—Ç–∞ –±–∞–∑–æ–≤–æ–≥–æ –ø–æ–ª—è —É—Å–ª–æ–≤–∏–π –æ—Ç –∏–∑–º–µ–Ω–µ–Ω–∏—è
        // –í—ã–Ω–æ—Å–∏–º —Ñ—É–Ω–∫—Ü–∏—é –≤ –≥–ª–æ–±–∞–ª—å–Ω—É—é –æ–±–ª–∞—Å—Ç—å –≤–∏–¥–∏–º–æ—Å—Ç–∏, —á—Ç–æ–±—ã –æ–Ω–∞ –±—ã–ª–∞ –¥–æ—Å—Ç—É–ø–Ω–∞ –≤ openEditDrawingContestModal
        window.setupBaseConditionsProtection = function() {
          const baseConditionsField = document.getElementById('drawing-contest-conditions-base');
          if (!baseConditionsField) return;
          
          // –£–¥–∞–ª—è–µ–º —Å—Ç–∞—Ä—ã–µ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏, –µ—Å–ª–∏ –æ–Ω–∏ –µ—Å—Ç—å
          if (protectionHandlers.input) {
            baseConditionsField.removeEventListener('input', protectionHandlers.input);
          }
          if (protectionHandlers.keydown) {
            baseConditionsField.removeEventListener('keydown', protectionHandlers.keydown);
          }
          if (protectionHandlers.paste) {
            baseConditionsField.removeEventListener('paste', protectionHandlers.paste);
          }
          
          // –û–±–Ω–æ–≤–ª—è–µ–º –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ
          originalBaseValue = baseConditionsField.value;
          
          // –°–æ–∑–¥–∞–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏
          protectionHandlers.input = function(e) {
            if (this.value !== originalBaseValue) {
              this.value = originalBaseValue;
            }
          };
          
          protectionHandlers.keydown = function(e) {
            // –†–∞–∑—Ä–µ—à–∞–µ–º —Ç–æ–ª—å–∫–æ Ctrl+A, Ctrl+C –¥–ª—è –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è
            if (e.ctrlKey && (e.key === 'a' || e.key === 'c')) {
              return;
            }
            // –ë–ª–æ–∫–∏—Ä—É–µ–º –≤—Å–µ –æ—Å—Ç–∞–ª—å–Ω—ã–µ –∫–ª–∞–≤–∏—à–∏ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
            if (!e.ctrlKey && !e.metaKey && e.key !== 'Tab' && e.key !== 'Escape' && e.key !== 'F5') {
              e.preventDefault();
            }
          };
          
          protectionHandlers.paste = function(e) {
            e.preventDefault();
          };
          
          // –î–æ–±–∞–≤–ª—è–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏
          baseConditionsField.addEventListener('input', protectionHandlers.input);
          baseConditionsField.addEventListener('keydown', protectionHandlers.keydown);
          baseConditionsField.addEventListener('paste', protectionHandlers.paste);
        };
        
        // –ó–∞—â–∏—Ç–∞ –±–∞–∑–æ–≤—ã—Ö —É—Å–ª–æ–≤–∏–π –ø—Ä–∏–º–µ–Ω—è–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –ø—Ä–∏ –æ—Ç–∫—Ä—ã—Ç–∏–∏ –º–æ–¥–∞–ª–∫–∏ –∫–æ–Ω–∫—É—Ä—Å–∞ —Ä–∏—Å—É–Ω–∫–æ–≤
        // –ù–ï –≤—ã–∑—ã–≤–∞–µ–º setupBaseConditionsProtection() –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        // –ó–∞—â–∏—Ç–∞ –±—É–¥–µ—Ç —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞ —Ç–æ–ª—å–∫–æ –∫–æ–≥–¥–∞ –º–æ–¥–∞–ª–∫–∞ –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç—Å—è –∏ –ø–æ–ª–µ –∑–∞–ø–æ–ª–Ω–µ–Ω–æ
        if (drawingContestModal) {
          const modalObserver = new MutationObserver(() => {
            if (!drawingContestModal.classList.contains('hidden')) {
              // –î–∞–µ–º –≤—Ä–µ–º—è –Ω–∞ —É—Å—Ç–∞–Ω–æ–≤–∫—É –∑–Ω–∞—á–µ–Ω–∏—è —á–µ—Ä–µ–∑ —Å–∫—Ä–∏–ø—Ç
              setTimeout(() => {
                const baseConditionsField = document.getElementById('drawing-contest-conditions-base');
                if (baseConditionsField && baseConditionsField.value) {
                  originalBaseValue = baseConditionsField.value;
                  if (typeof window.setupBaseConditionsProtection === 'function') {
                    window.setupBaseConditionsProtection();
                  }
                }
              }, 150);
            }
          });
          modalObserver.observe(drawingContestModal, { attributes: true, attributeFilter: ['class'] });
        }
        
        // –°–±—Ä–æ—Å –∑–Ω–∞—á–µ–Ω–∏—è –ø—Ä–∏ –æ—Ç–∫—Ä—ã—Ç–∏–∏ –º–æ–¥–∞–ª–∫–∏ –∫–æ–Ω–∫—É—Ä—Å–∞ —Ä–∏—Å—É–Ω–∫–æ–≤
        if (drawingContestModal) {
          drawingContestModal.addEventListener('click', (e) => {
            if (e.target === drawingContestModal) {
              currentDrawingWinnersCount = 1;
              const drawingWinnersCountValueEl = document.getElementById('drawing-winners-count-value');
              const drawingWinnersCountInputEl = document.getElementById('drawing-contest-winners-count');
              if (drawingWinnersCountValueEl) drawingWinnersCountValueEl.textContent = '1';
              if (drawingWinnersCountInputEl) drawingWinnersCountInputEl.value = '1';
            }
          });
        }
        
        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ —Å–æ–∑–¥–∞–Ω–∏—è –∫–æ–Ω–∫—É—Ä—Å–∞ —Ä–∏—Å—É–Ω–∫–æ–≤
        if (submitDrawingContest) {
          submitDrawingContest.addEventListener('click', async () => {
            const theme = document.getElementById('drawing-contest-theme')?.value.trim();
            const baseConditions = document.getElementById('drawing-contest-conditions-base')?.value.trim() || '';
            const additionalConditions = document.getElementById('drawing-contest-conditions-additional')?.value.trim() || '';
            const winnersCount = parseInt(document.getElementById('drawing-contest-winners-count')?.value) || 1;
            const submissionEndDate = document.getElementById('drawing-contest-submission-end')?.value;
            const votingEndDate = document.getElementById('drawing-contest-voting-end')?.value;
            
            // –û–±—ä–µ–¥–∏–Ω—è–µ–º –±–∞–∑–æ–≤—ã–µ –∏ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —É—Å–ª–æ–≤–∏—è
            let conditions = baseConditions;
            if (additionalConditions) {
              conditions += (conditions ? '\n\n' : '') + additionalConditions;
            }
            
            if (!theme || !baseConditions || !submissionEndDate || !votingEndDate) {
              alert('‚ö†Ô∏è –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –∑–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–æ–ª—è');
              return;
            }
            
            // –í–∞–ª–∏–¥–∞—Ü–∏—è –≤—Ä–µ–º–µ–Ω–∏: –º–∏–Ω–∏–º—É–º 10 –º–∏–Ω—É—Ç –º–µ–∂–¥—É –æ–∫–æ–Ω—á–∞–Ω–∏–µ–º –ø—Ä–∏–µ–º–∞ –∏ –æ–∫–æ–Ω—á–∞–Ω–∏–µ–º –≥–æ–ª–æ—Å–æ–≤–∞–Ω–∏—è
            const submissionEnd = new Date(submissionEndDate);
            const votingEnd = new Date(votingEndDate);
            const timeDiff = (votingEnd - submissionEnd) / 1000 / 60; // —Ä–∞–∑–Ω–∏—Ü–∞ –≤ –º–∏–Ω—É—Ç–∞—Ö
            
            if (timeDiff < 10) {
              alert('‚ö†Ô∏è –ú–µ–∂–¥—É –æ–∫–æ–Ω—á–∞–Ω–∏–µ–º –ø—Ä–∏–µ–º–∞ —Ä–∞–±–æ—Ç –∏ –æ–∫–æ–Ω—á–∞–Ω–∏–µ–º –≥–æ–ª–æ—Å–æ–≤–∞–Ω–∏—è –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –º–∏–Ω–∏–º—É–º 10 –º–∏–Ω—É—Ç');
              return;
            }
            
            if (submissionEnd >= votingEnd) {
              alert('‚ö†Ô∏è –î–∞—Ç–∞ –æ–∫–æ–Ω—á–∞–Ω–∏—è –ø—Ä–∏–µ–º–∞ —Ä–∞–±–æ—Ç –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å —Ä–∞–Ω—å—à–µ –¥–∞—Ç—ã –æ–∫–æ–Ω—á–∞–Ω–∏—è –≥–æ–ª–æ—Å–æ–≤–∞–Ω–∏—è');
              return;
            }
            
            // –§–æ—Ä–º–∏—Ä—É–µ–º –Ω–∞–∑–≤–∞–Ω–∏–µ –∫–æ–Ω–∫—É—Ä—Å–∞
            const contestTitle = `–ö–æ–Ω–∫—É—Ä—Å —Ä–∏—Å—É–Ω–∫–æ–≤: ${theme}`;
            
            // –î–ª—è –∫–æ–Ω–∫—É—Ä—Å–∞ —Ä–∏—Å—É–Ω–∫–æ–≤ start_at —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è –Ω–∞ —Ç–µ–∫—É—â–µ–µ –≤—Ä–µ–º—è (–Ω–∞—á–∞–ª–æ –∫–æ–Ω–∫—É—Ä—Å–∞)
            // submission_end_date - –≤—Ä–µ–º—è –æ–∫–æ–Ω—á–∞–Ω–∏—è –ø—Ä–∏–µ–º–∞ —Ä–∞–±–æ—Ç
            // end_at - –≤—Ä–µ–º—è –æ–∫–æ–Ω—á–∞–Ω–∏—è –≥–æ–ª–æ—Å–æ–≤–∞–Ω–∏—è
            // –ü–æ–ª—É—á–∞–µ–º —Ç–µ–∫—É—â–µ–µ –≤—Ä–µ–º—è –≤ –ú–°–ö –¥–ª—è –≤—Ä–µ–º–µ–Ω–∏ –Ω–∞—á–∞–ª–∞
            const now = new Date();
            const mskTimeString = now.toLocaleString('sv-SE', { timeZone: 'Europe/Moscow' }).slice(0, 16).replace(' ', 'T'); // –§–æ—Ä–º–∞—Ç: YYYY-MM-DDTHH:mm
            
            // –°–æ–±–∏—Ä–∞–µ–º –¥–∞–Ω–Ω—ã–µ –∂—é—Ä–∏ (—Ç–æ–ª—å–∫–æ –≤–∫–ª—é—á–µ–Ω–∏–µ/–≤—ã–∫–ª—é—á–µ–Ω–∏–µ –∏ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ, –¥–∞–Ω–Ω—ã–µ –≤–≤–µ–¥–µ–º –ø–æ–∑–∂–µ)
            let juryData = null;
            const juryEnabled = juryEnabledCheckbox && juryEnabledCheckbox.checked;
            const juryCount = parseInt(document.getElementById('drawing-contest-jury-count')?.value) || 1;
            
            if (juryEnabled) {
              juryData = {
                enabled: true,
                members_count: juryCount,
                members: [] // –î–∞–Ω–Ω—ã–µ –±—É–¥—É—Ç –≤–≤–µ–¥–µ–Ω—ã –≤ –º–æ–¥–∞–ª–∫–µ –ø—Ä–∏–∑–æ–≤
              };
            } else {
              juryData = {
                enabled: false,
                members: []
              };
            }
            
            // –°–æ—Ö—Ä–∞–Ω—è–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –∂—é—Ä–∏ –¥–ª—è –º–æ–¥–∞–ª–∫–∏ –ø—Ä–∏–∑–æ–≤
            window.currentJuryEnabled = juryEnabled;
            window.currentJuryCount = juryCount;
            
            const payload = {
              title: contestTitle,
              name: contestTitle,
              conditions: conditions,
              prize: '',
              start_at: mskTimeString, // –¢–µ–∫—É—â–µ–µ –≤—Ä–µ–º—è –≤ –ú–°–ö –∫–∞–∫ –Ω–∞—á–∞–ª–æ –∫–æ–Ω–∫—É—Ä—Å–∞
              end_at: votingEndDate,
              submission_end_date: submissionEndDate,
              winners_count: winnersCount,
              created_by: currentUserId,
              contest_type: 'drawing',
              post_link: '', // –î–ª—è –∫–æ–Ω–∫—É—Ä—Å–∞ —Ä–∏—Å—É–Ω–∫–æ–≤ post_link –Ω–µ –Ω—É–∂–µ–Ω
              jury: juryData
            };
            
            try {
              // –ò—Å–ø–æ–ª—å–∑—É–µ–º /api/contests –¥–ª—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏ (—ç—Ç–æ –∞–ª–∏–∞—Å –¥–ª—è /api/giveaways)
              const response = await fetchJSON('/api/contests', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(payload)
              });
              
              if (response.success && response.id) {
                closeModal(drawingContestModal);
                window.currentContestId = response.id;
                window.currentWinnersCount = winnersCount;
                
                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –º–æ–¥–∞–ª–∫—É –¥–ª—è –≤–≤–æ–¥–∞ –ø—Ä–∏–∑–æ–≤ (—á–µ—Ä–µ–∑ —Ñ—É–Ω–∫—Ü–∏—é openPrizesModal)
                if (typeof openPrizesModal === 'function') {
                  openPrizesModal();
                } else {
                  // Fallback: –æ—Ç–∫—Ä—ã–≤–∞–µ–º –º–æ–¥–∞–ª–∫—É –Ω–∞–ø—Ä—è–º—É—é
                  const prizesModal = document.getElementById('prizes-modal');
                  if (prizesModal) {
                    const prizesList = document.getElementById('prizes-list');
                    if (prizesList) {
                      prizesList.innerHTML = '';
                      for (let i = 0; i < winnersCount; i++) {
                        const prizeDiv = document.createElement('div');
                        prizeDiv.className = 'flex gap-2 items-center';
                        prizeDiv.style.pointerEvents = 'auto';
                        prizeDiv.innerHTML = `
                          <label class="text-sm text-gray-400 w-20">–ü—Ä–∏–∑ ${i + 1}:</label>
                          <input type="text" class="prize-input input-field flex-1 p-2 rounded" placeholder="t.me/nft/–Ω–∞–∑–≤–∞–Ω–∏–µ-–Ω–æ–º–µ—Ä" data-index="${i + 1}" style="pointer-events: auto; position: relative; z-index: 1;" />
                        `;
                        prizesList.appendChild(prizeDiv);
                      }
                      openModal(prizesModal);
                    }
                  }
                }
              } else {
                alert('‚ö†Ô∏è –û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –∫–æ–Ω–∫—É—Ä—Å–∞: ' + (response.message || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞'));
              }
            } catch (e) {
              console.error('–û—à–∏–±–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è –∫–æ–Ω–∫—É—Ä—Å–∞ —Ä–∏—Å—É–Ω–∫–æ–≤:', e);
              alert('‚ö†Ô∏è –û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –∫–æ–Ω–∫—É—Ä—Å–∞: ' + (e.message || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞'));
            }
          });
        }
        
        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –∫–æ–Ω–∫—É—Ä—Å–∞ —Ä–∏—Å—É–Ω–∫–æ–≤
        const updateDrawingContest = document.getElementById('update-drawing-contest');
        if (updateDrawingContest) {
          updateDrawingContest.addEventListener('click', async () => {
            if (!currentEditContestId) {
              alert('‚ö†Ô∏è –û—à–∏–±–∫–∞: –Ω–µ —É–∫–∞–∑–∞–Ω ID –∫–æ–Ω–∫—É—Ä—Å–∞ –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è');
              return;
            }
            
            const theme = document.getElementById('drawing-contest-theme')?.value.trim();
            const baseConditions = document.getElementById('drawing-contest-conditions-base')?.value.trim() || '';
            const additionalConditions = document.getElementById('drawing-contest-conditions-additional')?.value.trim() || '';
            const winnersCount = parseInt(document.getElementById('drawing-contest-winners-count')?.value) || 1;
            const submissionEndDate = document.getElementById('drawing-contest-submission-end')?.value;
            const votingEndDate = document.getElementById('drawing-contest-voting-end')?.value;
            
            // –û–±—ä–µ–¥–∏–Ω—è–µ–º –±–∞–∑–æ–≤—ã–µ –∏ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —É—Å–ª–æ–≤–∏—è
            let conditions = baseConditions;
            if (additionalConditions) {
              conditions += (conditions ? '\n\n' : '') + additionalConditions;
            }
            
            if (!theme || !baseConditions || !submissionEndDate || !votingEndDate) {
              alert('‚ö†Ô∏è –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –∑–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–æ–ª—è');
              return;
            }
            
            // –í–∞–ª–∏–¥–∞—Ü–∏—è –≤—Ä–µ–º–µ–Ω–∏: –º–∏–Ω–∏–º—É–º 10 –º–∏–Ω—É—Ç –º–µ–∂–¥—É –æ–∫–æ–Ω—á–∞–Ω–∏–µ–º –ø—Ä–∏–µ–º–∞ –∏ –æ–∫–æ–Ω—á–∞–Ω–∏–µ–º –≥–æ–ª–æ—Å–æ–≤–∞–Ω–∏—è
            const submissionEnd = new Date(submissionEndDate);
            const votingEnd = new Date(votingEndDate);
            const timeDiff = (votingEnd - submissionEnd) / 1000 / 60; // —Ä–∞–∑–Ω–∏—Ü–∞ –≤ –º–∏–Ω—É—Ç–∞—Ö
            
            if (timeDiff < 10) {
              alert('‚ö†Ô∏è –ú–µ–∂–¥—É –æ–∫–æ–Ω—á–∞–Ω–∏–µ–º –ø—Ä–∏–µ–º–∞ —Ä–∞–±–æ—Ç –∏ –æ–∫–æ–Ω—á–∞–Ω–∏–µ–º –≥–æ–ª–æ—Å–æ–≤–∞–Ω–∏—è –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –º–∏–Ω–∏–º—É–º 10 –º–∏–Ω—É—Ç');
              return;
            }
            
            if (submissionEnd >= votingEnd) {
              alert('‚ö†Ô∏è –î–∞—Ç–∞ –æ–∫–æ–Ω—á–∞–Ω–∏—è –ø—Ä–∏–µ–º–∞ —Ä–∞–±–æ—Ç –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å —Ä–∞–Ω—å—à–µ –¥–∞—Ç—ã –æ–∫–æ–Ω—á–∞–Ω–∏—è –≥–æ–ª–æ—Å–æ–≤–∞–Ω–∏—è');
              return;
            }
            
            // –§–æ—Ä–º–∏—Ä—É–µ–º –Ω–∞–∑–≤–∞–Ω–∏–µ –∫–æ–Ω–∫—É—Ä—Å–∞
            const contestTitle = `–ö–æ–Ω–∫—É—Ä—Å —Ä–∏—Å—É–Ω–∫–æ–≤: ${theme}`;
            
            try {
              // –ü–æ–ª—É—á–∞–µ–º —Ç–µ–∫—É—â–µ–µ –≤—Ä–µ–º—è –≤ –ú–°–ö –¥–ª—è –≤—Ä–µ–º–µ–Ω–∏ –Ω–∞—á–∞–ª–∞
              const now = new Date();
              const mskTimeString = now.toLocaleString('sv-SE', { timeZone: 'Europe/Moscow' }).slice(0, 16).replace(' ', 'T'); // –§–æ—Ä–º–∞—Ç: YYYY-MM-DDTHH:mm
              
              const payload = {
                title: contestTitle,
                name: contestTitle,
                conditions: conditions,
                prize: '',
                start_at: mskTimeString, // –¢–µ–∫—É—â–µ–µ –≤—Ä–µ–º—è –≤ –ú–°–ö –∫–∞–∫ –Ω–∞—á–∞–ª–æ –∫–æ–Ω–∫—É—Ä—Å–∞
                end_at: votingEndDate,
                submission_end_date: submissionEndDate,
                winners_count: winnersCount,
                created_by: currentUserId,
                contest_type: 'drawing'
              };
              
              const response = await fetchJSON(`/api/contests/${currentEditContestId}`, {
                method: 'PUT',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(payload)
              });
              
              if (response.success) {
                alert('‚úÖ –ö–æ–Ω–∫—É—Ä—Å —É—Å–ø–µ—à–Ω–æ –æ–±–Ω–æ–≤–ª–µ–Ω!');
                closeModal(drawingContestModal);
                
                // –°–±—Ä–∞—Å—ã–≤–∞–µ–º —Ä–µ–∂–∏–º —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
                currentEditContestId = null;
                const submitBtn = document.getElementById('submit-drawing-contest');
                const updateBtn = document.getElementById('update-drawing-contest');
                if (submitBtn) submitBtn.classList.remove('hidden');
                if (updateBtn) updateBtn.classList.add('hidden');
                const modalTitle = document.getElementById('drawing-contest-modal-title');
                if (modalTitle) modalTitle.textContent = '–°–æ–∑–¥–∞—Ç—å –∫–æ–Ω–∫—É—Ä—Å —Ä–∏—Å—É–Ω–∫–æ–≤';
                
                if (typeof loadContests === 'function') await loadContests();
              } else {
                alert('‚ö†Ô∏è –û—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ –∫–æ–Ω–∫—É—Ä—Å–∞: ' + (response.message || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞'));
              }
            } catch (e) {
              console.error('–û—à–∏–±–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –∫–æ–Ω–∫—É—Ä—Å–∞ —Ä–∏—Å—É–Ω–∫–æ–≤:', e);
              alert('‚ö†Ô∏è –û—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ –∫–æ–Ω–∫—É—Ä—Å–∞: ' + (e.message || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞'));
            }
          });
        }
        
        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –¥–ª—è –º–æ–¥–∞–ª–∫–∏ –∫–æ–Ω–∫—É—Ä—Å–∞ –∫–æ–ª–ª–µ–∫—Ü–∏–π
        const collectionContestModal = document.getElementById('collection-contest-modal');
        const closeCollectionContestModal = document.getElementById('close-collection-contest-modal');
        const submitCollectionContest = document.getElementById('submit-collection-contest');
        const updateCollectionContest = document.getElementById('update-collection-contest');
        const collectionWinnersCountDecrease = document.getElementById('collection-winners-count-decrease');
        const collectionWinnersCountIncrease = document.getElementById('collection-winners-count-increase');
        
        if (closeCollectionContestModal && collectionContestModal) {
          closeCollectionContestModal.addEventListener('click', (e) => {
            e.preventDefault();
            e.stopPropagation();
            
            // –°–±—Ä–∞—Å—ã–≤–∞–µ–º —Ä–µ–∂–∏–º —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –ø—Ä–∏ –∑–∞–∫—Ä—ã—Ç–∏–∏
            currentEditContestId = null;
            const submitBtn = document.getElementById('submit-collection-contest');
            const updateBtn = document.getElementById('update-collection-contest');
            if (submitBtn) submitBtn.classList.remove('hidden');
            if (updateBtn) updateBtn.classList.add('hidden');
            const modalTitle = document.getElementById('collection-contest-modal-title');
            if (modalTitle) modalTitle.textContent = '–°–æ–∑–¥–∞—Ç—å –∫–æ–Ω–∫—É—Ä—Å –∫–æ–ª–ª–µ–∫—Ü–∏–π';
            
            closeModal(collectionContestModal);
          });
        }
        
        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –¥–ª—è –∏–∑–º–µ–Ω–µ–Ω–∏—è –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –ø–æ–±–µ–¥–∏—Ç–µ–ª–µ–π –≤ –∫–æ–Ω–∫—É—Ä—Å–µ –∫–æ–ª–ª–µ–∫—Ü–∏–π
        function updateCollectionWinnersCount(newValue, direction) {
          const minCount = 1;
          const maxCount = 50;
          if (newValue < minCount) newValue = minCount;
          if (newValue > maxCount) newValue = maxCount;
          
          if (newValue !== currentCollectionWinnersCount) {
            currentCollectionWinnersCount = newValue;
            
            const collectionWinnersCountValueEl = document.getElementById('collection-winners-count-value');
            const collectionWinnersCountInputEl = document.getElementById('collection-contest-winners-count');
            
            if (collectionWinnersCountValueEl) {
              collectionWinnersCountValueEl.classList.remove('number-spin-up', 'number-spin-down');
              void collectionWinnersCountValueEl.offsetWidth;
              
              if (direction === 'up') {
                collectionWinnersCountValueEl.classList.add('number-spin-up');
              } else if (direction === 'down') {
                collectionWinnersCountValueEl.classList.add('number-spin-down');
              }
              
              collectionWinnersCountValueEl.textContent = currentCollectionWinnersCount;
            }
            
            if (collectionWinnersCountInputEl) {
              collectionWinnersCountInputEl.value = currentCollectionWinnersCount;
            }
          }
        }
        
        if (collectionWinnersCountDecrease) {
          collectionWinnersCountDecrease.addEventListener('click', () => {
            updateCollectionWinnersCount(currentCollectionWinnersCount - 1, 'down');
          });
        }
        
        if (collectionWinnersCountIncrease) {
          collectionWinnersCountIncrease.addEventListener('click', () => {
            updateCollectionWinnersCount(currentCollectionWinnersCount + 1, 'up');
          });
        }
        
        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ —Å–æ–∑–¥–∞–Ω–∏—è –∫–æ–Ω–∫—É—Ä—Å–∞ –∫–æ–ª–ª–µ–∫—Ü–∏–π
        if (submitCollectionContest) {
          submitCollectionContest.addEventListener('click', async () => {
            const theme = document.getElementById('collection-contest-theme')?.value.trim();
            const baseConditions = document.getElementById('collection-contest-conditions-base')?.value.trim() || '';
            const additionalConditions = document.getElementById('collection-contest-conditions-additional')?.value.trim() || '';
            const winnersCount = parseInt(document.getElementById('collection-contest-winners-count')?.value) || 1;
            const submissionEndDate = document.getElementById('collection-contest-submission-end')?.value;
            const votingEndDate = document.getElementById('collection-contest-voting-end')?.value;
            
            // –û–±—ä–µ–¥–∏–Ω—è–µ–º –±–∞–∑–æ–≤—ã–µ –∏ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —É—Å–ª–æ–≤–∏—è
            let conditions = baseConditions;
            if (additionalConditions) {
              conditions += (conditions ? '\n\n' : '') + additionalConditions;
            }
            
            if (!theme || !baseConditions || !submissionEndDate || !votingEndDate) {
              alert('‚ö†Ô∏è –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –∑–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–æ–ª—è');
              return;
            }
            
            // –í–∞–ª–∏–¥–∞—Ü–∏—è –≤—Ä–µ–º–µ–Ω–∏: –º–∏–Ω–∏–º—É–º 10 –º–∏–Ω—É—Ç –º–µ–∂–¥—É –æ–∫–æ–Ω—á–∞–Ω–∏–µ–º –ø—Ä–∏–µ–º–∞ –∏ –æ–∫–æ–Ω—á–∞–Ω–∏–µ–º –≥–æ–ª–æ—Å–æ–≤–∞–Ω–∏—è
            const submissionEnd = new Date(submissionEndDate);
            const votingEnd = new Date(votingEndDate);
            const timeDiff = (votingEnd - submissionEnd) / 1000 / 60;
            
            if (timeDiff < 10) {
              alert('‚ö†Ô∏è –ú–µ–∂–¥—É –æ–∫–æ–Ω—á–∞–Ω–∏–µ–º –ø—Ä–∏–µ–º–∞ —Ä–∞–±–æ—Ç –∏ –æ–∫–æ–Ω—á–∞–Ω–∏–µ–º –≥–æ–ª–æ—Å–æ–≤–∞–Ω–∏—è –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –º–∏–Ω–∏–º—É–º 10 –º–∏–Ω—É—Ç');
              return;
            }
            
            if (submissionEnd >= votingEnd) {
              alert('‚ö†Ô∏è –î–∞—Ç–∞ –æ–∫–æ–Ω—á–∞–Ω–∏—è –ø—Ä–∏–µ–º–∞ —Ä–∞–±–æ—Ç –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å —Ä–∞–Ω—å—à–µ –¥–∞—Ç—ã –æ–∫–æ–Ω—á–∞–Ω–∏—è –≥–æ–ª–æ—Å–æ–≤–∞–Ω–∏—è');
              return;
            }
            
            // –§–æ—Ä–º–∏—Ä—É–µ–º –Ω–∞–∑–≤–∞–Ω–∏–µ –∫–æ–Ω–∫—É—Ä—Å–∞
            const contestTitle = `–ö–æ–Ω–∫—É—Ä—Å –∫–æ–ª–ª–µ–∫—Ü–∏–π: ${theme}`;
            
            // –ü–æ–ª—É—á–∞–µ–º —Ç–µ–∫—É—â–µ–µ –≤—Ä–µ–º—è –≤ –ú–°–ö –¥–ª—è –≤—Ä–µ–º–µ–Ω–∏ –Ω–∞—á–∞–ª–∞
            const now = new Date();
            const mskTimeString = now.toLocaleString('sv-SE', { timeZone: 'Europe/Moscow' }).slice(0, 16).replace(' ', 'T');
            
            const payload = {
              title: contestTitle,
              name: contestTitle,
              conditions: conditions,
              prize: '',
              start_at: mskTimeString,
              end_at: votingEndDate,
              submission_end_date: submissionEndDate,
              winners_count: winnersCount,
              created_by: currentUserId,
              contest_type: 'collection',
              post_link: ''
            };
            
            try {
              const response = await fetchJSON('/api/contests', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(payload)
              });
              
              if (response.success && response.id) {
                closeModal(collectionContestModal);
                window.currentContestId = response.id;
                window.currentWinnersCount = winnersCount;
                
                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –º–æ–¥–∞–ª–∫—É –¥–ª—è –≤–≤–æ–¥–∞ –ø—Ä–∏–∑–æ–≤
                const prizesModal = document.getElementById('prizes-modal');
                if (prizesModal) {
                  const prizesList = document.getElementById('prizes-list');
                  if (prizesList) {
                    prizesList.innerHTML = '';
                    for (let i = 0; i < winnersCount; i++) {
                      const prizeDiv = document.createElement('div');
                      prizeDiv.className = 'flex gap-2 items-center';
                      prizeDiv.style.pointerEvents = 'auto';
                      prizeDiv.innerHTML = `
                        <label class="text-sm text-gray-400 w-20">–ü—Ä–∏–∑ ${i + 1}:</label>
                        <input type="text" class="prize-input input-field flex-1 p-2 rounded" placeholder="t.me/nft/–Ω–∞–∑–≤–∞–Ω–∏–µ-–Ω–æ–º–µ—Ä" data-index="${i + 1}" style="pointer-events: auto; position: relative; z-index: 1;" />
                      `;
                      prizesList.appendChild(prizeDiv);
                    }
                    openModal(prizesModal);
                  }
                }
              } else {
                alert('‚ö†Ô∏è –û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –∫–æ–Ω–∫—É—Ä—Å–∞: ' + (response.message || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞'));
              }
            } catch (e) {
              console.error('–û—à–∏–±–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è –∫–æ–Ω–∫—É—Ä—Å–∞ –∫–æ–ª–ª–µ–∫—Ü–∏–π:', e);
              alert('‚ö†Ô∏è –û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –∫–æ–Ω–∫—É—Ä—Å–∞: ' + (e.message || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞'));
            }
          });
        }
        
        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –∫–æ–Ω–∫—É—Ä—Å–∞ –∫–æ–ª–ª–µ–∫—Ü–∏–π
        if (updateCollectionContest) {
          updateCollectionContest.addEventListener('click', async () => {
            if (!currentEditContestId) {
              alert('‚ö†Ô∏è –û—à–∏–±–∫–∞: –Ω–µ —É–∫–∞–∑–∞–Ω ID –∫–æ–Ω–∫—É—Ä—Å–∞ –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è');
              return;
            }
            
            const theme = document.getElementById('collection-contest-theme')?.value.trim();
            const baseConditions = document.getElementById('collection-contest-conditions-base')?.value.trim() || '';
            const additionalConditions = document.getElementById('collection-contest-conditions-additional')?.value.trim() || '';
            const winnersCount = parseInt(document.getElementById('collection-contest-winners-count')?.value) || 1;
            const submissionEndDate = document.getElementById('collection-contest-submission-end')?.value;
            const votingEndDate = document.getElementById('collection-contest-voting-end')?.value;
            
            // –û–±—ä–µ–¥–∏–Ω—è–µ–º –±–∞–∑–æ–≤—ã–µ –∏ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —É—Å–ª–æ–≤–∏—è
            let conditions = baseConditions;
            if (additionalConditions) {
              conditions += (conditions ? '\n\n' : '') + additionalConditions;
            }
            
            if (!theme || !baseConditions || !submissionEndDate || !votingEndDate) {
              alert('‚ö†Ô∏è –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –∑–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–æ–ª—è');
              return;
            }
            
            // –í–∞–ª–∏–¥–∞—Ü–∏—è –≤—Ä–µ–º–µ–Ω–∏: –º–∏–Ω–∏–º—É–º 10 –º–∏–Ω—É—Ç –º–µ–∂–¥—É –æ–∫–æ–Ω—á–∞–Ω–∏–µ–º –ø—Ä–∏–µ–º–∞ –∏ –æ–∫–æ–Ω—á–∞–Ω–∏–µ–º –≥–æ–ª–æ—Å–æ–≤–∞–Ω–∏—è
            const submissionEnd = new Date(submissionEndDate);
            const votingEnd = new Date(votingEndDate);
            const timeDiff = (votingEnd - submissionEnd) / 1000 / 60;
            
            if (timeDiff < 10) {
              alert('‚ö†Ô∏è –ú–µ–∂–¥—É –æ–∫–æ–Ω—á–∞–Ω–∏–µ–º –ø—Ä–∏–µ–º–∞ —Ä–∞–±–æ—Ç –∏ –æ–∫–æ–Ω—á–∞–Ω–∏–µ–º –≥–æ–ª–æ—Å–æ–≤–∞–Ω–∏—è –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –º–∏–Ω–∏–º—É–º 10 –º–∏–Ω—É—Ç');
              return;
            }
            
            if (submissionEnd >= votingEnd) {
              alert('‚ö†Ô∏è –î–∞—Ç–∞ –æ–∫–æ–Ω—á–∞–Ω–∏—è –ø—Ä–∏–µ–º–∞ —Ä–∞–±–æ—Ç –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å —Ä–∞–Ω—å—à–µ –¥–∞—Ç—ã –æ–∫–æ–Ω—á–∞–Ω–∏—è –≥–æ–ª–æ—Å–æ–≤–∞–Ω–∏—è');
              return;
            }
            
            // –§–æ—Ä–º–∏—Ä—É–µ–º –Ω–∞–∑–≤–∞–Ω–∏–µ –∫–æ–Ω–∫—É—Ä—Å–∞
            const contestTitle = `–ö–æ–Ω–∫—É—Ä—Å –∫–æ–ª–ª–µ–∫—Ü–∏–π: ${theme}`;
            
            try {
              const now = new Date();
              const mskTimeString = now.toLocaleString('sv-SE', { timeZone: 'Europe/Moscow' }).slice(0, 16).replace(' ', 'T');
              
              const payload = {
                title: contestTitle,
                name: contestTitle,
                conditions: conditions,
                prize: '',
                start_at: mskTimeString,
                end_at: votingEndDate,
                submission_end_date: submissionEndDate,
                winners_count: winnersCount,
                created_by: currentUserId,
                contest_type: 'collection'
              };
              
              const response = await fetchJSON(`/api/contests/${currentEditContestId}`, {
                method: 'PUT',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(payload)
              });
              
              if (response.success) {
                alert('‚úÖ –ö–æ–Ω–∫—É—Ä—Å —É—Å–ø–µ—à–Ω–æ –æ–±–Ω–æ–≤–ª–µ–Ω!');
                closeModal(collectionContestModal);
                
                // –°–±—Ä–∞—Å—ã–≤–∞–µ–º —Ä–µ–∂–∏–º —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
                currentEditContestId = null;
                const submitBtn = document.getElementById('submit-collection-contest');
                const updateBtn = document.getElementById('update-collection-contest');
                if (submitBtn) submitBtn.classList.remove('hidden');
                if (updateBtn) updateBtn.classList.add('hidden');
                const modalTitle = document.getElementById('collection-contest-modal-title');
                if (modalTitle) modalTitle.textContent = '–°–æ–∑–¥–∞—Ç—å –∫–æ–Ω–∫—É—Ä—Å –∫–æ–ª–ª–µ–∫—Ü–∏–π';
                
                if (typeof loadContests === 'function') await loadContests();
              } else {
                alert('‚ö†Ô∏è –û—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ –∫–æ–Ω–∫—É—Ä—Å–∞: ' + (response.message || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞'));
              }
            } catch (e) {
              console.error('–û—à–∏–±–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –∫–æ–Ω–∫—É—Ä—Å–∞ –∫–æ–ª–ª–µ–∫—Ü–∏–π:', e);
              alert('‚ö†Ô∏è –û—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ –∫–æ–Ω–∫—É—Ä—Å–∞: ' + (e.message || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞'));
            }
          });
        }
        
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –¥–ª—è –∞–¥–º–∏–Ω–æ–≤
        adminsList = document.getElementById('admins-list');
        const openAddAdmin = document.getElementById('open-add-admin');
        const adminModal = document.getElementById('admin-modal');
        const closeAdminModal = document.getElementById('close-admin-modal');
        const submitAdmin = document.getElementById('submit-admin');
        
        if (openAddAdmin && adminModal) {
          openAddAdmin.addEventListener('click', () => openModal(adminModal));
          openAddAdmin.style.pointerEvents = 'auto';
          openAddAdmin.style.cursor = 'pointer';
        }
        if (closeAdminModal && adminModal) {
          closeAdminModal.addEventListener('click', () => closeModal(adminModal));
        }
        if (submitAdmin) {
          submitAdmin.addEventListener('click', async () => {
            const adminIdStr = document.getElementById('modal-admin-id')?.value.trim();
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ ID –∑–∞–ø–æ–ª–Ω–µ–Ω
            if (!adminIdStr) {
              alert('‚ö†Ô∏è –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤–≤–µ–¥–∏—Ç–µ ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è');
              return;
            }
            
            // –ü—Ä–µ–æ–±—Ä–∞–∑—É–µ–º ID –≤ —á–∏—Å–ª–æ
            let adminId;
            try {
              adminId = parseInt(adminIdStr);
              if (isNaN(adminId) || adminId <= 0) {
                throw new Error('–ù–µ–≤–µ—Ä–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç ID');
              }
            } catch (e) {
              alert('‚ö†Ô∏è ID –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –ø–æ–ª–æ–∂–∏—Ç–µ–ª—å–Ω—ã–º —á–∏—Å–ª–æ–º');
              return;
            }
            
            const payload = {
              id: adminId,
              username: document.getElementById('modal-admin-username')?.value.trim() || '',
              channel_link: document.getElementById('modal-admin-channel')?.value.trim() || '',
              chat_link: document.getElementById('modal-admin-chat')?.value.trim() || ''
            };
            
            try {
              await fetchJSON('/api/admins', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(payload)
              });
              closeModal(adminModal);
              // –û—á–∏—â–∞–µ–º —Ñ–æ—Ä–º—É
              document.getElementById('modal-admin-id').value = '';
              document.getElementById('modal-admin-username').value = '';
              document.getElementById('modal-admin-channel').value = '';
              document.getElementById('modal-admin-chat').value = '';
              if (typeof loadAdmins === 'function') await loadAdmins();
              showSection('admins-section');
            } catch (e) {
              let errorMessage = '–û—à–∏–±–∫–∞ –ø—Ä–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–∏ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞';
              try {
                const errorResponse = await e.response?.json();
                if (errorResponse?.detail) {
                  errorMessage = errorResponse.detail;
                }
              } catch (parseError) {
                // –ï—Å–ª–∏ –Ω–µ —É–¥–∞–ª–æ—Å—å —Ä–∞—Å–ø–∞—Ä—Å–∏—Ç—å –æ—à–∏–±–∫—É, –∏—Å–ø–æ–ª—å–∑—É–µ–º —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ
              }
              alert(`‚ö†Ô∏è ${errorMessage}`);
              closeModal(adminModal);
              if (typeof loadAdmins === 'function') await loadAdmins();
            }
          });
        }
        
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –¥–ª—è —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
        editContestModal = document.getElementById('edit-contest-modal');
        const closeEditContestModal = document.getElementById('close-edit-contest-modal');
        updateContest = document.getElementById('update-contest');
        editAdminModal = document.getElementById('edit-admin-modal');
        const closeEditAdminModal = document.getElementById('close-edit-admin-modal');
        updateAdmin = document.getElementById('update-admin');
        
        if (closeEditContestModal && editContestModal) {
          closeEditContestModal.addEventListener('click', () => closeModal(editContestModal));
        }
        if (closeEditAdminModal && editAdminModal) {
          closeEditAdminModal.addEventListener('click', () => closeModal(editAdminModal));
        }
        
        // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –¥–ª—è –∫–Ω–æ–ø–æ–∫ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è
        if (updateContest) {
          updateContest.addEventListener('click', async () => {
            if (!currentEditContestId) return;
            
            const postLink = document.getElementById('edit-contest-post-link')?.value.trim();
            
            // –í–∞–ª–∏–¥–∞—Ü–∏—è —Å—Å—ã–ª–∫–∏ –Ω–∞ –ø–æ—Å—Ç Telegram (—Ç–æ–ª—å–∫–æ –¥–ª—è —Ä–∞–Ω–¥–æ–º –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤)
            // –î–ª—è –∫–æ–Ω–∫—É—Ä—Å–æ–≤ —Ä–∏—Å—É–Ω–∫–æ–≤ post_link –Ω–µ —Ç—Ä–µ–±—É–µ—Ç—Å—è
            if (postLink && !/^https?:\/\/t\.me\/[a-zA-Z0-9_]+\/\d+$/.test(postLink)) {
              alert('‚ö†Ô∏è –ù–µ–≤–µ—Ä–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç —Å—Å—ã–ª–∫–∏ –Ω–∞ –ø–æ—Å—Ç!\n\n–ü—Ä–∏–º–µ—Ä –ø—Ä–∞–≤–∏–ª—å–Ω–æ–π —Å—Å—ã–ª–∫–∏:\nhttps://t.me/monkeys_giveaways/25');
              return;
            }
            
            // –î–ª—è —Ä–∞–Ω–¥–æ–º –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤ –Ω–µ –æ—Ç–ø—Ä–∞–≤–ª—è–µ–º –ø–æ–ª–µ prize (–ø—Ä–∏–∑—ã –¥–æ–±–∞–≤–ª—è—é—Ç—Å—è —á–µ—Ä–µ–∑ –º–æ–¥–∞–ª–∫—É –ø—Ä–∏–∑–æ–≤)
            const payload = {
              title: document.getElementById('edit-contest-title')?.value.trim() || '',
              post_link: postLink || '',
              conditions: document.getElementById('edit-contest-conditions')?.value.trim() || '',
              // prize –Ω–µ –æ—Ç–ø—Ä–∞–≤–ª—è–µ–º –¥–ª—è —Ä–∞–Ω–¥–æ–º –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤
              start_at: document.getElementById('edit-contest-start')?.value || '',
              end_at: document.getElementById('edit-contest-end')?.value || '',
              current_user_id: currentUserId
            };
            try {
              await fetchJSON(`/api/contests/${currentEditContestId}`, {
                method: 'PUT',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(payload)
              });
              closeModal(editContestModal);
              if (typeof loadContests === 'function') await loadContests();
            } catch (e) {
              console.error('–û—à–∏–±–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –∫–æ–Ω–∫—É—Ä—Å–∞:', e);
              alert('‚ö†Ô∏è –û—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ –∫–æ–Ω–∫—É—Ä—Å–∞: ' + (e.message || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞'));
            }
          });
        }
        
        if (updateAdmin) {
          updateAdmin.addEventListener('click', async () => {
            if (!currentEditAdminId) return;
            const payload = {
              channel_link: document.getElementById('edit-modal-admin-channel')?.value.trim() || '',
              chat_link: document.getElementById('edit-modal-admin-chat')?.value.trim() || ''
            };
            try {
              await fetchJSON(`/api/admins/${currentEditAdminId}`, {
                method: 'PUT',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(payload)
              });
              closeModal(editAdminModal);
              if (typeof loadAdmins === 'function') await loadAdmins();
            } catch (e) {
              console.error('–û—à–∏–±–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –∞–¥–º–∏–Ω–∞:', e);
              alert('‚ö†Ô∏è –û—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞: ' + (e.message || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞'));
            }
          });
        }
        
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –¥–ª—è –º–æ–¥–∞–ª–æ–∫ –ø—Ä–∏–∑–æ–≤
        const prizesModal = document.getElementById('prizes-modal');
        const closePrizesModal = document.getElementById('close-prizes-modal');
        const addPrizeBtn = document.getElementById('add-prize-btn');
        const submitPrizesBtn = document.getElementById('submit-prizes');
        const prizesList = document.getElementById('prizes-list');
        
        if (closePrizesModal && prizesModal) {
          closePrizesModal.addEventListener('click', () => closeModal(prizesModal));
        }
        
        if (addPrizeBtn && prizesList) {
          addPrizeBtn.addEventListener('click', () => {
            const currentCount = prizesList.querySelectorAll('.prize-input').length;
            addPrizeInput(currentCount + 1);
          });
        }
        
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –¥–ª—è —Å–æ–æ–±—â–µ–Ω–∏–π
        const messagesBtn = document.getElementById('messages-btn');
        const messagesModal = document.getElementById('messages-modal');
        const closeMessagesModal = document.getElementById('close-messages-modal');
        
        if (messagesBtn && messagesModal) {
          messagesBtn.addEventListener('click', () => {
            openModal(messagesModal);
            if (typeof loadMessages === 'function') loadMessages();
          });
          messagesBtn.style.pointerEvents = 'auto';
          messagesBtn.style.cursor = 'pointer';
        }
        
        if (closeMessagesModal && messagesModal) {
          closeMessagesModal.addEventListener('click', () => closeModal(messagesModal));
        }
        
        // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –¥–ª—è –∫–Ω–æ–ø–æ–∫ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –ø–æ–±–µ–¥–∏—Ç–µ–ª–µ–π
        setupWinnersCountHandlers();
        
        // –ó–∞–≥—Ä—É–∂–∞–µ–º –¥–∞–Ω–Ω—ã–µ –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ
        setTimeout(() => {
          try {
            console.log('üì• –ù–∞—á–∏–Ω–∞–µ–º –∑–∞–≥—Ä—É–∑–∫—É –¥–∞–Ω–Ω—ã—Ö...');
            if (typeof loadContests === 'function') loadContests();
            if (typeof loadAdmins === 'function') loadAdmins();
            if (typeof loadProfile === 'function') loadProfile();
          } catch (error) {
            console.error('‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ –¥–∞–Ω–Ω—ã—Ö:', error);
          }
        }, 200);
        
        // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —É–±—Ä–∞–Ω–æ - –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç —Ç–æ–ª—å–∫–æ –ø—Ä–∏ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã—Ö –¥–µ–π—Å—Ç–≤–∏—è—Ö
      }
      
      // –ó–∞–ø—É—Å–∫–∞–µ–º –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—é
      if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', init);
      } else {
        // DOM —É–∂–µ –∑–∞–≥—Ä—É–∂–µ–Ω, –∑–∞–ø—É—Å–∫–∞–µ–º —Å—Ä–∞–∑—É
        init();
      }
      
      // –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–π fallback - —Å–∫—Ä—ã–≤–∞–µ–º —Å–ø–∏–Ω–Ω–µ—Ä —á–µ—Ä–µ–∑ 500ms –≤ –ª—é–±–æ–º —Å–ª—É—á–∞–µ
      setTimeout(() => {
        if (spinner && spinner.style.display !== 'none') {
          console.warn('‚ö†Ô∏è Fallback: –ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ —Å–∫—Ä—ã–≤–∞–µ–º —Å–ø–∏–Ω–Ω–µ—Ä');
          hideSpinnerAndShowPanel();
        }
      }, 500);

      // Contests - –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –±—É–¥—É—Ç –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω—ã –≤ init()
      let contestList, openContestBtn, contestModal, closeContestModal, submitContest;
      
      // –ì–ª–æ–±–∞–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –¥–ª—è –∑–∞—â–∏—Ç—ã –±–∞–∑–æ–≤—ã—Ö —É—Å–ª–æ–≤–∏–π –∫–æ–Ω–∫—É—Ä—Å–∞ —Ä–∏—Å—É–Ω–∫–æ–≤
      let originalBaseValue = ''; // –ó–∞—â–∏—â–µ–Ω–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ –±–∞–∑–æ–≤—ã—Ö —É—Å–ª–æ–≤–∏–π
      let protectionHandlers = {}; // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –∑–∞—â–∏—Ç—ã
      let adminsList; // –û–±—ä—è–≤–ª—è–µ–º adminsList –Ω–∞ –≤–µ—Ä—Ö–Ω–µ–º —É—Ä–æ–≤–Ω–µ –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –≤ loadAdmins
      let editContestModal, editAdminModal; // –ú–æ–¥–∞–ª–∫–∏ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –¥–æ—Å—Ç—É–ø–Ω—ã –≥–ª–æ–±–∞–ª—å–Ω–æ

      function openModal(el) { 
        if (!el) return;
        el.classList.remove('hidden');
        // –£–±–µ–∂–¥–∞–µ–º—Å—è, —á—Ç–æ –º–æ–¥–∞–ª–∫–∞ –∫–ª–∏–∫–∞–±–µ–ª—å–Ω–∞
        el.style.pointerEvents = 'auto';
        el.style.zIndex = '30';
        // –£–±–µ–∂–¥–∞–µ–º—Å—è, —á—Ç–æ –≤—Å–µ —ç–ª–µ–º–µ–Ω—Ç—ã –≤–Ω—É—Ç—Ä–∏ –º–æ–¥–∞–ª–∫–∏ –∫–ª–∏–∫–∞–±–µ–ª—å–Ω—ã
        const clickableElements = el.querySelectorAll('button, input, textarea, a, select');
        clickableElements.forEach(elem => {
          elem.style.pointerEvents = 'auto';
          elem.style.zIndex = '1';
        });
        // –ë–ª–æ–∫–∏—Ä—É–µ–º —Å–∫—Ä–æ–ª–ª body
        document.body.classList.add('modal-open');
      }
      function closeModal(el) { 
        if (!el) return;
        el.classList.add('hidden');
        // –†–∞–∑–±–ª–æ–∫–∏—Ä—É–µ–º —Å–∫—Ä–æ–ª–ª body
        document.body.classList.remove('modal-open');
      }
      // –î–µ–ª–∞–µ–º —Ñ—É–Ω–∫—Ü–∏—é –≥–ª–æ–±–∞–ª—å–Ω–æ–π –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –≤ onclick
      window.closeModal = closeModal;
      
      // –û–±—ä—è–≤–ª—è–µ–º —Ñ—É–Ω–∫—Ü–∏—é openPrizesModal –∑–∞—Ä–∞–Ω–µ–µ, —á—Ç–æ–±—ã –æ–Ω–∞ –±—ã–ª–∞ –¥–æ—Å—Ç—É–ø–Ω–∞
      let openPrizesModal = null; // –ë—É–¥–µ—Ç –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∞ –ø–æ–∑–∂–µ

      // –ö—Ä—É—Ç–∏–ª–∫–∞ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –ø–æ–±–µ–¥–∏—Ç–µ–ª–µ–π
      const winnersCountValue = document.getElementById('winners-count-value');
      const winnersCountInput = document.getElementById('contest-winners-count');
      const winnersCountDecrease = document.getElementById('winners-count-decrease');
      const winnersCountIncrease = document.getElementById('winners-count-increase');
      
      let currentWinnersCount = 1;
      const minCount = 1;
      const maxCount = 50;
      
      function updateWinnersCount(newValue, direction) {
        // –û–≥—Ä–∞–Ω–∏—á–∏–≤–∞–µ–º –∑–Ω–∞—á–µ–Ω–∏–µ –¥–∏–∞–ø–∞–∑–æ–Ω–æ–º –æ—Ç 1 –¥–æ 50
        if (newValue < minCount) newValue = minCount;
        if (newValue > maxCount) newValue = maxCount;
        
        // –í–ê–ñ–ù–û: –†–∞–∑—Ä–µ—à–∞–µ–º –ª—é–±—ã–µ —á–∏—Å–ª–∞ (–∏ —á–µ—Ç–Ω—ã–µ, –∏ –Ω–µ—á–µ—Ç–Ω—ã–µ) –æ—Ç 1 –¥–æ 50
        // –ù–ï–¢ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–π –Ω–∞ —á–µ—Ç–Ω—ã–µ —á–∏—Å–ª–∞ - –º–æ–∂–Ω–æ –≤—ã–±–∏—Ä–∞—Ç—å 1, 2, 3, 4, 5, 6, 7, 8, 9, 10 –∏ —Ç.–¥.
        
        // –û–±–Ω–æ–≤–ª—è–µ–º –∑–Ω–∞—á–µ–Ω–∏–µ —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –æ–Ω–æ –∏–∑–º–µ–Ω–∏–ª–æ—Å—å
        if (newValue !== currentWinnersCount) {
          currentWinnersCount = newValue;
          
          // –ü–æ–ª—É—á–∞–µ–º —ç–ª–µ–º–µ–Ω—Ç—ã –∑–∞–Ω–æ–≤–æ, —Ç–∞–∫ –∫–∞–∫ –æ–Ω–∏ –º–æ–≥—É—Ç –±—ã—Ç—å –ø–µ—Ä–µ–º–µ—â–µ–Ω—ã
          const winnersCountValueEl = document.getElementById('winners-count-value');
          const winnersCountInputEl = document.getElementById('contest-winners-count');
          
          if (winnersCountValueEl) {
            winnersCountValueEl.classList.remove('number-spin-up', 'number-spin-down');
            void winnersCountValueEl.offsetWidth; // Trigger reflow
            
            if (direction === 'up') {
              winnersCountValueEl.classList.add('number-spin-up');
            } else if (direction === 'down') {
              winnersCountValueEl.classList.add('number-spin-down');
            }
            
            winnersCountValueEl.textContent = currentWinnersCount;
          }
          
          if (winnersCountInputEl) {
            winnersCountInputEl.value = currentWinnersCount;
          }
        }
      }
      
      // –ò—Å–ø–æ–ª—å–∑—É–µ–º –¥–µ–ª–µ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–æ–±—ã—Ç–∏–π –¥–ª—è –∫–Ω–æ–ø–æ–∫ –∏–∑–º–µ–Ω–µ–Ω–∏—è –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –ø–æ–±–µ–¥–∏—Ç–µ–ª–µ–π
      // –≠—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç –¥–∞–∂–µ –µ—Å–ª–∏ —ç–ª–µ–º–µ–Ω—Ç—ã –ø–µ—Ä–µ–º–µ—â–µ–Ω—ã –≤ DOM
      // contestModal —É–∂–µ –æ–±—ä—è–≤–ª–µ–Ω –≤ —Ñ—É–Ω–∫—Ü–∏–∏ init() (—Å—Ç—Ä–æ–∫–∞ 1045)
      // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –ø–æ—Å–ª–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ contestModal
      function setupWinnersCountHandlers() {
        const modal = document.getElementById('contest-modal');
        if (modal) {
          // –£–¥–∞–ª—è–µ–º —Å—Ç–∞—Ä—ã–µ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏, –µ—Å–ª–∏ –æ–Ω–∏ –µ—Å—Ç—å
          modal.removeEventListener('click', handleWinnersCountClick);
          // –î–æ–±–∞–≤–ª—è–µ–º –Ω–æ–≤—ã–π –æ–±—Ä–∞–±–æ—Ç—á–∏–∫
          modal.addEventListener('click', handleWinnersCountClick);
        }
      }
      
      // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–ª–∏–∫–∞ –¥–ª—è –∏–∑–º–µ–Ω–µ–Ω–∏—è –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –ø–æ–±–µ–¥–∏—Ç–µ–ª–µ–π
      function handleWinnersCountClick(e) {
        // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –±—ã–ª–∞ –ª–∏ –Ω–∞–∂–∞—Ç–∞ –∫–Ω–æ–ø–∫–∞ —É–º–µ–Ω—å—à–µ–Ω–∏—è
        if (e.target && (e.target.id === 'winners-count-decrease' || e.target.closest('#winners-count-decrease'))) {
          e.preventDefault();
          e.stopPropagation();
          // –£–º–µ–Ω—å—à–∞–µ–º –Ω–∞ 1 - —Ä–∞–∑—Ä–µ—à–∞–µ–º –ª—é–±—ã–µ —á–∏—Å–ª–∞ (—á–µ—Ç–Ω—ã–µ –∏ –Ω–µ—á–µ—Ç–Ω—ã–µ)
          updateWinnersCount(currentWinnersCount - 1, 'down');
        }
        // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –±—ã–ª–∞ –ª–∏ –Ω–∞–∂–∞—Ç–∞ –∫–Ω–æ–ø–∫–∞ —É–≤–µ–ª–∏—á–µ–Ω–∏—è
        if (e.target && (e.target.id === 'winners-count-increase' || e.target.closest('#winners-count-increase'))) {
          e.preventDefault();
          e.stopPropagation();
          // –£–≤–µ–ª–∏—á–∏–≤–∞–µ–º –Ω–∞ 1 - —Ä–∞–∑—Ä–µ—à–∞–µ–º –ª—é–±—ã–µ —á–∏—Å–ª–∞ (—á–µ—Ç–Ω—ã–µ –∏ –Ω–µ—á–µ—Ç–Ω—ã–µ)
          updateWinnersCount(currentWinnersCount + 1, 'up');
        }
      }
      
      // –ù–ï –¥–æ–±–∞–≤–ª—è–µ–º –ø—Ä—è–º—ã–µ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏, —á—Ç–æ–±—ã –∏–∑–±–µ–∂–∞—Ç—å –¥–≤–æ–π–Ω–æ–≥–æ –≤—ã–∑–æ–≤–∞
      // –ò—Å–ø–æ–ª—å–∑—É–µ–º —Ç–æ–ª—å–∫–æ –¥–µ–ª–µ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–æ–±—ã—Ç–∏–π —á–µ—Ä–µ–∑ setupWinnersCountHandlers
      
      // –°–±—Ä–æ—Å –∑–Ω–∞—á–µ–Ω–∏—è –ø—Ä–∏ –æ—Ç–∫—Ä—ã—Ç–∏–∏ –º–æ–¥–∞–ª–∫–∏
      if (openContestBtn) {
        const originalHandler = openContestBtn.onclick;
        openContestBtn.addEventListener('click', () => {
          updateWinnersCount(1, 'up');
        }, { once: false });
      }

      // Long press handlers
      let longPressTimer = null;
      let currentDeleteTarget = null;
      let deleteType = null; // 'contest' or 'admin'

      function setupLongPress(element, itemId, type, itemName) {
        let longPressTimer = null;

        const startLongPress = (e) => {
          // –ó–∞–ø—É—Å–∫–∞–µ–º —Ç–∞–π–º–µ—Ä –Ω–∞ –¥–æ–ª–≥–æ–µ –Ω–∞–∂–∞—Ç–∏–µ (1 —Å–µ–∫—É–Ω–¥–∞)
          longPressTimer = setTimeout(() => {
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è —Å—Ä–∞–∑—É
            showDeleteConfirm(itemId, type, itemName);
            longPressTimer = null;
          }, 1000); // 1 —Å–µ–∫—É–Ω–¥–∞ –¥–ª—è long press
        };

        const cancelLongPress = () => {
          if (longPressTimer) {
            clearTimeout(longPressTimer);
            longPressTimer = null;
          }
        };

        const handleRelease = (e) => {
          cancelLongPress();
        };

        // –î–≤–æ–π–Ω–æ–π –∫–ª–∏–∫ –¥–ª—è —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è - –∏—Å–ø–æ–ª—å–∑—É–µ–º –Ω–∞—Ç–∏–≤–Ω–æ–µ —Å–æ–±—ã—Ç–∏–µ
        const handleDoubleClick = (e) => {
          e.preventDefault();
          e.stopPropagation();
          cancelLongPress(); // –û—Ç–º–µ–Ω—è–µ–º long press –µ—Å–ª–∏ –æ–Ω –∞–∫—Ç–∏–≤–µ–Ω
          console.log('üîò –î–≤–æ–π–Ω–æ–π –∫–ª–∏–∫ –ø–æ —ç–ª–µ–º–µ–Ω—Ç—É, —Ç–∏–ø:', type, 'ID:', itemId);
          if (type === 'contest') {
            if (window.openEditContestModal) {
              window.openEditContestModal(itemId);
            } else {
              console.error('‚ùå –§—É–Ω–∫—Ü–∏—è openEditContestModal –Ω–µ –Ω–∞–π–¥–µ–Ω–∞!');
              alert('‚ö†Ô∏è –§—É–Ω–∫—Ü–∏—è —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –∫–æ–Ω–∫—É—Ä—Å–∞ –Ω–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–∞');
            }
          } else if (type === 'admin') {
            if (window.openEditAdminModal) {
              window.openEditAdminModal(itemId);
            } else {
              console.error('‚ùå –§—É–Ω–∫—Ü–∏—è openEditAdminModal –Ω–µ –Ω–∞–π–¥–µ–Ω–∞!');
              alert('‚ö†Ô∏è –§—É–Ω–∫—Ü–∏—è —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –∞–¥–º–∏–Ω–∞ –Ω–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–∞');
            }
          }
        };

        // –î–ª—è touch —É—Å—Ç—Ä–æ–π—Å—Ç–≤ - –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º –¥–≤–æ–π–Ω–æ–µ –Ω–∞–∂–∞—Ç–∏–µ
        let lastTapTime = 0;
        const handleTouchEnd = (e) => {
          const currentTime = Date.now();
          const tapLength = currentTime - lastTapTime;
          if (tapLength < 300 && tapLength > 0) {
            // –≠—Ç–æ –¥–≤–æ–π–Ω–æ–µ –Ω–∞–∂–∞—Ç–∏–µ
            e.preventDefault();
            cancelLongPress();
            console.log('üîò –î–≤–æ–π–Ω–æ–µ –Ω–∞–∂–∞—Ç–∏–µ –Ω–∞ touch —É—Å—Ç—Ä–æ–π—Å—Ç–≤–µ, —Ç–∏–ø:', type, 'ID:', itemId);
            if (type === 'contest') {
              if (window.openEditContestModal) {
                window.openEditContestModal(itemId);
              } else {
                console.error('‚ùå –§—É–Ω–∫—Ü–∏—è openEditContestModal –Ω–µ –Ω–∞–π–¥–µ–Ω–∞!');
                alert('‚ö†Ô∏è –§—É–Ω–∫—Ü–∏—è —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –∫–æ–Ω–∫—É—Ä—Å–∞ –Ω–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–∞');
              }
            } else if (type === 'admin') {
              if (window.openEditAdminModal) {
                window.openEditAdminModal(itemId);
              } else {
                console.error('‚ùå –§—É–Ω–∫—Ü–∏—è openEditAdminModal –Ω–µ –Ω–∞–π–¥–µ–Ω–∞!');
                alert('‚ö†Ô∏è –§—É–Ω–∫—Ü–∏—è —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –∞–¥–º–∏–Ω–∞ –Ω–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–∞');
              }
            }
          }
          lastTapTime = currentTime;
        };

        // Touch events
        element.addEventListener('touchstart', startLongPress, { passive: true });
        element.addEventListener('touchend', (e) => {
          handleRelease(e);
          handleTouchEnd(e);
        });
        element.addEventListener('touchcancel', handleRelease);

        // Mouse events
        element.addEventListener('mousedown', startLongPress);
        element.addEventListener('mouseup', handleRelease);
        element.addEventListener('mouseleave', handleRelease);
        // –ù–∞—Ç–∏–≤–Ω—ã–π –¥–≤–æ–π–Ω–æ–π –∫–ª–∏–∫ - —Ä–∞–±–æ—Ç–∞–µ—Ç –ª—É—á—à–µ —á–µ–º –∫–∞—Å—Ç–æ–º–Ω–∞—è –ª–æ–≥–∏–∫–∞
        element.addEventListener('dblclick', handleDoubleClick);
      }

      function resetDeleteState(element) {
        if (element) {
          element.classList.remove('deleting-mode', 'show-delete');
        }
        main.classList.remove('backdrop-blur-active');
        currentDeleteTarget = null;
        deleteType = null;
      }

      function triggerEvaporation(element) {
        if (!element) return;
        
        // –î–æ–±–∞–≤–ª—è–µ–º –∫–ª–∞—Å—Å –¥–ª—è –∏—Å–ø–∞—Ä–µ–Ω–∏—è –∫—Ä–∞—Å–Ω—ã–º —Ü–≤–µ—Ç–æ–º
        element.classList.add('evaporating-item', 'evaporating-now');
      }

      function showDeleteConfirm(itemId, type, itemName) {
        const modal = document.getElementById('delete-confirm-modal');
        const text = document.getElementById('delete-confirm-text');
        const cancelBtn = document.getElementById('delete-confirm-cancel');
        const okBtn = document.getElementById('delete-confirm-ok');

        const itemType = type === 'contest' ? '–∫–æ–Ω–∫—É—Ä—Å' : '–∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞';
        text.textContent = `–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å ${itemType} "${itemName}"?`;

        const cleanup = () => {
          modal.classList.add('hidden');
          cancelBtn.onclick = null;
          okBtn.onclick = null;
        };

        cancelBtn.onclick = cleanup; // –ü—Ä–∏ –æ—Ç–º–µ–Ω–µ –ø—Ä–æ—Å—Ç–æ –∑–∞–∫—Ä—ã–≤–∞–µ–º –æ–∫–Ω–æ
        okBtn.onclick = async () => {
          // –ó–∞–∫—Ä—ã–≤–∞–µ–º –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ —Å—Ä–∞–∑—É
          cleanup();
          
          // –ù–∞—Ö–æ–¥–∏–º —ç–ª–µ–º–µ–Ω—Ç –¥–ª—è —É–¥–∞–ª–µ–Ω–∏—è
          const targetElement = type === 'contest' 
            ? document.querySelector(`[data-contest-id="${itemId}"]`)
            : document.querySelector(`[data-admin-id="${itemId}"]`);
          
          // –°–Ω–∞—á–∞–ª–∞ –ø—Ä–æ–≤–µ—Ä—è–µ–º –ø—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞ - –ø—ã—Ç–∞–µ–º—Å—è —É–¥–∞–ª–∏—Ç—å
          try {
            if (type === 'contest') {
              // –ü—Ä–æ–±—É–µ–º —É–¥–∞–ª–∏—Ç—å –∫–æ–Ω–∫—É—Ä—Å (–ø—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∞–≤ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ)
              await fetchJSON(`/api/contests/${itemId}?current_user_id=${currentUserId}`, { method: 'DELETE' });
            } else {
              // –£–¥–∞–ª—è–µ–º –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞
              await fetchJSON(`/api/admins/${itemId}`, { method: 'DELETE' });
            }
            
            // –ï—Å–ª–∏ —É–¥–∞–ª–µ–Ω–∏–µ —É—Å–ø–µ—à–Ω–æ - –∑–∞–ø—É—Å–∫–∞–µ–º –∞–Ω–∏–º–∞—Ü–∏—é
            if (targetElement) {
              // –ó–∞–ø—É—Å–∫–∞–µ–º –∞–Ω–∏–º–∞—Ü–∏—é –∏—Å–ø–∞—Ä–µ–Ω–∏—è –∫—Ä–∞—Å–Ω—ã–º —Ü–≤–µ—Ç–æ–º
              triggerEvaporation(targetElement);
              
              // –û–±–Ω–æ–≤–ª—è–µ–º —Å–ø–∏—Å–æ–∫ –ø–æ—Å–ª–µ –∞–Ω–∏–º–∞—Ü–∏–∏
              setTimeout(async () => {
                if (type === 'contest') {
                  await loadContests();
                } else {
                  await loadAdmins();
                }
              }, 1500); // –í—Ä–µ–º—è –∞–Ω–∏–º–∞—Ü–∏–∏ –∏—Å–ø–∞—Ä–µ–Ω–∏—è
            } else {
              // –ï—Å–ª–∏ —ç–ª–µ–º–µ–Ω—Ç –Ω–µ –Ω–∞–π–¥–µ–Ω, –ø—Ä–æ—Å—Ç–æ –æ–±–Ω–æ–≤–ª—è–µ–º —Å–ø–∏—Å–æ–∫
              if (type === 'contest') {
                await loadContests();
              } else {
                await loadAdmins();
              }
            }
          } catch (e) {
            // –ï—Å–ª–∏ –æ—à–∏–±–∫–∞ - –ø–æ–∫–∞–∑—ã–≤–∞–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ –±–µ–∑ –∞–Ω–∏–º–∞—Ü–∏–∏
            let errorMessage = '–û—à–∏–±–∫–∞ –ø—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏';
            if (e.message) {
              errorMessage = e.message;
            } else if (e.response) {
              try {
                const errorData = await e.response.clone().json();
                errorMessage = errorData.detail || errorData.message || errorMessage;
              } catch {
                errorMessage = e.message || errorMessage;
              }
            }
            alert('‚ùå ' + errorMessage);
          }
        };

        modal.classList.remove('hidden');
      }

      async function loadContests(showLoading = true) {
        try {
          // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä –∑–∞–≥—Ä—É–∑–∫–∏ —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ —è–≤–Ω–æ –∑–∞–ø—Ä–æ—à–µ–Ω–æ
          if (contestList && showLoading) {
            // –°–æ—Ö—Ä–∞–Ω—è–µ–º —Ç–µ–∫—É—â–µ–µ —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ, —á—Ç–æ–±—ã –Ω–µ –±—ã–ª–æ –º–µ—Ä—Ü–∞–Ω–∏—è
            const currentContent = contestList.innerHTML;
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ —Å–ø–∏—Å–æ–∫ –ø—É—Å—Ç –∏–ª–∏ —ç—Ç–æ –ø–µ—Ä–≤–∞—è –∑–∞–≥—Ä—É–∑–∫–∞
            if (!currentContent || currentContent.trim() === '') {
              contestList.innerHTML = '<div class="text-gray-400 text-center py-4">‚è≥ –ó–∞–≥—Ä—É–∑–∫–∞ –∫–æ–Ω–∫—É—Ä—Å–æ–≤...</div>';
            }
          }
          
          const items = await fetchJSON('/api/contests');
          
          if (!contestList) {
            console.error('contestList –Ω–µ –Ω–∞–π–¥–µ–Ω');
            return;
          }
          
          // –û—á–∏—â–∞–µ–º —Å–ø–∏—Å–æ–∫ —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –µ—Å—Ç—å –Ω–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ
          contestList.innerHTML = '';
          
          if (items.length === 0) {
            contestList.innerHTML = '<div class="text-gray-500 text-center py-4">–ù–µ—Ç –∞–∫—Ç–∏–≤–Ω—ã—Ö –∫–æ–Ω–∫—É—Ä—Å–æ–≤</div>';
            return;
          }
          
          // –ó–∞–≥—Ä—É–∂–∞–µ–º –ø–æ–±–µ–¥–∏—Ç–µ–ª–µ–π –¥–ª—è –≤—Å–µ—Ö –∫–æ–Ω–∫—É—Ä—Å–æ–≤ –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ
          const winnersPromises = items.map(c => 
            fetchJSON(`/api/contests/${c.id}/winners`).catch(e => {
              console.error(`–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –ø–æ–±–µ–¥–∏—Ç–µ–ª–µ–π –¥–ª—è –∫–æ–Ω–∫—É—Ä—Å–∞ ${c.id}:`, e);
              return { winners: [], is_confirmed: false };
            })
          );
          const winnersResults = await Promise.all(winnersPromises);
          
          // –°–æ–∑–¥–∞–µ–º –∫–∞—Ä—Ç–æ—á–∫–∏ –∫–æ–Ω–∫—É—Ä—Å–æ–≤
          if (!contestList) {
            console.error('contestList –Ω–µ –Ω–∞–π–¥–µ–Ω');
            return;
          }
          
          for (let i = 0; i < items.length; i++) {
            const c = items[i];
            const winnersData = winnersResults[i];
            
            const card = document.createElement('div');
            card.className = 'deletable-item rounded-lg border border-violet-400/30 p-3 bg-black/30';
            card.dataset.contestId = c.id;
            
            const startSource = c.start_at_local || c.start_at;
            const endSource = c.end_at_local || c.end_at;
            const period = (startSource || endSource)
              ? `<div class="text-xs text-gray-400 mt-1">${startSource ? '–°—Ç–∞—Ä—Ç: ' + toMoscowDateTime(startSource) : ''} ${endSource ? ' ¬∑ –ö–æ–Ω–µ—Ü: ' + toMoscowDateTime(endSource) : ''}</div>`
              : '';
            
            const postLink = c.post_link 
              ? `<div class="mt-2 pt-2 border-t border-violet-400/20">
                   <div class="text-xs text-gray-500 mb-1">üîó –ß–∞—Å—Ç—å 1: –°—Å—ã–ª–∫–∞ –Ω–∞ –ø–æ—Å—Ç</div>
                   <a href="${c.post_link}" target="_blank" class="text-blue-400 hover:underline text-sm break-all">${c.post_link}</a>
                 </div>` 
              : '';
            
            const conditions = c.conditions 
              ? `<div class="mt-2 pt-2 border-t border-violet-400/20">
                   <div class="text-xs text-gray-500 mb-1">üìã –ß–∞—Å—Ç—å 2: –£—Å–ª–æ–≤–∏—è —É—á–∞—Å—Ç–∏—è</div>
                   <div class="text-sm text-gray-300">${c.conditions}</div>
                 </div>` 
              : '';
            
            // –ü–æ–ª—É—á–∞–µ–º –Ω–∞–∑–≤–∞–Ω–∏–µ –∫–æ–Ω–∫—É—Ä—Å–∞
            const contestTitle = c.title || c.name || '–ö–æ–Ω–∫—É—Ä—Å';
            
            // –û—Ç–æ–±—Ä–∞–∂–∞–µ–º –ø—Ä–∏–∑—ã (–º–∞–∫—Å–∏–º—É–º 3, –Ω–æ –µ—Å–ª–∏ –º–µ–Ω—å—à–µ - –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –≤—Å–µ)
            let prizesHtml = '';
            if (c.prize_links && Array.isArray(c.prize_links) && c.prize_links.length > 0) {
              // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –º–∞–∫—Å–∏–º—É–º 3 –ø—Ä–∏–∑–∞ (–∑–∞ –ø–µ—Ä–≤—ã–µ 3 –º–µ—Å—Ç–∞)
              const prizesToShow = c.prize_links.slice(0, Math.min(3, c.prize_links.length));
              
              // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏–∏ —Å—Å—ã–ª–∫–∏ –Ω–∞ –ø—Ä–∏–∑
              function normalizePrizeLink(link) {
                if (!link) return '';
                link = link.trim();
                if (link.startsWith('http://') || link.startsWith('https://')) {
                  return link;
                }
                if (link.startsWith('t.me/')) {
                  return 'https://' + link;
                }
                return 'https://' + link;
              }
              
              // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è NFT - –∏—Å–ø–æ–ª—å–∑—É–µ–º img —Å –∑–∞–≥—Ä—É–∑–∫–æ–π —á–µ—Ä–µ–∑ API
              function getNFTImageHtml(link, idx) {
                const normalizedLink = normalizePrizeLink(link);
                // –ò—Å–ø–æ–ª—å–∑—É–µ–º img —Å src, –∫–æ—Ç–æ—Ä—ã–π –±—É–¥–µ—Ç –∑–∞–≥—Ä—É–∂–µ–Ω —á–µ—Ä–µ–∑ API endpoint
                return `
                  <img 
                    src="/api/nft-preview?nft_link=${encodeURIComponent(normalizedLink)}" 
                    alt="–ü—Ä–∏–∑ ${idx + 1}"
                    class="w-full h-full object-cover rounded-lg prize-image"
                    onerror="this.style.display='none'; this.nextElementSibling.classList.remove('hidden');"
                    loading="lazy"
                  />
                `;
              }
              
              // –û–ø—Ä–µ–¥–µ–ª—è–µ–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∫–æ–ª–æ–Ω–æ–∫ –¥–ª—è grid
              const gridCols = prizesToShow.length === 1 ? 'grid-cols-1' : prizesToShow.length === 2 ? 'grid-cols-2' : 'grid-cols-3';
              
              prizesHtml = `
                <div class="mb-4">
                  <div class="grid ${gridCols} gap-3 mb-3">
                    ${prizesToShow.map((prizeLink, idx) => {
                      const normalizedLink = normalizePrizeLink(prizeLink);
                      return `
                      <div class="relative rounded-xl overflow-hidden border-2 border-violet-400/40 bg-gradient-to-br from-violet-600/30 via-pink-600/30 to-purple-600/30 aspect-square group hover:scale-105 transition-transform shadow-lg cursor-pointer">
                        <div class="absolute inset-0 bg-[url('data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTAwIiBoZWlnaHQ9IjEwMCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48ZGVmcz48cGF0dGVybiBpZD0iZ3JpZCIgd2lkdGg9IjIwIiBoZWlnaHQ9IjIwIiBwYXR0ZXJuVW5pdHM9InVzZXJTcGFjZU9uVXNlIj48Y2lyY2xlIGN4PSIxMCIgY3k9IjEwIiByPSIxLjUiIGZpbGw9IiNmZmYiIG9wYWNpdHk9IjAuMSIvPjwvcGF0dGVybj48L2RlZnM+PHJlY3Qgd2lkdGg9IjEwMCIgaGVpZ2h0PSIxMDAiIGZpbGw9InVybCgjZ3JpZCkiLz48L3N2Zz4=')] opacity-20"></div>
                        <a href="${normalizedLink}" target="_blank" class="absolute inset-0 z-10 block">
                          <div class="w-full h-full relative">
                            ${getNFTImageHtml(prizeLink, idx)}
                            <div class="absolute inset-0 flex items-center justify-center bg-black/30 rounded-lg fallback-prize hidden">
                              <div class="text-5xl opacity-70">üéÅ</div>
                            </div>
                          </div>
                        </a>
                        <div class="absolute bottom-0 left-0 right-0 bg-gradient-to-t from-black/90 via-black/70 to-transparent p-2 z-20 pointer-events-none">
                          <div class="text-xs text-white font-semibold text-center">${idx + 1} –º–µ—Å—Ç–æ</div>
                        </div>
                      </div>
                    `;
                    }).join('')}
                  </div>
                  ${c.prize_links.length > 3 ? `<div class="text-xs text-gray-400 text-center">+${c.prize_links.length - 3} –µ—â–µ –ø—Ä–∏–∑–æ–≤</div>` : ''}
                </div>
              `;
            }
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –∑–∞–≤–µ—Ä—à–µ–Ω –ª–∏ –∫–æ–Ω–∫—É—Ä—Å
            // –ü—Ä–∞–≤–∏–ª—å–Ω–æ –ø–∞—Ä—Å–∏–º –¥–∞—Ç—É –æ–∫–æ–Ω—á–∞–Ω–∏—è —Å —É—á–µ—Ç–æ–º timezone
            let isEnded = false;
            if (c.end_at) {
              try {
                const endDate = new Date(c.end_at);
                const now = new Date();
                isEnded = endDate < now;
                console.log(`–ö–æ–Ω–∫—É—Ä—Å ${c.id}: end_at=${c.end_at}, parsed=${endDate.toISOString()}, now=${now.toISOString()}, isEnded=${isEnded}`);
              } catch (e) {
                console.error(`–û—à–∏–±–∫–∞ –ø–∞—Ä—Å–∏–Ω–≥–∞ –¥–∞—Ç—ã –æ–∫–æ–Ω—á–∞–Ω–∏—è –¥–ª—è –∫–æ–Ω–∫—É—Ä—Å–∞ ${c.id}:`, e);
              }
            } else {
              isEnded = true;
            }
            
            // –û–ø—Ä–µ–¥–µ–ª—è–µ–º —Ç–∏–ø –∫–æ–Ω–∫—É—Ä—Å–∞
            const contestType = c.contest_type || 'random_comment';
            const isDrawingContest = contestType === 'drawing';
            const isCollectionContest = contestType === 'collection';
            const isRandomCommentContest = contestType === 'random_comment';
            
            // –î–ª—è –∫–æ–Ω–∫—É—Ä—Å–æ–≤ —Ä–∏—Å—É–Ω–∫–æ–≤ –ø—Ä–æ–≤–µ—Ä—è–µ–º —Å—Ç–∞—Ç—É—Å –∏—Ç–æ–≥–æ–≤
            let drawingResultsHtml = '';
            let drawingResultsCalculated = false;
            let drawingIsCreator = false;
            
            // –î–ª—è –∫–æ–Ω–∫—É—Ä—Å–æ–≤ –∫–æ–ª–ª–µ–∫—Ü–∏–π –ø—Ä–æ–≤–µ—Ä—è–µ–º —Å—Ç–∞—Ç—É—Å –∏—Ç–æ–≥–æ–≤
            let collectionResultsHtml = '';
            let collectionResultsCalculated = false;
            let collectionIsCreator = false;
            
            // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –¥–ª—è –≤—Å–µ—Ö –∫–æ–Ω–∫—É—Ä—Å–æ–≤
            if (isDrawingContest) {
              try {
                console.log(`üîç –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞ –∏—Ç–æ–≥–æ–≤ –¥–ª—è –∫–æ–Ω–∫—É—Ä—Å–∞ —Ä–∏—Å—É–Ω–∫–æ–≤ ${c.id}...`);
                const resultsResponse = await fetchJSON(`/api/contests/${c.id}/results`).catch((err) => {
                  console.log(`‚ö†Ô∏è –û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –¥–ª—è –∫–æ–Ω–∫—É—Ä—Å–∞ ${c.id}:`, err);
                  return { results_calculated: false };
                });
                drawingResultsCalculated = resultsResponse?.results_calculated || false;
                const currentUserId = window.Telegram?.WebApp?.initDataUnsafe?.user?.id || window.currentUserId;
                // –ü—Ä–∏–≤–æ–¥–∏–º –æ–±–∞ ID –∫ —á–∏—Å–ª—É –¥–ª—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–≥–æ —Å—Ä–∞–≤–Ω–µ–Ω–∏—è
                const currentUserIdNum = Number(currentUserId);
                const createdByIdNum = c.created_by ? Number(c.created_by) : null;
                drawingIsCreator = createdByIdNum !== null && currentUserIdNum === createdByIdNum;
                
                console.log(`üìä –ö–æ–Ω–∫—É—Ä—Å ${c.id}: isEnded=${isEnded}, resultsCalculated=${drawingResultsCalculated}, isCreator=${drawingIsCreator}, currentUserId=${currentUserIdNum}, created_by=${createdByIdNum} (raw: ${c.created_by}, type: ${typeof c.created_by})`);
                console.log(`üìã –ü–æ–ª–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –∫–æ–Ω–∫—É—Ä—Å–∞ ${c.id}:`, JSON.stringify(c, null, 2));
                
                if (isEnded && !drawingResultsCalculated) {
                  // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∫–Ω–æ–ø–∫—É "–ü–æ–¥—Å—á–µ—Ç –∏—Ç–æ–≥–æ–≤" —Ç–æ–ª—å–∫–æ –¥–ª—è —Å–æ–∑–¥–∞—Ç–µ–ª—è
                  if (drawingIsCreator) {
                    console.log(`‚úÖ –°–æ–∑–¥–∞–µ–º –∫–Ω–æ–ø–∫—É "–ü–æ–¥—Å—á–µ—Ç –∏—Ç–æ–≥–æ–≤" –¥–ª—è –∫–æ–Ω–∫—É—Ä—Å–∞ ${c.id} (isEnded=${isEnded}, isCreator=${drawingIsCreator})`);
                    drawingResultsHtml = `<div class="mt-2 pt-2 border-t border-violet-400/20">
                      <button 
                        class="neon-button w-full py-2 rounded-lg text-sm"
                        id="calculate-results-btn-${c.id}"
                        style="pointer-events: auto; cursor: pointer;"
                      >
                        üìä –ü–æ–¥—Å—á–µ—Ç –∏—Ç–æ–≥–æ–≤
                      </button>
                    </div>`;
                  } else {
                    console.log(`‚ùå –ö–Ω–æ–ø–∫–∞ –Ω–µ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è: –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ —è–≤–ª—è–µ—Ç—Å—è —Å–æ–∑–¥–∞—Ç–µ–ª–µ–º (currentUserId=${currentUserIdNum}, created_by=${createdByIdNum})`);
                  }
                } else if (drawingResultsCalculated) {
                  console.log(`‚úÖ –ò—Ç–æ–≥–∏ —É–∂–µ –ø–æ–¥—Å—á–∏—Ç–∞–Ω—ã, –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –∫–Ω–æ–ø–∫—É "–ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å –∏—Ç–æ–≥–∏"`);
                  // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∫–Ω–æ–ø–∫—É "–ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å –∏—Ç–æ–≥–∏" –¥–ª—è –≤—Å–µ—Ö –ø–æ—Å–ª–µ –ø–æ–¥—Å—á–µ—Ç–∞
                  drawingResultsHtml = `<div class="mt-2 pt-2 border-t border-violet-400/20">
                    <button 
                      onclick="showDrawingResults(${c.id})" 
                      class="neon-button w-full py-2 rounded-lg text-sm"
                      id="view-results-btn-${c.id}"
                    >
                      üèÜ –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å –∏—Ç–æ–≥–∏
                    </button>
                  </div>`;
                } else {
                  console.log(`‚ÑπÔ∏è –ö–æ–Ω–∫—É—Ä—Å ${c.id}: isEnded=${isEnded}, resultsCalculated=${drawingResultsCalculated}, isCreator=${drawingIsCreator}, –∫–Ω–æ–ø–∫–∞ –Ω–µ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è`);
                  if (!isEnded) {
                    console.log(`   ‚è∞ –ö–æ–Ω–∫—É—Ä—Å –µ—â–µ –Ω–µ –∑–∞–≤–µ—Ä—à–µ–Ω (end_at=${c.end_at})`);
                  }
                  if (drawingResultsCalculated) {
                    console.log(`   ‚úÖ –ò—Ç–æ–≥–∏ —É–∂–µ –ø–æ–¥—Å—á–∏—Ç–∞–Ω—ã`);
                  }
                  if (!drawingIsCreator) {
                    console.log(`   üë§ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ —è–≤–ª—è–µ—Ç—Å—è —Å–æ–∑–¥–∞—Ç–µ–ª–µ–º`);
                  }
                }
              } catch (e) {
                console.error('‚ùå –û—à–∏–±–∫–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏ —Å—Ç–∞—Ç—É—Å–∞ –∏—Ç–æ–≥–æ–≤:', e);
              }
            }
            
            // –î–ª—è –∫–æ–Ω–∫—É—Ä—Å–æ–≤ –∫–æ–ª–ª–µ–∫—Ü–∏–π –ø—Ä–æ–≤–µ—Ä—è–µ–º —Å—Ç–∞—Ç—É—Å –∏—Ç–æ–≥–æ–≤
            if (isCollectionContest) {
              try {
                console.log(`üîç –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞ –∏—Ç–æ–≥–æ–≤ –¥–ª—è –∫–æ–Ω–∫—É—Ä—Å–∞ –∫–æ–ª–ª–µ–∫—Ü–∏–π ${c.id}...`);
                const resultsResponse = await fetchJSON(`/api/contests/${c.id}/collection-results`).catch((err) => {
                  console.log(`‚ö†Ô∏è –û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –¥–ª—è –∫–æ–Ω–∫—É—Ä—Å–∞ ${c.id}:`, err);
                  return { results_calculated: false };
                });
                collectionResultsCalculated = resultsResponse?.results_calculated || false;
                const currentUserId = window.Telegram?.WebApp?.initDataUnsafe?.user?.id || window.currentUserId;
                const currentUserIdNum = Number(currentUserId);
                const createdByIdNum = c.created_by ? Number(c.created_by) : null;
                collectionIsCreator = createdByIdNum !== null && currentUserIdNum === createdByIdNum;
                
                console.log(`üìä –ö–æ–Ω–∫—É—Ä—Å –∫–æ–ª–ª–µ–∫—Ü–∏–π ${c.id}: isEnded=${isEnded}, resultsCalculated=${collectionResultsCalculated}, isCreator=${collectionIsCreator}`);
                
                if (isEnded && !collectionResultsCalculated) {
                  if (collectionIsCreator) {
                    console.log(`‚úÖ –°–æ–∑–¥–∞–µ–º –∫–Ω–æ–ø–∫—É "–ü–æ–¥—Å—á–µ—Ç –∏—Ç–æ–≥–æ–≤" –¥–ª—è –∫–æ–Ω–∫—É—Ä—Å–∞ –∫–æ–ª–ª–µ–∫—Ü–∏–π ${c.id}`);
                    collectionResultsHtml = `<div class="mt-2 pt-2 border-t border-violet-400/20">
                      <button 
                        class="neon-button w-full py-2 rounded-lg text-sm"
                        id="calculate-collection-results-btn-${c.id}"
                        style="pointer-events: auto; cursor: pointer;"
                      >
                        üìä –ü–æ–¥—Å—á–µ—Ç –∏—Ç–æ–≥–æ–≤
                      </button>
                    </div>`;
                  }
                } else if (collectionResultsCalculated) {
                  console.log(`‚úÖ –ò—Ç–æ–≥–∏ —É–∂–µ –ø–æ–¥—Å—á–∏—Ç–∞–Ω—ã, –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –∫–Ω–æ–ø–∫—É "–ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å –∏—Ç–æ–≥–∏"`);
                  collectionResultsHtml = `<div class="mt-2 pt-2 border-t border-violet-400/20">
                    <button 
                      onclick="showCollectionResults(${c.id})" 
                      class="neon-button w-full py-2 rounded-lg text-sm"
                      id="view-collection-results-btn-${c.id}"
                    >
                      üèÜ –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å –∏—Ç–æ–≥–∏
                    </button>
                  </div>`;
                }
              } catch (e) {
                console.error('‚ùå –û—à–∏–±–∫–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏ —Å—Ç–∞—Ç—É—Å–∞ –∏—Ç–æ–≥–æ–≤ –∫–æ–Ω–∫—É—Ä—Å–∞ –∫–æ–ª–ª–µ–∫—Ü–∏–π:', e);
              }
            }
            
            // –ü–æ–ª—É—á–∞–µ–º –ø–æ–±–µ–¥–∏—Ç–µ–ª–µ–π –∏–∑ —É–∂–µ –∑–∞–≥—Ä—É–∂–µ–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
            let winnersHtml = '';
            let isConfirmed = false;
            try {
              const winners = winnersData?.winners || winnersData || [];
              isConfirmed = winnersData?.is_confirmed || false;
              
              // –í–ª–∞–¥–µ–ª–µ—Ü –∫–æ–Ω–∫—É—Ä—Å–∞ (—Ç–æ–ª—å–∫–æ –æ–Ω –º–æ–∂–µ—Ç —Ä–µ—Ä–æ–ª–ª–∏—Ç—å –∏ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–∞—Ç—å)
              const currentUserIdNum = Number(currentUserId);
              const createdByIdNum = c.created_by ? Number(c.created_by) : null;
              const isOwner = createdByIdNum !== null && currentUserIdNum === createdByIdNum;

              if (winners && winners.length > 0) {
                winnersHtml = `<div class="mt-2 pt-2 border-t border-violet-400/20">
                  <div class="text-xs text-gray-500 mb-2">üèÜ –ü–æ–±–µ–¥–∏—Ç–µ–ª–∏ (${winners.length}):</div>
                  <div class="space-y-2">
                    ${winners.map((w, idx) => {
                      const place = w.place || (idx + 1);
                      const userDisplay = w.user_username ? `@${w.user_username}` : (w.user_id ? `ID: ${w.user_id}` : '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ');
                      // –ù–æ—Ä–º–∞–ª–∏–∑—É–µ–º —Å—Å—ã–ª–∫—É –Ω–∞ –ø—Ä–∏–∑
                      let prizeLink = w.prize_link;
                      if (prizeLink && !prizeLink.startsWith('http://') && !prizeLink.startsWith('https://')) {
                        prizeLink = 'https://' + prizeLink;
                      }
                      const prizeDisplay = prizeLink ? `<a href="${prizeLink}" target="_blank" class="text-pink-400 hover:underline font-semibold">üéÅ –ü—Ä–∏–∑ ${place} –º–µ—Å—Ç–∞</a>` : '<span class="text-gray-500">–ù–µ—Ç –ø—Ä–∏–∑–∞</span>';
                      const winnerLink = w.comment_link || w.photo_link;
                      // –û–ø—Ä–µ–¥–µ–ª—è–µ–º —Ç–∏–ø –∫–æ–Ω–∫—É—Ä—Å–∞ - –¥–ª—è –∫–æ–Ω–∫—É—Ä—Å–æ–≤ —Ä–∏—Å—É–Ω–∫–æ–≤ —Ä–µ—Ä–æ–ª–ª –Ω–µ –Ω—É–∂–µ–Ω
                      const contestType = c.contest_type || 'random_comment';
                      const showReroll = contestType !== 'drawing' && !isConfirmed && isOwner;
                      return `
                      <div class="flex flex-col gap-1 text-sm p-2 rounded-lg bg-black/20 border border-violet-400/20">
                        <div class="flex items-center gap-2">
                          <span class="text-violet-400 font-bold flex-shrink-0">${place} –º–µ—Å—Ç–æ</span>
                          <span class="text-gray-300">${userDisplay}</span>
                          ${showReroll ? `
                            <button 
                              onclick="rerollWinner(${c.id}, '${winnerLink}')" 
                              class="reroll-btn w-8 h-8 rounded-full bg-violet-600 hover:bg-violet-700 text-white flex items-center justify-center transition-all duration-200 flex-shrink-0 ml-auto"
                              data-winner-link="${winnerLink}"
                              title="–†–µ—Ä–∞–Ω–¥–æ–º–∏–∑–∏—Ä–æ–≤–∞—Ç—å –ø–æ–±–µ–¥–∏—Ç–µ–ª—è"
                            >
                              <svg class="w-4 h-4 reroll-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15" />
                              </svg>
                            </button>
                          ` : ''}
                        </div>
                        <div class="flex items-center gap-2 text-xs">
                          ${winnerLink ? `
                            <a href="${winnerLink}" target="_blank" class="text-blue-400 hover:underline break-all flex-1 min-w-0">${winnerLink}</a>
                          ` : '<span class="text-gray-500">–°—Å—ã–ª–∫–∞ –Ω–µ —É–∫–∞–∑–∞–Ω–∞</span>'}
                        </div>
                        <div class="text-xs text-gray-400">
                          –ü—Ä–∏–∑: ${prizeDisplay}
                        </div>
                      </div>
                    `;
                    }).join('')}
                  </div>
                  ${!isConfirmed && isOwner ? `
                    <button 
                      onclick="confirmWinners(${c.id})" 
                      class="neon-button w-full py-2 rounded-lg text-sm mt-3"
                    >
                      ‚úÖ –ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å –ø–æ–±–µ–¥–∏—Ç–µ–ª–µ–π
                    </button>
                  ` : ''}
                </div>`;
              } else if (isEnded && !isConfirmed && isRandomCommentContest) {
                // –ö–Ω–æ–ø–∫–∞ "–ü–æ–¥–≤–µ—Å—Ç–∏ –∏—Ç–æ–≥–∏" —Ç–æ–ª—å–∫–æ –¥–ª—è –≤–ª–∞–¥–µ–ª—å—Ü–∞ –∫–æ–Ω–∫—É—Ä—Å–∞
                if (isOwner) {
                  winnersHtml = `<div class="mt-2 pt-2 border-t border-violet-400/20">
                    <button 
                      onclick="selectWinnersViaTelethon(${c.id})" 
                      class="neon-button w-full py-2 rounded-lg text-sm"
                      id="select-winners-btn-${c.id}"
                    >
                      üé≤ –ü–æ–¥–≤–µ—Å—Ç–∏ –∏—Ç–æ–≥–∏
                    </button>
                  </div>`;
                }
              }
            } catch (e) {
              console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –ø–æ–±–µ–¥–∏—Ç–µ–ª–µ–π:', e);
              if (isEnded && !isConfirmed && isRandomCommentContest) {
                const currentUserIdNum = Number(currentUserId);
                const createdByIdNum = c.created_by ? Number(c.created_by) : null;
                const isOwner = createdByIdNum !== null && currentUserIdNum === createdByIdNum;
                if (isOwner) {
                  winnersHtml = `<div class="mt-2 pt-2 border-t border-violet-400/20">
                    <button 
                      onclick="selectWinnersViaTelethon(${c.id})" 
                      class="neon-button w-full py-2 rounded-lg text-sm"
                      id="select-winners-btn-${c.id}"
                    >
                      üé≤ –ü–æ–¥–≤–µ—Å—Ç–∏ –∏—Ç–æ–≥–∏
                    </button>
                  </div>`;
                }
              }
            }
            
            // –û—Ç–ª–∞–¥–æ—á–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è
            console.log(`–ö–æ–Ω–∫—É—Ä—Å ${c.id}: prize_links =`, c.prize_links, 'type:', typeof c.prize_links, 'isArray:', Array.isArray(c.prize_links));
            
            card.innerHTML = `
              ${prizesHtml || ''}
              
              <div class="font-bold text-xl text-white mb-3">${contestTitle}</div>
              
              ${postLink}
              ${conditions}
              
              <div class="mt-2 pt-2 border-t border-violet-400/20">
                ${period}
              </div>
              
              ${drawingResultsHtml}
              ${collectionResultsHtml}
              ${winnersHtml}
            `;
            
            // –î–æ–±–∞–≤–ª—è–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –¥–ª—è –∫–Ω–æ–ø–∫–∏ "–ü–æ–¥—Å—á–µ—Ç –∏—Ç–æ–≥–æ–≤" –ø–æ—Å–ª–µ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –≤ DOM
            if (drawingResultsHtml && isDrawingContest) {
              setTimeout(() => {
                const calculateBtn = document.getElementById(`calculate-results-btn-${c.id}`);
                if (calculateBtn) {
                  console.log(`‚úÖ –ù–∞–π–¥–µ–Ω–∞ –∫–Ω–æ–ø–∫–∞ "–ü–æ–¥—Å—á–µ—Ç –∏—Ç–æ–≥–æ–≤" –¥–ª—è –∫–æ–Ω–∫—É—Ä—Å–∞ ${c.id}, –¥–æ–±–∞–≤–ª—è–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫`);
                  // –£–±–∏—Ä–∞–µ–º disabled –µ—Å–ª–∏ –æ–Ω –±—ã–ª —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω
                  calculateBtn.disabled = false;
                  calculateBtn.style.pointerEvents = 'auto';
                  calculateBtn.style.cursor = 'pointer';
                  // –£–¥–∞–ª—è–µ–º —Å—Ç–∞—Ä—ã–π –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –µ—Å–ª–∏ –µ—Å—Ç—å
                  const newBtn = calculateBtn.cloneNode(true);
                  calculateBtn.parentNode.replaceChild(newBtn, calculateBtn);
                  // –î–æ–±–∞–≤–ª—è–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ —á–µ—Ä–µ–∑ addEventListener –¥–ª—è –Ω–∞–¥–µ–∂–Ω–æ—Å—Ç–∏
                  newBtn.addEventListener('click', async (e) => {
                    e.preventDefault();
                    e.stopPropagation();
                    console.log('–ö–Ω–æ–ø–∫–∞ "–ü–æ–¥—Å—á–µ—Ç –∏—Ç–æ–≥–æ–≤" –Ω–∞–∂–∞—Ç–∞ –¥–ª—è –∫–æ–Ω–∫—É—Ä—Å–∞', c.id);
                    await window.calculateDrawingResults(c.id);
                  });
                } else {
                  console.log(`‚ùå –ö–Ω–æ–ø–∫–∞ "–ü–æ–¥—Å—á–µ—Ç –∏—Ç–æ–≥–æ–≤" –Ω–µ –Ω–∞–π–¥–µ–Ω–∞ –≤ DOM –¥–ª—è –∫–æ–Ω–∫—É—Ä—Å–∞ ${c.id}, drawingResultsHtml=${drawingResultsHtml ? '–µ—Å—Ç—å' : '–ø—É—Å—Ç–æ'}`);
                }
              }, 100);
            }
            
            // –î–æ–±–∞–≤–ª—è–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –¥–ª—è –∫–Ω–æ–ø–∫–∏ "–ü–æ–¥—Å—á–µ—Ç –∏—Ç–æ–≥–æ–≤" –∫–æ–Ω–∫—É—Ä—Å–∞ –∫–æ–ª–ª–µ–∫—Ü–∏–π
            if (collectionResultsHtml && isCollectionContest) {
              setTimeout(() => {
                const calculateBtn = document.getElementById(`calculate-collection-results-btn-${c.id}`);
                if (calculateBtn) {
                  console.log(`‚úÖ –ù–∞–π–¥–µ–Ω–∞ –∫–Ω–æ–ø–∫–∞ "–ü–æ–¥—Å—á–µ—Ç –∏—Ç–æ–≥–æ–≤" –¥–ª—è –∫–æ–Ω–∫—É—Ä—Å–∞ –∫–æ–ª–ª–µ–∫—Ü–∏–π ${c.id}, –¥–æ–±–∞–≤–ª—è–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫`);
                  calculateBtn.disabled = false;
                  calculateBtn.style.pointerEvents = 'auto';
                  calculateBtn.style.cursor = 'pointer';
                  const newBtn = calculateBtn.cloneNode(true);
                  calculateBtn.parentNode.replaceChild(newBtn, calculateBtn);
                  newBtn.addEventListener('click', async (e) => {
                    e.preventDefault();
                    e.stopPropagation();
                    console.log('–ö–Ω–æ–ø–∫–∞ "–ü–æ–¥—Å—á–µ—Ç –∏—Ç–æ–≥–æ–≤" –Ω–∞–∂–∞—Ç–∞ –¥–ª—è –∫–æ–Ω–∫—É—Ä—Å–∞ –∫–æ–ª–ª–µ–∫—Ü–∏–π', c.id);
                    await window.calculateCollectionResults(c.id);
                  });
                } else {
                  console.log(`‚ùå –ö–Ω–æ–ø–∫–∞ "–ü–æ–¥—Å—á–µ—Ç –∏—Ç–æ–≥–æ–≤" –Ω–µ –Ω–∞–π–¥–µ–Ω–∞ –≤ DOM –¥–ª—è –∫–æ–Ω–∫—É—Ä—Å–∞ –∫–æ–ª–ª–µ–∫—Ü–∏–π ${c.id}`);
                }
              }, 100);
            }
            
            // –î–æ–±–∞–≤–ª—è–µ–º —Å–∫—Ä–∏–ø—Ç –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –∑–∞–≥—Ä—É–∑–∫–∏ iframe –ø—Ä–∏–∑–æ–≤
            if (prizesHtml) {
              setTimeout(() => {
                const iframes = card.querySelectorAll('iframe');
                iframes.forEach((iframe) => {
                  iframe.onerror = () => {
                    const fallback = iframe.closest('.relative')?.querySelector('.fallback-prize');
                    if (fallback) fallback.classList.remove('hidden');
                  };
                  setTimeout(() => {
                    try {
                      if (!iframe.contentDocument && !iframe.contentWindow) {
                        const fallback = iframe.closest('.relative')?.querySelector('.fallback-prize');
                        if (fallback) fallback.classList.remove('hidden');
                      }
                    } catch (e) {
                      // Cross-origin error - —ç—Ç–æ –Ω–æ—Ä–º–∞–ª—å–Ω–æ
                    }
                  }, 2000);
                });
              }, 100);
            }
            
            // –ï—Å–ª–∏ –∫–æ–Ω–∫—É—Ä—Å –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω, —Å–∫—Ä—ã–≤–∞–µ–º –∫–Ω–æ–ø–∫–∏ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è/—É–¥–∞–ª–µ–Ω–∏—è
            if (c.is_confirmed) {
              card.classList.add('contest-confirmed');
            }
            
            contestList.appendChild(card);
            // –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º long press –ø–æ—Å–ª–µ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –≤ DOM (—Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –Ω–µ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω)
            if (!c.is_confirmed) {
              setupLongPress(card, c.id, 'contest', c.title || c.name || '–ö–æ–Ω–∫—É—Ä—Å');
            }
          }
        } catch (e) {
          console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∫–æ–Ω–∫—É—Ä—Å–æ–≤:', e);
          if (contestList) {
            const errorMessage = e.message || '–û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ –∫–æ–Ω–∫—É—Ä—Å–æ–≤';
            contestList.innerHTML = `<div class="text-red-400 text-center py-4">‚ùå ${errorMessage}</div>`;
          }
        }
      }
      
      // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –≤—ã–±–æ—Ä–∞ –ø–æ–±–µ–¥–∏—Ç–µ–ª–µ–π —á–µ—Ä–µ–∑ Telethon
      window.selectWinnersViaTelethon = async function(contestId) {
        const btn = document.getElementById(`select-winners-btn-${contestId}`);
        if (!btn) return;
        
        // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ –∑–∞–≥—Ä—É–∑–∫–∏
        const originalText = btn.innerHTML;
        btn.disabled = true;
        btn.innerHTML = '‚è≥ –°–±–æ—Ä –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤ —á–µ—Ä–µ–∑ Telethon...';
        
        try {
          // –í—ã–∑—ã–≤–∞–µ–º API endpoint –¥–ª—è –≤—ã–±–æ—Ä–∞ –ø–æ–±–µ–¥–∏—Ç–µ–ª–µ–π —á–µ—Ä–µ–∑ Telethon
          // –ù–µ –∏—Å–ø–æ–ª—å–∑—É–µ–º —Ç–∞–π–º–∞—É—Ç –¥–ª—è —ç—Ç–æ–≥–æ –∑–∞–ø—Ä–æ—Å–∞ - Telethon –º–æ–∂–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å –¥–æ–ª–≥–æ
          let response;
          try {
            response = await fetchJSON(`/api/contests/${contestId}/select-winners`, {
              method: 'POST',
              headers: { 'Content-Type': 'application/json' },
              timeout: 120000 // 2 –º–∏–Ω—É—Ç—ã —Ç–∞–π–º–∞—É—Ç, –Ω–æ –æ—à–∏–±–∫—É –Ω–µ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º
            });
          } catch (fetchError) {
            // –õ–Æ–ë–ê–Ø –æ—à–∏–±–∫–∞ fetch (—Ç–∞–π–º–∞—É—Ç, —Å–µ—Ç—å, HTTP –æ—à–∏–±–∫–∞) - –ù–ï –ø–æ–∫–∞–∑—ã–≤–∞–µ–º alert
            // –ü—Ä–æ—Å—Ç–æ –∑–∞–ø—É—Å–∫–∞–µ–º –ø—Ä–æ–≤–µ—Ä–∫—É –≤ —Ñ–æ–Ω–µ
            console.log('–ó–∞–ø—Ä–æ—Å –∑–∞–≤–µ—Ä—à–µ–Ω (–≤–æ–∑–º–æ–∂–Ω–æ —Ç–∞–π–º–∞—É—Ç –∏–ª–∏ –æ—à–∏–±–∫–∞ —Å–µ—Ç–∏), –ø—Ä–æ–≤–µ—Ä—è–µ–º —Å—Ç–∞—Ç—É—Å –≤ —Ñ–æ–Ω–µ:', fetchError.name, fetchError.message);
            btn.innerHTML = '‚è≥ –û–±—Ä–∞–±–æ—Ç–∫–∞...';
            btn.disabled = true;
            startAutoRefresh(contestId, true);
            return; // –í—ã—Ö–æ–¥–∏–º –∏–∑ —Ñ—É–Ω–∫—Ü–∏–∏, –Ω–µ –ø–æ–∫–∞–∑—ã–≤–∞—è –æ—à–∏–±–∫—É
          }
            
          if (response && response.success) {
            // –ü–æ–±–µ–¥–∏—Ç–µ–ª–∏ –≤—ã–±—Ä–∞–Ω—ã —É—Å–ø–µ—à–Ω–æ - –°–†–ê–ó–£ –æ–±–Ω–æ–≤–ª—è–µ–º UI
            // –ó–∞–ø—É—Å–∫–∞–µ–º –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –¥–ª—è –Ω–µ–º–µ–¥–ª–µ–Ω–Ω–æ–π –ø—Ä–æ–≤–µ—Ä–∫–∏
            startAutoRefresh(contestId);
            
            // –¢–∞–∫–∂–µ —Å—Ä–∞–∑—É –æ–±–Ω–æ–≤–ª—è–µ–º —Å–ø–∏—Å–æ–∫ –∫–æ–Ω–∫—É—Ä—Å–æ–≤
            await loadContests(false);
            
            // –£–¥–∞–ª—è–µ–º –∫–Ω–æ–ø–∫—É –∏–∑ DOM, –µ—Å–ª–∏ –æ–Ω–∞ –µ—â–µ –µ—Å—Ç—å
            const checkBtn = document.getElementById(`select-winners-btn-${contestId}`);
            if (checkBtn) {
              checkBtn.remove();
            }
          } else if (response && response.collecting) {
            // –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ –µ—â–µ —Å–æ–±–∏—Ä–∞—é—Ç—Å—è, –∑–∞–ø—É—Å–∫–∞–µ–º –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ
            btn.innerHTML = '‚è≥ –°–±–æ—Ä –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤...';
            btn.disabled = true;
            startAutoRefresh(contestId, true);
          } else {
            // –î—Ä—É–≥–∞—è –æ—à–∏–±–∫–∞ - –Ω–æ –Ω–µ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º alert, –ø—Ä–æ—Å—Ç–æ –∑–∞–ø—É—Å–∫–∞–µ–º –ø—Ä–æ–≤–µ—Ä–∫—É
            btn.innerHTML = '‚è≥ –û–±—Ä–∞–±–æ—Ç–∫–∞...';
            btn.disabled = true;
            startAutoRefresh(contestId, true);
          }
        } catch (e) {
          // –õ–Æ–ë–ê–Ø –æ—à–∏–±–∫–∞ (–≤–∫–ª—é—á–∞—è —Ç–∞–π–º–∞—É—Ç) - –ù–ï –ø–æ–∫–∞–∑—ã–≤–∞–µ–º alert, –ø—Ä–æ—Å—Ç–æ –∑–∞–ø—É—Å–∫–∞–µ–º –ø—Ä–æ–≤–µ—Ä–∫—É –≤ —Ñ–æ–Ω–µ
          console.log('–ó–∞–ø—Ä–æ—Å –∑–∞–≤–µ—Ä—à–µ–Ω (–≤–æ–∑–º–æ–∂–Ω–æ —Ç–∞–π–º–∞—É—Ç), –ø—Ä–æ–≤–µ—Ä—è–µ–º —Å—Ç–∞—Ç—É—Å –≤ —Ñ–æ–Ω–µ:', e.name, e.message);
          btn.innerHTML = '‚è≥ –û–±—Ä–∞–±–æ—Ç–∫–∞...';
          btn.disabled = true;
          startAutoRefresh(contestId, true);
        }
      };
      
      // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö –∫–æ–Ω–∫—É—Ä—Å–∞
      let autoRefreshIntervals = {}; // –•—Ä–∞–Ω–∏–º –∏–Ω—Ç–µ—Ä–≤–∞–ª—ã –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –∫–æ–Ω–∫—É—Ä—Å–∞
      
      function startAutoRefresh(contestId, isCollecting = false) {
        // –û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –ø—Ä–µ–¥—ã–¥—É—â–∏–π –∏–Ω—Ç–µ—Ä–≤–∞–ª –¥–ª—è —ç—Ç–æ–≥–æ –∫–æ–Ω–∫—É—Ä—Å–∞, –µ—Å–ª–∏ –æ–Ω –µ—Å—Ç—å
        if (autoRefreshIntervals[contestId]) {
          clearInterval(autoRefreshIntervals[contestId]);
        }
        
        let attempts = 0;
        const maxAttempts = 300; // –ú–∞–∫—Å–∏–º—É–º 300 –ø–æ–ø—ã—Ç–æ–∫ (5 –º–∏–Ω—É—Ç –ø—Ä–∏ –ø—Ä–æ–≤–µ—Ä–∫–µ –∫–∞–∂–¥—É—é —Å–µ–∫—É–Ω–¥—É)
        
        autoRefreshIntervals[contestId] = setInterval(async () => {
          attempts++;
          
          try {
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –≤—ã–±—Ä–∞–Ω—ã –ª–∏ –ø–æ–±–µ–¥–∏—Ç–µ–ª–∏ - –ø—Ä–æ–≤–µ—Ä—è–µ–º —á–∞—Å—Ç–æ –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è UI
            const winnersResponse = await fetchJSON(`/api/contests/${contestId}/winners`).catch(() => null);
            
            if (winnersResponse && winnersResponse.winners && winnersResponse.winners.length > 0) {
              // –ü–æ–±–µ–¥–∏—Ç–µ–ª–∏ –≤—ã–±—Ä–∞–Ω—ã, –æ—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ
              clearInterval(autoRefreshIntervals[contestId]);
              delete autoRefreshIntervals[contestId];
              
              // –°–†–ê–ó–£ –æ–±–Ω–æ–≤–ª—è–µ–º —Å–ø–∏—Å–æ–∫ –∫–æ–Ω–∫—É—Ä—Å–æ–≤ - —ç—Ç–æ –ø–æ–∫–∞–∂–µ—Ç –ø–æ–±–µ–¥–∏—Ç–µ–ª–µ–π –∏ —Å–∫—Ä–æ–µ—Ç –∫–Ω–æ–ø–∫—É
              await loadContests(false);
              
              // –£–¥–∞–ª—è–µ–º –∫–Ω–æ–ø–∫—É –∏–∑ DOM, –µ—Å–ª–∏ –æ–Ω–∞ –µ—â–µ –µ—Å—Ç—å
              const btn = document.getElementById(`select-winners-btn-${contestId}`);
              if (btn) {
                btn.remove();
              }
            } else if (attempts >= maxAttempts) {
              // –ü—Ä–µ–≤—ã—à–µ–Ω –ª–∏–º–∏—Ç –ø–æ–ø—ã—Ç–æ–∫ - –ø—Ä–æ–¥–æ–ª–∂–∞–µ–º –ø—Ä–æ–≤–µ—Ä–∫—É —Å —É–≤–µ–ª–∏—á–µ–Ω–Ω—ã–º –∏–Ω—Ç–µ—Ä–≤–∞–ª–æ–º
              clearInterval(autoRefreshIntervals[contestId]);
              delete autoRefreshIntervals[contestId];
              
              const btn = document.getElementById(`select-winners-btn-${contestId}`);
              if (btn) {
                btn.innerHTML = '‚è≥ –û–∂–∏–¥–∞–Ω–∏–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è...';
              }
              
              // –ü—Ä–æ–¥–æ–ª–∂–∞–µ–º –ø—Ä–æ–≤–µ—Ä–∫—É –∫–∞–∂–¥—ã–µ 5 —Å–µ–∫—É–Ω–¥ –≤ —Ñ–æ–Ω–µ
              const checkInterval = setInterval(async () => {
                const winnersCheck = await fetchJSON(`/api/contests/${contestId}/winners`).catch(() => null);
                if (winnersCheck && winnersCheck.winners && winnersCheck.winners.length > 0) {
                  clearInterval(checkInterval);
                  await loadContests(false);
                  const btn = document.getElementById(`select-winners-btn-${contestId}`);
                  if (btn) {
                    btn.remove();
                  }
                }
              }, 5000);
            }
            // –ï—Å–ª–∏ –ø–æ–±–µ–¥–∏—Ç–µ–ª–∏ –µ—â–µ –Ω–µ –≤—ã–±—Ä–∞–Ω—ã, –ø—Ä–æ—Å—Ç–æ –ø—Ä–æ–¥–æ–ª–∂–∞–µ–º –ø—Ä–æ–≤–µ—Ä–∫—É
          } catch (error) {
            console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–º –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏:', error);
            // –ü—Ä–æ–¥–æ–ª–∂–∞–µ–º –ø–æ–ø—ã—Ç–∫–∏
          }
        }, 1000); // –ü—Ä–æ–≤–µ—Ä—è–µ–º –∫–∞–∂–¥—É—é —Å–µ–∫—É–Ω–¥—É –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è UI
      }
      
      // –û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –≤—Å–µ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –ø—Ä–∏ —É—Ö–æ–¥–µ —Å–æ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
      window.addEventListener('beforeunload', () => {
        Object.values(autoRefreshIntervals).forEach(interval => clearInterval(interval));
      });
      
      // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –≤—ã–±–æ—Ä–∞ –ø–æ–±–µ–¥–∏—Ç–µ–ª–µ–π (legacy - —Ç–µ–ø–µ—Ä—å –≤—ã–±–∏—Ä–∞—é—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏)
      
      // –§—É–Ω–∫—Ü–∏—è –¥–ª—è —Ä–µ—Ä–æ–ª–ª–∞ –æ–¥–Ω–æ–≥–æ –ø–æ–±–µ–¥–∏—Ç–µ–ª—è
      window.rerollWinner = async function(contestId, oldWinnerLink) {
        const btn = document.querySelector(`.reroll-btn[data-winner-link="${oldWinnerLink}"]`);
        if (!btn) return;
        
        const icon = btn.querySelector('.reroll-icon');
        if (!icon) return;
        
        // –ó–∞–ø—É—Å–∫–∞–µ–º –∞–Ω–∏–º–∞—Ü–∏—é –≤—Ä–∞—â–µ–Ω–∏—è
        btn.disabled = true;
        icon.classList.add('animate-spin');
        
        try {
          const response = await fetchJSON(`/api/contests/${contestId}/reroll-winner`, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ old_winner_link: oldWinnerLink })
          });
          
          if (response.success) {
            // –û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∞–Ω–∏–º–∞—Ü–∏—é
            icon.classList.remove('animate-spin');
            btn.disabled = false;
            
            // –°–†–ê–ó–£ –æ–±–Ω–æ–≤–ª—è–µ–º —Å–ø–∏—Å–æ–∫ –∫–æ–Ω–∫—É—Ä—Å–æ–≤ - —ç—Ç–æ –æ–±–Ω–æ–≤–∏—Ç –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π –ø–æ–±–µ–¥–∏—Ç–µ–ª—è –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏
            await loadContests(false);
          } else {
            icon.classList.remove('animate-spin');
            btn.disabled = false;
            // –ù–µ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º alert, –ø—Ä–æ—Å—Ç–æ –ª–æ–≥–∏—Ä—É–µ–º
            console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ —Ä–µ—Ä–∞–Ω–¥–æ–º–∏–∑–∞—Ü–∏–∏ –ø–æ–±–µ–¥–∏—Ç–µ–ª—è:', response);
          }
        } catch (e) {
          console.error('–û—à–∏–±–∫–∞ —Ä–µ—Ä–∞–Ω–¥–æ–º–∏–∑–∞—Ü–∏–∏ –ø–æ–±–µ–¥–∏—Ç–µ–ª—è:', e);
          icon.classList.remove('animate-spin');
          btn.disabled = false;
          // –ù–µ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º alert, –ø—Ä–æ—Å—Ç–æ –ª–æ–≥–∏—Ä—É–µ–º
        }
      };
      
      // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è –ø–æ–±–µ–¥–∏—Ç–µ–ª–µ–π
      window.confirmWinners = async function(contestId) {
        if (!confirm('–ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å –ø–æ–±–µ–¥–∏—Ç–µ–ª–µ–π? –ü–æ—Å–ª–µ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è –≤—Å–µ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ (–∫—Ä–æ–º–µ –≤—ã–∏–≥—Ä—ã—à–Ω—ã—Ö) –±—É–¥—É—Ç —É–¥–∞–ª–µ–Ω—ã –∏–∑ –ë–î, –∏ –∫–æ–Ω–∫—É—Ä—Å –Ω–µ–ª—å–∑—è –±—É–¥–µ—Ç —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –∏–ª–∏ —É–¥–∞–ª–∏—Ç—å.')) {
          return;
        }
        
        try {
          const response = await fetchJSON(`/api/contests/${contestId}/confirm-winners`, {
            method: 'POST'
          });
          
          if (response.success) {
            // –°–†–ê–ó–£ –æ–±–Ω–æ–≤–ª—è–µ–º UI - —ç—Ç–æ —Å–∫—Ä–æ–µ—Ç –∫–Ω–æ–ø–∫—É –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è –∏ –æ–±–Ω–æ–≤–∏—Ç —Å—Ç–∞—Ç—É—Å
            await loadContests(false);
            // –ù–µ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º alert, –ø—Ä–æ—Å—Ç–æ –æ–±–Ω–æ–≤–ª—è–µ–º UI
          } else {
            console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–∏ –ø–æ–±–µ–¥–∏—Ç–µ–ª–µ–π:', response);
          }
        } catch (e) {
          console.error('–û—à–∏–±–∫–∞ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è –ø–æ–±–µ–¥–∏—Ç–µ–ª–µ–π:', e);
          // –ù–µ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º alert, –ø—Ä–æ—Å—Ç–æ –ª–æ–≥–∏—Ä—É–µ–º
        }
      };
      
      // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–æ–¥—Å—á–µ—Ç–∞ –∏—Ç–æ–≥–æ–≤ –∫–æ–Ω–∫—É—Ä—Å–∞ —Ä–∏—Å—É–Ω–∫–æ–≤
      window.calculateDrawingResults = async function(contestId) {
        const btn = document.getElementById(`calculate-results-btn-${contestId}`);
        if (btn) {
          btn.disabled = true;
          btn.textContent = '‚è≥ –ü–æ–¥—Å—á–µ—Ç...';
        }
        
        try {
          const currentUserId = window.Telegram?.WebApp?.initDataUnsafe?.user?.id || window.currentUserId;
          const response = await fetchJSON(`/api/contests/${contestId}/calculate-results?current_user_id=${currentUserId}`, {
            method: 'POST'
          });
          
          if (response.success) {
            alert('‚úÖ –ò—Ç–æ–≥–∏ —É—Å–ø–µ—à–Ω–æ –ø–æ–¥—Å—á–∏—Ç–∞–Ω—ã!');
            await loadContests(false);
          } else {
            alert('‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–¥—Å—á–µ—Ç–µ –∏—Ç–æ–≥–æ–≤: ' + (response.message || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞'));
            if (btn) {
              btn.disabled = false;
              btn.textContent = 'üìä –ü–æ–¥—Å—á–µ—Ç –∏—Ç–æ–≥–æ–≤';
            }
          }
        } catch (e) {
          console.error('–û—à–∏–±–∫–∞ –ø–æ–¥—Å—á–µ—Ç–∞ –∏—Ç–æ–≥–æ–≤:', e);
          alert('‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–¥—Å—á–µ—Ç–µ –∏—Ç–æ–≥–æ–≤: ' + (e.message || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞'));
          if (btn) {
            btn.disabled = false;
            btn.textContent = 'üìä –ü–æ–¥—Å—á–µ—Ç –∏—Ç–æ–≥–æ–≤';
          }
        }
      };
      
      // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –∏—Ç–æ–≥–æ–≤ –∫–æ–Ω–∫—É—Ä—Å–∞ —Ä–∏—Å—É–Ω–∫–æ–≤
      window.showDrawingResults = async function(contestId) {
        try {
          const response = await fetchJSON(`/api/contests/${contestId}/results`);
          
          if (!response.results_calculated) {
            alert('–ò—Ç–æ–≥–∏ –µ—â–µ –Ω–µ –ø–æ–¥—Å—á–∏—Ç–∞–Ω—ã');
            return;
          }
          
          const results = response.results || [];
          const resultsModal = document.getElementById('drawing-results-modal');
          const resultsContent = document.getElementById('drawing-results-content');
          
          if (!resultsModal || !resultsContent) {
            alert('–ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ');
            return;
          }
          
          // –§–æ—Ä–º–∏—Ä—É–µ–º HTML —Å –∏—Ç–æ–≥–∞–º–∏
          let resultsHtml = '<div class="space-y-4">';
          
          for (const result of results) {
            const place = result.place;
            const username = result.username || '';
            const userId = result.participant_user_id;
            const userDisplay = username ? `${username} (ID: ${userId})` : `ID: ${userId}`;
            const imageUrl = `/api/drawing-contests/${contestId}/works/${result.work_number}/image`;
            const prizeLink = result.prize_link;
            const averageScore = result.average_score || 0;
            const votesCount = result.votes_count || 0;
            
            resultsHtml += `
              <div class="rounded-lg border border-violet-400/30 p-4 bg-black/30">
                <div class="text-2xl font-bold text-violet-400 mb-2">${place} –º–µ—Å—Ç–æ</div>
                <div class="text-sm text-gray-300 mb-3">
                  ${username ? `<span class="font-semibold text-violet-400">${username}</span> ` : ''}
                  <span class="text-gray-400">(ID: ${userId})</span>
                </div>
                <div class="mb-3">
                  <img src="${imageUrl}" alt="–†–∞–±–æ—Ç–∞ ${result.work_number}" class="w-full rounded-lg max-h-64 object-contain" />
                </div>
                <div class="text-sm text-gray-400 mb-3">
                  –°—Ä–µ–¥–Ω—è—è –æ—Ü–µ–Ω–∫–∞: <span class="text-violet-400 font-semibold">${averageScore.toFixed(2)}</span> (${votesCount} ${votesCount === 1 ? '–æ—Ü–µ–Ω–∫–∞' : votesCount < 5 ? '–æ—Ü–µ–Ω–∫–∏' : '–æ—Ü–µ–Ω–æ–∫'})
                </div>
                ${prizeLink ? `
                  <div class="text-sm">
                    <a href="${prizeLink.startsWith('http') ? prizeLink : 'https://' + prizeLink}" target="_blank" class="text-pink-400 hover:underline font-semibold">üéÅ –ü—Ä–∏–∑</a>
                  </div>
                ` : ''}
              </div>
            `;
          }
          
          resultsHtml += '</div>';
          resultsContent.innerHTML = resultsHtml;
          openModal(resultsModal);
        } catch (e) {
          console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∏—Ç–æ–≥–æ–≤:', e);
          alert('‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ –∏—Ç–æ–≥–æ–≤: ' + (e.message || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞'));
        }
      };
      
      // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–æ–¥—Å—á–µ—Ç–∞ –∏—Ç–æ–≥–æ–≤ –∫–æ–Ω–∫—É—Ä—Å–∞ –∫–æ–ª–ª–µ–∫—Ü–∏–π
      window.calculateCollectionResults = async function(contestId) {
        const btn = document.getElementById(`calculate-collection-results-btn-${contestId}`);
        if (btn) {
          btn.disabled = true;
          btn.textContent = '‚è≥ –ü–æ–¥—Å—á–µ—Ç...';
        }
        
        try {
          const currentUserId = window.Telegram?.WebApp?.initDataUnsafe?.user?.id || window.currentUserId;
          const response = await fetchJSON(`/api/contests/${contestId}/calculate-collection-results?current_user_id=${currentUserId}`, {
            method: 'POST'
          });
          
          if (response.success) {
            alert('‚úÖ –ò—Ç–æ–≥–∏ —É—Å–ø–µ—à–Ω–æ –ø–æ–¥—Å—á–∏—Ç–∞–Ω—ã!');
            await loadContests(false);
          } else {
            alert('‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–¥—Å—á–µ—Ç–µ –∏—Ç–æ–≥–æ–≤: ' + (response.message || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞'));
            if (btn) {
              btn.disabled = false;
              btn.textContent = 'üìä –ü–æ–¥—Å—á–µ—Ç –∏—Ç–æ–≥–æ–≤';
            }
          }
        } catch (e) {
          console.error('–û—à–∏–±–∫–∞ –ø–æ–¥—Å—á–µ—Ç–∞ –∏—Ç–æ–≥–æ–≤ –∫–æ–Ω–∫—É—Ä—Å–∞ –∫–æ–ª–ª–µ–∫—Ü–∏–π:', e);
          alert('‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–¥—Å—á–µ—Ç–µ –∏—Ç–æ–≥–æ–≤: ' + (e.message || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞'));
          if (btn) {
            btn.disabled = false;
            btn.textContent = 'üìä –ü–æ–¥—Å—á–µ—Ç –∏—Ç–æ–≥–æ–≤';
          }
        }
      };
      
      // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –∏—Ç–æ–≥–æ–≤ –∫–æ–Ω–∫—É—Ä—Å–∞ –∫–æ–ª–ª–µ–∫—Ü–∏–π
      window.showCollectionResults = async function(contestId) {
        try {
          const response = await fetchJSON(`/api/contests/${contestId}/collection-results`);
          
          if (!response.results_calculated) {
            alert('–ò—Ç–æ–≥–∏ –µ—â–µ –Ω–µ –ø–æ–¥—Å—á–∏—Ç–∞–Ω—ã');
            return;
          }
          
          const results = response.results || [];
          const resultsModal = document.getElementById('collection-results-modal');
          const resultsContent = document.getElementById('collection-results-content');
          
          if (!resultsModal || !resultsContent) {
            alert('–ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ');
            return;
          }
          
          // –§–æ—Ä–º–∏—Ä—É–µ–º HTML —Å –∏—Ç–æ–≥–∞–º–∏
          let resultsHtml = '<div class="space-y-4">';
          
          for (const result of results) {
            const place = result.place;
            const username = result.username || '';
            const userId = result.participant_user_id;
            const userDisplay = username ? `${username} (ID: ${userId})` : `ID: ${userId}`;
            const nftLinks = result.nft_links || [];
            const prizeLink = result.prize_link;
            const averageScore = result.average_score || 0;
            const votesCount = result.votes_count || 0;
            
            // –§–æ—Ä–º–∏—Ä—É–µ–º —Å–µ—Ç–∫—É 3x3 –¥–ª—è NFT
            let nftGridHtml = '<div class="grid grid-cols-3 gap-2 mb-3">';
            for (let i = 0; i < 9; i++) {
              const nftLink = nftLinks[i] || '';
              const normalizedLink = nftLink.startsWith('http') ? nftLink : (nftLink ? 'https://' + nftLink : '');
              nftGridHtml += `
                <div class="aspect-square rounded-lg overflow-hidden border border-violet-400/30 bg-black/20">
                  ${nftLink ? `
                    <img 
                      src="/api/nft-preview?nft_link=${encodeURIComponent(normalizedLink)}" 
                      alt="NFT ${i + 1}"
                      class="w-full h-full object-cover"
                      onerror="this.style.display='none'; this.nextElementSibling.classList.remove('hidden');"
                    />
                    <div class="hidden w-full h-full flex items-center justify-center bg-black/50">
                      <div class="text-2xl opacity-70">üñºÔ∏è</div>
                    </div>
                  ` : `
                    <div class="w-full h-full flex items-center justify-center bg-black/50">
                      <div class="text-2xl opacity-70">üñºÔ∏è</div>
                    </div>
                  `}
                </div>
              `;
            }
            nftGridHtml += '</div>';
            
            resultsHtml += `
              <div class="rounded-lg border border-violet-400/30 p-4 bg-black/30">
                <div class="text-2xl font-bold text-violet-400 mb-2">${place} –º–µ—Å—Ç–æ</div>
                <div class="text-sm text-gray-300 mb-3">
                  ${username ? `<span class="font-semibold text-violet-400">${username}</span> ` : ''}
                  <span class="text-gray-400">(ID: ${userId})</span>
                </div>
                ${nftGridHtml}
                <div class="text-sm text-gray-400 mb-3">
                  –°—Ä–µ–¥–Ω—è—è –æ—Ü–µ–Ω–∫–∞: <span class="text-violet-400 font-semibold">${averageScore.toFixed(2)}</span> (${votesCount} ${votesCount === 1 ? '–æ—Ü–µ–Ω–∫–∞' : votesCount < 5 ? '–æ—Ü–µ–Ω–∫–∏' : '–æ—Ü–µ–Ω–æ–∫'})
                </div>
                ${prizeLink ? `
                  <div class="text-sm">
                    <a href="${prizeLink.startsWith('http') ? prizeLink : 'https://' + prizeLink}" target="_blank" class="text-pink-400 hover:underline font-semibold">üéÅ –ü—Ä–∏–∑</a>
                  </div>
                ` : ''}
              </div>
            `;
          }
          
          resultsHtml += '</div>';
          resultsContent.innerHTML = resultsHtml;
          openModal(resultsModal);
        } catch (e) {
          console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∏—Ç–æ–≥–æ–≤ –∫–æ–Ω–∫—É—Ä—Å–∞ –∫–æ–ª–ª–µ–∫—Ü–∏–π:', e);
          alert('‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ –∏—Ç–æ–≥–æ–≤: ' + (e.message || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞'));
        }
      };

      // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –¥–ª—è submitContest, –∞–¥–º–∏–Ω–æ–≤ –∏ –¥—Ä—É–≥–∏—Ö —ç–ª–µ–º–µ–Ω—Ç–æ–≤ —Ç–µ–ø–µ—Ä—å –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É—é—Ç—Å—è –≤ —Ñ—É–Ω–∫—Ü–∏–∏ init()

      // –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–æ–Ω–∫—É—Ä—Å–æ–≤ –∏ –∞–¥–º–∏–Ω–æ–≤
      // –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ editContestModal, editAdminModal, updateContest –∏ updateAdmin –æ–±—ä—è–≤–ª–µ–Ω—ã –Ω–∞ –≤–µ—Ä—Ö–Ω–µ–º —É—Ä–æ–≤–Ω–µ
      let updateContest, updateAdmin;

      let currentEditContestId = null;
      let currentEditAdminId = null;

      // –î–µ–ª–∞–µ–º —Ñ—É–Ω–∫—Ü–∏–∏ –¥–æ—Å—Ç—É–ø–Ω—ã–º–∏ –≥–ª–æ–±–∞–ª—å–Ω–æ –¥–ª—è –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤ —Å–æ–±—ã—Ç–∏–π
      window.openEditContestModal = async function(contestId) {
        console.log('üîß –û—Ç–∫—Ä—ã–≤–∞–µ–º –º–æ–¥–∞–ª–∫—É —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –∫–æ–Ω–∫—É—Ä—Å–∞, ID:', contestId);
        currentEditContestId = contestId;
        
        try {
          // –ü—Ä–µ–æ–±—Ä–∞–∑—É–µ–º ID –≤ —á–∏—Å–ª–æ, –µ—Å–ª–∏ —ç—Ç–æ —Å—Ç—Ä–æ–∫–∞
          const id = typeof contestId === 'string' ? parseInt(contestId) : contestId;
          console.log('üì• –ó–∞–≥—Ä—É–∂–∞–µ–º –¥–∞–Ω–Ω—ã–µ –∫–æ–Ω–∫—É—Ä—Å–∞, ID:', id);
          
          const contests = await fetchJSON('/api/contests');
          console.log('üìã –ó–∞–≥—Ä—É–∂–µ–Ω–æ –∫–æ–Ω–∫—É—Ä—Å–æ–≤:', contests.length);
          
          const contest = contests.find(c => {
            // –°—Ä–∞–≤–Ω–∏–≤–∞–µ–º –∫–∞–∫ —á–∏—Å–ª–∞, —Ç–∞–∫ –∫–∞–∫ ID –º–æ–≥—É—Ç –±—ã—Ç—å —Ä–∞–∑–Ω—ã—Ö —Ç–∏–ø–æ–≤
            return parseInt(c.id) === parseInt(id) || c.id === id;
          });
          
          if (!contest) {
            console.error('‚ùå –ö–æ–Ω–∫—É—Ä—Å –Ω–µ –Ω–∞–π–¥–µ–Ω, ID:', id);
            alert(`‚ö†Ô∏è –ö–æ–Ω–∫—É—Ä—Å —Å ID ${id} –Ω–µ –Ω–∞–π–¥–µ–Ω`);
            return;
          }
          
          console.log('‚úÖ –ù–∞–π–¥–µ–Ω –∫–æ–Ω–∫—É—Ä—Å:', contest);
          console.log('üìã –í—Å–µ –ø–æ–ª—è –∫–æ–Ω–∫—É—Ä—Å–∞:', Object.keys(contest));
          console.log('üìå contest_type –∏–∑ –¥–∞–Ω–Ω—ã—Ö:', contest.contest_type);
          console.log('üìå submission_end_date:', contest.submission_end_date);
          console.log('üìå –Ω–∞–∑–≤–∞–Ω–∏–µ –∫–æ–Ω–∫—É—Ä—Å–∞:', contest.title || contest.name);
          
          // –û–ø—Ä–µ–¥–µ–ª—è–µ–º —Ç–∏–ø –∫–æ–Ω–∫—É—Ä—Å–∞ –Ω–µ—Å–∫–æ–ª—å–∫–∏–º–∏ —Å–ø–æ—Å–æ–±–∞–º–∏:
          // 1. –ü–æ –ø–æ–ª—é contest_type
          // 2. –ü–æ –Ω–∞–ª–∏—á–∏—é submission_end_date (–¥–ª—è –∫–æ–Ω–∫—É—Ä—Å–æ–≤ —Ä–∏—Å—É–Ω–∫–æ–≤)
          // 3. –ü–æ –Ω–∞–∑–≤–∞–Ω–∏—é –∫–æ–Ω–∫—É—Ä—Å–∞ (–µ—Å–ª–∏ —Å–æ–¥–µ—Ä–∂–∏—Ç "–ö–æ–Ω–∫—É—Ä—Å —Ä–∏—Å—É–Ω–∫–æ–≤")
          let contestType = contest.contest_type || contest.contestType;
          
          // –ï—Å–ª–∏ contest_type –Ω–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω, –ø—ã—Ç–∞–µ–º—Å—è –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å –ø–æ –¥—Ä—É–≥–∏–º –ø—Ä–∏–∑–Ω–∞–∫–∞–º
          if (!contestType || contestType === 'random_comment') {
            if (contest.title && contest.title.includes('–ö–æ–Ω–∫—É—Ä—Å –∫–æ–ª–ª–µ–∫—Ü–∏–π')) {
              contestType = 'collection';
              console.log('üìå –¢–∏–ø –∫–æ–Ω–∫—É—Ä—Å–∞ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω –ø–æ –Ω–∞–∑–≤–∞–Ω–∏—é: collection');
            } else if (contest.name && contest.name.includes('–ö–æ–Ω–∫—É—Ä—Å –∫–æ–ª–ª–µ–∫—Ü–∏–π')) {
              contestType = 'collection';
              console.log('üìå –¢–∏–ø –∫–æ–Ω–∫—É—Ä—Å–∞ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω –ø–æ –Ω–∞–∑–≤–∞–Ω–∏—é (name): collection');
            } else if (contest.submission_end_date) {
              // –ï—Å–ª–∏ –µ—Å—Ç—å submission_end_date, –Ω–æ –Ω–∞–∑–≤–∞–Ω–∏–µ –Ω–µ —Å–æ–¥–µ—Ä–∂–∏—Ç "–∫–æ–ª–ª–µ–∫—Ü–∏–π", —Ç–æ —ç—Ç–æ –∫–æ–Ω–∫—É—Ä—Å —Ä–∏—Å—É–Ω–∫–æ–≤
              if (contest.title && contest.title.includes('–ö–æ–Ω–∫—É—Ä—Å —Ä–∏—Å—É–Ω–∫–æ–≤')) {
                contestType = 'drawing';
                console.log('üìå –¢–∏–ø –∫–æ–Ω–∫—É—Ä—Å–∞ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω –ø–æ –Ω–∞–ª–∏—á–∏—é submission_end_date –∏ –Ω–∞–∑–≤–∞–Ω–∏—é: drawing');
              } else {
                contestType = 'drawing';
                console.log('üìå –¢–∏–ø –∫–æ–Ω–∫—É—Ä—Å–∞ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω –ø–æ –Ω–∞–ª–∏—á–∏—é submission_end_date: drawing');
              }
            } else if (contest.title && contest.title.includes('–ö–æ–Ω–∫—É—Ä—Å —Ä–∏—Å—É–Ω–∫–æ–≤')) {
              contestType = 'drawing';
              console.log('üìå –¢–∏–ø –∫–æ–Ω–∫—É—Ä—Å–∞ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω –ø–æ –Ω–∞–∑–≤–∞–Ω–∏—é: drawing');
            } else if (contest.name && contest.name.includes('–ö–æ–Ω–∫—É—Ä—Å —Ä–∏—Å—É–Ω–∫–æ–≤')) {
              contestType = 'drawing';
              console.log('üìå –¢–∏–ø –∫–æ–Ω–∫—É—Ä—Å–∞ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω –ø–æ –Ω–∞–∑–≤–∞–Ω–∏—é (name): drawing');
            } else {
              contestType = 'random_comment';
              console.log('üìå –¢–∏–ø –∫–æ–Ω–∫—É—Ä—Å–∞ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é: random_comment');
            }
          }
          
          console.log('üìå –§–∏–Ω–∞–ª—å–Ω—ã–π —Ç–∏–ø –∫–æ–Ω–∫—É—Ä—Å–∞:', contestType);
          
          if (contestType === 'drawing') {
            console.log('‚úÖ –û—Ç–∫—Ä—ã–≤–∞–µ–º –º–æ–¥–∞–ª–∫—É —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –∫–æ–Ω–∫—É—Ä—Å–∞ —Ä–∏—Å—É–Ω–∫–æ–≤');
            await openEditDrawingContestModal(contest);
          } else if (contestType === 'collection') {
            console.log('‚úÖ –û—Ç–∫—Ä—ã–≤–∞–µ–º –º–æ–¥–∞–ª–∫—É —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –∫–æ–Ω–∫—É—Ä—Å–∞ –∫–æ–ª–ª–µ–∫—Ü–∏–π');
            await openEditCollectionContestModal(contest);
          } else {
            console.log('‚úÖ –û—Ç–∫—Ä—ã–≤–∞–µ–º –º–æ–¥–∞–ª–∫—É —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è —Ä–∞–Ω–¥–æ–º –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤');
            await openEditRandomCommentContestModal(contest);
          }
        } catch (e) {
          console.error('‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö –∫–æ–Ω–∫—É—Ä—Å–∞:', e);
          alert('‚ö†Ô∏è –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö –∫–æ–Ω–∫—É—Ä—Å–∞: ' + (e.message || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞'));
        }
      };
      
      // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ—Ç–∫—Ä—ã—Ç–∏—è –º–æ–¥–∞–ª–∫–∏ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –∫–æ–Ω–∫—É—Ä—Å–∞ —Ä–∏—Å—É–Ω–∫–æ–≤
      async function openEditDrawingContestModal(contest) {
        const drawingContestModal = document.getElementById('drawing-contest-modal');
        if (!drawingContestModal) {
          console.error('‚ùå –ú–æ–¥–∞–ª–∫–∞ –∫–æ–Ω–∫—É—Ä—Å–∞ —Ä–∏—Å—É–Ω–∫–æ–≤ –Ω–µ –Ω–∞–π–¥–µ–Ω–∞!');
          alert('‚ö†Ô∏è –û—à–∏–±–∫–∞: –º–æ–¥–∞–ª–∫–∞ –∫–æ–Ω–∫—É—Ä—Å–∞ —Ä–∏—Å—É–Ω–∫–æ–≤ –Ω–µ –Ω–∞–π–¥–µ–Ω–∞');
          return;
        }
        
        // –ò–∑–º–µ–Ω—è–µ–º –∑–∞–≥–æ–ª–æ–≤–æ–∫ –º–æ–¥–∞–ª–∫–∏
        const modalTitle = document.getElementById('drawing-contest-modal-title');
        if (modalTitle) {
          modalTitle.textContent = '–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –∫–æ–Ω–∫—É—Ä—Å —Ä–∏—Å—É–Ω–∫–æ–≤';
        }
        
        // –°–∫—Ä—ã–≤–∞–µ–º –∫–Ω–æ–ø–∫—É —Å–æ–∑–¥–∞–Ω–∏—è, –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –∫–Ω–æ–ø–∫—É –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è
        const submitBtn = document.getElementById('submit-drawing-contest');
        const updateBtn = document.getElementById('update-drawing-contest');
        if (submitBtn) submitBtn.classList.add('hidden');
        if (updateBtn) updateBtn.classList.remove('hidden');
        
        // –ò–∑–≤–ª–µ–∫–∞–µ–º —Ç–µ–º—É –∏–∑ –Ω–∞–∑–≤–∞–Ω–∏—è –∫–æ–Ω–∫—É—Ä—Å–∞ (—Ñ–æ—Ä–º–∞—Ç: "–ö–æ–Ω–∫—É—Ä—Å —Ä–∏—Å—É–Ω–∫–æ–≤: –¢–µ–º–∞")
        const contestName = contest.title || contest.name || '';
        const themeMatch = contestName.match(/–ö–æ–Ω–∫—É—Ä—Å —Ä–∏—Å—É–Ω–∫–æ–≤:\s*(.+)/i);
        const theme = themeMatch ? themeMatch[1].trim() : contestName.replace(/–ö–æ–Ω–∫—É—Ä—Å —Ä–∏—Å—É–Ω–∫–æ–≤:\s*/i, '').trim();
        
        // –ó–∞–ø–æ–ª–Ω—è–µ–º –ø–æ–ª—è —Ñ–æ—Ä–º—ã
        const themeInput = document.getElementById('drawing-contest-theme');
        if (themeInput) themeInput.value = theme;
        
        // –ü–æ–ª—É—á–∞–µ–º —Ç–µ–∫—É—â–∏–µ —É—Å–ª–æ–≤–∏—è –∫–æ–Ω–∫—É—Ä—Å–∞
        const conditions = contest.conditions || '';
        
        // –ü—ã—Ç–∞–µ–º—Å—è –Ω–∞–π—Ç–∏ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —É—Å–ª–æ–≤–∏—è (–≤—Å—ë, —á—Ç–æ –∏–¥–µ—Ç –ø–æ—Å–ª–µ –±–∞–∑–æ–≤—ã—Ö —É—Å–ª–æ–≤–∏–π)
        // –ë–∞–∑–æ–≤—ã–µ —É—Å–ª–æ–≤–∏—è –æ–±—ã—á–Ω–æ –∑–∞–∫–∞–Ω—á–∏–≤–∞—é—Ç—Å—è –Ω–∞ "–û—Ç–ø—Ä–∞–≤–∏—Ç—å —Ä–∏—Å—É–Ω–æ–∫ –Ω–∞ –∑–∞–¥–∞–Ω–Ω—É—é —Ç–µ–º—É"
        // –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —É—Å–ª–æ–≤–∏—è –∏–¥—É—Ç –ø–æ—Å–ª–µ —ç—Ç–æ–≥–æ, –≤–æ–∑–º–æ–∂–Ω–æ —Å —Ä–∞–∑–¥–µ–ª–∏—Ç–µ–ª—è–º–∏
        let additionalConditions = '';
        const baseConditionsEndPattern = /–û—Ç–ø—Ä–∞–≤–∏—Ç—å —Ä–∏—Å—É–Ω–æ–∫ –Ω–∞ –∑–∞–¥–∞–Ω–Ω—É—é —Ç–µ–º—É[\s\n]*/i;
        const match = conditions.search(baseConditionsEndPattern);
        if (match !== -1) {
          // –ù–∞—Ö–æ–¥–∏–º –∫–æ–Ω–µ—Ü –±–∞–∑–æ–≤—ã—Ö —É—Å–ª–æ–≤–∏–π
          const baseEndPos = match + conditions.substring(match).match(baseConditionsEndPattern)[0].length;
          // –í—Å—ë –ø–æ—Å–ª–µ –±–∞–∑–æ–≤—ã—Ö —É—Å–ª–æ–≤–∏–π - –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —É—Å–ª–æ–≤–∏—è
          additionalConditions = conditions.substring(baseEndPos).trim();
          // –£–±–∏—Ä–∞–µ–º –≤–æ–∑–º–æ–∂–Ω—ã–µ —Ä–∞–∑–¥–µ–ª–∏—Ç–µ–ª–∏ (–¥–≤–æ–π–Ω—ã–µ –ø–µ—Ä–µ–Ω–æ—Å—ã —Å—Ç—Ä–æ–∫, —Ç–æ—á–∫–∏ –∏ —Ç.–¥.)
          additionalConditions = additionalConditions.replace(/^[\n\r\s\-\.]+/, '').trim();
        }
        
        // –ó–∞–ø–æ–ª–Ω—è–µ–º –±–∞–∑–æ–≤—ã–µ —É—Å–ª–æ–≤–∏—è (readonly)
        const baseConditionsInput = document.getElementById('drawing-contest-conditions-base');
        if (baseConditionsInput) {
          // –ó–∞–≥—Ä—É–∂–∞–µ–º –¥–∞–Ω–Ω—ã–µ –ø—Ä–æ—Ñ–∏–ª—è –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –∞–∫—Ç—É–∞–ª—å–Ω—ã—Ö —É—Å–ª–æ–≤–∏–π –ø–æ–¥–ø–∏—Å–∫–∏
          try {
            const profileResponse = await fetchJSON(`/api/profile?tg_id=${currentUserId}`);
            const userRole = profileResponse.status || 'user';
            const adminChannelLink = profileResponse.channel_link || '';
            const adminChatLink = profileResponse.chat_link || '';
            const creatorChannelLink = 't.me/monkeys_giveaways';
            
            // –§–æ—Ä–º–∏—Ä—É–µ–º –±–∞–∑–æ–≤—ã–µ —É—Å–ª–æ–≤–∏—è —É—á–∞—Å—Ç–∏—è
            let baseConditionsText = '–î–ª—è —É—á–∞—Å—Ç–∏—è –≤ –∫–æ–Ω–∫—É—Ä—Å–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ:\n';
            
            if (userRole === 'admin') {
              if (adminChannelLink) {
                baseConditionsText += `- –ü–æ–¥–ø–∏—Å–∞—Ç—å—Å—è –Ω–∞ –∫–∞–Ω–∞–ª –∞–¥–º–∏–Ω–∞: ${adminChannelLink}\n`;
              }
              if (adminChatLink) {
                baseConditionsText += `- –ü–æ–¥–ø–∏—Å–∞—Ç—å—Å—è –Ω–∞ —á–∞—Ç –∞–¥–º–∏–Ω–∞: ${adminChatLink}\n`;
              }
            }
            
            baseConditionsText += `- –ü–æ–¥–ø–∏—Å–∞—Ç—å—Å—è –Ω–∞ –∫–∞–Ω–∞–ª —Å–æ–∑–¥–∞—Ç–µ–ª—è: ${creatorChannelLink}\n`;
            baseConditionsText += '- –û—Ç–ø—Ä–∞–≤–∏—Ç—å —Ä–∏—Å—É–Ω–æ–∫ –Ω–∞ –∑–∞–¥–∞–Ω–Ω—É—é —Ç–µ–º—É';
            
            baseConditionsInput.value = baseConditionsText;
            originalBaseValue = baseConditionsText;
            
            // –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º –∑–∞—â–∏—Ç—É –±–∞–∑–æ–≤—ã—Ö —É—Å–ª–æ–≤–∏–π
            if (typeof window.setupBaseConditionsProtection === 'function') {
              window.setupBaseConditionsProtection();
            }
          } catch (error) {
            console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö –ø—Ä–æ—Ñ–∏–ª—è:', error);
            // –ò—Å–ø–æ–ª—å–∑—É–µ–º –±–∞–∑–æ–≤—ã–µ —É—Å–ª–æ–≤–∏—è –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
            const fallbackConditions = '–î–ª—è —É—á–∞—Å—Ç–∏—è –≤ –∫–æ–Ω–∫—É—Ä—Å–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ:\n- –ü–æ–¥–ø–∏—Å–∞—Ç—å—Å—è –Ω–∞ –∫–∞–Ω–∞–ª —Å–æ–∑–¥–∞—Ç–µ–ª—è: t.me/monkeys_giveaways\n- –û—Ç–ø—Ä–∞–≤–∏—Ç—å —Ä–∏—Å—É–Ω–æ–∫ –Ω–∞ –∑–∞–¥–∞–Ω–Ω—É—é —Ç–µ–º—É';
            baseConditionsInput.value = fallbackConditions;
            originalBaseValue = fallbackConditions;
            
            // –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º –∑–∞—â–∏—Ç—É –±–∞–∑–æ–≤—ã—Ö —É—Å–ª–æ–≤–∏–π
            if (typeof window.setupBaseConditionsProtection === 'function') {
              window.setupBaseConditionsProtection();
            }
          }
        }
        
        // –ó–∞–ø–æ–ª–Ω—è–µ–º –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —É—Å–ª–æ–≤–∏—è
        const additionalConditionsInput = document.getElementById('drawing-contest-conditions-additional');
        if (additionalConditionsInput) {
          additionalConditionsInput.value = additionalConditions;
        }
        
        // –ó–∞–ø–æ–ª–Ω—è–µ–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–æ–±–µ–¥–∏—Ç–µ–ª–µ–π
        const winnersCount = contest.winners_count || 1;
        const winnersCountValueEl = document.getElementById('drawing-winners-count-value');
        const winnersCountInputEl = document.getElementById('drawing-contest-winners-count');
        if (winnersCountValueEl) winnersCountValueEl.textContent = winnersCount;
        if (winnersCountInputEl) winnersCountInputEl.value = winnersCount;
        currentDrawingWinnersCount = winnersCount;
        
        // –ó–∞–ø–æ–ª–Ω—è–µ–º –¥–∞—Ç—ã
        if (contest.submission_end_date || contest.submission_end_date_local) {
          const submissionEndInput = document.getElementById('drawing-contest-submission-end');
          if (submissionEndInput) {
            const submissionRaw = contest.submission_end_date_local || contest.submission_end_date;
            submissionEndInput.value = toDatetimeLocalValue(submissionRaw);
          }
        }
        
        if (contest.end_date || contest.end_at || contest.end_at_local) {
          const votingEndInput = document.getElementById('drawing-contest-voting-end');
          if (votingEndInput) {
            const votingRaw = contest.end_at_local || contest.end_date || contest.end_at;
            votingEndInput.value = toDatetimeLocalValue(votingRaw);
          }
        }
        
        // –û—Ç–∫—Ä—ã–≤–∞–µ–º –º–æ–¥–∞–ª–∫—É
        openModal(drawingContestModal);
      }
      
      // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ—Ç–∫—Ä—ã—Ç–∏—è –º–æ–¥–∞–ª–∫–∏ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –∫–æ–Ω–∫—É—Ä—Å–∞ –∫–æ–ª–ª–µ–∫—Ü–∏–π
      async function openEditCollectionContestModal(contest) {
        const collectionContestModal = document.getElementById('collection-contest-modal');
        if (!collectionContestModal) {
          console.error('‚ùå –ú–æ–¥–∞–ª–∫–∞ –∫–æ–Ω–∫—É—Ä—Å–∞ –∫–æ–ª–ª–µ–∫—Ü–∏–π –Ω–µ –Ω–∞–π–¥–µ–Ω–∞!');
          alert('‚ö†Ô∏è –û—à–∏–±–∫–∞: –º–æ–¥–∞–ª–∫–∞ –∫–æ–Ω–∫—É—Ä—Å–∞ –∫–æ–ª–ª–µ–∫—Ü–∏–π –Ω–µ –Ω–∞–π–¥–µ–Ω–∞');
          return;
        }
        
        // –ò–∑–º–µ–Ω—è–µ–º –∑–∞–≥–æ–ª–æ–≤–æ–∫ –º–æ–¥–∞–ª–∫–∏
        const modalTitle = document.getElementById('collection-contest-modal-title');
        if (modalTitle) {
          modalTitle.textContent = '–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –∫–æ–Ω–∫—É—Ä—Å –∫–æ–ª–ª–µ–∫—Ü–∏–π';
        }
        
        // –°–∫—Ä—ã–≤–∞–µ–º –∫–Ω–æ–ø–∫—É —Å–æ–∑–¥–∞–Ω–∏—è, –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –∫–Ω–æ–ø–∫—É –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è
        const submitBtn = document.getElementById('submit-collection-contest');
        const updateBtn = document.getElementById('update-collection-contest');
        if (submitBtn) submitBtn.classList.add('hidden');
        if (updateBtn) updateBtn.classList.remove('hidden');
        
        // –ò–∑–≤–ª–µ–∫–∞–µ–º —Ç–µ–º—É –∏–∑ –Ω–∞–∑–≤–∞–Ω–∏—è –∫–æ–Ω–∫—É—Ä—Å–∞ (—Ñ–æ—Ä–º–∞—Ç: "–ö–æ–Ω–∫—É—Ä—Å –∫–æ–ª–ª–µ–∫—Ü–∏–π: –¢–µ–º–∞")
        const contestName = contest.title || contest.name || '';
        const themeMatch = contestName.match(/–ö–æ–Ω–∫—É—Ä—Å –∫–æ–ª–ª–µ–∫—Ü–∏–π:\s*(.+)/i);
        const theme = themeMatch ? themeMatch[1].trim() : contestName.replace(/–ö–æ–Ω–∫—É—Ä—Å –∫–æ–ª–ª–µ–∫—Ü–∏–π:\s*/i, '').trim();
        
        // –ó–∞–ø–æ–ª–Ω—è–µ–º –ø–æ–ª—è —Ñ–æ—Ä–º—ã
        const themeInput = document.getElementById('collection-contest-theme');
        if (themeInput) themeInput.value = theme;
        
        // –ü–æ–ª—É—á–∞–µ–º —Ç–µ–∫—É—â–∏–µ —É—Å–ª–æ–≤–∏—è –∫–æ–Ω–∫—É—Ä—Å–∞
        const conditions = contest.conditions || '';
        
        // –ü—ã—Ç–∞–µ–º—Å—è –Ω–∞–π—Ç–∏ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —É—Å–ª–æ–≤–∏—è
        let additionalConditions = '';
        const baseConditionsEndPattern = /–û—Ç–ø—Ä–∞–≤–∏—Ç—å –∫–æ–ª–ª–µ–∫—Ü–∏—é –∏–∑ 9 NFT[\s\n]*/i;
        const match = conditions.search(baseConditionsEndPattern);
        if (match !== -1) {
          const baseEndPos = match + conditions.substring(match).match(baseConditionsEndPattern)[0].length;
          additionalConditions = conditions.substring(baseEndPos).trim();
          additionalConditions = additionalConditions.replace(/^[\n\r\s\-\.]+/, '').trim();
        }
        
        // –ó–∞–ø–æ–ª–Ω—è–µ–º –±–∞–∑–æ–≤—ã–µ —É—Å–ª–æ–≤–∏—è (readonly)
        const baseConditionsInput = document.getElementById('collection-contest-conditions-base');
        if (baseConditionsInput) {
          // –ó–∞–≥—Ä—É–∂–∞–µ–º –¥–∞–Ω–Ω—ã–µ –ø—Ä–æ—Ñ–∏–ª—è –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –∞–∫—Ç—É–∞–ª—å–Ω—ã—Ö —É—Å–ª–æ–≤–∏–π –ø–æ–¥–ø–∏—Å–∫–∏
          try {
            const profileResponse = await fetchJSON(`/api/profile?tg_id=${currentUserId}`);
            const userRole = profileResponse.status || 'user';
            const adminChannelLink = profileResponse.channel_link || '';
            const adminChatLink = profileResponse.chat_link || '';
            const creatorChannelLink = 't.me/monkeys_giveaways';
            
            // –§–æ—Ä–º–∏—Ä—É–µ–º –±–∞–∑–æ–≤—ã–µ —É—Å–ª–æ–≤–∏—è —É—á–∞—Å—Ç–∏—è
            let baseConditionsText = '–î–ª—è —É—á–∞—Å—Ç–∏—è –≤ –∫–æ–Ω–∫—É—Ä—Å–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ:\n';
            
            if (userRole === 'admin') {
              if (adminChannelLink) {
                baseConditionsText += `- –ü–æ–¥–ø–∏—Å–∞—Ç—å—Å—è –Ω–∞ –∫–∞–Ω–∞–ª –∞–¥–º–∏–Ω–∞: ${adminChannelLink}\n`;
              }
              if (adminChatLink) {
                baseConditionsText += `- –ü–æ–¥–ø–∏—Å–∞—Ç—å—Å—è –Ω–∞ —á–∞—Ç –∞–¥–º–∏–Ω–∞: ${adminChatLink}\n`;
              }
            }
            
            baseConditionsText += `- –ü–æ–¥–ø–∏—Å–∞—Ç—å—Å—è –Ω–∞ –∫–∞–Ω–∞–ª —Å–æ–∑–¥–∞—Ç–µ–ª—è: ${creatorChannelLink}\n`;
            baseConditionsText += '- –û—Ç–ø—Ä–∞–≤–∏—Ç—å –∫–æ–ª–ª–µ–∫—Ü–∏—é –∏–∑ 9 NFT';
            
            baseConditionsInput.value = baseConditionsText;
            originalBaseValue = baseConditionsText;
          } catch (error) {
            console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö –ø—Ä–æ—Ñ–∏–ª—è:', error);
            // –ò—Å–ø–æ–ª—å–∑—É–µ–º —É—Å–ª–æ–≤–∏—è –∏–∑ –∫–æ–Ω–∫—É—Ä—Å–∞, –µ—Å–ª–∏ –Ω–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å –ø—Ä–æ—Ñ–∏–ª—å
            baseConditionsInput.value = conditions;
          }
        }
        
        // –ó–∞–ø–æ–ª–Ω—è–µ–º –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —É—Å–ª–æ–≤–∏—è
        const additionalConditionsInput = document.getElementById('collection-contest-conditions-additional');
        if (additionalConditionsInput) {
          additionalConditionsInput.value = additionalConditions;
        }
        
        // –ó–∞–ø–æ–ª–Ω—è–µ–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–æ–±–µ–¥–∏—Ç–µ–ª–µ–π
        const winnersCount = contest.winners_count || 1;
        currentCollectionWinnersCount = winnersCount;
        const winnersCountValueEl = document.getElementById('collection-winners-count-value');
        const winnersCountInputEl = document.getElementById('collection-contest-winners-count');
        if (winnersCountValueEl) winnersCountValueEl.textContent = winnersCount;
        if (winnersCountInputEl) winnersCountInputEl.value = winnersCount;
        
        // –ó–∞–ø–æ–ª–Ω—è–µ–º –¥–∞—Ç—É –æ–∫–æ–Ω—á–∞–Ω–∏—è –ø—Ä–∏–µ–º–∞ —Ä–∞–±–æ—Ç
        if (contest.submission_end_date || contest.submission_end_date_local) {
          const submissionEndInput = document.getElementById('collection-contest-submission-end');
          if (submissionEndInput) {
            const submissionRaw = contest.submission_end_date_local || contest.submission_end_date;
            submissionEndInput.value = toDatetimeLocalValue(submissionRaw);
          }
        }
        
        // –ó–∞–ø–æ–ª–Ω—è–µ–º –¥–∞—Ç—É –æ–∫–æ–Ω—á–∞–Ω–∏—è –≥–æ–ª–æ—Å–æ–≤–∞–Ω–∏—è
        if (contest.end_date || contest.end_at || contest.end_at_local) {
          const votingEndInput = document.getElementById('collection-contest-voting-end');
          if (votingEndInput) {
            const votingRaw = contest.end_at_local || contest.end_date || contest.end_at;
            votingEndInput.value = toDatetimeLocalValue(votingRaw);
          }
        }
        
        // –û—Ç–∫—Ä—ã–≤–∞–µ–º –º–æ–¥–∞–ª–∫—É
        openModal(collectionContestModal);
      }
      
      // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ—Ç–∫—Ä—ã—Ç–∏—è –º–æ–¥–∞–ª–∫–∏ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è —Ä–∞–Ω–¥–æ–º –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤
      async function openEditRandomCommentContestModal(contest) {
        // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ –º–æ–¥–∞–ª–∫–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–∞
        if (!editContestModal) {
          editContestModal = document.getElementById('edit-contest-modal');
          if (!editContestModal) {
            console.error('‚ùå –ú–æ–¥–∞–ª–∫–∞ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –∫–æ–Ω–∫—É—Ä—Å–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω–∞!');
            alert('‚ö†Ô∏è –û—à–∏–±–∫–∞: –º–æ–¥–∞–ª–∫–∞ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –Ω–µ –Ω–∞–π–¥–µ–Ω–∞');
            return;
          }
        }
        
        // –°–∫—Ä—ã–≤–∞–µ–º –ø–æ–ª–µ –ø—Ä–∏–∑–∞ –¥–ª—è —Ä–∞–Ω–¥–æ–º –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤
        const prizeContainer = document.getElementById('edit-contest-prize-container');
        if (prizeContainer) {
          prizeContainer.style.display = 'none';
        }
        
        // –ó–∞–ø–æ–ª–Ω—è–µ–º –ø–æ–ª—è —Ñ–æ—Ä–º—ã
        const titleInput = document.getElementById('edit-contest-title');
        const postLinkInput = document.getElementById('edit-contest-post-link');
        const conditionsInput = document.getElementById('edit-contest-conditions');
        const startInput = document.getElementById('edit-contest-start');
        const endInput = document.getElementById('edit-contest-end');
        
        // –ó–∞–ø–æ–ª–Ω—è–µ–º –ø–æ–ª—è - –Ω–∞–∑–≤–∞–Ω–∏–µ –∫–æ–Ω–∫—É—Ä—Å–∞ –Ω–µ —Ä–µ–¥–∞–∫—Ç–∏—Ä—É–µ—Ç—Å—è –¥–ª—è —Ä–∞–Ω–¥–æ–º –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤
        if (titleInput) {
          titleInput.value = contest.title || contest.name || '–†–∞–Ω–¥–æ–º–Ω—ã–π –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π';
          titleInput.readOnly = true;
          titleInput.disabled = true;
          titleInput.style.cursor = 'not-allowed';
          titleInput.style.backgroundColor = '#1a1a2e';
        }
        if (postLinkInput) {
          postLinkInput.value = contest.post_link || '';
          postLinkInput.readOnly = false;
          postLinkInput.disabled = false;
        }
        if (conditionsInput) {
          conditionsInput.value = contest.conditions || '';
          conditionsInput.readOnly = false;
          conditionsInput.disabled = false;
        }
        if (startInput) {
          startInput.readOnly = false;
          startInput.disabled = false;
        }
        if (endInput) {
          endInput.readOnly = false;
          endInput.disabled = false;
        }
        
        // –§–æ—Ä–º–∞—Ç–∏—Ä—É–µ–º –¥–∞—Ç—ã –¥–ª—è datetime-local
        if (startInput) startInput.value = '';
        if (endInput) endInput.value = '';
        
        console.log('‚úÖ –û—Ç–∫—Ä—ã–≤–∞–µ–º –º–æ–¥–∞–ª–∫—É —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è —Ä–∞–Ω–¥–æ–º –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤');
        openModal(editContestModal);
      }

      window.openEditAdminModal = async function(adminId) {
        console.log('üîß –û—Ç–∫—Ä—ã–≤–∞–µ–º –º–æ–¥–∞–ª–∫—É —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –∞–¥–º–∏–Ω–∞, ID:', adminId);
        currentEditAdminId = adminId;
        
        // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ –º–æ–¥–∞–ª–∫–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–∞
        if (!editAdminModal) {
          editAdminModal = document.getElementById('edit-admin-modal');
          if (!editAdminModal) {
            console.error('‚ùå –ú–æ–¥–∞–ª–∫–∞ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –∞–¥–º–∏–Ω–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω–∞!');
            alert('‚ö†Ô∏è –û—à–∏–±–∫–∞: –º–æ–¥–∞–ª–∫–∞ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –Ω–µ –Ω–∞–π–¥–µ–Ω–∞');
            return;
          }
        }
        
        try {
          // –ü—Ä–µ–æ–±—Ä–∞–∑—É–µ–º ID –≤ —á–∏—Å–ª–æ, –µ—Å–ª–∏ —ç—Ç–æ —Å—Ç—Ä–æ–∫–∞
          const id = typeof adminId === 'string' ? parseInt(adminId) : adminId;
          console.log('üì• –ó–∞–≥—Ä—É–∂–∞–µ–º –¥–∞–Ω–Ω—ã–µ –∞–¥–º–∏–Ω–∞, ID:', id);
          
          // –ü–æ–ª—É—á–∞–µ–º –¥–∞–Ω–Ω—ã–µ –∞–¥–º–∏–Ω–∞ –∏–∑ –ø—Ä–æ—Ñ–∏–ª—è
          const profile = await fetchJSON(`/api/profile?tg_id=${id}`);
          console.log('‚úÖ –ü–æ–ª—É—á–µ–Ω –ø—Ä–æ—Ñ–∏–ª—å –∞–¥–º–∏–Ω–∞:', profile);
          
          const idInput = document.getElementById('edit-modal-admin-id');
          const usernameInput = document.getElementById('edit-modal-admin-username');
          const channelInput = document.getElementById('edit-modal-admin-channel');
          const chatInput = document.getElementById('edit-modal-admin-chat');
          
          if (idInput) idInput.value = id;
          if (usernameInput) usernameInput.value = profile.username || '';
          if (channelInput) channelInput.value = profile.channel_link || '';
          if (chatInput) chatInput.value = profile.chat_link || '';
          
          console.log('‚úÖ –û—Ç–∫—Ä—ã–≤–∞–µ–º –º–æ–¥–∞–ª–∫—É —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –∞–¥–º–∏–Ω–∞');
          openModal(editAdminModal);
        } catch (e) {
          console.error('‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞:', e);
          alert('‚ö†Ô∏è –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞: ' + (e.message || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞'));
        }
      };

      // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –¥–ª—è updateContest –∏ updateAdmin —É–∂–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã –≤ —Ñ—É–Ω–∫—Ü–∏–∏ init()

      async function loadAdmins() {
        try {
          if (!adminsList) {
            console.error('adminsList –Ω–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω');
            return;
          }
          const admins = await fetchJSON('/api/admins');
          adminsList.innerHTML = '';
          admins.forEach(a => {
            const item = document.createElement('div');
            item.className = 'deletable-item rounded-lg border border-violet-400/30 p-3 bg-black/30 flex items-center justify-between';
            item.dataset.adminId = a.id;
            const adminName = a.username || ('ID ' + a.id);
            item.innerHTML = `<div>
                                <div class="font-medium">${adminName}</div>
                                <div class="text-xs text-gray-400">ID: ${a.id}</div>
                              </div>`;
            adminsList.appendChild(item);
            // –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º long press –ø–æ—Å–ª–µ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –≤ DOM
            setupLongPress(item, a.id, 'admin', adminName);
          });
        } catch (e) {
          console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∞–¥–º–∏–Ω–æ–≤:', e);
        }
      }

      // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –¥–ª—è submitAdmin —É–∂–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –≤ —Ñ—É–Ω–∫—Ü–∏–∏ init()

      // First-login marker: record on first open (client hint + let backend persist)
      try {
        if (!localStorage.getItem('first_login_ts')) {
          const ts = new Date().toISOString();
          localStorage.setItem('first_login_ts', ts);
          // optional notify backend
          fetch('/api/profile/first_login', { method: 'POST' }).catch(() => {});
        }
        const stored = localStorage.getItem('first_login_ts');
        if (stored) document.getElementById('profile-first-login').textContent = toMoscowDateTime(stored);
      } catch (e) {}

      // Messages functionality for creator
      // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –¥–ª—è messagesBtn –∏ closeMessagesModal —É–∂–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã –≤ —Ñ—É–Ω–∫—Ü–∏–∏ init()
      const messagesList = document.getElementById('messages-list');
      const messagesCount = document.getElementById('messages-count');
      const messageDetailModal = document.getElementById('message-detail-modal');
      const closeMessageDetailModal = document.getElementById('close-message-detail-modal');
      const approveMessageBtn = document.getElementById('approve-message-btn');
      const rejectMessageBtn = document.getElementById('reject-message-btn');
      let currentMessageId = null;

      if (closeMessageDetailModal && messageDetailModal) {
        closeMessageDetailModal.addEventListener('click', () => closeModal(messageDetailModal));
      }

      async function loadMessages() {
        try {
          const messages = await fetchJSON('/api/messages?status=pending');
          messagesList.innerHTML = '';
          
          if (messages.length === 0) {
            messagesList.innerHTML = '<div class="text-gray-500 text-center py-8">–ù–µ—Ç –Ω–æ–≤—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π</div>';
            return;
          }

          messages.forEach(msg => {
            const messageItem = document.createElement('div');
            messageItem.className = 'message-item rounded-lg border border-violet-400/30 p-4 bg-black/30 cursor-pointer hover:border-violet-400/50 transition-colors';
            messageItem.style.minHeight = '100px';
            messageItem.dataset.messageId = msg.id;
            
            // –ü—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä —Ç–µ–∫—Å—Ç–∞ (–ø–µ—Ä–≤—ã–µ 100 —Å–∏–º–≤–æ–ª–æ–≤)
            const previewText = msg.message_text.length > 100 
              ? msg.message_text.substring(0, 100) + '...' 
              : msg.message_text;
            
            messageItem.innerHTML = `
              <div class="flex justify-between items-start mb-2">
                <div class="text-sm text-violet-400 font-semibold">ID: ${msg.from_user_id}</div>
                <div class="text-xs text-gray-500">${toMoscowDateTime(msg.created_at)}</div>
              </div>
              <div class="text-sm text-gray-300 line-clamp-3">${previewText}</div>
            `;
            
            messageItem.addEventListener('click', () => {
              currentMessageId = msg.id;
              document.getElementById('message-sender-id').textContent = msg.from_user_id;
              document.getElementById('message-full-text').textContent = msg.message_text;
              openModal(messageDetailModal);
            });
            
            messagesList.appendChild(messageItem);
          });
        } catch (e) {
          messagesList.innerHTML = '<div class="text-red-400 text-center py-8">–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Å–æ–æ–±—â–µ–Ω–∏–π</div>';
        }
      }

      async function updateMessagesCount() {
        try {
          const data = await fetchJSON('/api/messages/unread-count');
          const count = data.count || 0;
          if (count > 0) {
            messagesCount.textContent = count;
            messagesCount.classList.remove('hidden');
          } else {
            messagesCount.classList.add('hidden');
          }
        } catch (e) {
          // ignore
        }
      }

      if (approveMessageBtn) {
        approveMessageBtn.addEventListener('click', async () => {
          if (!currentMessageId) return;
          try {
            await fetchJSON(`/api/messages/${currentMessageId}/respond`, {
              method: 'PUT',
              headers: { 'Content-Type': 'application/json' },
              body: JSON.stringify({ action: 'approve' })
            });
            closeModal(messageDetailModal);
            await loadMessages();
            await updateMessagesCount();
          } catch (e) {
            alert('–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ–¥–æ–±—Ä–µ–Ω–∏–∏ —Å–æ–æ–±—â–µ–Ω–∏—è');
          }
        });
      }

      if (rejectMessageBtn) {
        rejectMessageBtn.addEventListener('click', async () => {
          if (!currentMessageId) return;
          try {
            await fetchJSON(`/api/messages/${currentMessageId}/respond`, {
              method: 'PUT',
              headers: { 'Content-Type': 'application/json' },
              body: JSON.stringify({ action: 'reject' })
            });
            closeModal(messageDetailModal);
            await loadMessages();
            await updateMessagesCount();
          } catch (e) {
            alert('–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ç–∫–ª–æ–Ω–µ–Ω–∏–∏ —Å–æ–æ–±—â–µ–Ω–∏—è');
          }
        });
      }

      // –û–±–Ω–æ–≤–ª—è–µ–º —Å—á–µ—Ç—á–∏–∫ —Å–æ–æ–±—â–µ–Ω–∏–π –ø–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–∏ –∏ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ –ø—Ä–æ—Ñ–∏–ª—è
      setInterval(updateMessagesCount, 30000); // –ö–∞–∂–¥—ã–µ 30 —Å–µ–∫—É–Ω–¥

      // Profile
      async function loadProfile() {
        try {
          const params = new URLSearchParams(window.location.search);
          const tgId = params.get('tg_id');
          const p = await fetchJSON(`/api/profile?tg_id=${tgId || ''}`);
          const usernameEl = document.getElementById('profile-username');
          if (usernameEl) {
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º username –µ—Å–ª–∏ –µ—Å—Ç—å, –∏–Ω–∞—á–µ MONKEY BOSS
            if (p.username) {
              usernameEl.textContent = p.username;
            } else {
              usernameEl.textContent = 'MONKEY BOSS';
            }
          }
          const profileIdEl = document.getElementById('profile-id');
          if (profileIdEl && p.id) profileIdEl.textContent = p.id;
          if (p.first_login) document.getElementById('profile-first-login').textContent = toMoscowDateTime(p.first_login);
          if (p.status) document.getElementById('profile-status').textContent = p.status;
        } catch (e) {
          // ignore
        }
      }

      // Rating - –∑–∞–≥—Ä—É–∑–∫–∞ —Ä–µ–π—Ç–∏–Ω–≥–∞
      let currentRatingRole = 'user';
      
      window.loadRating = async function(role = 'user') {
        try {
          currentRatingRole = role;
          const ratingList = document.getElementById('rating-list');
          if (!ratingList) return;
          
          ratingList.innerHTML = '<div class="text-center text-gray-400 py-8">–ó–∞–≥—Ä—É–∑–∫–∞ —Ä–µ–π—Ç–∏–Ω–≥–∞...</div>';
          
          const response = await fetchJSON(`/api/rating?role=${role}`);
          
          if (!response.success || !response.ratings) {
            ratingList.innerHTML = '<div class="text-center text-red-400 py-8">–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Ä–µ–π—Ç–∏–Ω–≥–∞</div>';
            return;
          }
          
          const ratings = response.ratings;
          if (ratings.length === 0) {
            ratingList.innerHTML = '<div class="text-center text-gray-400 py-8">–†–µ–π—Ç–∏–Ω–≥ –ø—É—Å—Ç</div>';
            return;
          }
          
          let html = '';
          ratings.forEach((item) => {
            const avatarHtml = item.avatar_url 
              ? `<img src="${item.avatar_url}" alt="${item.username}" class="w-10 h-10 rounded-full object-cover" />`
              : `<div class="w-10 h-10 rounded-full bg-gradient-to-br from-violet-500 to-pink-500 flex items-center justify-center text-lg font-bold">${item.username ? item.username.charAt(0).toUpperCase() : '?'}</div>`;
            
            html += `
              <div class="rounded-lg border border-violet-400/30 p-4 bg-black/30 flex items-center gap-3">
                <div class="text-2xl font-bold text-violet-400 w-10 text-center flex-shrink-0">${item.place}</div>
                <div class="w-10 h-10 flex-shrink-0 flex items-center justify-center">${avatarHtml}</div>
                <div class="flex-1 min-w-0">
                  <div class="font-semibold text-white truncate">${item.username || `User_${item.telegram_id}`}</div>
                  <div class="text-sm text-gray-400 whitespace-nowrap">–ü–æ–±–µ–¥: ${item.wins} | –£—á–∞—Å—Ç–∏–π: ${item.participations}</div>
                </div>
                <div class="text-right flex-shrink-0 w-20">
                  <div class="text-xl font-bold text-violet-400">${item.rating}</div>
                  <div class="text-xs text-gray-400">—Ä–µ–π—Ç–∏–Ω–≥</div>
                </div>
              </div>
            `;
          });
          
          ratingList.innerHTML = html;
        } catch (e) {
          console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Ä–µ–π—Ç–∏–Ω–≥–∞:', e);
          const ratingList = document.getElementById('rating-list');
          if (ratingList) {
            ratingList.innerHTML = '<div class="text-center text-red-400 py-8">–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Ä–µ–π—Ç–∏–Ω–≥–∞</div>';
          }
        }
      };
      
      // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è —Ä–µ–π—Ç–∏–Ω–≥–∞
      setTimeout(function() {
        const usersBtn = document.getElementById('rating-users-btn');
        const adminsBtn = document.getElementById('rating-admins-btn');
        
        if (usersBtn) {
          usersBtn.addEventListener('click', () => {
            usersBtn.classList.add('active');
            if (adminsBtn) adminsBtn.classList.remove('active');
            window.loadRating('user');
          });
        }
        
        if (adminsBtn) {
          adminsBtn.addEventListener('click', () => {
            adminsBtn.classList.add('active');
            if (usersBtn) usersBtn.classList.remove('active');
            window.loadRating('admin');
          });
        }
      }, 1000);

      // Fallback: read params for id/username/role if provided by initial login redirect
      (function readParamsFallback(){
        const params = new URLSearchParams(window.location.search);
        const pid = params.get('tg_id');
        const puser = params.get('username');
        const prole = params.get('role');
        if (pid && !document.getElementById('profile-id').textContent) {
          document.getElementById('profile-id').textContent = pid;
        }
        const usernameEl = document.getElementById('profile-username');
        if (usernameEl && !usernameEl.textContent) {
          if (puser) {
            usernameEl.textContent = puser;
          } else {
            usernameEl.textContent = 'MONKEY BOSS';
          }
        }
        if (prole) {
          document.getElementById('profile-status').textContent = prole;
        }
      })();

      // –û–±—Ä–∞–±–æ—Ç–∫–∞ –∑–∞–∫—Ä—ã—Ç–∏—è –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞ —É–¥–∞–ª–µ–Ω–∏—è –ø–æ –∫–ª–∏–∫—É –Ω–∞ —Ñ–æ–Ω
      document.getElementById('delete-confirm-modal').addEventListener('click', (e) => {
        if (e.target.id === 'delete-confirm-modal') {
          document.getElementById('delete-confirm-modal').classList.add('hidden');
        }
      });
      
      // –ú–æ–¥–∞–ª–∫–∞ –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –ø—Ä–∏–∑–æ–≤
      // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –¥–ª—è closePrizesModal –∏ addPrizeBtn —É–∂–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã –≤ —Ñ—É–Ω–∫—Ü–∏–∏ init()
      const submitPrizesBtn = document.getElementById('submit-prizes');
      
      // –û–ø—Ä–µ–¥–µ–ª—è–µ–º —Ñ—É–Ω–∫—Ü–∏—é openPrizesModal
      openPrizesModal = function() {
        const prizesListEl = document.getElementById('prizes-list');
        if (!prizesListEl) {
          console.error('prizesList –Ω–µ –Ω–∞–π–¥–µ–Ω!');
          return;
        }
        prizesListEl.innerHTML = '';
        const winnersCount = window.currentWinnersCount || 1;
        console.log('–û—Ç–∫—Ä—ã–≤–∞–µ–º –º–æ–¥–∞–ª–∫—É –ø—Ä–∏–∑–æ–≤ –¥–ª—è', winnersCount, '–ø–æ–±–µ–¥–∏—Ç–µ–ª–µ–π');
        for (let i = 0; i < winnersCount; i++) {
          addPrizeInput(i + 1);
        }
        
        // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Å–µ–∫—Ü–∏—é –∂—é—Ä–∏, –µ—Å–ª–∏ –∂—é—Ä–∏ –±—ã–ª–æ –≤–∫–ª—é—á–µ–Ω–æ
        const jurySection = document.getElementById('prizes-modal-jury-section');
        const juryMembersDiv = document.getElementById('prizes-modal-jury-members');
        const juryEnabled = window.currentJuryEnabled || false;
        const juryCount = window.currentJuryCount || 1;
        
        if (jurySection && juryMembersDiv) {
          if (juryEnabled) {
            jurySection.classList.remove('hidden');
            juryMembersDiv.innerHTML = '';
            for (let i = 0; i < juryCount; i++) {
              const memberDiv = document.createElement('div');
              memberDiv.className = 'space-y-2 p-3 bg-gray-800/50 rounded border border-violet-500/20';
              memberDiv.innerHTML = `
                <label class="block text-xs text-gray-400 mb-1">–ß–ª–µ–Ω –∂—é—Ä–∏ ${i + 1}</label>
                <input type="text" class="jury-member-id input-field w-full p-2 rounded text-sm" placeholder="Telegram ID –∏–ª–∏ @username" data-index="${i}" style="pointer-events: auto;" />
                <input type="text" class="jury-member-channel input-field w-full p-2 rounded text-sm" placeholder="–°—Å—ã–ª–∫–∞ –Ω–∞ –∫–∞–Ω–∞–ª (t.me/...)" data-index="${i}" style="pointer-events: auto;" />
              `;
              juryMembersDiv.appendChild(memberDiv);
            }
          } else {
            jurySection.classList.add('hidden');
          }
        }
        
        const prizesModalEl = document.getElementById('prizes-modal');
        if (prizesModalEl) {
          openModal(prizesModalEl);
        } else {
          console.error('prizesModal –Ω–µ –Ω–∞–π–¥–µ–Ω!');
        }
      }
      
      function addPrizeInput(index) {
        const prizesListEl = document.getElementById('prizes-list');
        if (!prizesListEl) return;
        const prizeDiv = document.createElement('div');
        prizeDiv.className = 'flex gap-2 items-center';
        prizeDiv.style.pointerEvents = 'auto';
        prizeDiv.innerHTML = `
          <label class="text-sm text-gray-400 w-20">–ü—Ä–∏–∑ ${index}:</label>
          <input type="text" class="prize-input input-field flex-1 p-2 rounded" placeholder="t.me/nft/–Ω–∞–∑–≤–∞–Ω–∏–µ-–Ω–æ–º–µ—Ä" data-index="${index}" style="pointer-events: auto; position: relative; z-index: 1;" />
        `;
        prizesListEl.appendChild(prizeDiv);
      }
      
      if (submitPrizesBtn) {
        submitPrizesBtn.addEventListener('click', async () => {
          const prizesListEl = document.getElementById('prizes-list');
          if (!prizesListEl) return;
          const prizeInputs = prizesListEl.querySelectorAll('.prize-input');
          const prizeLinks = [];
          
          for (const input of prizeInputs) {
            const link = input.value.trim();
            if (link) {
              // –í–∞–ª–∏–¥–∞—Ü–∏—è —Ñ–æ—Ä–º–∞—Ç–∞ —Å—Å—ã–ª–∫–∏
              if (!/^t\.me\/nft\/[a-zA-Z0-9_-]+$/.test(link)) {
                alert(`‚ö†Ô∏è –ù–µ–≤–µ—Ä–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç —Å—Å—ã–ª–∫–∏ –Ω–∞ –ø—Ä–∏–∑!\n\n–ü—Ä–∏–º–µ—Ä: t.me/nft/SnoopDogg-119754\n\n–ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–∞—è —Å—Å—ã–ª–∫–∞: ${link}`);
                return;
              }
              prizeLinks.push(link);
            }
          }
          
          if (prizeLinks.length === 0) {
            alert('‚ö†Ô∏è –î–æ–±–∞–≤—å—Ç–µ —Ö–æ—Ç—è –±—ã –æ–¥–∏–Ω –ø—Ä–∏–∑!');
            return;
          }
          
          if (prizeLinks.length !== window.currentWinnersCount) {
            if (!confirm(`‚ö†Ô∏è –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø—Ä–∏–∑–æ–≤ (${prizeLinks.length}) –Ω–µ —Å–æ–≤–ø–∞–¥–∞–µ—Ç —Å –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ–º –ø–æ–±–µ–¥–∏—Ç–µ–ª–µ–π (${window.currentWinnersCount}). –ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å?`)) {
              return;
            }
          }
          
          // –°–æ–±–∏—Ä–∞–µ–º –¥–∞–Ω–Ω—ã–µ –∂—é—Ä–∏, –µ—Å–ª–∏ –∂—é—Ä–∏ –≤–∫–ª—é—á–µ–Ω–æ
          let juryData = null;
          const juryEnabled = window.currentJuryEnabled || false;
          if (juryEnabled) {
            const juryMembersDiv = document.getElementById('prizes-modal-jury-members');
            if (juryMembersDiv) {
              const members = [];
              const memberIdInputs = juryMembersDiv.querySelectorAll('.jury-member-id');
              const memberChannelInputs = juryMembersDiv.querySelectorAll('.jury-member-channel');
              
              for (let i = 0; i < memberIdInputs.length; i++) {
                const userIdOrUsername = memberIdInputs[i]?.value.trim();
                const channelLink = memberChannelInputs[i]?.value.trim();
                
                if (userIdOrUsername && channelLink) {
                  // –ü–∞—Ä—Å–∏–º ID –∏–ª–∏ username
                  let userId = null;
                  if (userIdOrUsername.startsWith('@')) {
                    // –≠—Ç–æ username, –Ω—É–∂–Ω–æ –±—É–¥–µ—Ç –ø–æ–ª—É—á–∏—Ç—å ID —á–µ—Ä–µ–∑ API –∏–ª–∏ –æ—Å—Ç–∞–≤–∏—Ç—å –∫–∞–∫ –µ—Å—Ç—å
                    // –ü–æ–∫–∞ —Å–æ—Ö—Ä–∞–Ω—è–µ–º –∫–∞–∫ username
                    userId = userIdOrUsername;
                  } else {
                    try {
                      userId = parseInt(userIdOrUsername);
                      if (isNaN(userId)) {
                        alert(`‚ö†Ô∏è –ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π Telegram ID –¥–ª—è —á–ª–µ–Ω–∞ –∂—é—Ä–∏ ${i + 1}. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —á–∏—Å–ª–æ–≤–æ–π ID –∏–ª–∏ @username`);
                        return;
                      }
                    } catch (e) {
                      alert(`‚ö†Ô∏è –û—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±—Ä–∞–±–æ—Ç–∫–µ ID —á–ª–µ–Ω–∞ –∂—é—Ä–∏ ${i + 1}: ${e.message}`);
                      return;
                    }
                  }
                  
                  members.push({
                    user_id: userId,
                    channel_link: channelLink
                  });
                } else if (userIdOrUsername || channelLink) {
                  alert(`‚ö†Ô∏è –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –∑–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –ø–æ–ª—è –¥–ª—è —á–ª–µ–Ω–∞ –∂—é—Ä–∏ ${i + 1}`);
                  return;
                }
              }
              
              if (members.length > 0) {
                juryData = {
                  enabled: true,
                  members: members
                };
              } else {
                alert('‚ö†Ô∏è –ï—Å–ª–∏ –∂—é—Ä–∏ –≤–∫–ª—é—á–µ–Ω–æ, –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –¥–æ–±–∞–≤–∏—Ç—å –¥–∞–Ω–Ω—ã–µ —Ö–æ—Ç—è –±—ã –¥–ª—è –æ–¥–Ω–æ–≥–æ —á–ª–µ–Ω–∞ –∂—é—Ä–∏');
                return;
              }
            }
          }
          
          try {
            const updateData = { prize_links: prizeLinks };
            if (juryData) {
              updateData.jury = juryData;
            }
            
            await fetchJSON(`/api/contests/${window.currentContestId}`, {
              method: 'PUT',
              headers: { 'Content-Type': 'application/json' },
              body: JSON.stringify(updateData)
            });
            const prizesModalEl = document.getElementById('prizes-modal');
            if (prizesModalEl) closeModal(prizesModalEl);
            if (typeof loadContests === 'function') await loadContests();
            showSection('contests-section');
            window.currentContestId = null;
            window.currentWinnersCount = null;
            window.currentJuryEnabled = null;
            window.currentJuryCount = null;
          } catch (e) {
            let errorMsg = '–û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏ –ø—Ä–∏–∑–æ–≤';
            if (e.message) {
              errorMsg += ': ' + e.message;
            } else if (e.status) {
              errorMsg += `: HTTP ${e.status}`;
            } else {
              errorMsg += ': –ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞';
            }
            alert(errorMsg);
            console.error('–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –ø—Ä–∏–∑–æ–≤:', e);
          }
        });
      }
    })();
  </script>
</body>
</html>
