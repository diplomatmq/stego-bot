<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>üéÅ –ü–∞–Ω–µ–ª—å –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <!-- –ü–∏–∫—Å–µ–ª—å–Ω—ã–π —à—Ä–∏—Ñ—Ç –¥–ª—è —Ç–µ–º—ã Mario -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap" rel="stylesheet">
  <!-- –ì–æ—Ç–∏—á–µ—Å–∫–∏–π —à—Ä–∏—Ñ—Ç –¥–ª—è —Ç–µ–º—ã Attack on Titan -->
  <link href="https://fonts.googleapis.com/css2?family=Creepster&family=Nosifer&family=UnifrakturMaguntia&display=swap" rel="stylesheet">

  <!-- –ü—Ä–æ—Å—Ç–æ–π —Ç–µ—Å—Ç - –≤—ã–ø–æ–ª–Ω–∏—Ç—Å—è –ª–∏ JavaScript –≤–æ–æ–±—â–µ -->
  <script>
    console.log('‚úÖ JavaScript —Ä–∞–±–æ—Ç–∞–µ—Ç! –°–∫—Ä–∏–ø—Ç –≤ head –∑–∞–≥—Ä—É–∂–µ–Ω.');
    console.log('üîß –¢–µ—Å—Ç–æ–≤—ã–π —Ä–µ–∂–∏–º - —Ä–∞–±–æ—Ç–∞ –±–µ–∑ —Å–µ—Ä–≤–µ—Ä–∞ –∏ –±–æ—Ç–∞');
  </script>

  <!-- –¢–µ—Å—Ç–æ–≤—ã–π —Ä–µ–∂–∏–º - –±–µ–∑ Telegram WebApp -->
  <script>
    document.addEventListener("DOMContentLoaded", () => {
      console.log('‚úÖ DOMContentLoaded –≤ head —Å–∫—Ä–∏–ø—Ç–µ');
      console.log('üîß –¢–µ—Å—Ç–æ–≤—ã–π —Ä–µ–∂–∏–º - Telegram WebApp –æ—Ç–∫–ª—é—á–µ–Ω');
    });
  </script>

  <style>
    /* üíß Ripple —ç—Ñ—Ñ–µ–∫—Ç */
    .ripple {
      position: absolute;
      border-radius: 50%;
      transform: scale(0);
      animation: ripple 0.6s linear;
      background: rgba(255, 255, 255, 0.4);
      pointer-events: none;
    }

    @keyframes ripple {
      to {
        transform: scale(4);
        opacity: 0;
      }
    }

    /* üü£ Black + Neon Purple global theme (default) */
    :root {
      --neon-purple-1: #7c3aed; /* violet-600 */
      --neon-purple-2: #8b5cf6; /* violet-500 */
      --neon-purple-3: #a78bfa; /* violet-400 */
      --neon-pink: #ec4899;     /* pink-500 */
      --neon-white: #ffffff;
      --neon-bg: #000000;
      --text-primary: #e5e7eb;
    }

    /* üê± Kitty theme - —Å–≤–µ—Ç–ª–∞—è –ø–∞—Å—Ç–µ–ª—å–Ω–∞—è —Ç–µ–º–∞ */
    body.theme-kitty {
      --neon-purple-1: #ff6b9d; /* —Ä–æ–∑–æ–≤—ã–π */
      --neon-purple-2: #ff8cc8; /* —Å–≤–µ—Ç–ª–æ-—Ä–æ–∑–æ–≤—ã–π */
      --neon-purple-3: #ffb3d9; /* –æ—á–µ–Ω—å —Å–≤–µ—Ç–ª–æ-—Ä–æ–∑–æ–≤—ã–π */
      --neon-pink: #ff1493;     /* –≥–ª—É–±–æ–∫–∏–π —Ä–æ–∑–æ–≤—ã–π */
      --neon-white: #ffffff;
      --neon-bg: #fff0f5;       /* –æ—á–µ–Ω—å —Å–≤–µ—Ç–ª—ã–π —Ä–æ–∑–æ–≤—ã–π —Ñ–æ–Ω (–ø–æ—á—Ç–∏ –±–µ–ª—ã–π) */
      --text-primary: #8b4a6b;  /* —Ç–µ–º–Ω–æ-—Ä–æ–∑–æ–≤—ã–π —Ç–µ–∫—Å—Ç –¥–ª—è —á–∏—Ç–∞–µ–º–æ—Å—Ç–∏ */
      --card-bg: #ffe6f2;       /* —Å–≤–µ—Ç–ª—ã–π —Ä–æ–∑–æ–≤—ã–π –¥–ª—è –∫–∞—Ä—Ç–æ—á–µ–∫ */
      --border-color: #ffb3d9;  /* —Å–≤–µ—Ç–ª–æ-—Ä–æ–∑–æ–≤–∞—è –≥—Ä–∞–Ω–∏—Ü–∞ */
    }

    /* –û—Å–Ω–æ–≤–Ω–æ–π —Ñ–æ–Ω —Å—Ç—Ä–∞–Ω–∏—Ü—ã */
    body.theme-kitty.page-dark {
      background-color: var(--neon-bg) !important;
      color: var(--text-primary) !important;
    }

    /* –ö–∞—Ä—Ç–æ—á–∫–∏ –∏ –∫–æ–Ω—Ç–µ–Ω—Ç */
    body.theme-kitty .rounded-lg.border,
    body.theme-kitty .bg-black\/30,
    body.theme-kitty main {
      background-color: var(--card-bg) !important;
      border-color: var(--border-color) !important;
      color: var(--text-primary) !important;
    }

    /* –¢–µ–∫—Å—Ç */
    body.theme-kitty .text-white {
      color: var(--text-primary) !important;
    }

    body.theme-kitty .text-gray-300,
    body.theme-kitty .text-gray-400 {
      color: #b87a9d !important; /* –±–æ–ª–µ–µ —Ç–µ–º–Ω—ã–π —Ä–æ–∑–æ–≤—ã–π –¥–ª—è –≤—Ç–æ—Ä–∏—á–Ω–æ–≥–æ —Ç–µ–∫—Å—Ç–∞ */
    }

    body.theme-kitty .text-gray-500 {
      color: #a06a8a !important;
    }

    /* –ö–Ω–æ–ø–∫–∏ –Ω–∞–≤–∏–≥–∞—Ü–∏–∏ */
    body.theme-kitty .nav-button {
      color: var(--text-primary) !important;
      box-shadow: inset 0 0 0 1px rgba(255, 107, 157, 0.4) !important;
    }

    body.theme-kitty .nav-button.active,
    body.theme-kitty .nav-button:hover {
      box-shadow:
        0 0 12px rgba(255, 107, 157, 0.6),
        inset 0 0 0 1px rgba(255, 107, 157, 0.7) !important;
    }

    /* Neon –∫–Ω–æ–ø–∫–∏ */
    body.theme-kitty .neon-button {
      background: #ffe6f2 !important;
      color: var(--text-primary) !important;
      border: 1px solid rgba(255, 107, 157, 0.5) !important;
      box-shadow:
        0 0 16px rgba(255, 107, 157, 0.4),
        inset 0 0 18px rgba(255, 140, 200, 0.3) !important;
    }

    body.theme-kitty .neon-button:hover {
      box-shadow:
        0 0 22px rgba(255, 107, 157, 0.6),
        inset 0 0 24px rgba(255, 140, 200, 0.4) !important;
      border-color: rgba(255, 107, 157, 0.8) !important;
    }

    /* –ë–æ–∫–æ–≤—ã–µ –ø–æ–ª–æ—Å—ã */
    body.theme-kitty .neon-sides::before,
    body.theme-kitty .neon-sides::after {
      background: linear-gradient(180deg,
        #ff6b9d 0%,
        #ff6b9d 25%,
        #ff1493 55%,
        #ffffff 85%,
        #ff8cc8 100%
      );
      box-shadow:
        0 0 12px rgba(255, 140, 200, 0.7),
        0 0 28px rgba(255, 107, 157, 0.5),
        inset 0 0 16px rgba(255, 179, 217, 0.4);
    }

    /* –ù–∏–∂–Ω—è—è –ø–∞–Ω–µ–ª—å */
    body.theme-kitty .neon-bottom {
      background:
        radial-gradient(60% 140% at 50% 100%, rgba(255, 107, 157, 0.2), rgba(255, 240, 245, 0) 60%),
        radial-gradient(25% 100% at 0% 100%, rgba(255, 20, 147, 0.22), transparent 70%),
        radial-gradient(25% 100% at 100% 100%, rgba(255, 255, 255, 0.1), transparent 70%);
    }

    body.theme-kitty .neon-bottom::before {
      background:
        repeating-linear-gradient(to right,
          rgba(255,255,255,0.9) 0 18px,
          transparent 18px 34px
        ),
        repeating-linear-gradient(to right,
          rgba(255,20,147,0.7) 0 14px,
          transparent 14px 30px
        ),
        repeating-linear-gradient(to right,
          rgba(255,107,157,0.7) 0 16px,
          transparent 16px 32px
        );
      box-shadow:
        0 0 22px rgba(255, 140, 200, 0.8),
        0 0 44px rgba(255, 107, 157, 0.7),
        inset 0 0 10px rgba(255, 179, 217, 0.6);
    }

    body.theme-kitty .neon-bottom::after {
      background: linear-gradient(90deg, transparent, rgba(255,107,157,0.3), rgba(255,20,147,0.3), rgba(255,255,255,0.22), rgba(255,140,200,0.3), transparent);
    }

    /* –ë–µ–π–¥–∂ —É—Ä–æ–≤–Ω—è */
    body.theme-kitty #level-badge {
      position: relative;
      background: linear-gradient(135deg,
        #ffe6f2 0%,
        #ff8cc8 25%,
        #ff6b9d 50%,
        #ff1493 75%,
        #ff69b4 100%
      );
      color: #ffffff !important;
      border: 1px solid rgba(255, 107, 157, 0.6) !important;
      box-shadow: 
        0 0 15px rgba(255, 107, 157, 0.7),
        0 0 30px rgba(255, 20, 147, 0.5),
        inset 0 0 10px rgba(255, 255, 255, 0.3) !important;
      overflow: visible !important;
    }

    /* –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä —Å –±–µ–π–¥–∂–µ–º —É—Ä–æ–≤–Ω—è - –¥–æ–±–∞–≤–ª—è–µ–º –æ—Ç—Å—Ç—É–ø —Å–≤–µ—Ä—Ö—É –¥–ª—è –∫–æ—Ç–∏–∫–∞ */
    body.theme-kitty #profile-section .rounded-lg.border.border-violet-400\/30 {
      position: relative;
      overflow: visible !important;
    }

    /* H3 —Å –±–µ–π–¥–∂–µ–º —É—Ä–æ–≤–Ω—è - —É–±–µ–∂–¥–∞–µ–º—Å—è, —á—Ç–æ –æ–Ω –∏–º–µ–µ—Ç overflow visible */
    body.theme-kitty #profile-section h3.flex.items-center.gap-2 {
      position: relative;
      overflow: visible !important;
      z-index: 1;
    }


    /* –¶–≤–µ—Ç–∞ –¥–ª—è –∞–∫—Ü–µ–Ω—Ç–æ–≤ */
    body.theme-kitty .text-violet-400 {
      color: #ff6b9d !important;
    }

    /* üçÑ Mario theme - —Ä–µ—Ç—Ä–æ —Å—Ç–∏–ª—å Super Mario Bros */
    body.theme-mario {
      font-family: 'Press Start 2P', cursive, monospace !important;
      --mario-sky: #5C94FC; /* –Ø—Ä–∫–æ–µ —Å–∏–Ω–µ–µ –Ω–µ–±–æ */
      --mario-cloud: #FFFFFF; /* –ë–µ–ª—ã–µ –æ–±–ª–∞–∫–∞ */
      --mario-hill: #00C000; /* –ó–µ–ª–µ–Ω—ã–µ —Ö–æ–ª–º—ã */
      --mario-brick: #B85C00; /* –ö–æ—Ä–∏—á–Ω–µ–≤—ã–µ –∫–∏—Ä–ø–∏—á–∏ */
      --mario-orange: #FF8C00; /* –û—Ä–∞–Ω–∂–µ–≤—ã–π –¥–ª—è –∑–∞–≥–æ–ª–æ–≤–∫–æ–≤ */
      --mario-yellow: #FFD700; /* –ñ–µ–ª—Ç—ã–π –¥–ª—è –ø–∞–Ω–µ–ª–µ–π */
      --mario-brown: #8B4513; /* –ö–æ—Ä–∏—á–Ω–µ–≤—ã–π –¥–ª—è –¥–µ—Ä–µ–≤–∞ */
      --mario-blue: #0066FF; /* –°–∏–Ω–∏–π –¥–ª—è –∫–Ω–æ–ø–æ–∫ */
      --mario-green: #00AA00; /* –ó–µ–ª–µ–Ω—ã–π –¥–ª—è –∫–Ω–æ–ø–æ–∫ */
      --mario-red: #FF0000; /* –ö—Ä–∞—Å–Ω—ã–π –¥–ª—è –≥—Ä–∞–Ω–∏—Ü */
      --mario-text: #000000; /* –ß–µ—Ä–Ω—ã–π —Ç–µ–∫—Å—Ç */
      --mario-white: #FFFFFF; /* –ë–µ–ª—ã–π —Ç–µ–∫—Å—Ç */
    }

    /* –§–æ–Ω —Å—Ç—Ä–∞–Ω–∏—Ü—ã –≤ —Å—Ç–∏–ª–µ Mario - —Ç–æ–ª—å–∫–æ –≥–æ–ª—É–±–æ–µ –Ω–µ–±–æ, –æ–±–ª–∞–∫–∞ –∏ –∫–∏—Ä–ø–∏—á–Ω—ã–π –ø–æ–ª */
    body.theme-mario.page-dark {
      position: relative;
      background: 
        /* –û–±–ª–∞–∫–æ 1 - –≤–µ—Ä—Ö–Ω–∏–π –ª–µ–≤—ã–π */
        radial-gradient(ellipse 120px 60px at 30% 25%, #FFFFFF 0%, #FFFFFF 70%, rgba(135, 206, 235, 0.2) 70%, transparent 100%),
        /* –û–±–ª–∞–∫–æ 2 - –≤–µ—Ä—Ö–Ω–∏–π –ø—Ä–∞–≤—ã–π, –≤—ã—à–µ –ø–µ—Ä–≤–æ–≥–æ */
        radial-gradient(ellipse 120px 60px at 75% 20%, #FFFFFF 0%, #FFFFFF 70%, rgba(135, 206, 235, 0.2) 70%, transparent 100%),
        /* –ö–∏—Ä–ø–∏—á–Ω—ã–π –ø–æ–ª - –Ω–∏–∂–Ω—è—è —Ç—Ä–µ—Ç—å */
        repeating-linear-gradient(
          0deg,
          #B85C00 0px,
          #B85C00 16px,
          #8B4513 16px,
          #8B4513 20px
        ),
        repeating-linear-gradient(
          90deg,
          transparent 0px,
          transparent 31px,
          rgba(0, 0, 0, 0.4) 31px,
          rgba(0, 0, 0, 0.4) 32px
        ),
        /* –ì–æ–ª—É–±–æ–µ –Ω–µ–±–æ - –æ–¥–Ω–æ—Ä–æ–¥–Ω—ã–π —Ü–≤–µ—Ç */
        #87CEEB;
      background-size: 
        120px 60px,
        120px 60px,
        32px 32px, 32px 32px,
        100% 100%;
      background-position: 
        30% 25%,
        75% 20%,
        0 67%, 0 67%,
        0 0;
      background-repeat: no-repeat;
      color: var(--mario-text) !important;
      image-rendering: pixelated;
      image-rendering: -moz-crisp-edges;
      image-rendering: crisp-edges;
      min-height: 100vh;
    }

    /* –ë–ª–æ–∫ —Å –≤–æ–ø—Ä–æ—Å–æ–º —Å–ø—Ä–∞–≤–∞ */
    body.theme-mario.page-dark::after {
      content: '?';
      position: fixed;
      right: 5%;
      bottom: 15%;
      width: 40px;
      height: 40px;
      background: var(--mario-yellow);
      border: 3px solid #000000;
      border-radius: 4px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 24px;
      font-weight: bold;
      color: #000000;
      z-index: 0;
      box-shadow: 
        inset 0 -3px 0 rgba(0, 0, 0, 0.3),
        0 3px 0 rgba(0, 0, 0, 0.2);
      font-family: 'Press Start 2P', cursive, monospace;
      pointer-events: none;
    }

    /* –ö–æ–Ω—Ç–µ–Ω—Ç –ø–æ–≤–µ—Ä—Ö –±–ª–æ–∫–∞ —Å –≤–æ–ø—Ä–æ—Å–æ–º */
    body.theme-mario main,
    body.theme-mario #profile-section {
      position: relative;
      z-index: 1;
    }

    /* –ê–Ω–∏–º–∞—Ü–∏—è –æ–±–ª–∞–∫–æ–≤ - –º–µ–¥–ª–µ–Ω–Ω–æ–µ –¥–≤–∏–∂–µ–Ω–∏–µ */
    @keyframes mario-clouds {
      0% { 
        background-position: 
          30% 25%,
          75% 20%,
          0 67%, 0 67%,
          0 0; 
      }
      100% { 
        background-position: 
          32% 25%,
          77% 20%,
          32px 67%, 32px 67%,
          0 0; 
      }
    }

    body.theme-mario.page-dark {
      animation: mario-clouds 30s linear infinite;
    }

    /* –ó–∞–≥–æ–ª–æ–≤–∫–∏ —Å–µ–∫—Ü–∏–π - –æ—Ä–∞–Ω–∂–µ–≤—ã–µ –ø–∞–Ω–µ–ª–∏ –ø–æ–ª—É–ø—Ä–æ–∑—Ä–∞—á–Ω—ã–µ */
    body.theme-mario h2 {
      background: rgba(255, 140, 0, 0.85) !important;
      color: var(--mario-white) !important;
      padding: 16px 20px !important;
      border-radius: 12px !important;
      border: 3px solid #CC7000 !important;
      box-shadow: 
        inset 0 -4px 0 rgba(0, 0, 0, 0.3),
        0 4px 0 rgba(0, 0, 0, 0.2) !important;
      text-shadow: 2px 2px 0 rgba(0, 0, 0, 0.5) !important;
      font-size: 0.8rem !important;
      letter-spacing: 1px !important;
      text-align: center !important;
      margin-bottom: 20px !important;
      width: 100% !important;
      backdrop-filter: blur(2px);
    }

    body.theme-mario h3 {
      background: var(--mario-orange) !important;
      color: var(--mario-white) !important;
      padding: 12px 16px !important;
      border-radius: 8px !important;
      border: 3px solid #CC7000 !important;
      box-shadow: 
        inset 0 -4px 0 rgba(0, 0, 0, 0.3),
        0 4px 0 rgba(0, 0, 0, 0.2) !important;
      text-shadow: 2px 2px 0 rgba(0, 0, 0, 0.5) !important;
      font-size: 0.7rem !important;
      letter-spacing: 1px !important;
      text-transform: uppercase !important;
    }

    /* –ü–∞–Ω–µ–ª–∏ —Å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π - –∂–µ–ª—Ç—ã–µ –ø–æ–ª—É–ø—Ä–æ–∑—Ä–∞—á–Ω—ã–µ */
    body.theme-mario #profile-section .rounded-lg.border.border-violet-400\/30:first-of-type {
      background: rgba(255, 215, 0, 0.85) !important;
      border: 3px solid #CCAA00 !important;
      border-radius: 12px !important;
      box-shadow: 
        inset 0 -4px 0 rgba(0, 0, 0, 0.2),
        0 4px 0 rgba(0, 0, 0, 0.15) !important;
      color: var(--mario-text) !important;
      padding: 20px !important;
      backdrop-filter: blur(2px);
    }

    body.theme-mario .rounded-lg.border,
    body.theme-mario .bg-black\/30 {
      background: rgba(255, 215, 0, 0.85) !important;
      border: 3px solid #CCAA00 !important;
      border-radius: 8px !important;
      box-shadow: 
        inset 0 -4px 0 rgba(0, 0, 0, 0.2),
        0 4px 0 rgba(0, 0, 0, 0.15) !important;
      color: var(--mario-text) !important;
      backdrop-filter: blur(2px);
    }

    body.theme-mario main {
      background: transparent !important;
    }

    /* –ü–∞–Ω–µ–ª—å —É—Ä–æ–≤–Ω—è - –∫–∏—Ä–ø–∏—á–Ω–∞—è –≤ —Å—Ç–∏–ª–µ Mario (–≤—Ç–æ—Ä–∞—è –ø–∞–Ω–µ–ª—å) */
    body.theme-mario #profile-section .rounded-lg.border.border-violet-400\/30:nth-of-type(2) {
      background: 
        repeating-linear-gradient(
          0deg,
          rgba(184, 92, 0, 0.9) 0px,
          rgba(184, 92, 0, 0.9) 8px,
          rgba(139, 69, 19, 0.9) 8px,
          rgba(139, 69, 19, 0.9) 16px
        ),
        repeating-linear-gradient(
          90deg,
          transparent 0px,
          transparent 15px,
          rgba(0, 0, 0, 0.1) 15px,
          rgba(0, 0, 0, 0.1) 16px
        ),
        rgba(184, 92, 0, 0.85) !important;
      border: 3px solid #8B4513 !important;
      box-shadow: 
        inset 0 -4px 0 rgba(0, 0, 0, 0.3),
        0 4px 0 rgba(0, 0, 0, 0.2) !important;
      background-size: 100% 16px, 16px 100%, 100% 100% !important;
      border-radius: 12px !important;
      padding: 20px !important;
      backdrop-filter: blur(2px);
    }

    /* –ë–µ–π–¥–∂ —É—Ä–æ–≤–Ω—è - —Å–∏–Ω–∏–π –∫–Ω–æ–ø–∫–∞ */
    body.theme-mario #level-badge {
      background: var(--mario-blue) !important;
      color: var(--mario-white) !important;
      border: 3px solid #0044AA !important;
      border-radius: 8px !important;
      padding: 10px 16px !important;
      box-shadow: 
        inset 0 -3px 0 rgba(0, 0, 0, 0.3),
        0 3px 0 rgba(0, 0, 0, 0.2) !important;
      text-shadow: 1px 1px 0 rgba(0, 0, 0, 0.5) !important;
      font-size: 0.65rem !important;
      display: inline-block !important;
      white-space: nowrap !important;
    }

    /* –û–ø—ã—Ç - —Ñ–∏–æ–ª–µ—Ç–æ–≤—ã–π –∫—Ä—É–≥ —Å–ø—Ä–∞–≤–∞ –æ—Ç —É—Ä–æ–≤–Ω—è */
    body.theme-mario #profile-section .flex.items-center.justify-between {
      display: flex !important;
      align-items: center !important;
      justify-content: space-between !important;
    }

    body.theme-mario #profile-section .flex.items-center.gap-2 {
      display: flex !important;
      align-items: center !important;
      gap: 8px !important;
    }

    body.theme-mario #current-experience {
      background: #8B5CF6 !important;
      color: var(--mario-white) !important;
      border-radius: 50% !important;
      width: 40px !important;
      height: 40px !important;
      display: flex !important;
      align-items: center !important;
      justify-content: center !important;
      border: 2px solid #6D28D9 !important;
      box-shadow: 
        inset 0 -2px 0 rgba(0, 0, 0, 0.3),
        0 2px 0 rgba(0, 0, 0, 0.2) !important;
      font-size: 0.7rem !important;
      text-shadow: 1px 1px 0 rgba(0, 0, 0, 0.5) !important;
    }

    body.theme-mario #profile-section .flex.items-center.gap-2 .text-xs.text-gray-400 {
      color: var(--mario-white) !important;
      font-size: 0.5rem !important;
      margin-top: 0 !important;
      white-space: nowrap !important;
    }

    /* –¢–µ–∫—Å—Ç –≤ –ø–∞–Ω–µ–ª–∏ —É—Ä–æ–≤–Ω—è - –±–µ–ª—ã–π */
    body.theme-mario #profile-section .rounded-lg.border.border-violet-400\/30:nth-of-type(2) .text-gray-400 {
      color: var(--mario-white) !important;
    }

    /* –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –ø—Ä–æ–≥—Ä–µ—Å—Å-–±–∞—Ä –≤ —Ç–µ–º–µ Mario */
    body.theme-mario #progress-bar-container {
      display: block !important;
      background: rgba(0, 0, 0, 0.3) !important;
      border: 3px solid #8B4513 !important;
      border-radius: 8px !important;
    }

    body.theme-mario #experience-progress-bar {
      background: linear-gradient(90deg, #0066FF 0%, #4A90E2 50%, #0066FF 100%) !important;
      background-size: 200% 100% !important;
      animation: mario-progress-flow 2s linear infinite !important;
    }

    @keyframes mario-progress-flow {
      0% { background-position: 0% 50%; }
      100% { background-position: 200% 50%; }
    }

    /* –¢–µ–∫—Å—Ç –≤ –ø–∞–Ω–µ–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è - —á–µ—Ä–Ω—ã–π */
    body.theme-mario #profile-section .text-lg,
    body.theme-mario #profile-section .text-sm,
    body.theme-mario #profile-section .text-gray-400:not(.text-xs) {
      color: var(--mario-text) !important;
    }

    body.theme-mario #profile-username {
      color: var(--mario-text) !important;
      font-weight: bold !important;
    }

    body.theme-mario #profile-id {
      color: var(--mario-blue) !important;
    }

    body.theme-mario #profile-first-login {
      color: var(--mario-blue) !important;
    }

    body.theme-mario #profile-status {
      color: var(--mario-green) !important;
    }

    /* –ö–Ω–æ–ø–∫–∏ –Ω–∞–≤–∏–≥–∞—Ü–∏–∏ */
    body.theme-mario .nav-button {
      background: var(--mario-green) !important;
      color: var(--mario-white) !important;
      border: 3px solid #008800 !important;
      box-shadow: 
        inset 0 -3px 0 rgba(0, 0, 0, 0.3),
        0 3px 0 rgba(0, 0, 0, 0.2) !important;
      text-shadow: 1px 1px 0 rgba(0, 0, 0, 0.5) !important;
      font-size: 0.6rem !important;
      transition: transform 0.1s !important;
    }

    body.theme-mario .nav-button:active {
      transform: translateY(2px) !important;
      box-shadow: 
        inset 0 -1px 0 rgba(0, 0, 0, 0.3),
        0 1px 0 rgba(0, 0, 0, 0.2) !important;
    }

    /* –ö–Ω–æ–ø–∫–∞ —Å–≤—è–∑–∏ —Å –≤–ª–∞–¥–µ–ª—å—Ü–µ–º - –∂–µ–ª—Ç–∞—è —Å –æ—Ä–∞–Ω–∂–µ–≤–æ–π —Ä–∞–º–∫–æ–π –ø–æ–ª—É–ø—Ä–æ–∑—Ä–∞—á–Ω–∞—è */
    body.theme-mario #contact-owner-btn {
      background: rgba(255, 215, 0, 0.85) !important;
      color: var(--mario-text) !important;
      border: 3px solid #CCAA00 !important;
      border-radius: 12px !important;
      box-shadow: 
        inset 0 -4px 0 rgba(0, 0, 0, 0.3),
        0 4px 0 rgba(0, 0, 0, 0.2) !important;
      text-shadow: 1px 1px 0 rgba(255, 255, 255, 0.5) !important;
      font-size: 0.65rem !important;
      font-weight: bold !important;
      padding: 14px !important;
      margin-top: 20px !important;
      backdrop-filter: blur(2px);
    }

    body.theme-mario #contact-owner-btn:active {
      transform: translateY(2px) !important;
      box-shadow: 
        inset 0 -2px 0 rgba(0, 0, 0, 0.3),
        0 2px 0 rgba(0, 0, 0, 0.2) !important;
    }

    /* –ö–Ω–æ–ø–∫–∞ —Å–º–µ–Ω—ã —Ç–µ–º—ã - –ø–æ–ª—É–ø—Ä–æ–∑—Ä–∞—á–Ω–∞—è */
    body.theme-mario #change-theme-btn {
      background: rgba(255, 140, 0, 0.85) !important;
      color: var(--mario-white) !important;
      border: 3px solid #CC7000 !important;
      border-radius: 12px !important;
      box-shadow: 
        inset 0 -3px 0 rgba(0, 0, 0, 0.3),
        0 3px 0 rgba(0, 0, 0, 0.2) !important;
      text-shadow: 1px 1px 0 rgba(0, 0, 0, 0.5) !important;
      font-size: 0.65rem !important;
      padding: 14px !important;
      margin-bottom: 12px !important;
      backdrop-filter: blur(2px);
    }

    /* –¢–µ–∫—Å—Ç */
    body.theme-mario .text-white {
      color: var(--mario-white) !important;
    }

    body.theme-mario .text-gray-300,
    body.theme-mario .text-gray-400 {
      color: #333333 !important;
    }

    body.theme-mario .text-violet-400 {
      color: var(--mario-blue) !important;
    }

    /* –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ - –∑–µ–ª–µ–Ω—ã–µ –∫–Ω–æ–ø–∫–∏ */
    body.theme-mario .bg-green-500,
    body.theme-mario button.bg-green-500 {
      background: var(--mario-green) !important;
      color: var(--mario-white) !important;
      border: 3px solid #008800 !important;
      box-shadow: 
        inset 0 -3px 0 rgba(0, 0, 0, 0.3),
        0 3px 0 rgba(0, 0, 0, 0.2) !important;
      text-shadow: 1px 1px 0 rgba(0, 0, 0, 0.5) !important;
    }

    /* –ö–Ω–æ–ø–∫–∏ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –£—á–∞—Å—Ç–∏–π –∏ –ü–æ–±–µ–¥ - –∑–µ–ª–µ–Ω—ã–µ –ø–æ–ª—É–ø—Ä–æ–∑—Ä–∞—á–Ω—ã–µ */
    body.theme-mario #profile-section .grid.grid-cols-2 > div {
      background: rgba(0, 170, 0, 0.85) !important;
      border: 3px solid #008800 !important;
      border-radius: 12px !important;
      padding: 16px !important;
      box-shadow: 
        inset 0 -4px 0 rgba(0, 0, 0, 0.3),
        0 4px 0 rgba(0, 0, 0, 0.2) !important;
      backdrop-filter: blur(2px);
    }

    body.theme-mario #profile-section .grid.grid-cols-2 .text-2xl {
      color: var(--mario-white) !important;
      text-shadow: 1px 1px 0 rgba(0, 0, 0, 0.5) !important;
    }

    body.theme-mario #profile-section .grid.grid-cols-2 .text-xs {
      color: var(--mario-white) !important;
      text-shadow: 1px 1px 0 rgba(0, 0, 0, 0.5) !important;
    }

    body.theme-mario #contests-won {
      color: #8B5CF6 !important;
    }

    /* –ê–Ω–∏–º–∞—Ü–∏—è –ø—Ä—ã–∂–∫–∞ –¥–ª—è –∫–Ω–æ–ø–æ–∫ */
    @keyframes mario-jump {
      0%, 100% { transform: translateY(0); }
      50% { transform: translateY(-4px); }
    }

    body.theme-mario button:hover {
      animation: mario-jump 0.3s ease-in-out;
    }

    /* –ê–Ω–∏–º–∞—Ü–∏—è –º–æ–Ω–µ—Ç–∫–∏ */
    @keyframes mario-coin {
      0% { transform: rotateY(0deg) scale(1); }
      50% { transform: rotateY(180deg) scale(1.1); }
      100% { transform: rotateY(360deg) scale(1); }
    }

    body.theme-mario .text-violet-400 {
      animation: mario-coin 2s ease-in-out infinite;
    }

    /* –£–±–∏—Ä–∞–µ–º –∞–Ω–∏–º–∞—Ü–∏—é –¥–ª—è —á–∏—Å–ª–∞ "–£—á–∞—Å—Ç–∏–π" –≤ —Ç–µ–º–µ Mario */
    body.theme-mario #contests-participated {
      animation: none !important;
    }

    /* –ü–∏–∫—Å–µ–ª—å–Ω—ã–π —ç—Ñ—Ñ–µ–∫—Ç –¥–ª—è –≤—Å–µ—Ö —ç–ª–µ–º–µ–Ω—Ç–æ–≤ */
    body.theme-mario * {
      image-rendering: pixelated;
      image-rendering: -moz-crisp-edges;
      image-rendering: crisp-edges;
    }

    /* –ê–≤–∞—Ç–∞—Ä - —Å—Ç–∏–ª—å Mario —Å –∞–Ω–∏–º–∞—Ü–∏–µ–π */
    body.theme-mario .theme-avatar {
      background: var(--mario-blue) !important;
      border: 3px solid #0044AA !important;
      border-radius: 8px !important;
      box-shadow: 
        inset 0 -3px 0 rgba(0, 0, 0, 0.3),
        0 3px 0 rgba(0, 0, 0, 0.2) !important;
      width: 64px !important;
      height: 64px !important;
    }

    body.theme-mario #profile-avatar {
      animation: mario-jump 2s ease-in-out infinite;
      display: inline-block;
      color: var(--mario-white) !important;
      font-size: 1.5rem !important;
    }

    @keyframes mario-jump {
      0%, 100% { transform: translateY(0) scale(1); }
      25% { transform: translateY(-5px) scale(1.05); }
      50% { transform: translateY(-8px) scale(1.1); }
      75% { transform: translateY(-5px) scale(1.05); }
    }

    body.theme-kitty .text-pink-400 {
      color: #ff1493 !important;
    }

    body.theme-kitty .text-blue-400 {
      color: #ff8cc8 !important;
    }

    body.theme-kitty .text-green-400 {
      color: #4ade80 !important; /* –∑–µ–ª–µ–Ω—ã–π –¥–ª—è —Å—Ç–∞—Ç—É—Å–∞ */
    }

    /* –ì—Ä–∞–Ω–∏—Ü—ã –∏ —Ä–∞–∑–¥–µ–ª–∏—Ç–µ–ª–∏ */
    body.theme-kitty .border-violet-400\/30,
    body.theme-kitty .border-violet-400\/20 {
      border-color: rgba(255, 179, 217, 0.5) !important;
    }

    /* –ù–∞–≤–∏–≥–∞—Ü–∏—è */
    body.theme-kitty .neon-nav {
      background: rgba(255, 230, 242, 0.9) !important;
      border-bottom: 1px solid rgba(255, 179, 217, 0.3) !important;
      box-shadow: 0 0 24px rgba(255, 107, 157, 0.3) !important;
    }

    /* –ú–æ–¥–∞–ª—å–Ω—ã–µ –æ–∫–Ω–∞ */
    body.theme-kitty #theme-selector-modal,
    body.theme-kitty #contact-owner-modal,
    body.theme-kitty #subscription-modal {
      background: rgba(255, 240, 245, 0.95) !important;
    }

    body.theme-kitty #theme-selector-modal > div,
    body.theme-kitty #contact-owner-modal > div {
      background: var(--card-bg) !important;
      border-color: var(--border-color) !important;
    }

    /* –ò–Ω–ø—É—Ç—ã */
    body.theme-kitty .input-field {
      background: #ffffff !important;
      border: 1px solid rgba(255, 179, 217, 0.3) !important;
      color: var(--text-primary) !important;
    }

    body.theme-kitty .input-field:focus {
      border-color: rgba(255, 107, 157, 0.7) !important;
      box-shadow:
        0 0 0 3px rgba(255, 107, 157, 0.3),
        inset 0 0 0 1px rgba(255, 107, 157, 0.7) !important;
    }

    /* –ü—Ä–æ–≥—Ä–µ—Å—Å –±–∞—Ä */
    body.theme-kitty .bg-gray-800 {
      background-color: rgba(255, 255, 255, 0.5) !important;
    }

    body.theme-kitty #progress-bar-container {
      overflow: visible !important;
    }

    body.theme-kitty #experience-progress-bar {
      background: linear-gradient(to right, #ff6b9d, #ff1493, #ff6b9d) !important;
      position: relative;
    }

    /* –õ–∞–ø–∫–∏ –≤ –ø—Ä–æ–≥—Ä–µ—Å—Å-–±–∞—Ä–µ –¥–ª—è —Ç–µ–º—ã kitty */
    body.theme-kitty #progress-bar-container {
      --paw-position: 0px;
    }

    body.theme-kitty #progress-bar-container::before {
      content: 'üêæ';
      position: absolute;
      left: var(--paw-position, 0px);
      top: 50%;
      transform: translateY(-50%);
      font-size: 1.2rem;
      animation: kitty-paw-move 2s ease-in-out infinite;
      z-index: 10;
      filter: drop-shadow(0 0 4px rgba(255, 107, 157, 0.8));
      pointer-events: none;
      transition: left 0.3s ease-out;
    }

    body.theme-kitty #progress-bar-container::after {
      content: 'üêæ';
      position: absolute;
      left: var(--paw-position, 0px);
      top: 50%;
      transform: translateY(-50%);
      font-size: 1rem;
      animation: kitty-paw-move 2s ease-in-out infinite 0.3s;
      z-index: 9;
      opacity: 0.7;
      filter: drop-shadow(0 0 3px rgba(255, 20, 147, 0.6));
      pointer-events: none;
      transition: left 0.3s ease-out;
    }

    @keyframes kitty-paw-move {
      0%, 100% {
        transform: translateY(-50%) translateX(0) rotate(0deg) scale(1);
        opacity: 1;
      }
      25% {
        transform: translateY(-50%) translateX(3px) rotate(-8deg) scale(1.1);
        opacity: 0.95;
      }
      50% {
        transform: translateY(-50%) translateX(5px) rotate(0deg) scale(1.05);
        opacity: 0.9;
      }
      75% {
        transform: translateY(-50%) translateX(3px) rotate(8deg) scale(1.1);
        opacity: 0.95;
      }
    }

    /* –ê–≤–∞—Ç–∞—Ä - –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é */
    .theme-avatar {
      display: flex !important;
    }

    body.theme-kitty #profile-avatar {
      font-size: 2rem !important;
    }

    /* –°–∫—Ä—ã–≤–∞–µ–º –¥–µ–∫–æ—Ä–∞—Ü–∏—é –∫–æ—Ç–∏–∫–∞ —Å–ø—Ä–∞–≤–∞ —Å–≤–µ—Ä—Ö—É */
    .kitty-decoration {
      display: none !important;
      visibility: hidden !important;
      opacity: 0 !important;
    }

    /* –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Å—Ç–∏–ª–∏ –¥–ª—è —Ä–æ–∑–æ–≤—ã—Ö –∏–∫–æ–Ω–æ–∫ –≤ —Ç–µ–º–µ Kitty */
    body.theme-kitty .nav-button {
      transition: all 0.3s ease;
    }

    /* –£–≤–µ–ª–∏—á–µ–Ω–∏–µ —Ä–∞–∑–º–µ—Ä–∞ –∏–∫–æ–Ω–æ–∫ –≤ —Ç–µ–º–µ Kitty –¥–ª—è –ª—É—á—à–µ–π –≤–∏–¥–∏–º–æ—Å—Ç–∏ */
    body.theme-kitty .nav-button {
      font-size: 1.1rem;
    }

    /* –†–æ–∑–æ–≤—ã–π —Ñ–∏–ª—å—Ç—Ä –¥–ª—è —ç–º–æ–¥–∑–∏ –≤ —Ç–µ–º–µ Kitty */
    body.theme-kitty .nav-button,
    body.theme-kitty h2,
    body.theme-kitty h3,
    body.theme-kitty button,
    body.theme-kitty #profile-avatar {
      filter: hue-rotate(-10deg) saturate(1.3) brightness(1.1);
    }

    /* –û—Å–æ–±—ã–π —Ñ–∏–ª—å—Ç—Ä –¥–ª—è –∫–æ—Ç–∏–∫–∞ - –¥–µ–ª–∞–µ–º –µ–≥–æ –±–æ–ª–µ–µ —Ä–æ–∑–æ–≤—ã–º */
    body.theme-kitty #profile-avatar {
      filter: hue-rotate(-15deg) saturate(1.5) brightness(1.2);
    }

    /* üê± –ê–Ω–∏–º–∞—Ü–∏–∏ –¥–ª—è –∫–æ—Ç–∏–∫–æ–≤ –≤ —Ç–µ–º–µ Kitty */
    @keyframes kitty-bounce {
      0%, 100% { transform: translateY(0) rotate(0deg); }
      25% { transform: translateY(-8px) rotate(-5deg); }
      75% { transform: translateY(-8px) rotate(5deg); }
    }

    @keyframes kitty-wiggle {
      0%, 100% { transform: rotate(0deg); }
      25% { transform: rotate(-10deg); }
      75% { transform: rotate(10deg); }
    }

    @keyframes kitty-blink {
      0%, 90%, 100% { transform: scaleY(1); }
      95% { transform: scaleY(0.1); }
    }

    @keyframes kitty-float {
      0%, 100% { transform: translateY(0px); }
      50% { transform: translateY(-10px); }
    }

    @keyframes kitty-heart {
      0%, 100% { transform: scale(1); }
      50% { transform: scale(1.2); }
    }

    @keyframes kitty-spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }

    /* –ê–Ω–∏–º–∞—Ü–∏—è –∫—Ä—É—Ç–∏–ª–∫–∏ –¥–ª—è —á–∏—Å–µ–ª —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ */
    @keyframes number-spin-up {
      from { 
        transform: translateY(20px) scale(0.8); 
        opacity: 0; 
      }
      to { 
        transform: translateY(0) scale(1); 
        opacity: 1; 
      }
    }
    
    @keyframes number-spin-down {
      from { 
        transform: translateY(-20px) scale(0.8); 
        opacity: 0; 
      }
      to { 
        transform: translateY(0) scale(1); 
        opacity: 1; 
      }
    }
    
    .number-spin-up {
      animation: number-spin-up 0.5s ease-out;
    }
    
    .number-spin-down {
      animation: number-spin-down 0.5s ease-out;
    }

    /* –ê–Ω–∏–º–∞—Ü–∏—è –¥–ª—è –∞–≤–∞—Ç–∞—Ä–∞ –∫–æ—Ç–∏–∫–∞ */
    body.theme-kitty #profile-avatar {
      animation: kitty-float 3s ease-in-out infinite;
      display: inline-block;
    }

    body.theme-kitty #profile-avatar:hover {
      animation: kitty-bounce 0.6s ease-in-out infinite;
    }

    /* –£–±—Ä–∞–Ω–∞ –∞–Ω–∏–º–∞—Ü–∏—è –ø—Ä–∏ –Ω–∞–≤–µ–¥–µ–Ω–∏–∏ –Ω–∞ –∫–Ω–æ–ø–∫–∏ –Ω–∞–≤–∏–≥–∞—Ü–∏–∏ */

    /* –î–µ–∫–æ—Ä–∞—Ç–∏–≤–Ω—ã–µ –∫–æ—Ç–∏–∫–∏ –≤ —É–≥–ª–∞—Ö */
    body.theme-kitty main::before {
      content: 'üêæ';
      position: fixed;
      top: 20px;
      right: 20px;
      font-size: 2rem;
      opacity: 0.3;
      animation: kitty-float 4s ease-in-out infinite;
      pointer-events: none;
      z-index: 1;
    }

    body.theme-kitty main::after {
      content: 'üêæ';
      position: fixed;
      bottom: 80px;
      left: 20px;
      font-size: 1.5rem;
      opacity: 0.2;
      animation: kitty-float 3s ease-in-out infinite 1s;
      pointer-events: none;
      z-index: 1;
    }

    /* –ö–æ—Ç–∏–∫–∏ –≤ –ø—É—Å—Ç—ã—Ö —Å–æ—Å—Ç–æ—è–Ω–∏—è—Ö */
    body.theme-kitty .text-center:empty::before,
    body.theme-kitty #contest-list:empty::before,
    body.theme-kitty #rating-list:empty::before {
      content: 'üê±\A –ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö...';
      white-space: pre;
      display: block;
      font-size: 3rem;
      opacity: 0.5;
      padding: 2rem;
      animation: kitty-float 2s ease-in-out infinite;
    }

    /* –ê–Ω–∏–º–∞—Ü–∏—è –¥–ª—è –∏–∫–æ–Ω–æ–∫ –≤ –∫–Ω–æ–ø–∫–∞—Ö */
    body.theme-kitty button:has(üê±),
    body.theme-kitty button:has(üéÅ),
    body.theme-kitty button:has(üíñ) {
      position: relative;
    }

    body.theme-kitty .nav-button::after {
      content: '';
      position: absolute;
      top: -5px;
      right: -5px;
      width: 8px;
      height: 8px;
      background: #ff6b9d;
      border-radius: 50%;
      opacity: 0;
      animation: kitty-heart 1s ease-in-out infinite;
    }

    body.theme-kitty .nav-button.active::after {
      opacity: 1;
    }

    /* –ú–∏–ª—ã–µ —ç—Ñ—Ñ–µ–∫—Ç—ã –ø—Ä–∏ –Ω–∞–≤–µ–¥–µ–Ω–∏–∏ –Ω–∞ –∫–∞—Ä—Ç–æ—á–∫–∏ */
    body.theme-kitty .rounded-lg.border:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 20px rgba(255, 107, 157, 0.4) !important;
      transition: all 0.3s ease;
    }

    /* –ö–æ—Ç–∏–∫–∏ –≤ —Å–ø–∏–Ω–Ω–µ—Ä–µ –∑–∞–≥—Ä—É–∑–∫–∏ */
    body.theme-kitty #loading-spinner {
      background: linear-gradient(135deg, #ffe6f2, #fff0f5) !important;
    }

    body.theme-kitty #loading-spinner .flex .animate-spin {
      display: none !important;
    }

    body.theme-kitty #loading-spinner .flex p {
      display: none !important;
    }

    body.theme-kitty #loading-spinner::before {
      content: 'üê±';
      font-size: 5rem;
      animation: kitty-bounce 1s ease-in-out infinite, kitty-blink 3s ease-in-out infinite;
      display: block;
      text-align: center;
      margin-bottom: 1rem;
    }

    body.theme-kitty #loading-spinner::after {
      content: '–ó–∞–≥—Ä—É–∑–∫–∞... üêæ';
      display: block;
      text-align: center;
      color: #ff6b9d;
      font-size: 1.2rem;
      animation: kitty-float 2s ease-in-out infinite;
      font-weight: bold;
    }

    /* –î–µ–∫–æ—Ä–∞—Ç–∏–≤–Ω—ã–µ –ª–∞–ø–∫–∏ */
    body.theme-kitty section::before {
      content: 'üêæ';
      position: absolute;
      top: -10px;
      left: 10px;
      font-size: 1rem;
      opacity: 0.2;
      animation: kitty-wiggle 2s ease-in-out infinite;
      pointer-events: none;
    }


    /* –ó–∞–≥–æ–ª–æ–≤–∫–∏ */
    body.theme-kitty h2,
    body.theme-kitty h3 {
      color: var(--text-primary) !important;
    }

    /* –ö–∞—Ä—Ç–æ—á–∫–∏ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ */
    body.theme-kitty .bg-black\/40 {
      background-color: rgba(255, 255, 255, 0.6) !important;
    }

    /* –°–µ–∫—Ü–∏–∏ –∫–æ–Ω—Ç–µ–Ω—Ç–∞ */
    body.theme-kitty section {
      background-color: transparent !important;
    }

    /* –°–ø–∏–Ω–Ω–µ—Ä –∑–∞–≥—Ä—É–∑–∫–∏ */
    body.theme-kitty #loading-spinner {
      background: var(--neon-bg) !important;
    }

    /* –ú–æ–¥–∞–ª—å–Ω—ã–µ –æ–∫–Ω–∞ –¥–ª—è –∫–æ–Ω–∫—É—Ä—Å–æ–≤ */
    body.theme-kitty #drawing-results-modal,
    body.theme-kitty #voting-modal,
    body.theme-kitty #collection-links-modal,
    body.theme-kitty #collection-arrange-modal {
      background: rgba(255, 240, 245, 0.95) !important;
    }

    body.theme-kitty #drawing-results-modal > div,
    body.theme-kitty #voting-modal > div,
    body.theme-kitty #collection-links-modal > div,
    body.theme-kitty #collection-arrange-modal > div {
      background: var(--card-bg) !important;
      border-color: var(--border-color) !important;
    }

    /* –ö—Ä–∞—Å–Ω—ã–π —Ü–≤–µ—Ç –¥–ª—è –æ—à–∏–±–æ–∫ */
    body.theme-kitty .text-red-400 {
      color: #ef4444 !important;
    }

    /* –°—Å—ã–ª–∫–∏ */
    body.theme-kitty a {
      color: #ff6b9d !important;
    }

    body.theme-kitty a:hover {
      color: #ff1493 !important;
    }

    /* ‚öîÔ∏è Attack on Titan theme - —Å–µ–ø–∏—è, –ø–µ—Ä–≥–∞–º–µ–Ω—Ç, –≥–æ—Ç–∏—á–µ—Å–∫–∏–π —Å—Ç–∏–ª—å */
    body.theme-aot {
      font-family: 'UnifrakturMaguntia', 'Creepster', serif !important;
      --aot-parchment: #f4e4bc;
      --aot-parchment-dark: #d4c4a4;
      --aot-sepia: #8b6f47;
      --aot-blood: #8b0000;
      --aot-text: #3d2817;
      --aot-border: #5c4a2f;
      --aot-sky: #c9b99b;
    }

    /* –§–æ–Ω —Å—Ç—Ä–∞–Ω–∏—Ü—ã - —Å–µ–ø–∏—è —Å —Ç–µ–∫—Å—Ç—É—Ä–æ–π –ø–µ—Ä–≥–∞–º–µ–Ω—Ç–∞ */
    body.theme-aot.page-dark {
      position: relative;
      background: 
        /* –¢–µ–∫—Å—Ç—É—Ä–∞ –ø–µ—Ä–≥–∞–º–µ–Ω—Ç–∞ */
        repeating-linear-gradient(
          0deg,
          rgba(139, 111, 71, 0.03) 0px,
          rgba(139, 111, 71, 0.03) 1px,
          transparent 1px,
          transparent 2px
        ),
        repeating-linear-gradient(
          90deg,
          rgba(139, 111, 71, 0.03) 0px,
          rgba(139, 111, 71, 0.03) 1px,
          transparent 1px,
          transparent 2px
        ),
        /* –ì—Ä–∞–¥–∏–µ–Ω—Ç —Å–µ–ø–∏–∏ */
        radial-gradient(ellipse at top, #e8d5b7 0%, #d4c4a4 50%, #c9b99b 100%),
        /* –ë–∞–∑–æ–≤—ã–π —Ü–≤–µ—Ç –ø–µ—Ä–≥–∞–º–µ–Ω—Ç–∞ */
        #f4e4bc;
      background-size: 
        20px 20px,
        20px 20px,
        100% 60%,
        100% 100%;
      color: var(--aot-text) !important;
      min-height: 100vh;
    }

    /* –ò–ª–ª—é—Å—Ç—Ä–∞—Ü–∏—è Attack Titan –≤–≤–µ—Ä—Ö—É –ø—Ä–æ—Ñ–∏–ª—è */
    body.theme-aot #profile-section {
      position: relative;
      padding-top: 0;
    }

    /* –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Ç–∏—Ç–∞–Ω–∞ –¥–ª—è —Ç–µ–º—ã AoT */
    body.theme-aot #aot-titan-image {
      display: block !important;
      position: relative !important;
      width: 100% !important;
      margin-bottom: 20px !important;
    }

    /* –ê–¥–∞–ø—Ç–∏–≤–Ω–æ–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Ç–∏—Ç–∞–Ω–∞ */
    body.theme-aot #aot-titan-image img {
      width: 100% !important;
      height: auto !important;
      max-height: 300px !important;
      object-fit: contain !important;
      display: block !important;
    }

    /* –ù–∞ –º–æ–±–∏–ª—å–Ω—ã—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞—Ö */
    @media (max-width: 640px) {
      body.theme-aot #aot-titan-image {
        max-height: 200px !important;
      }
      body.theme-aot #aot-titan-image img {
        max-height: 200px !important;
      }
    }

    /* –ù–∞ –ø–ª–∞–Ω—à–µ—Ç–∞—Ö */
    @media (min-width: 641px) and (max-width: 1024px) {
      body.theme-aot #aot-titan-image {
        max-height: 250px !important;
      }
      body.theme-aot #aot-titan-image img {
        max-height: 250px !important;
      }
    }

    body.theme-aot #profile-section::before {
      content: '';
      position: absolute;
      top: -20px;
      left: 0;
      right: 0;
      height: 200px;
      background: 
        /* –ì–ª–∞–∑–∞ —Ç–∏—Ç–∞–Ω–∞ - –∑–µ–ª–µ–Ω–æ–µ —Å–≤–µ—á–µ–Ω–∏–µ */
        radial-gradient(ellipse 30px 20px at 45% 45%, rgba(0, 255, 0, 0.4) 0%, transparent 70%),
        radial-gradient(ellipse 30px 20px at 55% 45%, rgba(0, 255, 0, 0.4) 0%, transparent 70%),
        /* –û–±–ª–∞—á–Ω–æ–µ –Ω–µ–±–æ */
        radial-gradient(ellipse 200px 100px at 50% 30%, rgba(201, 185, 155, 0.6) 0%, transparent 60%),
        /* –¢–µ–º–Ω—ã–µ –æ–±–ª–∞–∫–∞ */
        radial-gradient(ellipse 150px 80px at 30% 25%, rgba(139, 111, 71, 0.3) 0%, transparent 50%),
        radial-gradient(ellipse 150px 80px at 70% 25%, rgba(139, 111, 71, 0.3) 0%, transparent 50%),
        /* –ë–∞–∑–æ–≤—ã–π —Å–µ–ø–∏—è —Ñ–æ–Ω */
        linear-gradient(to bottom, rgba(201, 185, 155, 0.4), transparent);
      background-size: 100% 100%;
      z-index: 0;
      pointer-events: none;
      opacity: 0.8;
    }

    /* –ö—Ä–æ–≤–∞–≤—ã–µ –±—Ä—ã–∑–≥–∏ - –ú–ù–û–ì–û –ö–†–û–í–ò! */
    body.theme-aot #profile-section .rounded-lg.border {
      position: relative;
    }

    body.theme-aot #profile-section .rounded-lg.border::before,
    body.theme-aot #profile-section .rounded-lg.border::after {
      content: '';
      position: absolute;
      background: var(--aot-blood);
      border-radius: 50% 50% 50% 0;
      opacity: 0.7;
      z-index: 10;
    }

    /* –ü–µ—Ä–≤–∞—è –ø–∞–Ω–µ–ª—å - –º–Ω–æ–≥–æ –±—Ä—ã–∑–≥ —Å–ø—Ä–∞–≤–∞ */
    body.theme-aot #profile-section .rounded-lg.border:first-of-type::before {
      top: 8px;
      right: 12px;
      width: 12px;
      height: 12px;
      transform: rotate(45deg);
    }

    body.theme-aot #profile-section .rounded-lg.border:first-of-type::after {
      top: 22px;
      right: 3px;
      width: 8px;
      height: 8px;
      transform: rotate(-30deg);
    }

    body.theme-aot #profile-section .rounded-lg.border:first-of-type {
      background: 
        /* –ú–Ω–æ–≥–æ –∫—Ä–æ–≤–∞–≤—ã—Ö –±—Ä—ã–∑–≥ —Å–ø—Ä–∞–≤–∞ */
        radial-gradient(ellipse 20px 25px at 96% 15%, rgba(139, 0, 0, 0.5) 0%, transparent 70%),
        radial-gradient(ellipse 15px 20px at 98% 35%, rgba(139, 0, 0, 0.45) 0%, transparent 70%),
        radial-gradient(ellipse 12px 18px at 94% 50%, rgba(139, 0, 0, 0.4) 0%, transparent 70%),
        radial-gradient(ellipse 10px 15px at 97% 65%, rgba(139, 0, 0, 0.35) 0%, transparent 70%),
        radial-gradient(ellipse 8px 12px at 95% 80%, rgba(139, 0, 0, 0.3) 0%, transparent 70%),
        /* –ö—Ä–æ–≤–∞–≤—ã–µ –±—Ä—ã–∑–≥–∏ —Å–ª–µ–≤–∞ */
        radial-gradient(ellipse 10px 14px at 4% 25%, rgba(139, 0, 0, 0.35) 0%, transparent 70%),
        radial-gradient(ellipse 8px 10px at 2% 55%, rgba(139, 0, 0, 0.3) 0%, transparent 70%),
        /* –¢–µ–∫—Å—Ç—É—Ä–∞ –ø–µ—Ä–≥–∞–º–µ–Ω—Ç–∞ */
        repeating-linear-gradient(
          0deg,
          rgba(139, 111, 71, 0.05) 0px,
          rgba(139, 111, 71, 0.05) 1px,
          transparent 1px,
          transparent 2px
        ),
        linear-gradient(135deg, #f4e4bc 0%, #e8d5b7 100%) !important;
    }

    /* –í—Ç–æ—Ä–∞—è –ø–∞–Ω–µ–ª—å - –º–Ω–æ–≥–æ –±—Ä—ã–∑–≥ —Å–æ –≤—Å–µ—Ö —Å—Ç–æ—Ä–æ–Ω */
    body.theme-aot #profile-section .rounded-lg.border:nth-of-type(2)::before {
      top: 8px;
      left: 8px;
      width: 10px;
      height: 10px;
      transform: rotate(-45deg);
    }

    body.theme-aot #profile-section .rounded-lg.border:nth-of-type(2)::after {
      top: 8px;
      right: 8px;
      width: 9px;
      height: 9px;
      transform: rotate(60deg);
    }

    body.theme-aot #profile-section .rounded-lg.border:nth-of-type(2) {
      background: 
        /* –ö—Ä–æ–≤–∞–≤—ã–µ –±—Ä—ã–∑–≥–∏ —Å–ª–µ–≤–∞ */
        radial-gradient(ellipse 18px 22px at 3% 12%, rgba(139, 0, 0, 0.5) 0%, transparent 70%),
        radial-gradient(ellipse 14px 18px at 5% 30%, rgba(139, 0, 0, 0.45) 0%, transparent 70%),
        radial-gradient(ellipse 12px 16px at 2% 50%, rgba(139, 0, 0, 0.4) 0%, transparent 70%),
        radial-gradient(ellipse 10px 14px at 4% 70%, rgba(139, 0, 0, 0.35) 0%, transparent 70%),
        radial-gradient(ellipse 8px 12px at 3% 85%, rgba(139, 0, 0, 0.3) 0%, transparent 70%),
        /* –ö—Ä–æ–≤–∞–≤—ã–µ –±—Ä—ã–∑–≥–∏ —Å–ø—Ä–∞–≤–∞ */
        radial-gradient(ellipse 16px 20px at 97% 18%, rgba(139, 0, 0, 0.5) 0%, transparent 70%),
        radial-gradient(ellipse 13px 17px at 95% 40%, rgba(139, 0, 0, 0.45) 0%, transparent 70%),
        radial-gradient(ellipse 11px 15px at 98% 60%, rgba(139, 0, 0, 0.4) 0%, transparent 70%),
        radial-gradient(ellipse 9px 13px at 96% 75%, rgba(139, 0, 0, 0.35) 0%, transparent 70%),
        /* –ö—Ä–æ–≤–∞–≤—ã–µ –±—Ä—ã–∑–≥–∏ —Å–≤–µ—Ä—Ö—É */
        radial-gradient(ellipse 10px 12px at 20% 2%, rgba(139, 0, 0, 0.4) 0%, transparent 70%),
        radial-gradient(ellipse 8px 10px at 50% 3%, rgba(139, 0, 0, 0.35) 0%, transparent 70%),
        radial-gradient(ellipse 9px 11px at 80% 2%, rgba(139, 0, 0, 0.4) 0%, transparent 70%),
        /* –¢–µ–∫—Å—Ç—É—Ä–∞ –ø–µ—Ä–≥–∞–º–µ–Ω—Ç–∞ */
        repeating-linear-gradient(
          0deg,
          rgba(139, 111, 71, 0.05) 0px,
          rgba(139, 111, 71, 0.05) 1px,
          transparent 1px,
          transparent 2px
        ),
        linear-gradient(135deg, #f4e4bc 0%, #e8d5b7 100%) !important;
    }

    /* –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –∫—Ä–æ–≤–∞–≤—ã–µ –±—Ä—ã–∑–≥–∏ –Ω–∞ –ø–∞–Ω–µ–ª—è—Ö —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ */
    body.theme-aot #profile-section .grid.grid-cols-2 > div {
      position: relative;
    }

    body.theme-aot #profile-section .grid.grid-cols-2 > div::before,
    body.theme-aot #profile-section .grid.grid-cols-2 > div::after {
      content: '';
      position: absolute;
      background: var(--aot-blood);
      border-radius: 50% 50% 50% 0;
      opacity: 0.6;
      z-index: 10;
    }

    body.theme-aot #profile-section .grid.grid-cols-2 > div:first-child::before {
      top: 5px;
      left: 5px;
      width: 7px;
      height: 7px;
      transform: rotate(-30deg);
    }

    body.theme-aot #profile-section .grid.grid-cols-2 > div:first-child::after {
      top: 5px;
      right: 5px;
      width: 6px;
      height: 6px;
      transform: rotate(45deg);
    }

    body.theme-aot #profile-section .grid.grid-cols-2 > div:last-child::before {
      top: 5px;
      left: 5px;
      width: 8px;
      height: 8px;
      transform: rotate(-45deg);
    }

    body.theme-aot #profile-section .grid.grid-cols-2 > div:last-child::after {
      top: 5px;
      right: 5px;
      width: 7px;
      height: 7px;
      transform: rotate(30deg);
    }

    /* –û—Å–Ω–æ–≤–Ω–æ–π –∫–æ–Ω—Ç–µ–Ω—Ç */
    body.theme-aot main,
    body.theme-aot #profile-section {
      position: relative;
      z-index: 1;
    }

    /* –ö–æ–Ω—Ç–µ–Ω—Ç –ø—Ä–æ—Ñ–∏–ª—è –ø–æ–≤–µ—Ä—Ö –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –ö—É—Ä–∞–ø–∏–∫–∏ */
    body.theme-kurapika #profile-section > *:not(#kurapika-image) {
      position: relative;
      z-index: 1;
    }

    /* –ó–∞–≥–æ–ª–æ–≤–∫–∏ - –≥–æ—Ç–∏—á–µ—Å–∫–∏–π —Å—Ç–∏–ª—å */
    body.theme-aot h2 {
      font-family: 'UnifrakturMaguntia', serif !important;
      color: var(--aot-text) !important;
      font-size: 2rem !important;
      text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3) !important;
      margin-bottom: 20px !important;
      letter-spacing: 2px !important;
    }

    body.theme-aot h3 {
      font-family: 'UnifrakturMaguntia', serif !important;
      color: var(--aot-text) !important;
      font-size: 1.5rem !important;
      text-shadow: 1px 1px 3px rgba(0, 0, 0, 0.3) !important;
    }

    /* –ü–∞–Ω–µ–ª–∏ - –ø–µ—Ä–≥–∞–º–µ–Ω—Ç —Å —Ä–∞–º–∫–æ–π */
    body.theme-aot .rounded-lg.border,
    body.theme-aot .bg-black\/30 {
      background: 
        /* –¢–µ–∫—Å—Ç—É—Ä–∞ –ø–µ—Ä–≥–∞–º–µ–Ω—Ç–∞ */
        repeating-linear-gradient(
          0deg,
          rgba(139, 111, 71, 0.05) 0px,
          rgba(139, 111, 71, 0.05) 1px,
          transparent 1px,
          transparent 2px
        ),
        /* –ë–∞–∑–æ–≤—ã–π –ø–µ—Ä–≥–∞–º–µ–Ω—Ç */
        linear-gradient(135deg, #f4e4bc 0%, #e8d5b7 100%) !important;
      border: 2px solid var(--aot-border) !important;
      border-radius: 8px !important;
      box-shadow: 
        inset 0 0 20px rgba(139, 111, 71, 0.2),
        0 4px 8px rgba(0, 0, 0, 0.2) !important;
      color: var(--aot-text) !important;
      position: relative;
    }

    /* –ü–µ—Ä–≤–∞—è –ø–∞–Ω–µ–ª—å –ø—Ä–æ—Ñ–∏–ª—è - —Å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (—Ñ–æ–Ω —É–∂–µ –∑–∞–¥–∞–Ω –≤—ã—à–µ) */
    body.theme-aot #profile-section .rounded-lg.border.border-violet-400\/30:first-of-type {
      border: 2px solid var(--aot-border) !important;
      padding: 20px !important;
      margin-bottom: 20px !important;
    }

    /* –ê–≤–∞—Ç–∞—Ä - –∫—Ä—É–≥–ª—ã–π —Å –≥—Ä–∞–¥–∏–µ–Ω—Ç–æ–º */
    body.theme-aot .theme-avatar {
      background: linear-gradient(135deg, #ff69b4 0%, #9370db 50%, #87ceeb 100%) !important;
      border: 2px solid var(--aot-border) !important;
      border-radius: 50% !important;
      width: 64px !important;
      height: 64px !important;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.3) !important;
    }

    /* –¢–µ–∫—Å—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è - –≥–æ—Ç–∏—á–µ—Å–∫–∏–π */
    body.theme-aot #profile-username {
      font-family: 'UnifrakturMaguntia', serif !important;
      font-size: 1.5rem !important;
      color: var(--aot-text) !important;
      font-weight: bold !important;
      text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.2) !important;
    }

    body.theme-aot #profile-id,
    body.theme-aot #profile-first-login {
      font-family: 'Arial', sans-serif !important;
      color: var(--aot-sepia) !important;
      font-size: 0.9rem !important;
    }

    body.theme-aot #profile-status {
      font-family: 'Arial', sans-serif !important;
      color: var(--aot-sepia) !important;
      font-weight: bold !important;
    }

    body.theme-aot .text-gray-400 {
      font-family: 'UnifrakturMaguntia', serif !important;
      color: var(--aot-sepia) !important;
    }

    /* –í—Ç–æ—Ä–∞—è –ø–∞–Ω–µ–ª—å - —É—Ä–æ–≤–µ–Ω—å –∏ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ (—Ñ–æ–Ω —É–∂–µ –∑–∞–¥–∞–Ω –≤—ã—à–µ) */
    body.theme-aot #profile-section .rounded-lg.border.border-violet-400\/30:nth-of-type(2) {
      border: 2px solid var(--aot-border) !important;
      padding: 20px !important;
    }

    /* –ë–µ–π–¥–∂ —É—Ä–æ–≤–Ω—è */
    body.theme-aot #level-badge {
      background: linear-gradient(135deg, #8b6f47 0%, #5c4a2f 100%) !important;
      color: #f4e4bc !important;
      border: 2px solid var(--aot-border) !important;
      border-radius: 6px !important;
      padding: 8px 16px !important;
      font-family: 'UnifrakturMaguntia', serif !important;
      font-size: 1rem !important;
      text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.5) !important;
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.3) !important;
    }

    /* –û–ø—ã—Ç */
    body.theme-aot #current-experience {
      color: var(--aot-sepia) !important;
      font-family: 'Arial', sans-serif !important;
      font-weight: bold !important;
    }

    /* –ü—Ä–æ–≥—Ä–µ—Å—Å-–±–∞—Ä */
    body.theme-aot #progress-bar-container {
      background: rgba(139, 111, 71, 0.3) !important;
      border: 2px solid var(--aot-border) !important;
      border-radius: 4px !important;
    }

    body.theme-aot #experience-progress-bar {
      background: linear-gradient(90deg, #8b6f47 0%, #5c4a2f 50%, #8b6f47 100%) !important;
      background-size: 200% 100% !important;
      animation: aot-progress-flow 2s linear infinite !important;
    }

    @keyframes aot-progress-flow {
      0% { background-position: 0% 50%; }
      100% { background-position: 200% 50%; }
    }

    /* –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ - –¥–≤–µ –ø–∞–Ω–µ–ª–∏ —Å —ç–º–±–ª–µ–º–æ–π Wings of Freedom –∏ –∫—Ä–æ–≤–∞–≤—ã–º–∏ –±—Ä—ã–∑–≥–∞–º–∏ */
    body.theme-aot #profile-section .grid.grid-cols-2 > div {
      background: 
        /* –≠–º–±–ª–µ–º–∞ Wings of Freedom —Å–ª–µ–≤–∞ */
        url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><path d="M50 20 L30 50 L50 45 L70 50 Z" fill="%235c4a2f" opacity="0.3"/><path d="M50 45 L30 80 L50 70 L70 80 Z" fill="%235c4a2f" opacity="0.3"/></svg>') no-repeat 10px center,
        /* –ú–Ω–æ–≥–æ –∫—Ä–æ–≤–∞–≤—ã—Ö –±—Ä—ã–∑–≥ */
        radial-gradient(ellipse 10px 12px at 8% 15%, rgba(139, 0, 0, 0.4) 0%, transparent 70%),
        radial-gradient(ellipse 8px 10px at 92% 18%, rgba(139, 0, 0, 0.4) 0%, transparent 70%),
        radial-gradient(ellipse 7px 9px at 5% 50%, rgba(139, 0, 0, 0.35) 0%, transparent 70%),
        radial-gradient(ellipse 6px 8px at 95% 55%, rgba(139, 0, 0, 0.35) 0%, transparent 70%),
        radial-gradient(ellipse 9px 11px at 10% 80%, rgba(139, 0, 0, 0.4) 0%, transparent 70%),
        radial-gradient(ellipse 8px 10px at 90% 82%, rgba(139, 0, 0, 0.4) 0%, transparent 70%),
        /* –¢–µ–∫—Å—Ç—É—Ä–∞ –ø–µ—Ä–≥–∞–º–µ–Ω—Ç–∞ */
        repeating-linear-gradient(
          0deg,
          rgba(139, 111, 71, 0.05) 0px,
          rgba(139, 111, 71, 0.05) 1px,
          transparent 1px,
          transparent 2px
        ),
        linear-gradient(135deg, #f4e4bc 0%, #e8d5b7 100%) !important;
      border: 2px solid var(--aot-border) !important;
      border-radius: 8px !important;
      padding: 16px !important;
      box-shadow: 
        inset 0 0 15px rgba(139, 111, 71, 0.2),
        0 2px 4px rgba(0, 0, 0, 0.2) !important;
      text-align: center !important;
    }

    body.theme-aot #profile-section .grid.grid-cols-2 .text-2xl {
      font-family: 'UnifrakturMaguntia', serif !important;
      color: var(--aot-text) !important;
      font-size: 2rem !important;
      text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.2) !important;
    }

    body.theme-aot #profile-section .grid.grid-cols-2 .text-xs {
      font-family: 'UnifrakturMaguntia', serif !important;
      color: var(--aot-sepia) !important;
      font-size: 0.9rem !important;
      margin-top: 4px !important;
    }

    /* –ö–Ω–æ–ø–∫–∏ */
    body.theme-aot .nav-button {
      background: linear-gradient(135deg, #8b6f47 0%, #5c4a2f 100%) !important;
      color: #f4e4bc !important;
      border: 2px solid var(--aot-border) !important;
      border-radius: 6px !important;
      font-family: 'UnifrakturMaguntia', serif !important;
      font-size: 1rem !important;
      text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.5) !important;
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.3) !important;
      transition: all 0.2s !important;
    }

    body.theme-aot .nav-button:hover,
    body.theme-aot .nav-button.active {
      background: linear-gradient(135deg, #5c4a2f 0%, #8b6f47 100%) !important;
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.4) !important;
      transform: translateY(-1px);
    }

    body.theme-aot .neon-button,
    body.theme-aot #change-theme-btn,
    body.theme-aot #contact-owner-btn {
      background: linear-gradient(135deg, #8b6f47 0%, #5c4a2f 100%) !important;
      color: #f4e4bc !important;
      border: 2px solid var(--aot-border) !important;
      border-radius: 6px !important;
      font-family: 'UnifrakturMaguntia', serif !important;
      font-size: 1rem !important;
      text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.5) !important;
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.3) !important;
      padding: 12px 20px !important;
    }

    body.theme-aot .neon-button:hover,
    body.theme-aot #change-theme-btn:hover,
    body.theme-aot #contact-owner-btn:hover {
      background: linear-gradient(135deg, #5c4a2f 0%, #8b6f47 100%) !important;
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.4) !important;
      transform: translateY(-1px);
    }

    /* –¢–µ–∫—Å—Ç */
    body.theme-aot .text-white {
      color: var(--aot-text) !important;
    }

    body.theme-aot .text-gray-300 {
      color: var(--aot-sepia) !important;
    }

    body.theme-aot .text-violet-400 {
      color: var(--aot-sepia) !important;
    }

    body.theme-aot .text-pink-400 {
      color: var(--aot-sepia) !important;
    }

    body.theme-aot .text-blue-400 {
      color: var(--aot-sepia) !important;
    }

    body.theme-aot .text-green-400 {
      color: var(--aot-sepia) !important;
    }

    /* –†–∞–∑–¥–µ–ª–∏—Ç–µ–ª–∏ */
    body.theme-aot .border-violet-400\/30,
    body.theme-aot .border-violet-400\/20 {
      border-color: var(--aot-border) !important;
    }

    body.theme-aot .border-t {
      border-top-color: var(--aot-border) !important;
    }

    /* –ú–æ–¥–∞–ª—å–Ω—ã–µ –æ–∫–Ω–∞ */
    body.theme-aot #theme-selector-modal,
    body.theme-aot #contact-owner-modal,
    body.theme-aot #subscription-modal {
      background: rgba(0, 0, 0, 0.7) !important;
    }

    body.theme-aot #theme-selector-modal > div,
    body.theme-aot #contact-owner-modal > div {
      background: linear-gradient(135deg, #f4e4bc 0%, #e8d5b7 100%) !important;
      border: 2px solid var(--aot-border) !important;
      color: var(--aot-text) !important;
    }

    body.theme-aot .input-field {
      background: rgba(244, 228, 188, 0.8) !important;
      border: 2px solid var(--aot-border) !important;
      color: var(--aot-text) !important;
      font-family: 'Arial', sans-serif !important;
    }

    body.theme-aot .input-field:focus {
      border-color: var(--aot-sepia) !important;
      box-shadow: 0 0 8px rgba(139, 111, 71, 0.4) !important;
    }

    /* üîó Kurapika theme - –∫–æ—Ä–∏—á–Ω–µ–≤–æ-–∑–æ–ª–æ—Ç–∞—è —Ç–µ–º–∞ —Å —Ü–µ–ø—è–º–∏ */
    body.theme-kurapika {
      font-family: 'Arial', sans-serif !important;
      --kurapika-brown: #8b6f47;
      --kurapika-brown-dark: #5c4a2f;
      --kurapika-brown-light: #a0826d;
      --kurapika-gold: #d4af37;
      --kurapika-gold-light: #f4e4bc;
      --kurapika-gold-dark: #b8941f;
      --kurapika-bg: #e8d5b7;
      --kurapika-text: #3d2817;
      --kurapika-chain: #c9a961;
    }

    /* –§–æ–Ω —Å—Ç—Ä–∞–Ω–∏—Ü—ã - —Å–≤–µ—Ç–ª–æ-–∫–æ—Ä–∏—á–Ω–µ–≤—ã–π */
    body.theme-kurapika.page-dark {
      background: 
        repeating-linear-gradient(0deg, rgba(139, 111, 71, 0.02) 0px, rgba(139, 111, 71, 0.02) 1px, transparent 1px, transparent 2px),
        repeating-linear-gradient(90deg, rgba(139, 111, 71, 0.02) 0px, rgba(139, 111, 71, 0.02) 1px, transparent 1px, transparent 2px),
        linear-gradient(135deg, #f4e4bc 0%, #e8d5b7 50%, #d4c4a4 100%);
      background-size: 20px 20px, 20px 20px, 100% 100%;
      color: var(--kurapika-text) !important;
      min-height: 100vh;
    }

    /* –î–µ–∫–æ—Ä–∞—Ç–∏–≤–Ω—ã–µ —Ü–µ–ø–Ω—ã–µ –≥—Ä–∞–Ω–∏—Ü—ã */
    body.theme-kurapika .rounded-lg.border,
    body.theme-kurapika .bg-black\/30 {
      position: relative;
      background: linear-gradient(135deg, #fdf5da 0%, #f1deba 45%, #d8be8c 100%) padding-box !important;
      border: 3px solid transparent !important;
      border-radius: 14px !important;
      box-shadow:
        inset 0 0 25px rgba(79, 56, 27, 0.25),
        0 14px 18px rgba(48, 32, 17, 0.35) !important;
      color: var(--kurapika-text) !important;
    }

    /* –¶–µ–ø–Ω—ã–µ –≥—Ä–∞–Ω–∏—Ü—ã —á–µ—Ä–µ–∑ –ø—Å–µ–≤–¥–æ—ç–ª–µ–º–µ–Ω—Ç—ã - –Ω–∞—Å—Ç–æ—è—â–∏–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–Ω—ã–µ –∑–≤–µ–Ω—å—è */
    body.theme-kurapika .rounded-lg.border::before,
    body.theme-kurapika .bg-black\/30::before {
      content: '';
      position: absolute;
      inset: -12px;
      border-radius: 20px;
      background-image: url("data:image/svg+xml,%3Csvg width='80' height='80' viewBox='0 0 80 80' xmlns='http://www.w3.org/2000/svg'%3E%3Cdefs%3E%3ClinearGradient id='chainGrad' x1='0%25' y1='0%25' x2='100%25' y2='100%25'%3E%3Cstop offset='0%25' stop-color='%23f9e6b9'/%3E%3Cstop offset='50%25' stop-color='%23d4af37'/%3E%3Cstop offset='100%25' stop-color='%23a96d17'/%3E%3C/linearGradient%3E%3Cfilter id='chainShadow'%3E%3CfeGaussianBlur in='SourceAlpha' stdDeviation='1.5'/%3E%3CfeOffset dx='2' dy='2' result='offsetblur'/%3E%3CfeComponentTransfer%3E%3CfeFuncA type='linear' slope='0.4'/%3E%3C/feComponentTransfer%3E%3CfeMerge%3E%3CfeMergeNode/%3E%3CfeMergeNode in='SourceGraphic'/%3E%3C/feMerge%3E%3C/filter%3E%3C/defs%3E%3Cg filter='url(%23chainShadow)'%3E%3Cpath d='M 20 10 Q 20 0 30 0 Q 40 0 40 10 L 40 30 Q 40 40 30 40 Q 20 40 20 30 Z' fill='url(%23chainGrad)' stroke='%23a96d17' stroke-width='1.5'/%3E%3Cpath d='M 40 10 Q 40 0 50 0 Q 60 0 60 10 L 60 30 Q 60 40 50 40 Q 40 40 40 30 Z' fill='url(%23chainGrad)' stroke='%23a96d17' stroke-width='1.5'/%3E%3Cpath d='M 20 40 Q 20 50 30 50 Q 40 50 40 40 L 40 60 Q 40 70 30 70 Q 20 70 20 60 Z' fill='url(%23chainGrad)' stroke='%23a96d17' stroke-width='1.5'/%3E%3Cpath d='M 40 40 Q 40 50 50 50 Q 60 50 60 40 L 60 60 Q 60 70 50 70 Q 40 70 40 60 Z' fill='url(%23chainGrad)' stroke='%23a96d17' stroke-width='1.5'/%3E%3Cpath d='M 0 30 Q 0 20 10 20 Q 20 20 20 30 L 20 50 Q 20 60 10 60 Q 0 60 0 50 Z' fill='url(%23chainGrad)' stroke='%23a96d17' stroke-width='1.5'/%3E%3Cpath d='M 60 30 Q 60 20 70 20 Q 80 20 80 30 L 80 50 Q 80 60 70 60 Q 60 60 60 50 Z' fill='url(%23chainGrad)' stroke='%23a96d17' stroke-width='1.5'/%3E%3C/g%3E%3C/svg%3E");
      background-size: 80px 80px;
      background-repeat: repeat;
      opacity: 0.9;
      z-index: -2;
    }

    body.theme-kurapika .rounded-lg.border::after,
    body.theme-kurapika .bg-black\/30::after {
      content: '';
      position: absolute;
      inset: 8px;
      border-radius: 12px;
      border: 2px dashed rgba(193, 149, 60, 0.5);
      box-shadow: inset 0 0 18px rgba(255, 255, 255, 0.25);
      z-index: -1;
    }

    /* –ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –ö—É—Ä–∞–ø–∏–∫–∏ - –≤–Ω–∏–∑—É —Å–ø—Ä–∞–≤–∞ */
    body.theme-kurapika #profile-section {
      position: relative;
      min-height: 400px;
    }

    body.theme-kurapika #kurapika-image {
      display: block !important;
      position: absolute !important;
      bottom: 0 !important;
      right: 0 !important;
      width: min(32vw, 280px) !important;
      aspect-ratio: 3 / 4 !important;
      padding: 18px !important;
      z-index: 0 !important;
      pointer-events: none !important;
      border-radius: 18px !important;
      background: radial-gradient(circle at 30% 20%, rgba(255, 255, 255, 0.35), transparent 55%), linear-gradient(135deg, rgba(54, 37, 19, 0.4), rgba(0, 0, 0, 0.2));
      border: 2px solid rgba(212, 175, 55, 0.85) !important;
      box-shadow: 0 20px 40px rgba(34, 21, 10, 0.45);
    }

    body.theme-kurapika #kurapika-image::before {
      content: '';
      position: absolute;
      inset: -16px;
      border-radius: 26px;
      background-image: url("data:image/svg+xml,%3Csvg width='100' height='100' viewBox='0 0 100 100' xmlns='http://www.w3.org/2000/svg'%3E%3Cdefs%3E%3ClinearGradient id='chainGrad3' x1='0%25' y1='0%25' x2='100%25' y2='100%25'%3E%3Cstop offset='0%25' stop-color='%23f9e6b9'/%3E%3Cstop offset='50%25' stop-color='%23d4af37'/%3E%3Cstop offset='100%25' stop-color='%23a96d17'/%3E%3C/linearGradient%3E%3Cfilter id='chainShadow3'%3E%3CfeGaussianBlur in='SourceAlpha' stdDeviation='2'/%3E%3CfeOffset dx='2.5' dy='2.5' result='offsetblur'/%3E%3CfeComponentTransfer%3E%3CfeFuncA type='linear' slope='0.45'/%3E%3C/feComponentTransfer%3E%3CfeMerge%3E%3CfeMergeNode/%3E%3CfeMergeNode in='SourceGraphic'/%3E%3C/feMerge%3E%3C/filter%3E%3C/defs%3E%3Cg filter='url(%23chainShadow3)'%3E%3Cpath d='M 25 12 Q 25 0 37.5 0 Q 50 0 50 12 L 50 37 Q 50 50 37.5 50 Q 25 50 25 37 Z' fill='url(%23chainGrad3)' stroke='%23a96d17' stroke-width='2'/%3E%3Cpath d='M 50 12 Q 50 0 62.5 0 Q 75 0 75 12 L 75 37 Q 75 50 62.5 50 Q 50 50 50 37 Z' fill='url(%23chainGrad3)' stroke='%23a96d17' stroke-width='2'/%3E%3Cpath d='M 25 50 Q 25 62 37.5 62 Q 50 62 50 50 L 50 75 Q 50 87 37.5 87 Q 25 87 25 75 Z' fill='url(%23chainGrad3)' stroke='%23a96d17' stroke-width='2'/%3E%3Cpath d='M 50 50 Q 50 62 62.5 62 Q 75 62 75 50 L 75 75 Q 75 87 62.5 87 Q 50 87 50 75 Z' fill='url(%23chainGrad3)' stroke='%23a96d17' stroke-width='2'/%3E%3Cpath d='M 0 37 Q 0 25 12.5 25 Q 25 25 25 37 L 25 62 Q 25 75 12.5 75 Q 0 75 0 62 Z' fill='url(%23chainGrad3)' stroke='%23a96d17' stroke-width='2'/%3E%3Cpath d='M 75 37 Q 75 25 87.5 25 Q 100 25 100 37 L 100 62 Q 100 75 87.5 75 Q 75 75 75 62 Z' fill='url(%23chainGrad3)' stroke='%23a96d17' stroke-width='2'/%3E%3C/g%3E%3C/svg%3E");
      background-size: 100px 100px;
      background-repeat: repeat;
      opacity: 0.95;
      filter: drop-shadow(0 8px 16px rgba(0, 0, 0, 0.5));
      z-index: -1;
    }

    body.theme-kurapika #kurapika-image::after {
      content: '';
      position: absolute;
      inset: 0;
      border-radius: 18px;
      background-image:
        repeating-linear-gradient(45deg, transparent 0 16px, rgba(255, 255, 255, 0.08) 16px 20px),
        repeating-linear-gradient(-45deg, transparent 0 18px, rgba(0, 0, 0, 0.15) 18px 21px);
      mix-blend-mode: screen;
      opacity: 0.5;
      pointer-events: none;
    }

    body.theme-kurapika #kurapika-image svg {
      width: 100% !important;
      height: 100% !important;
      display: block !important;
      filter: drop-shadow(0 12px 18px rgba(0, 0, 0, 0.35));
    }

    @media (max-width: 640px) {
      body.theme-kurapika #kurapika-image { 
        width: min(45vw, 200px) !important;
        padding: 12px !important;
      }
    }

    /* –ó–∞–≥–æ–ª–æ–≤–∫–∏ */
    body.theme-kurapika h2 {
      color: var(--kurapika-text) !important;
      font-size: 1.75rem !important;
      font-weight: bold !important;
      text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.1) !important;
    }

    /* –ü–∞–Ω–µ–ª—å –ø—Ä–æ—Ñ–∏–ª—è */
    body.theme-kurapika #profile-section .rounded-lg.border.border-violet-400\/30:first-of-type {
      background: linear-gradient(135deg, #f4e4bc 0%, #e8d5b7 100%) !important;
      border: 3px solid var(--kurapika-brown-dark) !important;
      padding: 20px !important;
    }

    /* –ê–≤–∞—Ç–∞—Ä - —Å—Ç–∏–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–π –ø–æ—Ä—Ç—Ä–µ—Ç –ö—É—Ä–∞–ø–∏–∫–∏ */
    body.theme-kurapika .theme-avatar {
      background: linear-gradient(135deg, #d4af37 0%, #f4e4bc 50%, #d4af37 100%) !important;
      border: 3px solid var(--kurapika-gold-dark) !important;
      border-radius: 50% !important;
      width: 64px !important;
      height: 64px !important;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2) !important;
      position: relative;
      overflow: hidden;
    }

    body.theme-kurapika .theme-avatar::before {
      content: '';
      position: absolute;
      inset: -2px;
      border-radius: 50%;
      background: repeating-conic-gradient(from 0deg, var(--kurapika-gold) 0deg 10deg, transparent 10deg 20deg);
      z-index: -1;
      opacity: 0.3;
    }

    /* –¢–µ–∫—Å—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è */
    body.theme-kurapika #profile-username {
      color: var(--kurapika-text) !important;
      font-size: 1.5rem !important;
      font-weight: bold !important;
    }

    body.theme-kurapika #profile-id,
    body.theme-kurapika #profile-first-login,
    body.theme-kurapika #profile-status,
    body.theme-kurapika .text-gray-400 {
      color: var(--kurapika-brown-dark) !important;
    }

    /* –í—Ç–æ—Ä–∞—è –ø–∞–Ω–µ–ª—å */
    body.theme-kurapika #profile-section .rounded-lg.border.border-violet-400\/30:nth-of-type(2) {
      background: linear-gradient(135deg, #f4e4bc 0%, #e8d5b7 100%) !important;
      border: 3px solid var(--kurapika-brown-dark) !important;
      padding: 20px !important;
    }

    /* –ë–µ–π–¥–∂ —É—Ä–æ–≤–Ω—è - –∑–æ–ª–æ—Ç–∞—è –∫–Ω–æ–ø–∫–∞ */
    body.theme-kurapika #level-badge {
      background: linear-gradient(135deg, #d4af37 0%, #f4e4bc 50%, #d4af37 100%) !important;
      color: var(--kurapika-text) !important;
      border: 2px solid var(--kurapika-gold-dark) !important;
      border-radius: 8px !important;
      padding: 10px 20px !important;
      font-weight: bold !important;
      font-size: 0.95rem !important;
      box-shadow: 
        0 2px 4px rgba(0, 0, 0, 0.2),
        inset 0 1px 0 rgba(255, 255, 255, 0.3) !important;
      display: inline-flex !important;
      align-items: center !important;
      gap: 8px !important;
    }

    /* –ó–≤–µ–∑–¥–æ—á–∫–∞ —Ä—è–¥–æ–º —Å —É—Ä–æ–≤–Ω–µ–º */
    body.theme-kurapika #level-badge::after {
      content: '‚≠ê';
      font-size: 0.9rem;
    }

    /* –û–ø—ã—Ç */
    body.theme-kurapika #current-experience {
      color: var(--kurapika-brown-dark) !important;
      font-weight: bold !important;
    }

    /* –ü—Ä–æ–≥—Ä–µ—Å—Å-–±–∞—Ä */
    body.theme-kurapika #progress-bar-container {
      background: rgba(139, 111, 71, 0.2) !important;
      border: 2px solid var(--kurapika-brown-dark) !important;
      border-radius: 8px !important;
    }

    body.theme-kurapika #experience-progress-bar {
      background: linear-gradient(90deg, #d4af37 0%, #f4e4bc 50%, #d4af37 100%) !important;
      background-size: 200% 100% !important;
      animation: kurapika-progress-flow 2s linear infinite !important;
    }

    @keyframes kurapika-progress-flow {
      0% { background-position: 0% 50%; }
      100% { background-position: 200% 50%; }
    }

    /* –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ - –¥–≤–µ –ø–∞–Ω–µ–ª–∏ */
    body.theme-kurapika #profile-section .grid.grid-cols-2 > div {
      background: linear-gradient(135deg, #f4e4bc 0%, #e8d5b7 100%) !important;
      border: 3px solid var(--kurapika-brown-dark) !important;
      border-radius: 12px !important;
      padding: 16px !important;
      box-shadow: 
        inset 0 0 10px rgba(139, 111, 71, 0.1),
        0 2px 4px rgba(0, 0, 0, 0.15) !important;
      text-align: center !important;
      position: relative;
    }

    body.theme-kurapika #profile-section .grid.grid-cols-2 > div::before {
      content: '';
      position: absolute;
      top: -8px;
      left: -8px;
      right: -8px;
      bottom: -8px;
      border-radius: 16px;
      background-image: url("data:image/svg+xml,%3Csvg width='60' height='60' viewBox='0 0 60 60' xmlns='http://www.w3.org/2000/svg'%3E%3Cdefs%3E%3ClinearGradient id='chainGrad2' x1='0%25' y1='0%25' x2='100%25' y2='100%25'%3E%3Cstop offset='0%25' stop-color='%23f9e6b9'/%3E%3Cstop offset='50%25' stop-color='%23d4af37'/%3E%3Cstop offset='100%25' stop-color='%23a96d17'/%3E%3C/linearGradient%3E%3Cfilter id='chainShadow2'%3E%3CfeGaussianBlur in='SourceAlpha' stdDeviation='1'/%3E%3CfeOffset dx='1.5' dy='1.5' result='offsetblur'/%3E%3CfeComponentTransfer%3E%3CfeFuncA type='linear' slope='0.35'/%3E%3C/feComponentTransfer%3E%3CfeMerge%3E%3CfeMergeNode/%3E%3CfeMergeNode in='SourceGraphic'/%3E%3C/feMerge%3E%3C/filter%3E%3C/defs%3E%3Cg filter='url(%23chainShadow2)'%3E%3Cpath d='M 15 8 Q 15 0 22.5 0 Q 30 0 30 8 L 30 22 Q 30 30 22.5 30 Q 15 30 15 22 Z' fill='url(%23chainGrad2)' stroke='%23a96d17' stroke-width='1.2'/%3E%3Cpath d='M 30 8 Q 30 0 37.5 0 Q 45 0 45 8 L 45 22 Q 45 30 37.5 30 Q 30 30 30 22 Z' fill='url(%23chainGrad2)' stroke='%23a96d17' stroke-width='1.2'/%3E%3Cpath d='M 15 30 Q 15 38 22.5 38 Q 30 38 30 30 L 30 45 Q 30 53 22.5 53 Q 15 53 15 45 Z' fill='url(%23chainGrad2)' stroke='%23a96d17' stroke-width='1.2'/%3E%3Cpath d='M 30 30 Q 30 38 37.5 38 Q 45 38 45 30 L 45 45 Q 45 53 37.5 53 Q 30 53 30 45 Z' fill='url(%23chainGrad2)' stroke='%23a96d17' stroke-width='1.2'/%3E%3Cpath d='M 0 22 Q 0 14 7.5 14 Q 15 14 15 22 L 15 37 Q 15 45 7.5 45 Q 0 45 0 37 Z' fill='url(%23chainGrad2)' stroke='%23a96d17' stroke-width='1.2'/%3E%3Cpath d='M 45 22 Q 45 14 52.5 14 Q 60 14 60 22 L 60 37 Q 60 45 52.5 45 Q 45 45 45 37 Z' fill='url(%23chainGrad2)' stroke='%23a96d17' stroke-width='1.2'/%3E%3C/g%3E%3C/svg%3E");
      background-size: 60px 60px;
      background-repeat: repeat;
      opacity: 0.85;
      z-index: -1;
      mask: linear-gradient(#000 0 0) content-box, linear-gradient(#000 0 0);
      -webkit-mask-composite: xor;
      mask-composite: exclude;
      padding: 8px;
    }

    body.theme-kurapika #profile-section .grid.grid-cols-2 .text-2xl {
      color: var(--kurapika-text) !important;
      font-size: 2rem !important;
      font-weight: bold !important;
    }

    body.theme-kurapika #profile-section .grid.grid-cols-2 .text-xs {
      color: var(--kurapika-brown-dark) !important;
      font-size: 0.9rem !important;
    }

    /* –ö–Ω–æ–ø–∫–∏ */
    body.theme-kurapika .nav-button {
      background: linear-gradient(135deg, #d4af37 0%, #f4e4bc 50%, #d4af37 100%) !important;
      color: var(--kurapika-text) !important;
      border: 2px solid var(--kurapika-gold-dark) !important;
      border-radius: 8px !important;
      font-weight: bold !important;
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2) !important;
      transition: all 0.2s !important;
    }

    body.theme-kurapika .nav-button:hover,
    body.theme-kurapika .nav-button.active {
      background: linear-gradient(135deg, #f4e4bc 0%, #d4af37 50%, #f4e4bc 100%) !important;
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3) !important;
      transform: translateY(-1px);
    }

    body.theme-kurapika .neon-button,
    body.theme-kurapika #change-theme-btn,
    body.theme-kurapika #contact-owner-btn {
      background: linear-gradient(135deg, #d4af37 0%, #f4e4bc 50%, #d4af37 100%) !important;
      color: var(--kurapika-text) !important;
      border: 2px solid var(--kurapika-gold-dark) !important;
      border-radius: 8px !important;
      font-weight: bold !important;
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2) !important;
      padding: 12px 20px !important;
    }

    body.theme-kurapika .neon-button:hover,
    body.theme-kurapika #change-theme-btn:hover,
    body.theme-kurapika #contact-owner-btn:hover {
      background: linear-gradient(135deg, #f4e4bc 0%, #d4af37 50%, #f4e4bc 100%) !important;
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3) !important;
      transform: translateY(-1px);
    }

    /* –¢–µ–∫—Å—Ç */
    body.theme-kurapika .text-white {
      color: var(--kurapika-text) !important;
    }

    body.theme-kurapika .text-gray-300 {
      color: var(--kurapika-brown-dark) !important;
    }

    body.theme-kurapika .text-violet-400,
    body.theme-kurapika .text-pink-400,
    body.theme-kurapika .text-blue-400,
    body.theme-kurapika .text-green-400 {
      color: var(--kurapika-brown-dark) !important;
    }

    /* –†–∞–∑–¥–µ–ª–∏—Ç–µ–ª–∏ */
    body.theme-kurapika .border-violet-400\/30,
    body.theme-kurapika .border-violet-400\/20 {
      border-color: var(--kurapika-brown-dark) !important;
    }

    body.theme-kurapika .border-t {
      border-top-color: var(--kurapika-brown-dark) !important;
    }

    /* –ú–æ–¥–∞–ª—å–Ω—ã–µ –æ–∫–Ω–∞ */
    body.theme-kurapika #theme-selector-modal,
    body.theme-kurapika #contact-owner-modal,
    body.theme-kurapika #subscription-modal {
      background: rgba(0, 0, 0, 0.6) !important;
    }

    body.theme-kurapika #theme-selector-modal > div,
    body.theme-kurapika #contact-owner-modal > div {
      background: linear-gradient(135deg, #f4e4bc 0%, #e8d5b7 100%) !important;
      border: 3px solid var(--kurapika-brown-dark) !important;
      color: var(--kurapika-text) !important;
    }

    body.theme-kurapika .input-field {
      background: rgba(244, 228, 188, 0.9) !important;
      border: 2px solid var(--kurapika-brown-dark) !important;
      color: var(--kurapika-text) !important;
    }

    body.theme-kurapika .input-field:focus {
      border-color: var(--kurapika-gold-dark) !important;
      box-shadow: 0 0 8px rgba(212, 175, 55, 0.4) !important;
    }

    .page-dark { background-color: var(--neon-bg); color: var(--text-primary); }

    @keyframes neonFlow {
      0% { background-position: 0% 50%; }
      50% { background-position: 100% 50%; }
      100% { background-position: 0% 50%; }
    }

    /* Liquid flow animations */
    @keyframes liquidHorizontal {
      0%   { background-position: 0% center, 100% center, 50% center; }
      50%  { background-position: 100% center, 0% center, 0% center; }
      100% { background-position: 0% center, 100% center, 50% center; }
    }

    /* Text-flow like gradient for side bars */
    @keyframes sideflow {
      from { background-position: center 0%; }
      to { background-position: center 200%; }
    }
    @keyframes sideflowReverse {
      from { background-position: center 200%; }
      to { background-position: center 0%; }
    }

    /* ‚ú® Neon side stripes */
    .neon-sides::before,
    .neon-sides::after {
      content: "";
      position: fixed;
      top: 3vh;
      bottom: 96px;
      width: 4px;
      border-radius: 9999px;
      background: linear-gradient(180deg,
        var(--neon-purple-1) 0%,
        var(--neon-purple-1) 25%,
        var(--neon-pink) 55%,
        var(--neon-white) 85%,
        var(--neon-purple-1) 100%
      );
      background-size: 100% 250%;
      box-shadow:
        0 0 12px rgba(167, 139, 250, 0.6),
        0 0 28px rgba(139, 92, 246, 0.45),
        inset 0 0 16px rgba(167, 139, 250, 0.35);
      z-index: 5;
      pointer-events: none;
    }

    .neon-sides::before { left: 10px; animation: sideflow 5s linear infinite; }
    .neon-sides::after { right: 10px; animation: sideflowReverse 5s linear infinite; }

    /* üîª Bottom neon shimmer bar */
    .neon-bottom {
      position: fixed;
      left: 0;
      right: 0;
      bottom: 0;
      height: 86px;
      display: flex;
      align-items: center;
      justify-content: center;
      background:
        radial-gradient(60% 140% at 50% 100%, rgba(139, 92, 246, 0.16), rgba(0, 0, 0, 0) 60%),
        radial-gradient(25% 100% at 0% 100%, rgba(236, 72, 153, 0.18), transparent 70%),
        radial-gradient(25% 100% at 100% 100%, rgba(255, 255, 255, 0.08), transparent 70%);
      z-index: 4;
      pointer-events: none;
    }

    .neon-bottom::before {
      content: "";
      position: absolute;
      bottom: 24px;
      left: 50%;
      transform: translateX(-50%);
      width: min(560px, 92vw);
      height: 13px;
      border-radius: 9999px;
      background:
        repeating-linear-gradient(to right,
          rgba(255,255,255,0.85) 0 18px,
          transparent 18px 34px
        ),
        repeating-linear-gradient(to right,
          rgba(236,72,153,0.6) 0 14px,
          transparent 14px 30px
        ),
        repeating-linear-gradient(to right,
          rgba(139,92,246,0.6) 0 16px,
          transparent 16px 32px
        );
      background-blend-mode: screen;
      animation: liquidHorizontal 9s linear infinite;
      box-shadow:
        0 0 22px rgba(167, 139, 250, 0.75),
        0 0 44px rgba(139, 92, 246, 0.65),
        inset 0 0 10px rgba(167, 139, 250, 0.55);
    }

    .neon-bottom::after {
      content: "";
      position: absolute;
      bottom: 24px;
      left: 10px;
      right: 10px;
      height: 18px;
      border-bottom-left-radius: 9999px;
      border-bottom-right-radius: 9999px;
      background: linear-gradient(90deg, transparent, rgba(167,139,250,0.25), rgba(236,72,153,0.25), rgba(255,255,255,0.18), rgba(167,139,250,0.25), transparent);
      filter: blur(8px);
      pointer-events: none;
    }

    /* üß≠ Neon nav */
    .neon-nav {
      background: rgba(10, 10, 16, 0.85) !important;
      backdrop-filter: blur(6px);
      border-bottom: 1px solid rgba(167, 139, 250, 0.25);
      box-shadow: 0 0 24px rgba(139, 92, 246, 0.25);
      pointer-events: auto !important;
      z-index: 1000 !important;
    }

    .nav-button {
      color: var(--text-primary);
      padding: 0.35rem 0.5rem;
      border-radius: 0.5rem;
      transition: transform .15s ease, box-shadow .2s ease;
      box-shadow: inset 0 0 0 1px rgba(167, 139, 250, 0.35);
      font-size: 0.875rem;
      cursor: pointer !important;
      pointer-events: auto !important;
      position: relative !important;
      z-index: 1001 !important;
      touch-action: manipulation;
      -webkit-tap-highlight-color: transparent;
    }

    .nav-button.active,
    .nav-button:hover {
      box-shadow:
        0 0 12px rgba(167, 139, 250, 0.55),
        inset 0 0 0 1px rgba(167, 139, 250, 0.65);
      transform: translateY(-1px);
    }

    /* üîò Neon buttons */
    .neon-button {
      position: relative;
      background: #0b0b0f !important;
      color: #ffffff !important;
      border: 1px solid rgba(167, 139, 250, 0.45) !important;
      box-shadow:
        0 0 16px rgba(139, 92, 246, 0.35),
        inset 0 0 18px rgba(139, 92, 246, 0.2);
      transition: transform .15s ease, box-shadow .2s ease, border-color .2s ease;
      overflow: hidden;
    }

    .neon-button::before {
      content: "";
      position: absolute;
      inset: -1px;
      border-radius: inherit;
      background: linear-gradient(120deg, transparent 0%, rgba(167, 139, 250, 0.35) 40%, rgba(167, 139, 250, 0.6) 50%, rgba(167, 139, 250, 0.35) 60%, transparent 100%);
      background-size: 300% 100%;
      animation: neonFlow 6s linear infinite;
      z-index: 0;
      pointer-events: none;
      mask: linear-gradient(#000 0 0) content-box, linear-gradient(#000 0 0);
      -webkit-mask-composite: xor;
              mask-composite: exclude;
      padding: 1px;
    }

    .neon-button > * { position: relative; z-index: 1; }

    .neon-button:hover {
      box-shadow:
        0 0 22px rgba(139, 92, 246, 0.55),
        inset 0 0 24px rgba(139, 92, 246, 0.28);
      transform: translateY(-1px);
      border-color: rgba(167, 139, 250, 0.75) !important;
    }

    .neon-button:active { transform: translateY(0); }

    /* Prevent text selection on buttons */
    .neon-button,
    .nav-button,
    button {
      user-select: none;
      -webkit-user-select: none;
      -moz-user-select: none;
      -ms-user-select: none;
      -webkit-touch-callout: none;
    }

    /* ‚ú® Shimmer animation for experience bar */
    @keyframes shimmer {
      0% { transform: translateX(-100%); }
      100% { transform: translateX(100%); }
    }

    .animate-shimmer {
      animation: shimmer 2s infinite;
    }

    /* üéØ Level badge glow */
    #level-badge {
      background: linear-gradient(135deg,
        #000000 0%,
        #4c1d95 25%,
        #7c3aed 50%,
        #ec4899 75%,
        #dc2626 100%
      );
      background-size: 200% 200%;
      color: #ffffff;
      border: 1px solid rgba(167, 139, 250, 0.5);
      box-shadow:
        0 0 15px rgba(124, 58, 237, 0.6),
        0 0 30px rgba(236, 72, 153, 0.4),
        inset 0 0 10px rgba(0, 0, 0, 0.5);
      animation: level-badge-flow 3s ease-in-out infinite, level-badge-pulse 2s ease-in-out infinite;
      text-shadow: 0 0 10px rgba(167, 139, 250, 0.8);
    }

    @keyframes level-badge-flow {
      0% {
        background-position: 0% 50%;
      }
      50% {
        background-position: 100% 50%;
      }
      100% {
        background-position: 0% 50%;
      }
    }

    @keyframes level-badge-pulse {
      0%, 100% {
      box-shadow:
        0 0 15px rgba(124, 58, 237, 0.6),
        0 0 30px rgba(236, 72, 153, 0.4),
        inset 0 0 10px rgba(0, 0, 0, 0.5);
      }
      50% {
      box-shadow:
        0 0 25px rgba(124, 58, 237, 0.9),
        0 0 50px rgba(236, 72, 153, 0.7),
        0 0 20px rgba(220, 38, 38, 0.5),
        inset 0 0 15px rgba(0, 0, 0, 0.7);
      }
    }

    /* üìù Inputs */
    .input-field {
      background: #0f0f16 !important;
      border: 1px solid rgba(148, 163, 184, 0.15);
      color: var(--text-primary) !important;
      box-shadow: inset 0 0 0 1px rgba(167, 139, 250, 0.15);
      transition: box-shadow .2s ease, border-color .2s ease;
    }

    .input-field:focus {
      outline: none;
      border-color: rgba(167, 139, 250, 0.55);
      box-shadow:
        0 0 0 3px rgba(167, 139, 250, 0.25),
        inset 0 0 0 1px rgba(167, 139, 250, 0.55);
    }

    /* –°–∫—Ä—ã—Ç–∏–µ —Å–ø–∏–Ω–Ω–µ—Ä–∞ –∑–∞–≥—Ä—É–∑–∫–∏ */
    .loading-spinner.hidden {
      display: none !important;
      visibility: hidden !important;
      opacity: 0 !important;
      z-index: -9999 !important;
      pointer-events: none !important;
    }

    /* üì± –°—Ç–∏–ª–∏ –¥–ª—è –º–æ–¥–∞–ª—å–Ω—ã—Ö –æ–∫–æ–Ω –Ω–∞ –º–æ–±–∏–ª—å–Ω—ã—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞—Ö */
    #contact-owner-modal,
    #subscription-modal {
      /* –û–±–µ—Å–ø–µ—á–∏–≤–∞–µ–º —Å–∫—Ä–æ–ª–ª –¥–∞–∂–µ –ø—Ä–∏ –æ—Ç–∫—Ä—ã—Ç–æ–π –∫–ª–∞–≤–∏–∞—Ç—É—Ä–µ */
      -webkit-overflow-scrolling: touch;
      overscroll-behavior: contain;
      /* –ó–∞–ø—Ä–µ—â–∞–µ–º –≥–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω—ã–π —Å–∫—Ä–æ–ª–ª */
      overflow-x: hidden !important;
      overflow-y: auto !important;
      /* –†–∞–∑—Ä–µ—à–∞–µ–º –∫–ª–∏–∫–∏ –∏ –∂–µ—Å—Ç—ã */
      pointer-events: auto !important;
      touch-action: pan-y pinch-zoom;
      /* –§–∏–∫—Å–∏—Ä—É–µ–º —à–∏—Ä–∏–Ω—É –∏ –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ–º –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ */
      max-width: 100vw;
      width: 100%;
      z-index: 30 !important;
    }

    #contact-owner-modal > div,
    #subscription-modal > div {
      /* –ü–æ–∑–≤–æ–ª—è–µ–º —Å–∫—Ä–æ–ª–ª–∏—Ç—å —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ –≤–Ω—É—Ç—Ä–∏ –º–æ–¥–∞–ª–∫–∏ —Ç–æ–ª—å–∫–æ –≤–µ—Ä—Ç–∏–∫–∞–ª—å–Ω–æ */
      overscroll-behavior: contain;
      overflow-x: hidden !important;
      overflow-y: auto !important;
      /* –†–∞–∑—Ä–µ—à–∞–µ–º –∫–ª–∏–∫–∏ */
      pointer-events: auto !important;
      touch-action: pan-y pinch-zoom;
      /* –§–∏–∫—Å–∏—Ä—É–µ–º –º–∞–∫—Å–∏–º–∞–ª—å–Ω—É—é —à–∏—Ä–∏–Ω—É */
      max-width: 100%;
      width: 100%;
      position: relative;
      z-index: 1;
    }

    /* –£–±–µ–∂–¥–∞–µ–º—Å—è, —á—Ç–æ –≤—Å–µ –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã–µ —ç–ª–µ–º–µ–Ω—Ç—ã –≤–Ω—É—Ç—Ä–∏ –º–æ–¥–∞–ª–æ–∫ –∫–ª–∏–∫–∞–±–µ–ª—å–Ω—ã */
    #contact-owner-modal button,
    #contact-owner-modal input,
    #contact-owner-modal textarea,
    #contact-owner-modal select,
    #subscription-modal button,
    #subscription-modal input,
    #subscription-modal textarea {
      pointer-events: auto !important;
      cursor: pointer;
      position: relative;
      z-index: 10;
    }

    /* –ó–∞–ø—Ä–µ—Ç zoom –¥–ª—è –≤—Å–µ–≥–æ body –ø—Ä–∏ –æ—Ç–∫—Ä—ã—Ç—ã—Ö –º–æ–¥–∞–ª–∫–∞—Ö */
    body.modal-open {
      overflow: hidden;
      overflow-x: hidden !important;
      touch-action: pan-y;
      position: fixed;
      width: 100%;
      height: 100%;
      max-width: 100vw;
    }

    /* üñºÔ∏è Drag and Drop —Å—Ç–∏–ª–∏ –¥–ª—è NFT –∫–æ–ª–ª–µ–∫—Ü–∏–π */
    #collection-grid > div {
      transition: all 0.2s ease;
    }

    #collection-grid > div:hover {
      transform: scale(1.05);
      border-color: rgba(167, 139, 250, 0.6);
      box-shadow: 0 0 15px rgba(124, 58, 237, 0.5);
    }

    #collection-grid > div.dragging {
      opacity: 0.5;
      transform: scale(0.95);
      cursor: grabbing;
    }

    #collection-grid > div.drag-over {
      border-color: rgba(236, 72, 153, 0.8);
      background-color: rgba(236, 72, 153, 0.1);
      transform: scale(1.1);
      box-shadow: 0 0 20px rgba(236, 72, 153, 0.7);
    }

    /* –ê–Ω–∏–º–∞—Ü–∏—è –¥–ª—è NFT –≤ —Å–µ—Ç–∫–µ */
    #collection-grid > div img {
      transition: transform 0.3s ease;
    }

    #collection-grid > div:hover img {
      transform: scale(1.1);
    }

    /* –£–ª—É—á—à–µ–Ω–Ω–∞—è –≤–∏–¥–∏–º–æ—Å—Ç—å –ø—Ä–∏ –ø–µ—Ä–µ—Ç–∞—Å–∫–∏–≤–∞–Ω–∏–∏ */
    #collection-grid > div[draggable="true"] {
      cursor: grab;
    }

    #collection-grid > div[draggable="true"]:active {
      cursor: grabbing;
    }

    /* –ó–∞–ø—Ä–µ—Ç –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è –∏ –∫–æ–Ω—Ç–µ–∫—Å—Ç–Ω–æ–≥–æ –º–µ–Ω—é –¥–ª—è NFT */
    #collection-grid > div,
    #collection-grid > div img,
    #collection-grid > div video {
      -webkit-user-select: none;
      -moz-user-select: none;
      -ms-user-select: none;
      user-select: none;
      -webkit-touch-callout: none;
      -webkit-tap-highlight-color: transparent;
      pointer-events: auto;
    }

    #collection-grid > div img,
    #collection-grid > div video {
      pointer-events: none; /* –ü—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ–º –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ —Å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ–º/–≤–∏–¥–µ–æ –Ω–∞–ø—Ä—è–º—É—é */
      -webkit-user-drag: none;
      -khtml-user-drag: none;
      -moz-user-drag: none;
      -o-user-drag: none;
      user-drag: none;
    }

    /* –ó–∞–ø—Ä–µ—Ç –∫–æ–Ω—Ç–µ–∫—Å—Ç–Ω–æ–≥–æ –º–µ–Ω—é */
    #collection-grid {
      -webkit-user-select: none;
      -moz-user-select: none;
      -ms-user-select: none;
      user-select: none;
    }

    /* –ó–∞–ø—Ä–µ—Ç –≥–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω–æ–π –ø—Ä–æ–∫—Ä—É—Ç–∫–∏ –≤ –º–æ–¥–∞–ª–∫–µ –∫–æ–ª–ª–µ–∫—Ü–∏–π */
    #collection-arrange-modal {
      overflow-x: hidden !important;
      overflow-y: auto;
      width: 100%;
      max-width: 100vw;
      position: fixed;
      left: 0;
      right: 0;
    }

    #collection-arrange-modal > div {
      overflow-x: hidden !important;
      overflow-y: auto;
      max-width: 100%;
      width: calc(100% - 2rem);
      box-sizing: border-box;
      margin: 0 auto;
    }

    #collection-grid {
      overflow-x: hidden !important;
      width: 100%;
      max-width: 100%;
      box-sizing: border-box;
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 0.75rem;
    }

    #collection-grid > div {
      max-width: 100%;
      box-sizing: border-box;
      width: 100%;
      aspect-ratio: 1;
      min-width: 0;
    }

    /* –£–±–µ–∂–¥–∞–µ–º—Å—è, —á—Ç–æ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –Ω–µ –≤—ã—Ö–æ–¥—è—Ç –∑–∞ –≥—Ä–∞–Ω–∏—Ü—ã */
    #collection-grid img,
    #collection-grid video {
      max-width: 100%;
      width: 100%;
      height: 100%;
      object-fit: cover;
      display: block;
    }

    /* –ó–∞–ø—Ä–µ—Ç –≥–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω–æ–π –ø—Ä–æ–∫—Ä—É—Ç–∫–∏ –¥–ª—è –≤—Å–µ—Ö —ç–ª–µ–º–µ–Ω—Ç–æ–≤ –≤–Ω—É—Ç—Ä–∏ –º–æ–¥–∞–ª–∫–∏ */
    #collection-arrange-modal * {
      max-width: 100%;
      box-sizing: border-box;
    }
  </style>
</head>
<body class="page-dark text-white min-h-screen flex flex-col neon-sides">

  <!-- üîÑ –ó–∞–≥—Ä—É–∑–∫–∞ -->
  <div id="loading-spinner" class="loading-spinner relative w-full h-screen flex flex-col items-center justify-center" style="background: #000; position: fixed; top: 0; left: 0; width: 100vw; height: 100vh; z-index: 9999; pointer-events: auto;">
    <div class="flex flex-col items-center">
      <div class="animate-spin rounded-full h-12 w-12 border-t-4 border-white mb-4"></div>
      <p class="text-white text-lg font-semibold">–ó–∞–≥—Ä—É–∑–∫–∞ –ø–∞–Ω–µ–ª–∏...</p>
    </div>
  </div>

  <!-- –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–π —Å–∫—Ä–∏–ø—Ç –¥–ª—è –Ω–µ–º–µ–¥–ª–µ–Ω–Ω–æ–≥–æ —Å–∫—Ä—ã—Ç–∏—è —Å–ø–∏–Ω–Ω–µ—Ä–∞ -->
  <script>
    (function() {
      // –°–∫—Ä—ã–≤–∞–µ–º —Å–ø–∏–Ω–Ω–µ—Ä —á–µ—Ä–µ–∑ 100ms –ø–æ—Å–ª–µ –∑–∞–≥—Ä—É–∑–∫–∏ DOM –≤ –ª—é–±–æ–º —Å–ª—É—á–∞–µ
      function forceHideSpinner() {
        var spinner = document.getElementById('loading-spinner');
        var nav = document.getElementById('user-nav');
        var main = document.querySelector('main');

        if (spinner) {
          spinner.style.display = 'none';
          spinner.style.visibility = 'hidden';
          spinner.style.opacity = '0';
          spinner.style.pointerEvents = 'none'; // –ö–†–ò–¢–ò–ß–ù–û: –æ—Ç–∫–ª—é—á–∞–µ–º pointer events
          spinner.style.zIndex = '-1'; // –£–±–∏—Ä–∞–µ–º –≤—ã—Å–æ–∫–∏–π z-index
          spinner.classList.add('hidden');
        }
        if (nav) {
          nav.style.display = 'flex';
          nav.style.pointerEvents = 'auto'; // –í–∫–ª—é—á–∞–µ–º –∫–ª–∏–∫–∏ –Ω–∞ –Ω–∞–≤–∏–≥–∞—Ü–∏—é
          nav.style.zIndex = '10';
          nav.classList.remove('hidden');
        }
        if (main) {
          main.style.display = 'block';
          main.style.pointerEvents = 'auto'; // –í–∫–ª—é—á–∞–µ–º –∫–ª–∏–∫–∏ –Ω–∞ –æ—Å–Ω–æ–≤–Ω–æ–π –∫–æ–Ω—Ç–µ–Ω—Ç
          main.classList.remove('hidden');
        }
      }

      if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', function() {
          setTimeout(forceHideSpinner, 100);
        });
      } else {
        setTimeout(forceHideSpinner, 100);
      }
    })();
  </script>

  <!-- üöÄ –ù–∞–≤–∏–≥–∞—Ü–∏—è -->
  <nav id="user-nav" class="neon-nav fixed left-0 right-0 z-10 flex justify-around items-center px-2 pb-2 pt-3 hidden" style="bottom: 18px;">
    <button class="nav-button active relative" data-section="contests-section">üèÜ –ö–æ–Ω–∫—É—Ä—Å—ã</button>
    <button class="nav-button relative" data-section="rating-section">‚≠ê –†–µ–π—Ç–∏–Ω–≥</button>
    <button class="nav-button relative" data-section="profile-section">üë§ –ü—Ä–æ—Ñ–∏–ª—å</button>
  </nav>

  <!-- üì¶ –û—Å–Ω–æ–≤–Ω–æ–µ —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ -->
  <main class="flex-1 p-6 space-y-6 pb-24 hidden">

    <!-- üèÜ –ö–æ–Ω–∫—É—Ä—Å—ã -->
    <section id="contests-section" class="content-section">
      <h2 class="text-xl font-bold mb-4">–ê–∫—Ç–∏–≤–Ω—ã–µ –∫–æ–Ω–∫—É—Ä—Å—ã</h2>
      <div id="contest-list" class="space-y-4 mb-6"></div>
    </section>

    <!-- ‚≠ê –†–µ–π—Ç–∏–Ω–≥ -->
    <section id="rating-section" class="content-section hidden relative">
      <div class="kitty-decoration absolute -top-2 -left-2 text-2xl opacity-10" style="animation: kitty-bounce 3s ease-in-out infinite;">üò∏</div>
      <h2 class="text-xl font-bold mb-4">–†–µ–π—Ç–∏–Ω–≥</h2>

      <!-- –ü–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª—å –º–µ–∂–¥—É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏ –∏ –∞–¥–º–∏–Ω–∞–º–∏ -->
      <div class="flex gap-2 mb-4">
        <button id="rating-users-btn" class="nav-button active px-4 py-2 rounded-lg" data-role="user">–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏</button>
        <button id="rating-admins-btn" class="nav-button px-4 py-2 rounded-lg" data-role="admin">–ê–¥–º–∏–Ω—ã</button>
      </div>

      <!-- –°–ø–∏—Å–æ–∫ —Ä–µ–π—Ç–∏–Ω–≥–∞ -->
      <div id="rating-list" class="space-y-2">
        <div class="text-center text-gray-400 py-8">–ó–∞–≥—Ä—É–∑–∫–∞ —Ä–µ–π—Ç–∏–Ω–≥–∞...</div>
      </div>
    </section>

    <!-- üë§ –ü—Ä–æ—Ñ–∏–ª—å -->
    <section id="profile-section" class="content-section hidden relative">
      <div class="kitty-decoration absolute top-0 right-0 text-4xl opacity-10" style="animation: kitty-float 2.5s ease-in-out infinite;">üòª</div>
      <!-- Attack Titan –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –¥–ª—è —Ç–µ–º—ã AoT -->
      <div id="aot-titan-image" class="hidden absolute top-0 left-0 right-0 -mt-8 mb-4 z-0 pointer-events-none" style="border: 3px solid #5c4a2f; border-radius: 8px; box-shadow: 0 4px 12px rgba(0,0,0,0.4); min-height: 200px; max-height: 300px; height: auto;">
        <img src="AoT.jpg" 
             alt="Attack Titan" 
             class="w-full h-auto opacity-95"
             style="filter: sepia(70%) contrast(1.5) brightness(0.75) saturate(0.6) hue-rotate(-10deg); object-fit: contain; display: block; max-height: 300px; width: 100%; height: auto;">
        <!-- –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–π —Å–ª–æ–π –¥–ª—è —ç—Ñ—Ñ–µ–∫—Ç–∞ —Å—Ç–∞—Ä–∏–Ω–Ω–æ–π –±—É–º–∞–≥–∏ -->
        <div class="absolute inset-0 pointer-events-none" style="background: repeating-linear-gradient(0deg, rgba(139,111,71,0.03) 0px, transparent 1px, transparent 2px), repeating-linear-gradient(90deg, rgba(139,111,71,0.03) 0px, transparent 1px, transparent 2px); mix-blend-mode: overlay;"></div>
      </div>
      <!-- Kurapika –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –¥–ª—è —Ç–µ–º—ã Kurapika -->
      <div id="kurapika-image" class="hidden absolute bottom-0 right-0 z-0 pointer-events-none" style="opacity: 0.98;">
        <svg viewBox="0 0 260 360" xmlns="http://www.w3.org/2000/svg" role="img" aria-label="Kurapika with chains">
          <defs>
            <linearGradient id="bgGradient" x1="0" y1="0" x2="1" y2="1">
              <stop offset="0%" stop-color="#fff8e3"/>
              <stop offset="45%" stop-color="#f0d4a2"/>
              <stop offset="100%" stop-color="#c28e3d"/>
            </linearGradient>
            <pattern id="paperGrain" width="6" height="6" patternUnits="userSpaceOnUse">
              <circle cx="2" cy="1" r="0.5" fill="#b89a6d" opacity="0.35"/>
              <circle cx="5" cy="4" r="0.4" fill="#7a5a2f" opacity="0.2"/>
            </pattern>
            <linearGradient id="hairGradient" x1="0" y1="0" x2="0" y2="1">
              <stop offset="0%" stop-color="#fff4c9"/>
              <stop offset="50%" stop-color="#f2d36d"/>
              <stop offset="100%" stop-color="#bb8a2a"/>
            </linearGradient>
            <linearGradient id="coatGradient" x1="0" y1="0" x2="1" y2="1">
              <stop offset="0%" stop-color="#1c2b6a"/>
              <stop offset="50%" stop-color="#142058"/>
              <stop offset="100%" stop-color="#050c2c"/>
            </linearGradient>
            <linearGradient id="trimGradient" x1="0" y1="0" x2="1" y2="1">
              <stop offset="0%" stop-color="#f8e7b5"/>
              <stop offset="100%" stop-color="#c5932e"/>
            </linearGradient>
            <linearGradient id="chainGradient" x1="0" y1="0" x2="1" y2="1">
              <stop offset="0%" stop-color="#fff2c9"/>
              <stop offset="50%" stop-color="#e6c15c"/>
              <stop offset="100%" stop-color="#a96d17"/>
            </linearGradient>
            <radialGradient id="irisScarlet" cx="0.5" cy="0.5" r="0.6">
              <stop offset="0%" stop-color="#ffefec"/>
              <stop offset="45%" stop-color="#e01818"/>
              <stop offset="100%" stop-color="#6b0303"/>
            </radialGradient>
            <filter id="softGlow" x="-20%" y="-20%" width="140%" height="140%">
              <feGaussianBlur stdDeviation="2.8" result="blur"/>
              <feMerge>
                <feMergeNode in="blur"/>
                <feMergeNode in="SourceGraphic"/>
              </feMerge>
            </filter>
          </defs>

          <rect width="260" height="360" fill="url(#bgGradient)"/>
          <rect width="260" height="360" fill="url(#paperGrain)" opacity="0.25"/>
          <circle cx="130" cy="170" r="120" fill="rgba(255,255,255,0.35)" filter="url(#softGlow)"/>

          <!-- –í–æ–ª–æ—Å—ã -->
          <path d="M45 120 C40 80 70 30 130 35 C190 40 212 90 205 130 C198 170 180 195 130 200 C80 205 53 165 45 120 Z" fill="url(#hairGradient)" stroke="#c08a23" stroke-width="3" stroke-linejoin="round"/>
          <path d="M60 100 C75 70 110 55 145 70 C165 80 185 110 170 150" fill="none" stroke="#fbe6a5" stroke-width="5" stroke-linecap="round" opacity="0.6"/>

          <!-- –õ–∏—Ü–æ -->
          <ellipse cx="132" cy="150" rx="55" ry="68" fill="#f8e0c4" stroke="#c29b7c" stroke-width="2"/>
          <ellipse cx="132" cy="224" rx="28" ry="36" fill="#f4d7b3" stroke="#c29b7c" stroke-width="1.5"/>

          <!-- –ì–ª–∞–∑–∞ -->
          <ellipse cx="110" cy="145" rx="12" ry="16" fill="#fff"/>
          <ellipse cx="154" cy="145" rx="12" ry="16" fill="#fff"/>
          <ellipse cx="110" cy="145" rx="8" ry="9" fill="url(#irisScarlet)"/>
          <ellipse cx="154" cy="145" rx="8" ry="9" fill="url(#irisScarlet)"/>
          <circle cx="108" cy="140" r="3" fill="#fff" opacity="0.8"/>
          <circle cx="152" cy="140" r="3" fill="#fff" opacity="0.8"/>
          <path d="M96 132 Q112 128 118 134" stroke="#704828" stroke-width="4" stroke-linecap="round"/>
          <path d="M146 134 Q158 128 168 133" stroke="#704828" stroke-width="4" stroke-linecap="round"/>

          <!-- –ù–æ—Å –∏ —Ä–æ—Ç -->
          <path d="M132 158 Q130 170 135 175" stroke="#a47550" stroke-width="3" stroke-linecap="round" fill="none"/>
          <path d="M118 188 Q132 194 146 188" stroke="#a47550" stroke-width="3" stroke-linecap="round"/>

          <!-- –û–¥–µ–∂–¥–∞ -->
          <path d="M70 235 Q130 250 190 235 L210 340 H50 Z" fill="url(#coatGradient)" stroke="#050c2c" stroke-width="2" />
          <path d="M80 245 L180 245 L175 330 L85 330 Z" fill="#0b1540" opacity="0.8"/>
          <path d="M90 242 L95 332" stroke="url(#trimGradient)" stroke-width="6" stroke-linecap="round"/>
          <path d="M170 242 L165 332" stroke="url(#trimGradient)" stroke-width="6" stroke-linecap="round"/>
          <path d="M70 235 Q130 220 190 235" fill="none" stroke="url(#trimGradient)" stroke-width="8" stroke-linecap="round"/>
          <path d="M76 260 H184" stroke="url(#trimGradient)" stroke-width="8" stroke-linecap="round"/>

          <!-- –†—É–∫–∏ -->
          <path d="M205 220 C230 230 228 252 210 266 L172 296 C162 304 150 297 152 285 L160 250 Z" fill="#f5dcc0" stroke="#c29b7c" stroke-width="2"/>
          <path d="M55 220 C30 230 32 252 50 266 L88 296 C98 304 110 297 108 285 L100 250 Z" fill="#f5dcc0" stroke="#c29b7c" stroke-width="2"/>
          <circle cx="205" cy="230" r="18" fill="#f5dcc0" stroke="#c29b7c" stroke-width="2"/>
          <circle cx="59" cy="230" r="18" fill="#f5dcc0" stroke="#c29b7c" stroke-width="2"/>

          <!-- –¶–µ–ø–∏ –≤–æ–∫—Ä—É–≥ - –Ω–∞—Å—Ç–æ—è—â–∏–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–Ω—ã–µ –∑–≤–µ–Ω—å—è -->
          <g filter="url(#softGlow)">
            <!-- –¶–µ–ø—å –≤–Ω–∏–∑—É -->
            <path d="M 25 310 Q 25 300 35 300 Q 45 300 45 310 L 45 330 Q 45 340 35 340 Q 25 340 25 330 Z" fill="url(#chainGradient)" stroke="#a96d17" stroke-width="1.5"/>
            <path d="M 45 310 Q 45 300 55 300 Q 65 300 65 310 L 65 330 Q 65 340 55 340 Q 45 340 45 330 Z" fill="url(#chainGradient)" stroke="#a96d17" stroke-width="1.5"/>
            <path d="M 65 310 Q 65 300 75 300 Q 85 300 85 310 L 85 330 Q 85 340 75 340 Q 65 340 65 330 Z" fill="url(#chainGradient)" stroke="#a96d17" stroke-width="1.5"/>
            <path d="M 85 310 Q 85 300 95 300 Q 105 300 105 310 L 105 330 Q 105 340 95 340 Q 85 340 85 330 Z" fill="url(#chainGradient)" stroke="#a96d17" stroke-width="1.5"/>
            <path d="M 105 310 Q 105 300 115 300 Q 125 300 125 310 L 125 330 Q 125 340 115 340 Q 105 340 105 330 Z" fill="url(#chainGradient)" stroke="#a96d17" stroke-width="1.5"/>
            <path d="M 125 310 Q 125 300 135 300 Q 145 300 145 310 L 145 330 Q 145 340 135 340 Q 125 340 125 330 Z" fill="url(#chainGradient)" stroke="#a96d17" stroke-width="1.5"/>
            <path d="M 145 310 Q 145 300 155 300 Q 165 300 165 310 L 165 330 Q 165 340 155 340 Q 145 340 145 330 Z" fill="url(#chainGradient)" stroke="#a96d17" stroke-width="1.5"/>
            <path d="M 165 310 Q 165 300 175 300 Q 185 300 185 310 L 185 330 Q 185 340 175 340 Q 165 340 165 330 Z" fill="url(#chainGradient)" stroke="#a96d17" stroke-width="1.5"/>
            <path d="M 185 310 Q 185 300 195 300 Q 205 300 205 310 L 205 330 Q 205 340 195 340 Q 185 340 185 330 Z" fill="url(#chainGradient)" stroke="#a96d17" stroke-width="1.5"/>
            <path d="M 205 310 Q 205 300 215 300 Q 225 300 225 310 L 225 330 Q 225 340 215 340 Q 205 340 205 330 Z" fill="url(#chainGradient)" stroke="#a96d17" stroke-width="1.5"/>
            <path d="M 225 310 Q 225 300 235 300 Q 245 300 245 310 L 245 330 Q 245 340 235 340 Q 225 340 225 330 Z" fill="url(#chainGradient)" stroke="#a96d17" stroke-width="1.5"/>
            
            <!-- –¶–µ–ø—å –ø–æ—Å–µ—Ä–µ–¥–∏–Ω–µ -->
            <path d="M 35 180 Q 35 170 45 170 Q 55 170 55 180 L 55 200 Q 55 210 45 210 Q 35 210 35 200 Z" fill="url(#chainGradient)" stroke="#a96d17" stroke-width="1.5"/>
            <path d="M 55 180 Q 55 170 65 170 Q 75 170 75 180 L 75 200 Q 75 210 65 210 Q 55 210 55 200 Z" fill="url(#chainGradient)" stroke="#a96d17" stroke-width="1.5"/>
            <path d="M 75 180 Q 75 170 85 170 Q 95 170 95 180 L 95 200 Q 95 210 85 210 Q 75 210 75 200 Z" fill="url(#chainGradient)" stroke="#a96d17" stroke-width="1.5"/>
            <path d="M 95 180 Q 95 170 105 170 Q 115 170 115 180 L 115 200 Q 115 210 105 210 Q 95 210 95 200 Z" fill="url(#chainGradient)" stroke="#a96d17" stroke-width="1.5"/>
            <path d="M 115 180 Q 115 170 125 170 Q 135 170 135 180 L 135 200 Q 135 210 125 210 Q 115 210 115 200 Z" fill="url(#chainGradient)" stroke="#a96d17" stroke-width="1.5"/>
            <path d="M 135 180 Q 135 170 145 170 Q 155 170 155 180 L 155 200 Q 155 210 145 210 Q 135 210 135 200 Z" fill="url(#chainGradient)" stroke="#a96d17" stroke-width="1.5"/>
            <path d="M 155 180 Q 155 170 165 170 Q 175 170 175 180 L 175 200 Q 175 210 165 210 Q 155 210 155 200 Z" fill="url(#chainGradient)" stroke="#a96d17" stroke-width="1.5"/>
            <path d="M 175 180 Q 175 170 185 170 Q 195 170 195 180 L 195 200 Q 195 210 185 210 Q 175 210 175 200 Z" fill="url(#chainGradient)" stroke="#a96d17" stroke-width="1.5"/>
            <path d="M 195 180 Q 195 170 205 170 Q 215 170 215 180 L 215 200 Q 215 210 205 210 Q 195 210 195 200 Z" fill="url(#chainGradient)" stroke="#a96d17" stroke-width="1.5"/>
            <path d="M 215 180 Q 215 170 225 170 Q 235 170 235 180 L 235 200 Q 235 210 225 210 Q 215 210 215 200 Z" fill="url(#chainGradient)" stroke="#a96d17" stroke-width="1.5"/>
            
            <!-- –¶–µ–ø—å —Å–≤–µ—Ä—Ö—É -->
            <path d="M 25 70 Q 25 60 35 60 Q 45 60 45 70 L 45 90 Q 45 100 35 100 Q 25 100 25 90 Z" fill="url(#chainGradient)" stroke="#a96d17" stroke-width="1.5"/>
            <path d="M 45 70 Q 45 60 55 60 Q 65 60 65 70 L 65 90 Q 65 100 55 100 Q 45 100 45 90 Z" fill="url(#chainGradient)" stroke="#a96d17" stroke-width="1.5"/>
            <path d="M 65 70 Q 65 60 75 60 Q 85 60 85 70 L 85 90 Q 85 100 75 100 Q 65 100 65 90 Z" fill="url(#chainGradient)" stroke="#a96d17" stroke-width="1.5"/>
            <path d="M 85 70 Q 85 60 95 60 Q 105 60 105 70 L 105 90 Q 105 100 95 100 Q 85 100 85 90 Z" fill="url(#chainGradient)" stroke="#a96d17" stroke-width="1.5"/>
            <path d="M 105 70 Q 105 60 115 60 Q 125 60 125 70 L 125 90 Q 125 100 115 100 Q 105 100 105 90 Z" fill="url(#chainGradient)" stroke="#a96d17" stroke-width="1.5"/>
            <path d="M 125 70 Q 125 60 135 60 Q 145 60 145 70 L 145 90 Q 145 100 135 100 Q 125 100 125 90 Z" fill="url(#chainGradient)" stroke="#a96d17" stroke-width="1.5"/>
            <path d="M 145 70 Q 145 60 155 60 Q 165 60 165 70 L 165 90 Q 165 100 155 100 Q 145 100 145 90 Z" fill="url(#chainGradient)" stroke="#a96d17" stroke-width="1.5"/>
            <path d="M 165 70 Q 165 60 175 60 Q 185 60 185 70 L 185 90 Q 185 100 175 100 Q 165 100 165 90 Z" fill="url(#chainGradient)" stroke="#a96d17" stroke-width="1.5"/>
            <path d="M 185 70 Q 185 60 195 60 Q 205 60 205 70 L 205 90 Q 205 100 195 100 Q 185 100 185 90 Z" fill="url(#chainGradient)" stroke="#a96d17" stroke-width="1.5"/>
            <path d="M 205 70 Q 205 60 215 60 Q 225 60 225 70 L 225 90 Q 225 100 215 100 Q 205 100 205 90 Z" fill="url(#chainGradient)" stroke="#a96d17" stroke-width="1.5"/>
            <path d="M 225 70 Q 225 60 235 60 Q 245 60 245 70 L 245 90 Q 245 100 235 100 Q 225 100 225 90 Z" fill="url(#chainGradient)" stroke="#a96d17" stroke-width="1.5"/>
          </g>

          <!-- –ù–µ–Ω –∏ —Ü–µ–ø—å –Ω–∞ —Ä—É–∫–µ - —Å–æ–µ–¥–∏–Ω–µ–Ω–Ω—ã–µ –∑–≤–µ–Ω—å—è -->
          <g filter="url(#softGlow)">
            <path d="M 178 260 Q 178 250 188 250 Q 198 250 198 260 L 198 275 Q 198 285 188 285 Q 178 285 178 275 Z" fill="url(#chainGradient)" stroke="#a96d17" stroke-width="2"/>
            <path d="M 198 260 Q 198 250 208 250 Q 218 250 218 260 L 218 275 Q 218 285 208 285 Q 198 285 198 275 Z" fill="url(#chainGradient)" stroke="#a96d17" stroke-width="2"/>
            <path d="M 218 245 Q 218 235 228 235 Q 238 235 238 245 L 238 255 Q 238 265 228 265 Q 218 265 218 255 Z" fill="url(#chainGradient)" stroke="#a96d17" stroke-width="2"/>
            <circle cx="220" cy="235" r="12" fill="#0b1540" stroke="url(#chainGradient)" stroke-width="3"/>
            <circle cx="178" cy="260" r="10" fill="#0b1540" stroke="url(#chainGradient)" stroke-width="3"/>
          </g>

          <!-- –ë–ª–∏–∫–∏ -->
          <path d="M80 90 Q110 60 150 90" fill="none" stroke="#fff8dc" stroke-width="6" opacity="0.35"/>
          <path d="M90 300 Q130 330 170 300" fill="none" stroke="#fde2a3" stroke-width="5" opacity="0.4"/>
        </svg>
      </div>
      <h2 class="text-xl font-bold mb-6">–ü—Ä–æ—Ñ–∏–ª—å</h2>

      <div class="rounded-lg border border-violet-400/30 p-6 bg-black/30 space-y-4 mb-6">
        <div class="flex items-center gap-3">
          <div class="w-16 h-16 rounded-full bg-gradient-to-br from-violet-500 to-pink-500 flex items-center justify-center text-2xl font-bold theme-avatar">
            <span id="profile-avatar">üë§</span>
          </div>
          <div>
            <div class="text-lg font-semibold" id="profile-username">–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å</div>
            <div class="text-sm text-gray-400">ID: <span id="profile-id" class="text-violet-400"></span></div>
          </div>
        </div>

        <div class="pt-4 border-t border-violet-400/20 space-y-3">
          <div class="flex justify-between items-center">
            <span class="text-gray-400">–ü–µ—Ä–≤—ã–π –≤—Ö–æ–¥:</span>
            <span id="profile-first-login" class="text-blue-400"></span>
          </div>
          <div class="flex justify-between items-center">
            <span class="text-gray-400">–°—Ç–∞—Ç—É—Å:</span>
            <span id="profile-status" class="text-green-400 font-semibold"></span>
          </div>
        </div>
      </div>

      <!-- ‚≠ê –°–∏—Å—Ç–µ–º–∞ —É—Ä–æ–≤–Ω–µ–π –∏ –æ–ø—ã—Ç–∞ -->
      <div class="mb-6">
        <div class="rounded-lg border border-violet-400/30 p-6 bg-black/30 space-y-4">
          <div class="flex items-center justify-between mb-2">
            <span id="level-badge" class="text-sm font-bold">–£—Ä–æ–≤–µ–Ω—å 1</span>
            <div class="flex items-center gap-2">
              <div id="current-experience" class="text-2xl font-bold text-violet-400">0</div>
              <div class="text-xs text-gray-400">–æ–ø—ã—Ç–∞</div>
            </div>
          </div>

          <!-- –ü–æ–ª–æ—Å–∫–∞ –ø—Ä–æ–≥—Ä–µ—Å—Å–∞ -->
          <div class="relative">
            <div class="w-full h-6 bg-gray-800 rounded-full overflow-hidden border border-violet-400/20" id="progress-bar-container">
              <div id="experience-progress-bar" class="h-full bg-gradient-to-r from-violet-500 via-pink-500 to-violet-500 rounded-full transition-all duration-500 ease-out relative overflow-hidden" style="width: 0%; background-size: 200% 100%; animation: neonFlow 3s linear infinite;">
                <div class="absolute inset-0 bg-gradient-to-r from-transparent via-white/30 to-transparent animate-shimmer"></div>
              </div>
            </div>
            <div class="flex justify-between items-center mt-2 text-xs text-gray-400">
              <span id="current-level-exp">0</span>
              <span id="next-level-exp">100</span>
            </div>
          </div>

          <!-- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ -->
          <div class="pt-3 border-t border-violet-400/20 grid grid-cols-2 gap-3">
            <div class="text-center p-3 rounded-lg bg-black/40 border border-violet-400/20">
              <div class="text-2xl font-bold text-violet-400" id="contests-participated">0</div>
              <div class="text-xs text-gray-400 mt-1">–£—á–∞—Å—Ç–∏–π</div>
            </div>
            <div class="text-center p-3 rounded-lg bg-black/40 border border-violet-400/20">
              <div class="text-2xl font-bold text-pink-400" id="contests-won">0</div>
              <div class="text-xs text-gray-400 mt-1">–ü–æ–±–µ–¥</div>
            </div>
          </div>
        </div>
      </div>

      <!-- üé® –°–º–µ–Ω–∞ —Ç–µ–º—ã -->
      <button id="change-theme-btn" class="neon-button w-full py-3 rounded-lg mb-3 relative">
        <span class="kitty-btn-icon">üé®</span> –°–º–µ–Ω–∏—Ç—å —Ç–µ–º—É
      </button>

      <!-- üì® –°–≤—è–∑—å —Å –≤–ª–∞–¥–µ–ª—å—Ü–µ–º -->
      <button id="contact-owner-btn" class="neon-button w-full py-3 rounded-lg relative">
        <span class="kitty-btn-icon">üì®</span> –°–≤—è–∑—å —Å –≤–ª–∞–¥–µ–ª—å—Ü–µ–º
      </button>
    </section>

    <!-- üé® –ú–æ–¥–∞–ª–∫–∞: –í—ã–±–æ—Ä —Ç–µ–º—ã -->
    <div id="theme-selector-modal" class="hidden fixed inset-0 z-30 flex items-center justify-center bg-black/70 backdrop-blur-sm">
      <div class="relative w-full sm:w-[500px] bg-[#0b0b10] rounded-2xl border border-violet-500/30 shadow-2xl p-6 mx-4 max-h-[90vh] overflow-y-auto">
        <button id="close-theme-modal" class="absolute -top-3 -right-3 bg-black text-white border border-violet-400/50 rounded-full w-9 h-9 neon-button" aria-label="–ó–∞–∫—Ä—ã—Ç—å">‚úï</button>
        <h3 class="text-lg font-semibold mb-4">üé® –í—ã–±–µ—Ä–∏—Ç–µ —Ç–µ–º—É</h3>
        <div id="themes-list" class="space-y-3">
          <!-- –¢–µ–º—ã –±—É–¥—É—Ç –¥–æ–±–∞–≤–ª–µ–Ω—ã –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
        </div>
      </div>
    </div>

    <!-- üì® –ú–æ–¥–∞–ª–∫–∞: –û—Ç–ø—Ä–∞–≤–∏—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ –≤–ª–∞–¥–µ–ª—å—Ü—É -->
    <div id="contact-owner-modal" class="hidden fixed inset-0 z-30 flex items-center justify-center bg-black/70 backdrop-blur-sm">
      <div class="relative w-full sm:w-[500px] bg-[#0b0b10] rounded-2xl border border-violet-500/30 shadow-2xl p-6 mx-4">
        <button id="close-contact-modal" class="absolute -top-3 -right-3 bg-black text-white border border-violet-400/50 rounded-full w-9 h-9 neon-button" aria-label="–ó–∞–∫—Ä—ã—Ç—å">‚úï</button>
        <h3 class="text-lg font-semibold mb-4">üì® –°–≤—è–∑—å —Å –≤–ª–∞–¥–µ–ª—å—Ü–µ–º</h3>
        <div class="space-y-4">
          <div>
            <label class="block text-sm text-gray-400 mb-2">–í–∞—à–µ —Å–æ–æ–±—â–µ–Ω–∏–µ:</label>
            <textarea id="contact-message-text" class="input-field w-full p-3 rounded" rows="6" placeholder="–í–≤–µ–¥–∏—Ç–µ –≤–∞—à–µ —Å–æ–æ–±—â–µ–Ω–∏–µ..."></textarea>
          </div>
          <button id="send-contact-message" class="neon-button w-full py-3 rounded-lg">–û—Ç–ø—Ä–∞–≤–∏—Ç—å</button>
        </div>
      </div>
    </div>

  </main>

  <!-- üü£ Bottom neon shimmer backdrop for buttons -->
  <div class="neon-bottom"></div>

  <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–ª—è –ø–æ–¥–ø–∏—Å–∫–∏ –Ω–∞ –∫–∞–Ω–∞–ª—ã/—á–∞—Ç—ã -->
  <div id="subscription-modal" class="fixed inset-0 bg-black/80 backdrop-blur-sm z-50 flex items-center justify-center p-4 hidden">
    <div id="subscription-modal-content" class="bg-gradient-to-br from-gray-900 via-purple-900/30 to-gray-900 rounded-xl border-2 border-violet-400/40 p-6 max-w-md w-full max-h-[90vh] overflow-y-auto shadow-2xl">
      <div class="text-center mb-4">
        <h2 class="text-2xl font-bold text-white mb-2">‚ö†Ô∏è –¢—Ä–µ–±—É–µ—Ç—Å—è –ø–æ–¥–ø–∏—Å–∫–∞</h2>
        <p class="text-gray-300 text-sm">–î–ª—è —É—á–∞—Å—Ç–∏—è –≤ –∫–æ–Ω–∫—É—Ä—Å–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –ø–æ–¥–ø–∏—Å–∞—Ç—å—Å—è –Ω–∞ —Å–ª–µ–¥—É—é—â–∏–µ –∫–∞–Ω–∞–ª—ã –∏ —á–∞—Ç—ã:</p>
      </div>
      <div id="subscription-list" class="space-y-3 mb-4"></div>
      <div class="flex flex-col gap-2">
        <button id="verify-subscription-btn" class="neon-button px-6 py-3 rounded-lg font-semibold text-white w-full">
          ‚úì –í—ã–ø–æ–ª–Ω–∏–ª
        </button>
        <button id="close-subscription-modal" class="px-6 py-2 rounded-lg font-semibold text-gray-300 bg-gray-800 hover:bg-gray-700 w-full">
          –û—Ç–º–µ–Ω–∞
        </button>
      </div>
    </div>
  </div>

  <!-- üèÜ –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–ª—è –∏—Ç–æ–≥–æ–≤ –∫–æ–Ω–∫—É—Ä—Å–∞ —Ä–∏—Å—É–Ω–∫–æ–≤ -->
  <div id="drawing-results-modal" class="fixed inset-0 bg-black/80 backdrop-blur-sm z-50 hidden flex items-center justify-center p-4">
    <div class="relative w-full max-w-2xl bg-gradient-to-br from-gray-900 via-purple-900/20 to-gray-900 border border-violet-400/40 rounded-2xl shadow-2xl p-6 max-h-[90vh] overflow-y-auto">
      <div class="flex items-center justify-between mb-4">
        <h2 class="text-2xl font-bold text-white">üèÜ –ò—Ç–æ–≥–∏ –∫–æ–Ω–∫—É—Ä—Å–∞</h2>
        <button onclick="document.getElementById('drawing-results-modal').classList.add('hidden')" class="bg-black text-white border border-violet-400/50 rounded-full w-9 h-9 neon-button flex items-center justify-center" aria-label="–ó–∞–∫—Ä—ã—Ç—å">‚úï</button>
      </div>
      <div id="drawing-results-content" class="space-y-4">
        <!-- –°–æ–¥–µ—Ä–∂–∏–º–æ–µ –±—É–¥–µ—Ç –¥–æ–±–∞–≤–ª–µ–Ω–æ –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
      </div>
    </div>
  </div>

  <!-- üó≥Ô∏è –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –≥–æ–ª–æ—Å–æ–≤–∞–Ω–∏—è –∑–∞ —Ä–∞–±–æ—Ç—ã -->
  <div id="voting-modal" class="fixed inset-0 bg-black/80 backdrop-blur-sm z-50 hidden flex items-center justify-center p-4">
    <div class="relative w-full max-w-xl bg-gradient-to-br from-gray-900 via-purple-900/20 to-gray-900 border border-violet-400/40 rounded-2xl shadow-2xl p-6">
      <button id="voting-modal-close" class="absolute -top-3 -right-3 bg-black text-white border border-violet-400/50 rounded-full w-9 h-9 neon-button" aria-label="–ó–∞–∫—Ä—ã—Ç—å">‚úï</button>
      <div id="voting-modal-progress" class="text-sm text-gray-300 text-center mb-3"></div>
      <div class="w-full rounded-xl overflow-hidden bg-black/40 mb-4 flex items-center justify-center min-h-[260px]">
        <img id="voting-modal-image" src="" alt="–†–∞–±–æ—Ç–∞ –∫–æ–Ω–∫—É—Ä—Å–∞" class="max-h-[360px] object-contain w-full transition-opacity duration-300 hidden" />
        <div id="voting-modal-loader" class="text-gray-400 text-sm">‚è≥ –ó–∞–≥—Ä—É–∑–∫–∞...</div>
      </div>
      <div id="voting-modal-info" class="text-sm text-gray-400 text-center mb-4"></div>
      <div class="flex justify-center gap-2 flex-wrap">
        <button class="voting-score-btn neon-button px-4 py-2 rounded-lg text-sm font-semibold bg-violet-500/40 border border-violet-500/20" data-score="1">1</button>
        <button class="voting-score-btn neon-button px-4 py-2 rounded-lg text-sm font-semibold bg-violet-500/40 border border-violet-500/20" data-score="2">2</button>
        <button class="voting-score-btn neon-button px-4 py-2 rounded-lg text-sm font-semibold bg-violet-500/40 border border-violet-500/20" data-score="3">3</button>
        <button class="voting-score-btn neon-button px-4 py-2 rounded-lg text-sm font-semibold bg-violet-500/40 border border-violet-500/20" data-score="4">4</button>
        <button class="voting-score-btn neon-button px-4 py-2 rounded-lg text-sm font-semibold bg-violet-500/40 border border-violet-500/20" data-score="5">5</button>
      </div>
    </div>
  </div>

  <!-- üñºÔ∏è –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–ª—è –≤–≤–æ–¥–∞ —Å—Å—ã–ª–æ–∫ –Ω–∞ NFT (—à–∞–≥ 1) -->
  <div id="collection-links-modal" class="fixed inset-0 bg-black/80 backdrop-blur-sm z-50 hidden flex items-center justify-center p-4">
    <div class="relative w-full max-w-2xl bg-gradient-to-br from-gray-900 via-purple-900/20 to-gray-900 border border-violet-400/40 rounded-2xl shadow-2xl p-6 max-h-[90vh] overflow-y-auto">
      <button id="collection-links-modal-close" class="absolute -top-3 -right-3 bg-black text-white border border-violet-400/50 rounded-full w-9 h-9 neon-button flex items-center justify-center" aria-label="–ó–∞–∫—Ä—ã—Ç—å">‚úï</button>
      <h2 class="text-2xl font-bold text-white mb-4">üñºÔ∏è –í–≤–µ–¥–∏—Ç–µ —Å—Å—ã–ª–∫–∏ –Ω–∞ NFT</h2>
      <p class="text-gray-300 text-sm mb-4">–í–≤–µ–¥–∏—Ç–µ 9 —Å—Å—ã–ª–æ–∫ –Ω–∞ NFT –≤ —Ñ–æ—Ä–º–∞—Ç–µ <code class="bg-black/40 px-2 py-1 rounded">t.me/nft/–Ω–∞–∑–≤–∞–Ω–∏–µ-–Ω–æ–º–µ—Ä</code></p>

      <div id="collection-links-inputs" class="space-y-3 mb-4">
        <!-- –ü–æ–ª—è –≤–≤–æ–¥–∞ –±—É–¥—É—Ç –¥–æ–±–∞–≤–ª–µ–Ω—ã –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
      </div>

      <div class="flex items-center justify-between mb-4">
        <div id="collection-links-count" class="text-sm text-gray-400">
          –í–≤–µ–¥–µ–Ω–æ: <span id="collection-links-entered">0</span> / 9
        </div>
        <div id="collection-links-error" class="text-sm text-red-400 hidden"></div>
      </div>

      <div class="flex gap-3">
        <button id="collection-links-continue" class="neon-button px-6 py-3 rounded-lg font-semibold text-white flex-1 disabled:opacity-50 disabled:cursor-not-allowed" disabled>
          –ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å
        </button>
        <button id="collection-links-cancel" class="px-6 py-3 rounded-lg font-semibold text-gray-300 bg-gray-800 hover:bg-gray-700">
          –û—Ç–º–µ–Ω–∞
        </button>
      </div>
    </div>
  </div>

  <!-- üñºÔ∏è –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–ª—è —Ä–∞—Å—Å—Ç–∞–Ω–æ–≤–∫–∏ NFT (—à–∞–≥ 2) -->
  <div id="collection-arrange-modal" class="fixed inset-0 bg-black/80 backdrop-blur-sm z-50 hidden flex items-center justify-center p-4" style="overflow-x: hidden !important; overflow-y: auto; left: 0; right: 0; width: 100vw; max-width: 100vw; box-sizing: border-box; position: fixed;">
    <div class="relative w-full max-w-4xl bg-gradient-to-br from-gray-900 via-purple-900/20 to-gray-900 border border-violet-400/40 rounded-2xl shadow-2xl p-6 max-h-[90vh] overflow-y-auto" style="overflow-x: hidden !important; max-width: calc(100% - 2rem); width: calc(100% - 2rem); box-sizing: border-box; margin: 0 auto; position: relative;">
      <button id="collection-arrange-modal-close" class="absolute -top-3 -right-3 bg-black text-white border border-violet-400/50 rounded-full w-9 h-9 neon-button flex items-center justify-center" aria-label="–ó–∞–∫—Ä—ã—Ç—å">‚úï</button>
      <h2 class="text-2xl font-bold text-white mb-4" style="word-wrap: break-word; overflow-wrap: break-word; max-width: 100%; box-sizing: border-box; overflow-x: hidden;">üñºÔ∏è –†–∞—Å—Å—Ç–∞–≤—å—Ç–µ NFT –≤ –Ω—É–∂–Ω–æ–º –ø–æ—Ä—è–¥–∫–µ</h2>
      <p class="text-gray-300 text-sm mb-4" style="word-wrap: break-word; overflow-wrap: break-word; max-width: 100%; box-sizing: border-box; overflow-x: hidden;">–ó–∞–∂–º–∏—Ç–µ –∏ –ø–µ—Ä–µ—Ç–∞—â–∏—Ç–µ NFT –¥–ª—è –∏–∑–º–µ–Ω–µ–Ω–∏—è –∏—Ö —Ä–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∏—è</p>

      <div id="collection-grid" class="grid grid-cols-3 gap-3 mb-6 w-full" oncontextmenu="return false;" style="-webkit-user-select: none; -moz-user-select: none; -ms-user-select: none; user-select: none; -webkit-touch-callout: none; overflow-x: hidden !important; width: 100%; max-width: 100%; box-sizing: border-box; min-width: 0;">
        <!-- –°–µ—Ç–∫–∞ 3x3 –±—É–¥–µ—Ç –¥–æ–±–∞–≤–ª–µ–Ω–∞ –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
      </div>

      <div class="flex gap-3" style="max-width: 100%; box-sizing: border-box; width: 100%; overflow-x: hidden;">
        <button id="collection-arrange-submit" class="neon-button px-6 py-3 rounded-lg font-semibold text-white flex-1" style="min-width: 0; max-width: 100%; box-sizing: border-box;">
          –û—Ç–ø—Ä–∞–≤–∏—Ç—å –∫–æ–ª–ª–µ–∫—Ü–∏—é
        </button>
        <button id="collection-arrange-back" class="px-6 py-3 rounded-lg font-semibold text-gray-300 bg-gray-800 hover:bg-gray-700" style="min-width: 0; max-width: 100%; box-sizing: border-box;">
          –ù–∞–∑–∞–¥
        </button>
      </div>
    </div>
  </div>

  <!-- üß† –í—Å—Ç—Ä–æ–µ–Ω–Ω–∞—è –ª–æ–≥–∏–∫–∞ UI/–∑–∞–≥—Ä—É–∑–∫–∞ -->
  <script>
    // –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–∞–º–æ–≥–æ –Ω–∞—á–∞–ª–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è —Å–∫—Ä–∏–ø—Ç–∞
    console.log('üöÄ ========== –°–ö–†–ò–ü–¢ USER.HTML –ó–ê–ì–†–£–ñ–ï–ù ==========');
    console.log('üöÄ –í—Ä–µ–º—è –∑–∞–≥—Ä—É–∑–∫–∏:', new Date().toISOString());
    console.log('üöÄ URL:', window.location.href);
    console.log('üöÄ User Agent:', navigator.userAgent);

    (function() {
      console.log('üöÄ IIFE —Ñ—É–Ω–∫—Ü–∏—è –∑–∞–ø—É—â–µ–Ω–∞');
      
      // –ó–∞–≥—Ä—É–∂–∞–µ–º —Ç–µ–º—É —Å—Ä–∞–∑—É –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å–∫—Ä–∏–ø—Ç–∞
      (function() {
        const savedTheme = localStorage.getItem('selectedTheme') || 'default';
        if (savedTheme !== 'default') {
          document.body.classList.add(`theme-${savedTheme}`);
        }
      })();
      
      let currentUserId = null;
      window.currentUserId = null; // –ì–ª–æ–±–∞–ª—å–Ω–∞—è –ø–µ—Ä–µ–º–µ–Ω–Ω–∞—è –¥–ª—è –¥–æ—Å—Ç—É–ø–∞ –∏–∑ –¥—Ä—É–≥–∏—Ö —Ñ—É–Ω–∫—Ü–∏–π
      let spinner, topNav, main, contentSections, navButtons;

      // –°–ù–ê–ß–ê–õ–ê –û–ü–†–ï–î–ï–õ–Ø–ï–ú –í–°–ï –§–£–ù–ö–¶–ò–ò, –ü–û–¢–û–ú –í–´–ó–´–í–ê–ï–ú initUserPage

      // Utilities
      function toMoscowDateTime(value) {
        if (!value) return '';
        const d = (value instanceof Date) ? value : new Date(value);
        if (Number.isNaN(d.getTime())) return '';
        return new Intl.DateTimeFormat('ru-RU', {
          timeZone: 'Europe/Moscow',
          year: 'numeric', month: '2-digit', day: '2-digit',
          hour: '2-digit', minute: '2-digit'
        }).format(d);
      }

      // –ú–æ–∫-–¥–∞–Ω–Ω—ã–µ –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –±–µ–∑ —Å–µ—Ä–≤–µ—Ä–∞
      const mockData = {
        '/api/contests': [
          {
            id: 1,
            title: '–¢–µ—Å—Ç–æ–≤—ã–π –∫–æ–Ω–∫—É—Ä—Å —Ä–∏—Å—É–Ω–∫–æ–≤',
            contest_type: 'drawing',
            post_link: 'https://t.me/test/123',
            prize_links: ['https://t.me/nft/test1', 'https://t.me/nft/test2'],
            submission_end_date: new Date(Date.now() + 7 * 24 * 60 * 60 * 1000).toISOString(),
            end_date: new Date(Date.now() + 14 * 24 * 60 * 60 * 1000).toISOString(),
            conditions: '–ù–∞—Ä–∏—Å—É–π—Ç–µ —á—Ç–æ-—Ç–æ –∫—Ä–∞—Å–∏–≤–æ–µ'
          }
        ],
        '/api/profile': {
          id: 123456789,
          username: 'TestUser',
          status: 'user',
          first_login: new Date().toISOString()
        },
        '/api/rating': {
          success: true,
          role: 'user',
          ratings: [
            { place: 1, telegram_id: 111, username: 'User1', rating: 150, wins: 5, participations: 100 },
            { place: 2, telegram_id: 222, username: 'User2', rating: 120, wins: 3, participations: 90 },
            { place: 3, telegram_id: 333, username: 'User3', rating: 100, wins: 2, participations: 80 }
          ]
        }
      };

      // –î–µ–ª–∞–µ–º fetchJSON –¥–æ—Å—Ç—É–ø–Ω–æ–π –≥–ª–æ–±–∞–ª—å–Ω–æ –°–†–ê–ó–£ - –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –º–æ–∫-–¥–∞–Ω–Ω—ã–µ
      window.fetchJSON = async function(url, options) {
        console.log('üîß Mock fetchJSON:', url, options);
        
        // –ò–º–∏—Ç–∏—Ä—É–µ–º –∑–∞–¥–µ—Ä–∂–∫—É —Å–µ—Ç–∏
        await new Promise(resolve => setTimeout(resolve, 300));
        
        // –í–æ–∑–≤—Ä–∞—â–∞–µ–º –º–æ–∫-–¥–∞–Ω–Ω—ã–µ
        const path = url.split('?')[0]; // –£–±–∏—Ä–∞–µ–º query –ø–∞—Ä–∞–º–µ—Ç—Ä—ã
        
        // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ç–æ—á–Ω–æ–µ —Å–æ–≤–ø–∞–¥–µ–Ω–∏–µ
        if (mockData[path]) {
          return Promise.resolve(JSON.parse(JSON.stringify(mockData[path])));
        }
        
        // –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–µ –ø—É—Ç–∏
        if (path.includes('/participants-count')) {
          return Promise.resolve({ count: 5 });
        }
        
        if (path.includes('/winners')) {
          return Promise.resolve({ winners: [], is_confirmed: false });
        }
        
        if (path.includes('/participant-status')) {
          return Promise.resolve({ is_participating: false, has_photo: false, has_collection: false });
        }
        
        if (path.includes('/results')) {
          return Promise.resolve({ results_calculated: false, message: '–ò—Ç–æ–≥–∏ –µ—â–µ –Ω–µ –ø–æ–¥—Å—á–∏—Ç–∞–Ω—ã' });
        }
        
        if (path.includes('/collection-results')) {
          return Promise.resolve({ results_calculated: false, message: '–ò—Ç–æ–≥–∏ –µ—â–µ –Ω–µ –ø–æ–¥—Å—á–∏—Ç–∞–Ω—ã' });
        }
        
        // –î–ª—è POST –∑–∞–ø—Ä–æ—Å–æ–≤ –≤–æ–∑–≤—Ä–∞—â–∞–µ–º success
        if (options && options.method === 'POST') {
          return Promise.resolve({ success: true, message: '–û–ø–µ—Ä–∞—Ü–∏—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∞ (—Ç–µ—Å—Ç–æ–≤—ã–π —Ä–µ–∂–∏–º)' });
        }
        
        // –î–ª—è –Ω–µ–∏–∑–≤–µ—Å—Ç–Ω—ã—Ö –ø—É—Ç–µ–π –≤–æ–∑–≤—Ä–∞—â–∞–µ–º –ø—É—Å—Ç–æ–π –æ—Ç–≤–µ—Ç
        return Promise.resolve({ success: true, data: [] });
      };

      // Extract channel username from post link
      function extractChannelFromPostLink(postLink) {
        if (!postLink) return null;
        const match = postLink.match(/(?:t\.me|telegram\.me)\/([a-zA-Z0-9_]+)\/(\d+)/);
        return match ? match[1] : null;
      }

      // Contests - –¥–µ–ª–∞–µ–º —Ñ—É–Ω–∫—Ü–∏–∏ –¥–æ—Å—Ç—É–ø–Ω—ã–º–∏ –≥–ª–æ–±–∞–ª—å–Ω–æ –°–†–ê–ó–£
      let contestList;

      function initContestList() {
        if (!contestList) {
          contestList = document.getElementById('contest-list');
        }
        return contestList;
      }

      const votingState = {
        contestId: null,
        works: [],
        currentIndex: 0
      };
      let votingModal;
      let votingModalImage;
      let votingModalProgress;
      let votingModalLoader;
      let votingModalInfo;
      let votingModalCloseBtn;
      let votingScoreButtons = [];

      function resetVotingState() {
        votingState.contestId = null;
        votingState.works = [];
        votingState.currentIndex = 0;
      }

      function closeVotingModal() {
        if (votingModal) {
          votingModal.classList.add('hidden');
        }
        resetVotingState();
      }

      function initVotingModalElements() {
        if (votingModal) {
          return;
        }

        votingModal = document.getElementById('voting-modal');
        votingModalImage = document.getElementById('voting-modal-image');
        votingModalProgress = document.getElementById('voting-modal-progress');
        votingModalLoader = document.getElementById('voting-modal-loader');
        votingModalInfo = document.getElementById('voting-modal-info');
        votingModalCloseBtn = document.getElementById('voting-modal-close');
        votingScoreButtons = Array.from(document.querySelectorAll('.voting-score-btn'));

        if (votingModalCloseBtn) {
          votingModalCloseBtn.addEventListener('click', closeVotingModal);
        }

        if (votingModal) {
          votingModal.addEventListener('click', (event) => {
            if (event.target === votingModal) {
              closeVotingModal();
            }
          });
        }

        votingScoreButtons.forEach((btn) => {
          btn.addEventListener('click', async () => {
            const score = parseInt(btn.dataset.score, 10);
            if (!Number.isNaN(score)) {
              await handleVoteClick(score);
            }
          });
        });
      }

      function showVotingLoader(show) {
        initVotingModalElements();
        if (votingModalLoader) {
          votingModalLoader.classList.toggle('hidden', !show);
        }
        if (votingModalImage && show) {
          votingModalImage.classList.add('hidden');
        }
        votingScoreButtons.forEach((btn) => {
          btn.disabled = show;
        });
      }

      function renderVotingWork() {
        initVotingModalElements();
        if (!votingState.works.length) {
          if (votingModalInfo) {
            votingModalInfo.textContent = '–ù–µ—Ç —Ä–∞–±–æ—Ç –¥–ª—è –æ—Ü–µ–Ω–∫–∏';
          }
          votingScoreButtons.forEach((btn) => {
            btn.disabled = true;
          });
          if (votingModalImage) {
            votingModalImage.src = '';
            votingModalImage.classList.add('hidden');
          }
          return;
        }

        const work = votingState.works[votingState.currentIndex];
        if (!work) {
          goToNextWork();
          return;
        }

        if (votingModalProgress) {
          votingModalProgress.textContent = `–†–∞–±–æ—Ç–∞ ${votingState.currentIndex + 1} –∏–∑ ${votingState.works.length}`;
        }
        if (votingModalInfo) {
          votingModalInfo.textContent = '–í—ã–±–µ—Ä–∏—Ç–µ –æ—Ü–µ–Ω–∫—É –æ—Ç 1 –¥–æ 5';
        }

        if (votingModalImage) {
          votingModalImage.classList.add('hidden');
          votingModalImage.onload = () => votingModalImage.classList.remove('hidden');
          votingModalImage.onerror = () => {
            if (votingModalInfo) {
              votingModalInfo.textContent = '–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ';
            }
          };
          votingModalImage.src = `${work.image_url}?t=${Date.now()}`;
        }

        votingScoreButtons.forEach((btn) => {
          const btnScore = Number(btn.dataset.score);
          const isSelected = work.rating === btnScore;
          if (isSelected) {
            btn.classList.add('bg-violet-600');
            btn.classList.remove('bg-violet-500/40');
          } else {
            btn.classList.remove('bg-violet-600');
            btn.classList.add('bg-violet-500/40');
          }
          btn.disabled = false;
        });
      }

      function goToNextWork() {
        const works = votingState.works;
        if (!works.length) {
          closeVotingModal();
          return;
        }

        const nextIndex = works.findIndex((work, index) => index > votingState.currentIndex && !work.already_rated);
        if (nextIndex !== -1) {
          votingState.currentIndex = nextIndex;
          renderVotingWork();
          return;
        }

        const firstUnrated = works.findIndex((work) => !work.already_rated);
        if (firstUnrated !== -1) {
          votingState.currentIndex = firstUnrated;
          renderVotingWork();
          return;
        }

        alert('–°–ø–∞—Å–∏–±–æ! –í—ã –æ—Ü–µ–Ω–∏–ª–∏ –≤—Å–µ –¥–æ—Å—Ç—É–ø–Ω—ã–µ —Ä–∞–±–æ—Ç—ã.');
        closeVotingModal();
        if (typeof window.loadContests === 'function') {
          window.loadContests(true);
        }
      }

      async function handleVoteClick(score) {
        initVotingModalElements();
        if (!votingState.contestId || !votingState.works.length) {
          return;
        }

        const currentWork = votingState.works[votingState.currentIndex];
        if (!currentWork || currentWork.already_rated) {
          goToNextWork();
          return;
        }

        showVotingLoader(true);
        if (votingModalInfo) {
          votingModalInfo.textContent = '–°–æ—Ö—Ä–∞–Ω—è–µ–º –≤–∞—à—É –æ—Ü–µ–Ω–∫—É...';
        }

        try {
          await window.fetchJSON(`/api/contests/${votingState.contestId}/vote`, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({
              user_id: currentUserId,
              work_number: currentWork.work_number,
              score: score
            })
          });

          currentWork.already_rated = true;
          currentWork.rating = score;
          showVotingLoader(false);
          goToNextWork();
        } catch (error) {
          showVotingLoader(false);
          let message = '–ù–µ —É–¥–∞–ª–æ—Å—å —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å –æ—Ü–µ–Ω–∫—É';
          if (error.response) {
            try {
              const errData = await error.response.clone().json();
              message = errData.detail || errData.message || message;
            } catch (e) {
              // ignore JSON parse errors
            }
          } else if (error.message) {
            message = error.message;
          }
          alert('‚ùå ' + message);
        }
      }

      async function openVotingModal(contestId) {
        if (!currentUserId) {
          alert('–ù–µ —É–¥–∞–ª–æ—Å—å –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å –≤–∞—à –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ.');
          return;
        }

        initVotingModalElements();
        resetVotingState();
        votingState.contestId = contestId;

        if (votingModal) {
          votingModal.classList.remove('hidden');
        }

        showVotingLoader(true);
        if (votingModalInfo) {
          votingModalInfo.textContent = '–ó–∞–≥—Ä—É–∂–∞–µ–º —Ä–∞–±–æ—Ç—ã –¥–ª—è –≥–æ–ª–æ—Å–æ–≤–∞–Ω–∏—è...';
        }

        try {
          const response = await window.fetchJSON(`/api/contests/${contestId}/voting-queue?user_id=${currentUserId}`);
          // –†–∞–±–æ—Ç—ã —É–∂–µ –æ—Ç—Ñ–∏–ª—å—Ç—Ä–æ–≤–∞–Ω—ã –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ (—Å–æ–±—Å—Ç–≤–µ–Ω–Ω—ã–µ —Ä–∞–±–æ—Ç—ã –∏—Å–∫–ª—é—á–µ–Ω—ã)
          const works = response?.works || [];

          if (!works.length) {
            alert('–ù–µ—Ç —Ä–∞–±–æ—Ç –¥–ª—è –æ—Ü–µ–Ω–∫–∏ –∏–ª–∏ –≤—Å–µ —Ä–∞–±–æ—Ç—ã –ø—Ä–∏–Ω–∞–¥–ª–µ–∂–∞—Ç –≤–∞–º.');
            closeVotingModal();
            return;
          }

          const firstUnratedIndex = works.findIndex((work) => !work.already_rated);
          if (firstUnratedIndex === -1) {
            alert('–í—ã —É–∂–µ –æ—Ü–µ–Ω–∏–ª–∏ –≤—Å–µ –¥–æ—Å—Ç—É–ø–Ω—ã–µ —Ä–∞–±–æ—Ç—ã. –°–ø–∞—Å–∏–±–æ!');
            closeVotingModal();
            return;
          }

          votingState.works = works;
          votingState.currentIndex = firstUnratedIndex;
          showVotingLoader(false);
          renderVotingWork();
        } catch (error) {
          showVotingLoader(false);
          let message = '–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å —Å–ø–∏—Å–æ–∫ —Ä–∞–±–æ—Ç';
          if (error.response) {
            try {
              const errData = await error.response.clone().json();
              message = errData.detail || errData.message || message;
            } catch (e) {
              // ignore JSON parse errors
            }
          } else if (error.message) {
            message = error.message;
          }
          alert('‚ùå ' + message);
          closeVotingModal();
        }
      }

      window.openVotingModal = openVotingModal;

      // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–æ–¥—Å—á–µ—Ç–∞ –∏—Ç–æ–≥–æ–≤ –∫–æ–Ω–∫—É—Ä—Å–∞ —Ä–∏—Å—É–Ω–∫–æ–≤ (–¥–ª—è —Å–æ–∑–¥–∞—Ç–µ–ª—è)
      window.calculateDrawingResults = async function(contestId) {
        const btn = document.getElementById(`calculate-results-btn-${contestId}`);
        if (btn) {
          btn.disabled = true;
          btn.textContent = '‚è≥ –ü–æ–¥—Å—á–µ—Ç...';
        }

        try {
          const currentUserId = window.currentUserId || 123456789;
          const response = await window.fetchJSON(`/api/contests/${contestId}/calculate-results?current_user_id=${currentUserId}`, {
            method: 'POST'
          });

          if (response.success) {
            alert('‚úÖ –ò—Ç–æ–≥–∏ —É—Å–ø–µ—à–Ω–æ –ø–æ–¥—Å—á–∏—Ç–∞–Ω—ã!');
            await window.loadContests(true);
          } else {
            alert('‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–¥—Å—á–µ—Ç–µ –∏—Ç–æ–≥–æ–≤: ' + (response.message || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞'));
            if (btn) {
              btn.disabled = false;
              btn.textContent = 'üìä –ü–æ–¥—Å—á–µ—Ç –∏—Ç–æ–≥–æ–≤';
            }
          }
        } catch (e) {
          console.error('–û—à–∏–±–∫–∞ –ø–æ–¥—Å—á–µ—Ç–∞ –∏—Ç–æ–≥–æ–≤:', e);
          let errorMessage = '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞';
          if (e.response) {
            try {
              const errData = await e.response.clone().json();
              errorMessage = errData.detail || errData.message || errorMessage;
            } catch (parseError) {
              if (e.message) errorMessage = e.message;
            }
          } else if (e.message) {
            errorMessage = e.message;
          }
          alert('‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–¥—Å—á–µ—Ç–µ –∏—Ç–æ–≥–æ–≤: ' + errorMessage);
          if (btn) {
            btn.disabled = false;
            btn.textContent = 'üìä –ü–æ–¥—Å—á–µ—Ç –∏—Ç–æ–≥–æ–≤';
          }
        }
      };

      // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –∏—Ç–æ–≥–æ–≤ –∫–æ–Ω–∫—É—Ä—Å–∞ —Ä–∏—Å—É–Ω–∫–æ–≤
      window.showDrawingResults = async function(contestId) {
        try {
          const response = await window.fetchJSON(`/api/contests/${contestId}/results`);

          if (!response.results_calculated) {
            alert('–ò—Ç–æ–≥–∏ –µ—â–µ –Ω–µ –ø–æ–¥—Å—á–∏—Ç–∞–Ω—ã');
            return;
          }

          const results = response.results || [];
          const resultsModal = document.getElementById('drawing-results-modal');
          const resultsContent = document.getElementById('drawing-results-content');

          if (!resultsModal || !resultsContent) {
            alert('–ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ');
            return;
          }

          // –§–æ—Ä–º–∏—Ä—É–µ–º HTML —Å –∏—Ç–æ–≥–∞–º–∏
          let resultsHtml = '<div class="space-y-4">';

          for (const result of results) {
            const place = result.place;
            const username = result.username || '';
            const userId = result.participant_user_id;
            const userDisplay = username ? `${username} (ID: ${userId})` : `ID: ${userId}`;
            const imageUrl = `/api/drawing-contests/${contestId}/works/${result.work_number}/image`;
            const prizeLink = result.prize_link;
            const averageScore = result.average_score || 0;
            const votesCount = result.votes_count || 0;

            resultsHtml += `
              <div class="rounded-lg border border-violet-400/30 p-4 bg-black/30">
                <div class="text-2xl font-bold text-violet-400 mb-2">${place} –º–µ—Å—Ç–æ</div>
                <div class="text-sm text-gray-300 mb-3">
                  ${username ? `<span class="font-semibold text-violet-400">${username}</span> ` : ''}
                  <span class="text-gray-400">(ID: ${userId})</span>
                </div>
                <div class="mb-3">
                  <img src="${imageUrl}" alt="–†–∞–±–æ—Ç–∞ ${result.work_number}" class="w-full rounded-lg max-h-64 object-contain" />
                </div>
                <div class="text-sm text-gray-400 mb-3">
                  –°—Ä–µ–¥–Ω—è—è –æ—Ü–µ–Ω–∫–∞: <span class="text-violet-400 font-semibold">${averageScore.toFixed(2)}</span> (${votesCount} ${votesCount === 1 ? '–æ—Ü–µ–Ω–∫–∞' : votesCount < 5 ? '–æ—Ü–µ–Ω–∫–∏' : '–æ—Ü–µ–Ω–æ–∫'})
                </div>
                ${prizeLink ? `
                  <div class="text-sm">
                    <a href="${prizeLink.startsWith('http') ? prizeLink : 'https://' + prizeLink}" target="_blank" class="text-pink-400 hover:underline font-semibold">üéÅ –ü—Ä–∏–∑</a>
                  </div>
                ` : ''}
              </div>
            `;
          }

          resultsHtml += '</div>';
          resultsContent.innerHTML = resultsHtml;

          // –û—Ç–∫—Ä—ã–≤–∞–µ–º –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ
          resultsModal.classList.remove('hidden');
        } catch (e) {
          console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∏—Ç–æ–≥–æ–≤:', e);
          alert('‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ –∏—Ç–æ–≥–æ–≤: ' + (e.message || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞'));
        }
      };
      window.closeVotingModal = closeVotingModal;

      // üé® –°–∏—Å—Ç–µ–º–∞ —Ç–µ–º (–æ–ø—Ä–µ–¥–µ–ª—è–µ–º —Ä–∞–Ω—å—à–µ, —á—Ç–æ–±—ã –±—ã–ª–∞ –¥–æ—Å—Ç—É–ø–Ω–∞ –ø—Ä–∏ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏)
      const themes = {
        default: {
          name: '–ü–æ —É–º–æ–ª—á–∞–Ω–∏—é',
          id: 'default',
          icon: 'üü£',
          description: '–ö–ª–∞—Å—Å–∏—á–µ—Å–∫–∞—è —Ñ–∏–æ–ª–µ—Ç–æ–≤–æ-—Ä–æ–∑–æ–≤–∞—è —Ç–µ–º–∞'
        },
        kitty: {
          name: 'Kitty',
          id: 'kitty',
          icon: 'üê±',
          description: '–ú–∏–ª—ã–µ —Ä–æ–∑–æ–≤—ã–µ –æ—Ç—Ç–µ–Ω–∫–∏'
        },
        mario: {
          name: 'Mario',
          id: 'mario',
          icon: 'üçÑ',
          description: '–†–µ—Ç—Ä–æ —Å—Ç–∏–ª—å Super Mario Bros'
        },
        aot: {
          name: 'Attack on Titan',
          id: 'aot',
          icon: '‚öîÔ∏è',
          description: '–°–µ–ø–∏—è, –ø–µ—Ä–≥–∞–º–µ–Ω—Ç, –≥–æ—Ç–∏—á–µ—Å–∫–∏–π —Å—Ç–∏–ª—å'
        },
        kurapika: {
          name: '–ö—É—Ä–∞–ø–∏–∫–∞',
          id: 'kurapika',
          icon: 'üîó',
          description: '–ö–æ—Ä–∏—á–Ω–µ–≤–æ-–∑–æ–ª–æ—Ç–∞—è —Ç–µ–º–∞ —Å —Ü–µ–ø—è–º–∏'
        }
      };

      // –ó–∞–≥—Ä—É–∑–∫–∞ —Ç–µ–∫—É—â–µ–π —Ç–µ–º—ã –∏–∑ localStorage
      function loadTheme() {
        const savedTheme = localStorage.getItem('selectedTheme') || 'default';
        applyTheme(savedTheme);
        // –û–±–Ω–æ–≤–ª—è–µ–º –∏–∫–æ–Ω–∫–∏ –ø–æ—Å–ª–µ –Ω–µ–±–æ–ª—å—à–æ–π –∑–∞–¥–µ—Ä–∂–∫–∏, —á—Ç–æ–±—ã DOM –±—ã–ª –≥–æ—Ç–æ–≤ (applyTheme —É–∂–µ –≤—ã–∑—ã–≤–∞–µ—Ç updateIconsForTheme, –Ω–æ –Ω—É–∂–Ω–∞ –∑–∞–¥–µ—Ä–∂–∫–∞ –¥–ª—è DOM)
        setTimeout(() => {
          updateIconsForTheme(savedTheme);
        }, 300);
      }

      // –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ —Ç–µ–º—ã
      function applyTheme(themeId) {
        const body = document.body;
        // –£–¥–∞–ª—è–µ–º –≤—Å–µ –∫–ª–∞—Å—Å—ã —Ç–µ–º
        body.classList.remove('theme-kitty', 'theme-mario', 'theme-aot', 'theme-kurapika');
        
        if (themeId !== 'default') {
          body.classList.add(`theme-${themeId}`);
        }
        
        // –û–±–Ω–æ–≤–ª—è–µ–º –∏–∫–æ–Ω–∫–∏ –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Ç–µ–º—ã
        updateIconsForTheme(themeId);
        
        // –û–±–Ω–æ–≤–ª—è–µ–º –ø–æ–∑–∏—Ü–∏—é –ª–∞–ø–æ–∫ –¥–ª—è —Ç–µ–º—ã kitty
        if (themeId === 'kitty') {
          setTimeout(() => {
            const progressBar = document.getElementById('experience-progress-bar');
            const progressContainer = document.getElementById('progress-bar-container');
            if (progressBar && progressContainer) {
              const progressPercent = parseFloat(progressBar.style.width) || 0;
              const containerWidth = progressContainer.offsetWidth;
              const pawPosition = (containerWidth * progressPercent / 100) - 15;
              progressContainer.style.setProperty('--paw-position', `${Math.max(0, pawPosition)}px`);
            }
          }, 100);
        }
        
        localStorage.setItem('selectedTheme', themeId);
        console.log('‚úÖ –¢–µ–º–∞ –ø—Ä–∏–º–µ–Ω–µ–Ω–∞:', themeId);
      }

      // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ—á–∏—Å—Ç–∫–∏ –≤—Å–µ—Ö –∏–∫–æ–Ω–æ–∫ –ø–µ—Ä–µ–¥ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏–µ–º –Ω–æ–≤–æ–π —Ç–µ–º—ã
      function clearAllThemeIcons() {
        // –°–∫—Ä—ã–≤–∞–µ–º –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è
        const titanImage = document.getElementById('aot-titan-image');
        if (titanImage) {
          titanImage.classList.add('hidden');
        }
        const kurapikaImage = document.getElementById('kurapika-image');
        if (kurapikaImage) {
          kurapikaImage.classList.add('hidden');
        }

        // –û—á–∏—â–∞–µ–º –∞–≤–∞—Ç–∞—Ä
        const avatarEl = document.getElementById('profile-avatar');
        if (avatarEl) {
          avatarEl.textContent = avatarEl.textContent.replace(/[üçÑ‚≠êü™ôüëëüê±üò∏üòªüôÄüòΩüòæüòø‚öîÔ∏èüõ°Ô∏èüîóüë§üë®üë©]/g, '');
          if (!avatarEl.textContent.trim()) {
            avatarEl.textContent = 'üë§';
          }
        }

        // –û—á–∏—â–∞–µ–º –∫–Ω–æ–ø–∫–∏ –Ω–∞–≤–∏–≥–∞—Ü–∏–∏
        const profileBtn = document.querySelector('[data-section="profile-section"]');
        if (profileBtn) {
          const text = profileBtn.textContent.replace(/[üçÑüê±‚öîÔ∏èüîóüë§üë®üë©]/g, '').trim();
          profileBtn.innerHTML = text || '–ü—Ä–æ—Ñ–∏–ª—å';
        }

        const contestsBtn = document.querySelector('[data-section="contests-section"]');
        if (contestsBtn) {
          const text = contestsBtn.textContent.replace(/[‚≠êüéÅüèÜüéØüõ°Ô∏è]/g, '').trim();
          contestsBtn.innerHTML = text || '–ö–æ–Ω–∫—É—Ä—Å—ã';
        }

        const ratingBtn = document.querySelector('[data-section="rating-section"]');
        if (ratingBtn) {
          const text = ratingBtn.textContent.replace(/[ü™ôüíñ‚≠êüåüüèÜ]/g, '').trim();
          ratingBtn.innerHTML = text || '–†–µ–π—Ç–∏–Ω–≥';
        }

        // –û—á–∏—â–∞–µ–º –∫–Ω–æ–ø–∫–∏
        const changeThemeBtn = document.getElementById('change-theme-btn');
        if (changeThemeBtn) {
          const text = changeThemeBtn.textContent.replace(/[üéÆüíùüé®‚öîÔ∏èüîó]/g, '').trim();
          changeThemeBtn.innerHTML = text || '–°–º–µ–Ω–∏—Ç—å —Ç–µ–º—É';
        }

        const contactBtn = document.getElementById('contact-owner-btn');
        if (contactBtn) {
          const text = contactBtn.textContent.replace(/[üìÆüíåüì®]/g, '').trim();
          contactBtn.innerHTML = text || '–°–≤—è–∑—å —Å –≤–ª–∞–¥–µ–ª—å—Ü–µ–º';
        }

        // –û—á–∏—â–∞–µ–º –∏–∫–æ–Ω–∫—É –æ–ø—ã—Ç–∞
        const levelBadgeSection = document.querySelector('h3.flex.items-center.gap-2');
        if (levelBadgeSection) {
          const starIcon = levelBadgeSection.querySelector('.text-violet-400');
          if (starIcon) {
            starIcon.textContent = starIcon.textContent.replace(/[ü™ôüê±üíñ‚≠êüåü‚öîÔ∏èüîó]/g, '');
            starIcon.style.animation = '';
          }
        }

        // –û—á–∏—â–∞–µ–º –∑–∞–≥–æ–ª–æ–≤–∫–∏ —Å–µ–∫—Ü–∏–π
        const profileSection = document.querySelector('#profile-section h2');
        if (profileSection) {
          const text = profileSection.textContent.replace(/[üçÑüê±‚öîÔ∏èüîóüë§üë®üë©]/g, '').trim();
          profileSection.innerHTML = text || '–ü—Ä–æ—Ñ–∏–ª—å';
        }

        const contestsSection = document.querySelector('#contests-section h2');
        if (contestsSection) {
          const text = contestsSection.textContent.replace(/[‚≠êüéÅüèÜüéØüõ°Ô∏è]/g, '').trim();
          contestsSection.innerHTML = text || '–ö–æ–Ω–∫—É—Ä—Å—ã';
        }

        const ratingSection = document.querySelector('#rating-section h2');
        if (ratingSection) {
          const text = ratingSection.textContent.replace(/[ü™ôüíñ‚≠êüåüüèÜ]/g, '').trim();
          ratingSection.innerHTML = text || '–†–µ–π—Ç–∏–Ω–≥';
        }
      }

      // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–∫–æ–Ω–æ–∫ –¥–ª—è —Ç–µ–º—ã
      function updateIconsForTheme(themeId) {
        // –°–Ω–∞—á–∞–ª–∞ –æ—á–∏—â–∞–µ–º –≤—Å–µ –∏–∫–æ–Ω–∫–∏
        clearAllThemeIcons();

        if (themeId === 'mario') {
          // –ê–≤–∞—Ç–∞—Ä - –≥—Ä–∏–± –∏–ª–∏ Mario
          const avatarEl = document.getElementById('profile-avatar');
          if (avatarEl) {
            const marioIcons = ['üçÑ', '‚≠ê', 'ü™ô', 'üëë'];
            avatarEl.textContent = marioIcons[Math.floor(Math.random() * marioIcons.length)];
          }

          // –ù–∞–≤–∏–≥–∞—Ü–∏—è - –¥–æ–±–∞–≤–ª—è–µ–º –∏–∫–æ–Ω–∫–∏ Mario —Ç–µ–º–∞—Ç–∏–∫–∏
          const profileBtn = document.querySelector('[data-section="profile-section"]');
          if (profileBtn) {
            profileBtn.innerHTML = 'üçÑ –ü—Ä–æ—Ñ–∏–ª—å';
          }

          const contestsBtn = document.querySelector('[data-section="contests-section"]');
          if (contestsBtn) {
            contestsBtn.innerHTML = '‚≠ê –ö–æ–Ω–∫—É—Ä—Å—ã';
          }

          const ratingBtn = document.querySelector('[data-section="rating-section"]');
          if (ratingBtn) {
            ratingBtn.innerHTML = 'ü™ô –†–µ–π—Ç–∏–Ω–≥';
          }

          // –ö–Ω–æ–ø–∫–∞ —Å–º–µ–Ω—ã —Ç–µ–º—ã
          const changeThemeBtn = document.getElementById('change-theme-btn');
          if (changeThemeBtn) {
            changeThemeBtn.innerHTML = 'üéÆ –°–º–µ–Ω–∏—Ç—å —Ç–µ–º—É';
          }

          // –ö–Ω–æ–ø–∫–∞ —Å–≤—è–∑–∏ —Å –≤–ª–∞–¥–µ–ª—å—Ü–µ–º
          const contactBtn = document.getElementById('contact-owner-btn');
          if (contactBtn) {
            contactBtn.innerHTML = 'üìÆ –°–≤—è–∑—å —Å –≤–ª–∞–¥–µ–ª—å—Ü–µ–º';
          }

          // –ò–∫–æ–Ω–∫–∞ –æ–ø—ã—Ç–∞ (–º–æ–Ω–µ—Ç–∫–∞ —Ä—è–¥–æ–º —Å –±–µ–π–¥–∂–µ–º —É—Ä–æ–≤–Ω—è)
          const levelBadgeSection = document.querySelector('h3.flex.items-center.gap-2');
          if (levelBadgeSection) {
            const starIcon = levelBadgeSection.querySelector('.text-violet-400');
            if (starIcon) {
              starIcon.textContent = 'ü™ô';
              starIcon.style.animation = '';
            }
          }

          // –ó–∞–≥–æ–ª–æ–≤–∫–∏ —Å–µ–∫—Ü–∏–π
          const profileSection = document.querySelector('#profile-section h2');
          if (profileSection) {
            profileSection.innerHTML = 'üçÑ –ü—Ä–æ—Ñ–∏–ª—å';
          }

          // –ê–≤–∞—Ç–∞—Ä –º–∞—Ä–∏–æ - –¥–æ–±–∞–≤–ª—è–µ–º –∞–Ω–∏–º–∞—Ü–∏—é
          const avatarContainer = document.querySelector('.theme-avatar');
          if (avatarContainer) {
            avatarContainer.classList.add('mario-avatar');
          }

          const contestsSection = document.querySelector('#contests-section h2');
          if (contestsSection) {
            contestsSection.innerHTML = '‚≠ê –ö–æ–Ω–∫—É—Ä—Å—ã';
          }

          const ratingSection = document.querySelector('#rating-section h2');
          if (ratingSection) {
            ratingSection.innerHTML = 'ü™ô –†–µ–π—Ç–∏–Ω–≥';
          }

        } else if (themeId === 'kitty') {
          // –ê–≤–∞—Ç–∞—Ä - —Ä–æ–∑–æ–≤—ã–π –∫–æ—Ç–∏–∫ (–∏—Å–ø–æ–ª—å–∑—É–µ–º —Ä–∞–∑–Ω—ã–µ –∫–æ—Ç–∏–∫–∏ –¥–ª—è —Ä–∞–∑–Ω–æ–æ–±—Ä–∞–∑–∏—è)
          const avatarEl = document.getElementById('profile-avatar');
          if (avatarEl) {
            const kitties = ['üê±', 'üò∏', 'üòª', 'üôÄ', 'üòΩ', 'üòæ', 'üòø'];
            avatarEl.textContent = kitties[Math.floor(Math.random() * kitties.length)];
          }

          // –ù–∞–≤–∏–≥–∞—Ü–∏—è - –∑–∞–º–µ–Ω—è–µ–º –∏–∫–æ–Ω–∫–∏ –Ω–∞ –∫–æ—Ç–∏–∫–æ–≤ (–ø–æ –æ–¥–Ω–æ–π)
          const profileBtn = document.querySelector('[data-section="profile-section"]');
          if (profileBtn) {
            profileBtn.innerHTML = profileBtn.innerHTML.replace(/üë§|üë®|üë©/g, 'üê±');
            // –£–±–∏—Ä–∞–µ–º –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ - –æ—Å—Ç–∞–≤–ª—è–µ–º —Ç–æ–ª—å–∫–æ –æ–¥–Ω—É –∏–∫–æ–Ω–∫—É
            if (profileBtn.textContent.includes('üê± –ü—Ä–æ—Ñ–∏–ª—å')) {
              profileBtn.innerHTML = 'üê± –ü—Ä–æ—Ñ–∏–ª—å';
            } else if (!profileBtn.textContent.includes('üê±')) {
              profileBtn.innerHTML = profileBtn.innerHTML.replace('–ü—Ä–æ—Ñ–∏–ª—å', 'üê± –ü—Ä–æ—Ñ–∏–ª—å');
            }
          }

          const contestsBtn = document.querySelector('[data-section="contests-section"]');
          if (contestsBtn) {
            contestsBtn.innerHTML = contestsBtn.innerHTML.replace(/üèÜ|üéØ/g, 'üéÅ');
            if (contestsBtn.textContent.includes('üéÅ –ö–æ–Ω–∫—É—Ä—Å—ã')) {
              contestsBtn.innerHTML = 'üéÅ –ö–æ–Ω–∫—É—Ä—Å—ã';
            } else if (!contestsBtn.textContent.includes('üéÅ')) {
              contestsBtn.innerHTML = contestsBtn.innerHTML.replace('–ö–æ–Ω–∫—É—Ä—Å—ã', 'üéÅ –ö–æ–Ω–∫—É—Ä—Å—ã');
            }
          }

          const ratingBtn = document.querySelector('[data-section="rating-section"]');
          if (ratingBtn) {
            ratingBtn.innerHTML = ratingBtn.innerHTML.replace(/‚≠ê|üåü/g, 'üíñ');
            if (ratingBtn.textContent.includes('üíñ –†–µ–π—Ç–∏–Ω–≥')) {
              ratingBtn.innerHTML = 'üíñ –†–µ–π—Ç–∏–Ω–≥';
            } else if (!ratingBtn.textContent.includes('üíñ')) {
              ratingBtn.innerHTML = ratingBtn.innerHTML.replace('–†–µ–π—Ç–∏–Ω–≥', 'üíñ –†–µ–π—Ç–∏–Ω–≥');
            }
          }

          // –ö–Ω–æ–ø–∫–∞ —Å–º–µ–Ω—ã —Ç–µ–º—ã (–ø–æ –æ–¥–Ω–æ–π –∏–∫–æ–Ω–∫–µ)
          const changeThemeBtn = document.getElementById('change-theme-btn');
          if (changeThemeBtn) {
            // –£–±–∏—Ä–∞–µ–º –≤—Å–µ —ç–º–æ–¥–∑–∏ –∏ –æ—Å—Ç–∞–≤–ª—è–µ–º –æ–¥–Ω–æ
            changeThemeBtn.innerHTML = changeThemeBtn.innerHTML.replace(/[üíùüé®]/g, '').trim();
            if (changeThemeBtn.querySelector('.kitty-btn-icon')) {
              changeThemeBtn.querySelector('.kitty-btn-icon').textContent = 'üíù';
            } else {
              changeThemeBtn.innerHTML = '<span class="kitty-btn-icon">üíù</span> –°–º–µ–Ω–∏—Ç—å —Ç–µ–º—É';
            }
          }

          // –ö–Ω–æ–ø–∫–∞ —Å–≤—è–∑–∏ —Å –≤–ª–∞–¥–µ–ª—å—Ü–µ–º (–ø–æ –æ–¥–Ω–æ–π –∏–∫–æ–Ω–∫–µ)
          const contactBtn = document.getElementById('contact-owner-btn');
          if (contactBtn) {
            // –£–±–∏—Ä–∞–µ–º –≤—Å–µ —ç–º–æ–¥–∑–∏ –∏ –æ—Å—Ç–∞–≤–ª—è–µ–º –æ–¥–Ω–æ
            contactBtn.innerHTML = contactBtn.innerHTML.replace(/[üíåüì®]/g, '').trim();
            if (contactBtn.querySelector('.kitty-btn-icon')) {
              contactBtn.querySelector('.kitty-btn-icon').textContent = 'üíå';
            } else {
              contactBtn.innerHTML = '<span class="kitty-btn-icon">üíå</span> –°–≤—è–∑—å —Å –≤–ª–∞–¥–µ–ª—å—Ü–µ–º';
            }
          }

          // –î–æ–±–∞–≤–ª—è–µ–º –∫–æ—Ç–∏–∫–æ–≤ –≤ –ø—É—Å—Ç—ã–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è
          const contestList = document.getElementById('contest-list');
          if (contestList && contestList.children.length === 0) {
            const emptyState = document.createElement('div');
            emptyState.className = 'text-center py-12';
            emptyState.innerHTML = `
              <div class="text-6xl mb-4" style="animation: kitty-float 2s ease-in-out infinite;">üê±</div>
              <div class="text-xl text-gray-400 mb-2">–ü–æ–∫–∞ –Ω–µ—Ç –∫–æ–Ω–∫—É—Ä—Å–æ–≤...</div>
              <div class="text-sm text-gray-500">üêæ –°–∫–æ—Ä–æ –ø–æ—è–≤—è—Ç—Å—è –Ω–æ–≤—ã–µ! üêæ</div>
            `;
            contestList.appendChild(emptyState);
          }

          const ratingList = document.getElementById('rating-list');
          if (ratingList) {
            const emptyText = ratingList.querySelector('.text-center');
            if (emptyText && emptyText.textContent.includes('–ó–∞–≥—Ä—É–∑–∫–∞')) {
              emptyText.innerHTML = '<div class="text-4xl mb-2" style="animation: kitty-bounce 1s ease-in-out infinite;">üê±</div><div>–ó–∞–≥—Ä—É–∑–∫–∞ —Ä–µ–π—Ç–∏–Ω–≥–∞...</div>';
            }
          }

          // –ó–∞–≥–æ–ª–æ–≤–∫–∏ –º–æ–¥–∞–ª—å–Ω—ã—Ö –æ–∫–æ–Ω
          const themeModalTitle = document.querySelector('#theme-selector-modal h3');
          if (themeModalTitle) {
            themeModalTitle.innerHTML = themeModalTitle.innerHTML.replace('üé®', 'üíù');
          }

          const contactModalTitle = document.querySelector('#contact-owner-modal h3');
          if (contactModalTitle) {
            contactModalTitle.innerHTML = contactModalTitle.innerHTML.replace('üì®', 'üíå');
          }

          // –ò–∫–æ–Ω–∫–∞ –æ–ø—ã—Ç–∞ (–∑–≤–µ–∑–¥–æ—á–∫–∞ —Ä—è–¥–æ–º —Å –±–µ–π–¥–∂–µ–º —É—Ä–æ–≤–Ω—è)
          const levelBadgeSection = document.querySelector('h3.flex.items-center.gap-2');
          if (levelBadgeSection) {
            const starIcon = levelBadgeSection.querySelector('.text-violet-400');
            if (starIcon && (starIcon.textContent.includes('‚≠ê') || starIcon.textContent.includes('üåü'))) {
              starIcon.textContent = 'üê±';
              starIcon.style.animation = 'kitty-bounce 1.5s ease-in-out infinite';
            }
          }

          // –ò–∫–æ–Ω–∫–∞ –æ–ø—ã—Ç–∞ (—Å—Ç–∞—Ä–∞—è –≤–µ—Ä—Å–∏—è –¥–ª—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏)
          const experienceIcon = document.querySelector('#experience-section .text-violet-400');
          if (experienceIcon && experienceIcon.textContent.includes('‚≠ê')) {
            experienceIcon.textContent = 'üíñ';
            experienceIcon.style.animation = 'kitty-heart 2s ease-in-out infinite';
          }

          // –ó–∞–≥–æ–ª–æ–≤–∫–∏ —Å–µ–∫—Ü–∏–π - –æ–¥–Ω–æ —ç–º–æ–¥–∑–∏ –∫–æ—Ç–∏–∫–∞
          const profileSection = document.querySelector('#profile-section h2');
          if (profileSection) {
            profileSection.innerHTML = 'üê± –ü—Ä–æ—Ñ–∏–ª—å';
          }

          const contestsSection = document.querySelector('#contests-section h2');
          if (contestsSection) {
            contestsSection.innerHTML = 'üéÅ –ö–æ–Ω–∫—É—Ä—Å—ã';
          }

          const ratingSection = document.querySelector('#rating-section h2');
          if (ratingSection) {
            ratingSection.innerHTML = 'üíñ –†–µ–π—Ç–∏–Ω–≥';
          }

        } else if (themeId === 'aot') {
          // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Ç–∏—Ç–∞–Ω–∞
          const titanImage = document.getElementById('aot-titan-image');
          if (titanImage) {
            titanImage.classList.remove('hidden');
          }

          // –ê–≤–∞—Ç–∞—Ä - –º–µ—á –∏–ª–∏ —ç–º–±–ª–µ–º–∞
          const avatarEl = document.getElementById('profile-avatar');
          if (avatarEl) {
            avatarEl.textContent = '‚öîÔ∏è';
          }

          // –ù–∞–≤–∏–≥–∞—Ü–∏—è - –¥–æ–±–∞–≤–ª—è–µ–º –∏–∫–æ–Ω–∫–∏ AoT —Ç–µ–º–∞—Ç–∏–∫–∏
          const profileBtn = document.querySelector('[data-section="profile-section"]');
          if (profileBtn) {
            profileBtn.innerHTML = '‚öîÔ∏è –ü—Ä–æ—Ñ–∏–ª—å';
          }

          const contestsBtn = document.querySelector('[data-section="contests-section"]');
          if (contestsBtn) {
            contestsBtn.innerHTML = 'üõ°Ô∏è –ö–æ–Ω–∫—É—Ä—Å—ã';
          }

          const ratingBtn = document.querySelector('[data-section="rating-section"]');
          if (ratingBtn) {
            ratingBtn.innerHTML = 'üèÜ –†–µ–π—Ç–∏–Ω–≥';
          }

          // –ö–Ω–æ–ø–∫–∞ —Å–º–µ–Ω—ã —Ç–µ–º—ã
          const changeThemeBtn = document.getElementById('change-theme-btn');
          if (changeThemeBtn) {
            changeThemeBtn.innerHTML = '‚öîÔ∏è –°–º–µ–Ω–∏—Ç—å —Ç–µ–º—É';
          }

          // –ö–Ω–æ–ø–∫–∞ —Å–≤—è–∑–∏ —Å –≤–ª–∞–¥–µ–ª—å—Ü–µ–º
          const contactBtn = document.getElementById('contact-owner-btn');
          if (contactBtn) {
            contactBtn.innerHTML = 'üì® –°–≤—è–∑—å —Å –≤–ª–∞–¥–µ–ª—å—Ü–µ–º';
          }

          // –ò–∫–æ–Ω–∫–∞ –æ–ø—ã—Ç–∞ (–º–µ—á —Ä—è–¥–æ–º —Å –±–µ–π–¥–∂–µ–º —É—Ä–æ–≤–Ω—è)
          const levelBadgeSection = document.querySelector('h3.flex.items-center.gap-2');
          if (levelBadgeSection) {
            const starIcon = levelBadgeSection.querySelector('.text-violet-400');
            if (starIcon) {
              starIcon.textContent = '‚öîÔ∏è';
              starIcon.style.animation = '';
            }
          }

          // –ó–∞–≥–æ–ª–æ–≤–∫–∏ —Å–µ–∫—Ü–∏–π
          const profileSection = document.querySelector('#profile-section h2');
          if (profileSection) {
            profileSection.innerHTML = '‚öîÔ∏è –ü—Ä–æ—Ñ–∏–ª—å';
          }

          const contestsSection = document.querySelector('#contests-section h2');
          if (contestsSection) {
            contestsSection.innerHTML = 'üõ°Ô∏è –ö–æ–Ω–∫—É—Ä—Å—ã';
          }

          const ratingSection = document.querySelector('#rating-section h2');
          if (ratingSection) {
            ratingSection.innerHTML = 'üèÜ –†–µ–π—Ç–∏–Ω–≥';
          }

        } else if (themeId === 'kurapika') {
          // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –ö—É—Ä–∞–ø–∏–∫–∏
          const kurapikaImage = document.getElementById('kurapika-image');
          if (kurapikaImage) {
            kurapikaImage.classList.remove('hidden');
          }

          // –ê–≤–∞—Ç–∞—Ä - —Ü–µ–ø—å –∏–ª–∏ —ç–º–±–ª–µ–º–∞
          const avatarEl = document.getElementById('profile-avatar');
          if (avatarEl) {
            avatarEl.textContent = 'üîó';
          }

          // –ù–∞–≤–∏–≥–∞—Ü–∏—è - –¥–æ–±–∞–≤–ª—è–µ–º –∏–∫–æ–Ω–∫–∏ Kurapika —Ç–µ–º–∞—Ç–∏–∫–∏
          const profileBtn = document.querySelector('[data-section="profile-section"]');
          if (profileBtn) {
            profileBtn.innerHTML = 'üîó –ü—Ä–æ—Ñ–∏–ª—å';
          }

          const contestsBtn = document.querySelector('[data-section="contests-section"]');
          if (contestsBtn) {
            contestsBtn.innerHTML = 'üèÜ –ö–æ–Ω–∫—É—Ä—Å—ã';
          }

          const ratingBtn = document.querySelector('[data-section="rating-section"]');
          if (ratingBtn) {
            ratingBtn.innerHTML = '‚≠ê –†–µ–π—Ç–∏–Ω–≥';
          }

          // –ö–Ω–æ–ø–∫–∞ —Å–º–µ–Ω—ã —Ç–µ–º—ã
          const changeThemeBtn = document.getElementById('change-theme-btn');
          if (changeThemeBtn) {
            changeThemeBtn.innerHTML = 'üîó –°–º–µ–Ω–∏—Ç—å —Ç–µ–º—É';
          }

          // –ö–Ω–æ–ø–∫–∞ —Å–≤—è–∑–∏ —Å –≤–ª–∞–¥–µ–ª—å—Ü–µ–º
          const contactBtn = document.getElementById('contact-owner-btn');
          if (contactBtn) {
            contactBtn.innerHTML = 'üì® –°–≤—è–∑—å —Å –≤–ª–∞–¥–µ–ª—å—Ü–µ–º';
          }

          // –ò–∫–æ–Ω–∫–∞ –æ–ø—ã—Ç–∞ (—Ü–µ–ø—å —Ä—è–¥–æ–º —Å –±–µ–π–¥–∂–µ–º —É—Ä–æ–≤–Ω—è)
          const levelBadgeSection = document.querySelector('h3.flex.items-center.gap-2');
          if (levelBadgeSection) {
            const starIcon = levelBadgeSection.querySelector('.text-violet-400');
            if (starIcon) {
              starIcon.textContent = 'üîó';
              starIcon.style.animation = '';
            }
          }

          // –ó–∞–≥–æ–ª–æ–≤–∫–∏ —Å–µ–∫—Ü–∏–π
          const profileSection = document.querySelector('#profile-section h2');
          if (profileSection) {
            profileSection.innerHTML = 'üîó –ü—Ä–æ—Ñ–∏–ª—å';
          }

          const contestsSection = document.querySelector('#contests-section h2');
          if (contestsSection) {
            contestsSection.innerHTML = 'üèÜ –ö–æ–Ω–∫—É—Ä—Å—ã';
          }

          const ratingSection = document.querySelector('#rating-section h2');
          if (ratingSection) {
            ratingSection.innerHTML = '‚≠ê –†–µ–π—Ç–∏–Ω–≥';
          }

          // –ú–æ–¥–∞–ª—å–Ω—ã–µ –æ–∫–Ω–∞ –∫–æ–Ω–∫—É—Ä—Å–æ–≤
          const drawingResultsTitle = document.querySelector('#drawing-results-modal h2');
          if (drawingResultsTitle) {
            drawingResultsTitle.innerHTML = drawingResultsTitle.innerHTML.replace('üèÜ', 'üéÅ');
          }

          const nftModalTitle = document.querySelector('#collection-links-modal h2');
          if (nftModalTitle) {
            nftModalTitle.innerHTML = nftModalTitle.innerHTML.replace('üñºÔ∏è', 'üíé');
          }

          // –ò—â–µ–º –≤—Å–µ –∑–∞–≥–æ–ª–æ–≤–∫–∏ —Å –∏–∫–æ–Ω–∫–∞–º–∏ –≤ –º–æ–¥–∞–ª—å–Ω—ã—Ö –æ–∫–Ω–∞—Ö
          document.querySelectorAll('h2').forEach(h2 => {
            if (h2.textContent.includes('üñºÔ∏è')) {
              h2.innerHTML = h2.innerHTML.replace('üñºÔ∏è', 'üíé');
            }
          });

        } else {
          // –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–∞—è —Ç–µ–º–∞ - –ø—Ä–∏–º–µ–Ω—è–µ–º —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ –∏–∫–æ–Ω–∫–∏
          // –°–∫—Ä—ã–≤–∞–µ–º –≤—Å–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è
          const titanImage = document.getElementById('aot-titan-image');
          if (titanImage) {
            titanImage.classList.add('hidden');
          }
          const kurapikaImage = document.getElementById('kurapika-image');
          if (kurapikaImage) {
            kurapikaImage.classList.add('hidden');
          }

          const avatarEl = document.getElementById('profile-avatar');
          if (avatarEl) {
            avatarEl.textContent = 'üë§';
          }

          const profileBtn = document.querySelector('[data-section="profile-section"]');
          if (profileBtn) {
            profileBtn.innerHTML = 'üë§ –ü—Ä–æ—Ñ–∏–ª—å';
          }

          const contestsBtn = document.querySelector('[data-section="contests-section"]');
          if (contestsBtn) {
            contestsBtn.innerHTML = 'üèÜ –ö–æ–Ω–∫—É—Ä—Å—ã';
          }

          const ratingBtn = document.querySelector('[data-section="rating-section"]');
          if (ratingBtn) {
            ratingBtn.innerHTML = '‚≠ê –†–µ–π—Ç–∏–Ω–≥';
          }

          const changeThemeBtn = document.getElementById('change-theme-btn');
          if (changeThemeBtn) {
            changeThemeBtn.innerHTML = 'üé® –°–º–µ–Ω–∏—Ç—å —Ç–µ–º—É';
          }

          const contactBtn = document.getElementById('contact-owner-btn');
          if (contactBtn) {
            contactBtn.innerHTML = 'üì® –°–≤—è–∑—å —Å –≤–ª–∞–¥–µ–ª—å—Ü–µ–º';
          }

          const themeModalTitle = document.querySelector('#theme-selector-modal h3');
          if (themeModalTitle) {
            themeModalTitle.innerHTML = themeModalTitle.innerHTML.replace(/[üíùüéÆ]/g, 'üé®');
          }

          const contactModalTitle = document.querySelector('#contact-owner-modal h3');
          if (contactModalTitle) {
            contactModalTitle.innerHTML = contactModalTitle.innerHTML.replace(/[üíåüìÆ]/g, 'üì®');
          }

          // –ò–∫–æ–Ω–∫–∞ –æ–ø—ã—Ç–∞ (–∑–≤–µ–∑–¥–æ—á–∫–∞ —Ä—è–¥–æ–º —Å –±–µ–π–¥–∂–µ–º —É—Ä–æ–≤–Ω—è)
          const levelBadgeSection = document.querySelector('h3.flex.items-center.gap-2');
          if (levelBadgeSection) {
            const starIcon = levelBadgeSection.querySelector('.text-violet-400');
            if (starIcon) {
              starIcon.textContent = '‚≠ê';
              starIcon.style.animation = '';
            }
          }

          const experienceIcon = document.querySelector('#experience-section .text-violet-400');
          if (experienceIcon) {
            experienceIcon.textContent = '‚≠ê';
            experienceIcon.style.animation = '';
          }

          // –ó–∞–≥–æ–ª–æ–≤–∫–∏ —Å–µ–∫—Ü–∏–π
          const profileSection = document.querySelector('#profile-section h2');
          if (profileSection) {
            profileSection.innerHTML = 'üë§ –ü—Ä–æ—Ñ–∏–ª—å';
          }

          const contestsSection = document.querySelector('#contests-section h2');
          if (contestsSection) {
            contestsSection.innerHTML = 'üèÜ –ö–æ–Ω–∫—É—Ä—Å—ã';
          }

          const ratingSection = document.querySelector('#rating-section h2');
          if (ratingSection) {
            ratingSection.innerHTML = '‚≠ê –†–µ–π—Ç–∏–Ω–≥';
          }

          const drawingResultsTitle = document.querySelector('#drawing-results-modal h2');
          if (drawingResultsTitle) {
            drawingResultsTitle.innerHTML = drawingResultsTitle.innerHTML.replace('üéÅ', 'üèÜ');
          }

          const nftModalTitle = document.querySelector('#collection-links-modal h2');
          if (nftModalTitle) {
            nftModalTitle.innerHTML = nftModalTitle.innerHTML.replace('üíé', 'üñºÔ∏è');
          }

          // –í–æ–∑–≤—Ä–∞—â–∞–µ–º –≤—Å–µ –∑–∞–≥–æ–ª–æ–≤–∫–∏ —Å –∏–∫–æ–Ω–∫–∞–º–∏ –≤ –º–æ–¥–∞–ª—å–Ω—ã—Ö –æ–∫–Ω–∞—Ö
          document.querySelectorAll('h2').forEach(h2 => {
            if (h2.textContent.includes('üíé')) {
              h2.innerHTML = h2.innerHTML.replace('üíé', 'üñºÔ∏è');
            }
          });
        }
      }

      // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞ –≤—ã–±–æ—Ä–∞ —Ç–µ–º—ã
      function initThemeSelector() {
        const themeModal = document.getElementById('theme-selector-modal');
        const changeThemeBtn = document.getElementById('change-theme-btn');
        const closeThemeModal = document.getElementById('close-theme-modal');
        const themesList = document.getElementById('themes-list');

        if (!themeModal || !changeThemeBtn || !closeThemeModal || !themesList) {
          console.error('–≠–ª–µ–º–µ–Ω—Ç—ã –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞ —Ç–µ–º—ã –Ω–µ –Ω–∞–π–¥–µ–Ω—ã');
          return;
        }

        // –ó–∞–ø–æ–ª–Ω—è–µ–º —Å–ø–∏—Å–æ–∫ —Ç–µ–º
        function renderThemes() {
          const currentTheme = localStorage.getItem('selectedTheme') || 'default';
          themesList.innerHTML = '';
          
          Object.values(themes).forEach(theme => {
            const isActive = theme.id === currentTheme;
            const themeCard = document.createElement('div');
            themeCard.className = `rounded-lg border p-4 cursor-pointer transition-all ${
              isActive 
                ? 'border-violet-400 bg-violet-500/20' 
                : 'border-violet-400/30 bg-black/30 hover:border-violet-400/50 hover:bg-black/40'
            }`;
            themeCard.innerHTML = `
              <div class="flex items-center justify-between">
                <div class="flex items-center gap-3">
                  <div class="text-3xl">${theme.icon}</div>
                  <div>
                    <div class="font-semibold text-white">${theme.name}</div>
                    <div class="text-sm text-gray-400">${theme.description}</div>
                  </div>
                </div>
                ${isActive ? '<div class="text-violet-400 text-xl">‚úì</div>' : ''}
              </div>
            `;
            
            themeCard.addEventListener('click', () => {
              applyTheme(theme.id);
              renderThemes(); // –û–±–Ω–æ–≤–ª—è–µ–º —Å–ø–∏—Å–æ–∫ –¥–ª—è –ø–æ–∫–∞–∑–∞ –∞–∫—Ç–∏–≤–Ω–æ–π —Ç–µ–º—ã
              setTimeout(() => {
                themeModal.classList.add('hidden');
                document.body.classList.remove('modal-open');
              }, 300);
            });
            
            themesList.appendChild(themeCard);
          });
        }

        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –æ—Ç–∫—Ä—ã—Ç–∏—è –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞
        changeThemeBtn.addEventListener('click', (e) => {
          e.preventDefault();
          e.stopPropagation();
          renderThemes();
          themeModal.classList.remove('hidden');
          document.body.classList.add('modal-open');
        });

        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∑–∞–∫—Ä—ã—Ç–∏—è –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞
        closeThemeModal.addEventListener('click', (e) => {
          e.preventDefault();
          e.stopPropagation();
          themeModal.classList.add('hidden');
          document.body.classList.remove('modal-open');
        });

        // –ó–∞–∫—Ä—ã—Ç–∏–µ –ø–æ –∫–ª–∏–∫—É –≤–Ω–µ –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞
        themeModal.addEventListener('click', (e) => {
          if (e.target === themeModal) {
            themeModal.classList.add('hidden');
            document.body.classList.remove('modal-open');
          }
        });
      }

      // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –ø–æ—Å–ª–µ –∑–∞–≥—Ä—É–∑–∫–∏ DOM
      function initElements() {
        spinner = document.getElementById('loading-spinner');
        topNav = document.getElementById('user-nav');
        main = document.querySelector('main');
        contentSections = document.querySelectorAll('.content-section');
        navButtons = topNav ? topNav.querySelectorAll('.nav-button') : [];

        console.log('üîß –≠–ª–µ–º–µ–Ω—Ç—ã –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω—ã:', {
          spinner: !!spinner,
          topNav: !!topNav,
          main: !!main,
          contentSections: contentSections.length,
          navButtons: navButtons.length
        });
      }

      function showSection(id) {
        console.log('üîß showSection –≤—ã–∑–≤–∞–Ω–∞ —Å id:', id);

        // –ü–æ–ª—É—á–∞–µ–º —ç–ª–µ–º–µ–Ω—Ç—ã –Ω–∞–ø—Ä—è–º—É—é –∏–∑ DOM
        const sections = document.querySelectorAll('.content-section');
        const nav = document.getElementById('user-nav');
        const buttons = nav ? nav.querySelectorAll('.nav-button') : [];

        if (sections.length === 0) {
          console.error('‚ùå –°–µ–∫—Ü–∏–∏ –∫–æ–Ω—Ç–µ–Ω—Ç–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã!');
          return;
        }

        console.log('üîß –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Å–µ–∫—Ü–∏—é:', id);
        sections.forEach(s => {
          const shouldShow = s.id === id;
          console.log(`üîß –°–µ–∫—Ü–∏—è ${s.id}: ${shouldShow ? '–ø–æ–∫–∞–∑—ã–≤–∞–µ–º' : '—Å–∫—Ä—ã–≤–∞–µ–º'}`);
          if (shouldShow) {
            s.classList.remove('hidden');
          } else {
            s.classList.add('hidden');
          }
        });

        // –û–±–Ω–æ–≤–ª—è–µ–º –∞–∫—Ç–∏–≤–Ω—É—é –∫–Ω–æ–ø–∫—É
        buttons.forEach(b => {
          const isActive = b.dataset.section === id;
          if (isActive) {
            b.classList.add('active');
          } else {
            b.classList.remove('active');
          }
        });

        console.log('‚úÖ showSection –∑–∞–≤–µ—Ä—à–µ–Ω–∞');
      }

      function hideSpinnerAndShowPanel() {
        console.log('üîÑ –°–∫—Ä—ã–≤–∞–µ–º —Å–ø–∏–Ω–Ω–µ—Ä –∏ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –ø–∞–Ω–µ–ª—å');

        try {
          // –ü–æ–ª—É—á–∞–µ–º —ç–ª–µ–º–µ–Ω—Ç—ã –∑–∞–Ω–æ–≤–æ, –Ω–∞ —Å–ª—É—á–∞–π –µ—Å–ª–∏ –æ–Ω–∏ –µ—â–µ –Ω–µ –±—ã–ª–∏ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω—ã
          if (!spinner) spinner = document.getElementById('loading-spinner');
          if (!topNav) topNav = document.getElementById('user-nav');
          if (!main) main = document.querySelector('main');

          if (spinner) {
            spinner.classList.add('hidden');
            spinner.style.display = 'none';
            spinner.style.visibility = 'hidden';
            spinner.style.opacity = '0';
            spinner.style.pointerEvents = 'none'; // –ö–†–ò–¢–ò–ß–ù–û: –æ—Ç–∫–ª—é—á–∞–µ–º pointer events
            spinner.style.zIndex = '-1'; // –£–±–∏—Ä–∞–µ–º –≤—ã—Å–æ–∫–∏–π z-index
            console.log('‚úÖ –°–ø–∏–Ω–Ω–µ—Ä —Å–∫—Ä—ã—Ç –∏ pointer-events –æ—Ç–∫–ª—é—á–µ–Ω—ã');
          } else {
            console.error('‚ùå –≠–ª–µ–º–µ–Ω—Ç spinner –Ω–µ –Ω–∞–π–¥–µ–Ω!');
          }

          if (topNav) {
            topNav.classList.remove('hidden');
            topNav.style.display = 'flex';
            topNav.style.visibility = 'visible';
            topNav.style.pointerEvents = 'auto'; // –í–∫–ª—é—á–∞–µ–º –∫–ª–∏–∫–∏
            topNav.style.zIndex = '10';
            console.log('‚úÖ –ù–∞–≤–∏–≥–∞—Ü–∏—è –ø–æ–∫–∞–∑–∞–Ω–∞, pointer-events –≤–∫–ª—é—á–µ–Ω—ã');
          } else {
            console.error('‚ùå –≠–ª–µ–º–µ–Ω—Ç topNav –Ω–µ –Ω–∞–π–¥–µ–Ω!');
          }

          if (main) {
            main.classList.remove('hidden');
            main.style.display = 'block';
            main.style.visibility = 'visible';
            main.style.pointerEvents = 'auto'; // –í–∫–ª—é—á–∞–µ–º –∫–ª–∏–∫–∏
            console.log('‚úÖ –û—Å–Ω–æ–≤–Ω–æ–π –∫–æ–Ω—Ç–µ–Ω—Ç –ø–æ–∫–∞–∑–∞–Ω, pointer-events –≤–∫–ª—é—á–µ–Ω—ã');
          } else {
            console.error('‚ùå –≠–ª–µ–º–µ–Ω—Ç main –Ω–µ –Ω–∞–π–¥–µ–Ω!');
          }

          console.log('‚úÖ –ü–∞–Ω–µ–ª—å –ø–æ–ª–Ω–æ—Å—Ç—å—é –ø–æ–∫–∞–∑–∞–Ω–∞');
        } catch (error) {
          console.error('‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–∫—Ä—ã—Ç–∏–∏ —Å–ø–∏–Ω–Ω–µ—Ä–∞:', error);
          // –ü—ã—Ç–∞–µ–º—Å—è —Å–∫—Ä—ã—Ç—å —Å–ø–∏–Ω–Ω–µ—Ä –Ω–∞–ø—Ä—è–º—É—é —á–µ—Ä–µ–∑ style, –µ—Å–ª–∏ –∫–ª–∞—Å—Å—ã –Ω–µ —Ä–∞–±–æ—Ç–∞—é—Ç
          if (spinner) {
            spinner.style.display = 'none';
            spinner.style.visibility = 'hidden';
            spinner.style.opacity = '0';
            spinner.style.pointerEvents = 'none';
          }
        }
      }

      // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –∑–∞–≥—Ä—É–∂–µ–Ω –ª–∏ DOM —Å—Ä–∞–∑—É
      console.log('üöÄ –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ—Å—Ç–æ—è–Ω–∏—è DOM –¥–æ DOMContentLoaded:', {
        readyState: document.readyState,
        bodyExists: !!document.body,
        spinnerExists: !!document.getElementById('loading-spinner')
      });

      // –í–ê–ñ–ù–û: initUserPage –±—É–¥–µ—Ç –≤—ã–∑–≤–∞–Ω–∞ –ü–û–°–õ–ï –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –≤—Å–µ—Ö —Ñ—É–Ω–∫—Ü–∏–π
      // –§—É–Ω–∫—Ü–∏–∏ –æ–ø—Ä–µ–¥–µ–ª—è—é—Ç—Å—è —Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ, –ø–æ—ç—Ç–æ–º—É –º—ã –º–æ–∂–µ–º –≤—ã–∑–≤–∞—Ç—å initUserPage —Å—Ä–∞–∑—É –ø–æ—Å–ª–µ –∏—Ö –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è
      // –ù–æ –¥–ª—è –Ω–∞–¥–µ–∂–Ω–æ—Å—Ç–∏ –¥–æ–±–∞–≤–∏–º –Ω–µ–±–æ–ª—å—à—É—é –∑–∞–¥–µ—Ä–∂–∫—É
      function startInit() {
        if (document.readyState === 'loading') {
          console.log('üöÄ DOM –µ—â–µ –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è, –∂–¥–µ–º DOMContentLoaded');
          document.addEventListener('DOMContentLoaded', () => {
            setTimeout(initUserPage, 50); // –ù–µ–±–æ–ª—å—à–∞—è –∑–∞–¥–µ—Ä–∂–∫–∞ –¥–ª—è –≥–∞—Ä–∞–Ω—Ç–∏–∏
          });
        } else {
          console.log('üöÄ DOM —É–∂–µ –∑–∞–≥—Ä—É–∂–µ–Ω, –∑–∞–ø—É—Å–∫–∞–µ–º —Å—Ä–∞–∑—É');
          setTimeout(initUserPage, 50); // –ù–µ–±–æ–ª—å—à–∞—è –∑–∞–¥–µ—Ä–∂–∫–∞ –¥–ª—è –≥–∞—Ä–∞–Ω—Ç–∏–∏
        }
      }

      function initUserPage() {
        console.log('üöÄ ========== –ù–ê–ß–ê–õ–û –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–ò USER.HTML ==========');
        console.log('üöÄ DOMContentLoaded - –Ω–∞—á–∞–ª–æ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ user.html');

        // –ü–†–û–í–ï–†–Ø–ï–ú –î–û–°–¢–£–ü–ù–û–°–¢–¨ –§–£–ù–ö–¶–ò–ô
        console.log('üîç –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ —Ñ—É–Ω–∫—Ü–∏–π:', {
          'window.fetchJSON': typeof window.fetchJSON,
          'window.loadContests': typeof window.loadContests,
          'window.loadProfile': typeof window.loadProfile,
          'initContestList': typeof initContestList,
          'extractChannelFromPostLink': typeof extractChannelFromPostLink
        });

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º —ç–ª–µ–º–µ–Ω—Ç—ã –î–û –≤—Å–µ–≥–æ –æ—Å—Ç–∞–ª—å–Ω–æ–≥–æ
        initElements();

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º contestList
        if (typeof initContestList === 'function') {
          initContestList();
        } else {
          contestList = document.getElementById('contest-list');
        }

        console.log('–≠–ª–µ–º–µ–Ω—Ç—ã –Ω–∞–π–¥–µ–Ω—ã:', {
          spinner: !!spinner,
          topNav: !!topNav,
          main: !!main,
          contentSections: contentSections.length,
          navButtons: navButtons.length,
          contestList: !!contestList
        });

        // –î–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –∏—Å–ø–æ–ª—å–∑—É–µ–º –¥–µ—Ñ–æ–ª—Ç–Ω—ã–π ID (–Ω–µ —Ç—Ä–µ–±—É–µ—Ç—Å—è tg_id –∏–∑ URL)
        const params = new URLSearchParams(window.location.search);
        const tgId = params.get('tg_id') || '123456789'; // –î–µ—Ñ–æ–ª—Ç–Ω—ã–π ID –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

        // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º currentUserId
        currentUserId = parseInt(tgId);
        window.currentUserId = currentUserId;
        console.log('‚úÖ currentUserId —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω (—Ç–µ—Å—Ç–æ–≤—ã–π —Ä–µ–∂–∏–º):', currentUserId);

        // –ù–ê–°–¢–û–Ø–©–ï–ï –°–ö–†–´–¢–ò–ï –°–ü–ò–ù–ù–ï–†–ê - –í–´–ü–û–õ–ù–Ø–ï–ú –°–†–ê–ó–£
        console.log('üîÑ –°–∫—Ä—ã–≤–∞–µ–º —Å–ø–∏–Ω–Ω–µ—Ä –ù–ï–ú–ï–î–õ–ï–ù–ù–û');
        hideSpinnerAndShowPanel();

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º –Ω–∞–≤–∏–≥–∞—Ü–∏—é - –ü–†–û–°–¢–ê–Ø –õ–û–ì–ò–ö–ê
        console.log('üîò –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –Ω–∞–≤–∏–≥–∞—Ü–∏–∏');

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è —É—Å—Ç–∞–Ω–æ–≤–∫–∏ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤ –Ω–∞–≤–∏–≥–∞—Ü–∏–∏
        function setupNavigation() {
          const nav = document.getElementById('user-nav');
          if (!nav) {
            console.error('‚ùå –ù–∞–≤–∏–≥–∞—Ü–∏—è –Ω–µ –Ω–∞–π–¥–µ–Ω–∞!');
            return;
          }

          const buttons = nav.querySelectorAll('.nav-button');
          const sections = document.querySelectorAll('.content-section');

          console.log('üîò –ù–∞–π–¥–µ–Ω–æ –∫–Ω–æ–ø–æ–∫:', buttons.length, '—Å–µ–∫—Ü–∏–π:', sections.length);

          // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –¥–ª—è –∫–∞–∂–¥–æ–π –∫–Ω–æ–ø–∫–∏
          buttons.forEach((btn) => {
            // –£–¥–∞–ª—è–µ–º —Å—Ç–∞—Ä—ã–µ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —á–µ—Ä–µ–∑ –∫–ª–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ
            const newBtn = btn.cloneNode(true);
            btn.parentNode.replaceChild(newBtn, btn);

            console.log('üîò –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –Ω–∞ –∫–Ω–æ–ø–∫—É:', newBtn.dataset.section);

            // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–ª–∏–∫–∞
            newBtn.addEventListener('click', function(e) {
              e.preventDefault();
              e.stopPropagation();

              const sectionId = this.dataset.section;
              console.log('‚úÖ‚úÖ‚úÖ –ö–õ–ò–ö –ü–û –ö–ù–û–ü–ö–ï:', sectionId);

              // –û–±–Ω–æ–≤–ª—è–µ–º –∞–∫—Ç–∏–≤–Ω—É—é –∫–Ω–æ–ø–∫—É (–∏—Å–ø–æ–ª—å–∑—É–µ–º –≤—Å–µ –∫–Ω–æ–ø–∫–∏ –∏–∑ –Ω–∞–≤–∏–≥–∞—Ü–∏–∏)
              const allButtons = nav.querySelectorAll('.nav-button');
              allButtons.forEach(b => {
                if (b.dataset.section === sectionId) {
                  b.classList.add('active');
                } else {
                  b.classList.remove('active');
                }
              });

              // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º/—Å–∫—Ä—ã–≤–∞–µ–º —Å–µ–∫—Ü–∏–∏
              sections.forEach(sec => {
                if (sec.id === sectionId) {
                  console.log('‚úÖ –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Å–µ–∫—Ü–∏—é:', sec.id);
                  sec.classList.remove('hidden');

                  // –ï—Å–ª–∏ —ç—Ç–æ —Å–µ–∫—Ü–∏—è –∫–æ–Ω–∫—É—Ä—Å–æ–≤, –æ–±–Ω–æ–≤–ª—è–µ–º —Å–ø–∏—Å–æ–∫
                  if (sec.id === 'contests-section') {
                    setTimeout(async () => {
                      console.log('üì• –ó–∞–≥—Ä—É–∂–∞–µ–º –∫–æ–Ω–∫—É—Ä—Å—ã –ø—Ä–∏ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–∏ –Ω–∞ —Å–µ–∫—Ü–∏—é');
                      if (typeof window.loadContests === 'function') {
                        await window.loadContests(true);
                      } else {
                        console.error('‚ùå window.loadContests –Ω–µ –Ω–∞–π–¥–µ–Ω–∞!');
                      }
                    }, 100);
                  }

                  // –ï—Å–ª–∏ —ç—Ç–æ —Å–µ–∫—Ü–∏—è –ø—Ä–æ—Ñ–∏–ª—è, –∑–∞–≥—Ä—É–∂–∞–µ–º –ø—Ä–æ—Ñ–∏–ª—å
                  if (sec.id === 'profile-section') {
                    setTimeout(async () => {
                      console.log('üì• –ó–∞–≥—Ä—É–∂–∞–µ–º –ø—Ä–æ—Ñ–∏–ª—å –ø—Ä–∏ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–∏ –Ω–∞ —Å–µ–∫—Ü–∏—é');
                      if (typeof window.loadProfile === 'function') {
                        await window.loadProfile();
                      } else {
                        console.error('‚ùå window.loadProfile –Ω–µ –Ω–∞–π–¥–µ–Ω–∞!');
                      }
                    }, 100);
                  }
                  
                  // –ï—Å–ª–∏ —ç—Ç–æ —Å–µ–∫—Ü–∏—è —Ä–µ–π—Ç–∏–Ω–≥–∞, –∑–∞–≥—Ä—É–∂–∞–µ–º —Ä–µ–π—Ç–∏–Ω–≥
                  if (sec.id === 'rating-section') {
                    setTimeout(async () => {
                      console.log('üì• –ó–∞–≥—Ä—É–∂–∞–µ–º —Ä–µ–π—Ç–∏–Ω–≥ –ø—Ä–∏ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–∏ –Ω–∞ —Å–µ–∫—Ü–∏—é');
                      if (typeof window.loadRating === 'function') {
                        await window.loadRating(currentRatingRole || 'user');
                      } else {
                        console.error('‚ùå window.loadRating –Ω–µ –Ω–∞–π–¥–µ–Ω–∞!');
                      }
                    }, 100);
                  }
                } else {
                  console.log('‚ùå –°–∫—Ä—ã–≤–∞–µ–º —Å–µ–∫—Ü–∏—é:', sec.id);
                  sec.classList.add('hidden');
                }
              });

              console.log('‚úÖ –°–µ–∫—Ü–∏—è', sectionId, '–ø–æ–∫–∞–∑–∞–Ω–∞ —É—Å–ø–µ—à–Ω–æ');
            });

            // –£–±–µ–∂–¥–∞–µ–º—Å—è, —á—Ç–æ –∫–Ω–æ–ø–∫–∏ –∫–ª–∏–∫–∞–±–µ–ª—å–Ω—ã
            newBtn.style.pointerEvents = 'auto';
            newBtn.style.cursor = 'pointer';
          });

          console.log('‚úÖ –ù–∞–≤–∏–≥–∞—Ü–∏—è –ø–æ–ª–Ω–æ—Å—Ç—å—é –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–∞');
        }

        // –ó–∞–≥—Ä—É–∂–∞–µ–º —Ç–µ–º—É —Å—Ä–∞–∑—É –ø—Ä–∏ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏
        loadTheme();
        
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º –Ω–∞–≤–∏–≥–∞—Ü–∏—é –ø–æ—Å–ª–µ –ø–æ–∫–∞–∑–∞ –ø–∞–Ω–µ–ª–∏ (–Ω–µ–±–æ–ª—å—à–∞—è –∑–∞–¥–µ—Ä–∂–∫–∞ –¥–ª—è –≥–∞—Ä–∞–Ω—Ç–∏–∏ –≤–∏–¥–∏–º–æ—Å—Ç–∏)
        setTimeout(() => {
          setupNavigation();
          setupContactOwnerHandlers();
          initThemeSelector();

          // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Å–µ–∫—Ü–∏—é –∫–æ–Ω–∫—É—Ä—Å–æ–≤ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
          console.log('üîò –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Å–µ–∫—Ü–∏—é –∫–æ–Ω–∫—É—Ä—Å–æ–≤ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é');
          // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Å–µ–∫—Ü–∏—é –Ω–∞–ø—Ä—è–º—É—é
          const contestsSection = document.getElementById('contests-section');
          const profileSection = document.getElementById('profile-section');
          if (contestsSection) {
            contestsSection.classList.remove('hidden');
            // –ó–∞–≥—Ä—É–∂–∞–µ–º –∫–æ–Ω–∫—É—Ä—Å—ã
            setTimeout(async () => {
              if (typeof window.loadContests === 'function') {
                await window.loadContests();
              }
            }, 100);
          }
          if (profileSection) {
            profileSection.classList.add('hidden');
          }
        }, 100);

        // –¢–µ—Å—Ç–æ–≤—ã–π —Ä–µ–∂–∏–º - —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –¥–µ—Ñ–æ–ª—Ç–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è
        const usernameEl = document.getElementById('profile-username');
        if (usernameEl) {
          usernameEl.textContent = 'TestUser';
        }
        const profileIdEl = document.getElementById('profile-id');
        if (profileIdEl) {
          profileIdEl.textContent = currentUserId || '123456789';
        }

        // –ó–∞–≥—Ä—É–∂–∞–µ–º –∫–æ–Ω–∫—É—Ä—Å—ã —Å—Ä–∞–∑—É –ø–æ—Å–ª–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ (–∫–∞–∫ –≤ creator.html)
        console.log('üì• –ù–∞—á–∏–Ω–∞–µ–º –∑–∞–≥—Ä—É–∑–∫—É –∫–æ–Ω–∫—É—Ä—Å–æ–≤...');
        setTimeout(async () => {
          try {
            if (typeof window.loadContests === 'function') {
              console.log('üì• –í—ã–∑—ã–≤–∞–µ–º window.loadContests()...');
              await window.loadContests();
              console.log('‚úÖ –ö–æ–Ω–∫—É—Ä—Å—ã –∑–∞–≥—Ä—É–∂–µ–Ω—ã');
            } else {
              console.error('‚ùå –§—É–Ω–∫—Ü–∏—è window.loadContests –Ω–µ –Ω–∞–π–¥–µ–Ω–∞!');
            }
          } catch (error) {
            console.error('‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∫–æ–Ω–∫—É—Ä—Å–æ–≤:', error);
          }
        }, 200);

        // –ó–∞–≥—Ä—É–∂–∞–µ–º –ø—Ä–æ—Ñ–∏–ª—å
        setTimeout(async () => {
          try {
            if (typeof window.loadProfile === 'function') {
              await window.loadProfile();
              console.log('‚úÖ –ü—Ä–æ—Ñ–∏–ª—å –∑–∞–≥—Ä—É–∂–µ–Ω');
            } else {
              console.error('‚ùå –§—É–Ω–∫—Ü–∏—è window.loadProfile –Ω–µ –Ω–∞–π–¥–µ–Ω–∞!');
            }
          } catch (error) {
            console.error('‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –ø—Ä–æ—Ñ–∏–ª—è:', error);
          }
        }, 200);

        console.log('‚úÖ –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∑–∞–≤–µ—Ä—à–µ–Ω–∞');

        // –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–π fallback - —Å–∫—Ä—ã–≤–∞–µ–º —Å–ø–∏–Ω–Ω–µ—Ä —á–µ—Ä–µ–∑ 500ms –≤ –ª—é–±–æ–º —Å–ª—É—á–∞–µ
        setTimeout(() => {
          if (spinner && spinner.style.display !== 'none') {
            console.warn('‚ö†Ô∏è Fallback: –ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ —Å–∫—Ä—ã–≤–∞–µ–º —Å–ø–∏–Ω–Ω–µ—Ä');
            hideSpinnerAndShowPanel();
          }
        }, 500);

        // –û–±–Ω–æ–≤–ª—è–µ–º –ø—Ä–∏ –≤–æ–∑–≤—Ä–∞—Ç–µ —Ñ–æ–∫—É—Å–∞ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É
        let lastVisibilityChange = Date.now();
        document.addEventListener('visibilitychange', async () => {
          if (!document.hidden) {
            const now = Date.now();
            if (now - lastVisibilityChange > 5000) {
              const contestsSection = document.getElementById('contests-section');
              if (contestsSection && !contestsSection.classList.contains('hidden')) {
                if (typeof window.loadContests === 'function') {
                  await window.loadContests(true);
                }
              }
              lastVisibilityChange = now;
            }
          }
        });

        // –õ–µ–≥–∫–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –∏–∑–º–µ–Ω–µ–Ω–∏–π –∫–æ–Ω–∫—É—Ä—Å–æ–≤
        let lastContestIds = null;
        const checkForChanges = async () => {
          try {
            const contestsSection = document.getElementById('contests-section');
            if (!contestsSection || contestsSection.classList.contains('hidden')) {
              return;
            }
            const items = await window.fetchJSON('/api/contests');
            const currentIds = items.map(c => c.id.toString()).sort().join(',');
            if (lastContestIds !== null && lastContestIds !== currentIds) {
              if (typeof window.loadContests === 'function') {
                await window.loadContests(true);
              }
            }
            lastContestIds = currentIds;
          } catch (error) {
            console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø—Ä–æ–≤–µ—Ä–∫–µ –∏–∑–º–µ–Ω–µ–Ω–∏–π –∫–æ–Ω–∫—É—Ä—Å–æ–≤:', error);
          }
        };
        setInterval(checkForChanges, 10000);
      }

      // –≠–∫—Å–ø–æ—Ä—Ç–∏—Ä—É–µ–º —Ñ—É–Ω–∫—Ü–∏—é –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏
      window.initUserPage = initUserPage;

      // –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ —á–µ—Ä–µ–∑ –Ω–µ–∫–æ—Ç–æ—Ä–æ–µ –≤—Ä–µ–º—è (fallback)
    setTimeout(() => {
      console.log('üöÄ Fallback –ø—Ä–æ–≤–µ—Ä–∫–∞ —á–µ—Ä–µ–∑ 2 —Å–µ–∫—É–Ω–¥—ã –ø–æ—Å–ª–µ –∑–∞–≥—Ä—É–∑–∫–∏ —Å–∫—Ä–∏–ø—Ç–∞');
      const spinner = document.getElementById('loading-spinner');
      const nav = document.getElementById('user-nav');
      const main = document.querySelector('main');

      // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –≤–∏–¥–µ–Ω –ª–∏ —Å–ø–∏–Ω–Ω–µ—Ä (—á–µ—Ä–µ–∑ computed style)
      if (spinner) {
        const spinnerStyle = window.getComputedStyle(spinner);
        const isSpinnerVisible = spinnerStyle.display !== 'none' &&
                                 spinnerStyle.visibility !== 'hidden' &&
                                 spinner.offsetParent !== null;

        if (isSpinnerVisible) {
          console.warn('‚ö†Ô∏è –°–ø–∏–Ω–Ω–µ—Ä –≤—Å–µ –µ—â–µ –≤–∏–¥–µ–Ω —á–µ—Ä–µ–∑ 2 —Å–µ–∫—É–Ω–¥—ã, –ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ —Å–∫—Ä—ã–≤–∞–µ–º —á–µ—Ä–µ–∑ fallback');
          spinner.style.setProperty('display', 'none', 'important');
          spinner.style.setProperty('visibility', 'hidden', 'important');
          spinner.style.setProperty('opacity', '0', 'important');
          spinner.style.setProperty('z-index', '-1', 'important');
          spinner.classList.add('hidden');

          // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –Ω–∞–≤–∏–≥–∞—Ü–∏—é –∏ –∫–æ–Ω—Ç–µ–Ω—Ç
          if (nav) {
            nav.classList.remove('hidden');
            nav.style.setProperty('display', 'flex', 'important');
            nav.style.setProperty('visibility', 'visible', 'important');
            nav.style.setProperty('opacity', '1', 'important');
            nav.style.setProperty('pointer-events', 'auto', 'important');
          }
          if (main) {
            main.classList.remove('hidden');
            main.style.setProperty('display', 'block', 'important');
            main.style.setProperty('visibility', 'visible', 'important');
            main.style.setProperty('opacity', '1', 'important');
            main.style.setProperty('pointer-events', 'auto', 'important');
          }

          console.log('‚úÖ –°–ø–∏–Ω–Ω–µ—Ä –ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ —Å–∫—Ä—ã—Ç —á–µ—Ä–µ–∑ fallback –ø—Ä–æ–≤–µ—Ä–∫—É');
          console.log('‚ö†Ô∏è –ï—Å–ª–∏ –∫–Ω–æ–ø–∫–∏ –Ω–µ —Ä–∞–±–æ—Ç–∞—é—Ç, –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏—Ç–µ —Å—Ç—Ä–∞–Ω–∏—Ü—É');
        } else {
          console.log('‚úÖ –°–ø–∏–Ω–Ω–µ—Ä —É–∂–µ —Å–∫—Ä—ã—Ç, –≤—Å–µ –≤ –ø–æ—Ä—è–¥–∫–µ');
        }
      }
    }, 2000);

    console.log('üöÄ ========== –ö–û–ù–ï–¶ –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–ò –°–ö–†–ò–ü–¢–ê ==========');

      window.loadContests = async function(silentUpdate = false) {
        // –£–±–µ–∂–¥–∞–µ–º—Å—è, —á—Ç–æ contestList –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω
        if (!contestList) {
          contestList = initContestList();
        }
        
        if (!contestList) {
          console.error('‚ùå contestList –Ω–µ –Ω–∞–π–¥–µ–Ω!');
          return;
        }
        try {
          const items = await window.fetchJSON('/api/contests');
          
          // –î–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –¥–æ–±–∞–≤–ª—è–µ–º –±–æ–ª—å—à–µ –¥–∞–Ω–Ω—ã—Ö –µ—Å–ª–∏ –Ω—É–∂–Ω–æ
          if (items.length === 0) {
            console.log('‚ö†Ô∏è –ù–µ—Ç –∫–æ–Ω–∫—É—Ä—Å–æ–≤, –∏—Å–ø–æ–ª—å–∑—É–µ–º —Ç–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ');
          }

        // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –ø—É—Å—Ç –ª–∏ —Å–ø–∏—Å–æ–∫ (–ø–µ—Ä–≤–∞—è –∑–∞–≥—Ä—É–∑–∫–∞)
        const isFirstLoad = contestList.children.length === 0 ||
                           contestList.innerHTML.includes('–ù–µ—Ç –∞–∫—Ç–∏–≤–Ω—ã—Ö –∫–æ–Ω–∫—É—Ä—Å–æ–≤') ||
                           contestList.innerHTML.includes('–û—à–∏–±–∫–∞');

        // –ï—Å–ª–∏ —ç—Ç–æ –ø–µ—Ä–≤–∞—è –∑–∞–≥—Ä—É–∑–∫–∞, –æ—á–∏—â–∞–µ–º —Å–ø–∏—Å–æ–∫ –ø–æ–ª–Ω–æ—Å—Ç—å—é
        if (isFirstLoad && !silentUpdate) {
          contestList.innerHTML = '';
        }

        // –ï—Å–ª–∏ –Ω–µ—Ç –∫–æ–Ω–∫—É—Ä—Å–æ–≤ –∏ —Å–ø–∏—Å–æ–∫ –ø—É—Å—Ç, –ø–æ–∫–∞–∑—ã–≤–∞–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ
        if (items.length === 0) {
          // –£–¥–∞–ª—è–µ–º –≤—Å–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –∫–∞—Ä—Ç–æ—á–∫–∏ —Å –∞–Ω–∏–º–∞—Ü–∏–µ–π
          const allCards = Array.from(contestList.children);
          allCards.forEach(card => {
            if (card.dataset.contestId) {
              card.style.transition = 'opacity 0.5s ease-out, transform 0.5s ease-out';
              card.style.opacity = '0';
              card.style.transform = 'translateX(-100%)';
              setTimeout(() => {
                if (card.parentNode) {
                  card.parentNode.removeChild(card);
                }
              }, 500);
            }
          });

          // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ –ø–æ—Å–ª–µ –∞–Ω–∏–º–∞—Ü–∏–∏ —É–¥–∞–ª–µ–Ω–∏—è
          setTimeout(() => {
            if (contestList.children.length === 0) {
              contestList.innerHTML = '<div class="text-gray-500 text-center py-4">–ù–µ—Ç –∞–∫—Ç–∏–≤–Ω—ã—Ö –∫–æ–Ω–∫—É—Ä—Å–æ–≤</div>';
            }
          }, 600);
          return;
        }

        // –ï—Å–ª–∏ —Å–ø–∏—Å–æ–∫ –±—ã–ª –ø—É—Å—Ç, –æ—á–∏—â–∞–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ
        if (contestList.innerHTML.includes('–ù–µ—Ç –∞–∫—Ç–∏–≤–Ω—ã—Ö –∫–æ–Ω–∫—É—Ä—Å–æ–≤')) {
          contestList.innerHTML = '';
        }

        // –°–æ—Ö—Ä–∞–Ω—è–µ–º —Ç–µ–∫—É—â–∏–µ ID –∫–æ–Ω–∫—É—Ä—Å–æ–≤ –¥–ª—è —Å—Ä–∞–≤–Ω–µ–Ω–∏—è
        const currentContestIds = new Set(
          Array.from(contestList.children)
            .map(card => card.dataset.contestId)
            .filter(id => id)
        );

        const newContestIds = new Set(items.map(c => c.id.toString()));

        // –£–¥–∞–ª—è–µ–º –∫–æ–Ω–∫—É—Ä—Å—ã, –∫–æ—Ç–æ—Ä—ã—Ö –±–æ–ª—å—à–µ –Ω–µ—Ç (—Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ —ç—Ç–æ –Ω–µ –ø–µ—Ä–≤–∞—è –∑–∞–≥—Ä—É–∑–∫–∞)
        if (!isFirstLoad) {
          const contestsToRemove = Array.from(contestList.children).filter(card => {
            const contestId = card.dataset.contestId;
            return contestId && !newContestIds.has(contestId);
          });

          // –ê–Ω–∏–º–∏—Ä—É–µ–º —É–¥–∞–ª–µ–Ω–∏–µ –∫–æ–Ω–∫—É—Ä—Å–æ–≤
          contestsToRemove.forEach(card => {
            card.style.transition = 'opacity 0.5s ease-out, transform 0.5s ease-out';
            card.style.opacity = '0';
            card.style.transform = 'translateX(-100%)';
            setTimeout(() => {
              if (card.parentNode) {
                card.parentNode.removeChild(card);
              }
            }, 500);
          });
        }

        // –ó–∞–≥—Ä—É–∂–∞–µ–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤ –¥–ª—è –≤—Å–µ—Ö –∫–æ–Ω–∫—É—Ä—Å–æ–≤ –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ
        const participantsPromises = items.map(c =>
          window.fetchJSON(`/api/contests/${c.id}/participants-count`).catch(e => {
            console.error(`–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤ –¥–ª—è –∫–æ–Ω–∫—É—Ä—Å–∞ ${c.id}:`, e);
            return { count: 0 };
          })
        );
        const participantsResults = await Promise.all(participantsPromises);

        // –ó–∞–≥—Ä—É–∂–∞–µ–º –ø–æ–±–µ–¥–∏—Ç–µ–ª–µ–π –¥–ª—è –≤—Å–µ—Ö –∫–æ–Ω–∫—É—Ä—Å–æ–≤ –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ
        const winnersPromises = items.map(c =>
          window.fetchJSON(`/api/contests/${c.id}/winners`).catch(e => {
            console.error(`–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –ø–æ–±–µ–¥–∏—Ç–µ–ª–µ–π –¥–ª—è –∫–æ–Ω–∫—É—Ä—Å–∞ ${c.id}:`, e);
            return { winners: [], is_confirmed: false };
          })
        );
        const winnersResults = await Promise.all(winnersPromises);

        items.forEach((c, index) => {
          const participantsCount = participantsResults[index]?.count || 0;
          const winnersData = winnersResults[index];

          // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –ª–∏ —É–∂–µ –∫–∞—Ä—Ç–æ—á–∫–∞ –¥–ª—è —ç—Ç–æ–≥–æ –∫–æ–Ω–∫—É—Ä—Å–∞
          const existingCard = contestList.querySelector(`[data-contest-id="${c.id}"]`);
          if (existingCard && silentUpdate) {
            // –ï—Å–ª–∏ –∫–∞—Ä—Ç–æ—á–∫–∞ —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –∏ —ç—Ç–æ —Ç–∏—Ö–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ, –ø—Ä–æ–ø—É—Å–∫–∞–µ–º
            return;
          }

          // –ï—Å–ª–∏ –∫–∞—Ä—Ç–æ—á–∫–∞ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç, –Ω–æ —ç—Ç–æ –Ω–µ —Ç–∏—Ö–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ, —É–¥–∞–ª—è–µ–º –µ—ë –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è
          if (existingCard) {
            existingCard.remove();
          }

          const card = document.createElement('div');
          card.className = 'rounded-lg border border-violet-400/30 p-4 bg-black/30';
          card.dataset.contestId = c.id; // –°–æ—Ö—Ä–∞–Ω—è–µ–º ID –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è
          card.style.opacity = '0';
          card.style.transform = 'translateY(-20px)';
          card.style.transition = 'opacity 0.3s ease-in, transform 0.3s ease-in';

          const postLink = c.post_link || '';
          const channelUsername = extractChannelFromPostLink(postLink);
          const channelDisplay = channelUsername ? `@${channelUsername}` : '–ù–µ —É–∫–∞–∑–∞–Ω';

          // –ü–æ–ª—É—á–∞–µ–º –Ω–∞–∑–≤–∞–Ω–∏–µ –∫–æ–Ω–∫—É—Ä—Å–∞
          const contestTitle = c.title || c.name || '–ö–æ–Ω–∫—É—Ä—Å';

          // –û–ø—Ä–µ–¥–µ–ª—è–µ–º —Ç–∏–ø –∫–æ–Ω–∫—É—Ä—Å–∞
          const contestType = c.contest_type || 'random_comment';
          const isDrawingContest = contestType === 'drawing';
          const isCollectionContest = contestType === 'collection';

          // –û—Ç–æ–±—Ä–∞–∂–∞–µ–º –ø—Ä–∏–∑—ã (–º–∞–∫—Å–∏–º—É–º 3, –Ω–æ –µ—Å–ª–∏ –º–µ–Ω—å—à–µ - –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –≤—Å–µ)
          let prizesHtml = '';
          // –ù–æ—Ä–º–∞–ª–∏–∑—É–µ–º prize_links: —É–±–µ–∂–¥–∞–µ–º—Å—è —á—Ç–æ —ç—Ç–æ –º–∞—Å—Å–∏–≤
          let prizeLinks = c.prize_links;
          if (!prizeLinks) {
            prizeLinks = [];
          } else if (typeof prizeLinks === 'string') {
            // –ï—Å–ª–∏ —ç—Ç–æ —Å—Ç—Ä–æ–∫–∞, –ø—ã—Ç–∞–µ–º—Å—è —Ä–∞—Å–ø–∞—Ä—Å–∏—Ç—å –∫–∞–∫ JSON
            try {
              prizeLinks = JSON.parse(prizeLinks);
            } catch (e) {
              console.warn(`–ö–æ–Ω–∫—É—Ä—Å ${c.id}: –ù–µ —É–¥–∞–ª–æ—Å—å —Ä–∞—Å–ø–∞—Ä—Å–∏—Ç—å prize_links –∫–∞–∫ JSON:`, prizeLinks);
              prizeLinks = [];
            }
          } else if (!Array.isArray(prizeLinks)) {
            console.warn(`–ö–æ–Ω–∫—É—Ä—Å ${c.id}: prize_links –Ω–µ —è–≤–ª—è–µ—Ç—Å—è –º–∞—Å—Å–∏–≤–æ–º:`, typeof prizeLinks, prizeLinks);
            prizeLinks = [];
          }

          if (prizeLinks && Array.isArray(prizeLinks) && prizeLinks.length > 0) {
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –º–∞–∫—Å–∏–º—É–º 3 –ø—Ä–∏–∑–∞ (–∑–∞ –ø–µ—Ä–≤—ã–µ 3 –º–µ—Å—Ç–∞)
            const prizesToShow = prizeLinks.slice(0, Math.min(3, prizeLinks.length));

            // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏–∏ —Å—Å—ã–ª–∫–∏ –Ω–∞ –ø—Ä–∏–∑
            function normalizePrizeLink(link) {
              if (!link) return '';
              link = link.trim();
              // –ï—Å–ª–∏ —É–∂–µ –Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è —Å https:// –∏–ª–∏ http://, –≤–æ–∑–≤—Ä–∞—â–∞–µ–º –∫–∞–∫ –µ—Å—Ç—å
              if (link.startsWith('http://') || link.startsWith('https://')) {
                return link;
              }
              // –ï—Å–ª–∏ –Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è —Å t.me/, –¥–æ–±–∞–≤–ª—è–µ–º https://
              if (link.startsWith('t.me/')) {
                return 'https://' + link;
              }
              // –ò–Ω–∞—á–µ –¥–æ–±–∞–≤–ª—è–µ–º https://
              return 'https://' + link;
            }

            // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è NFT - –∏—Å–ø–æ–ª—å–∑—É–µ–º img —Å –∑–∞–≥—Ä—É–∑–∫–æ–π —á–µ—Ä–µ–∑ API
            function getNFTImageHtml(link, idx) {
              const normalizedLink = normalizePrizeLink(link);
              // –ò—Å–ø–æ–ª—å–∑—É–µ–º img —Å src, –∫–æ—Ç–æ—Ä—ã–π –±—É–¥–µ—Ç –∑–∞–≥—Ä—É–∂–µ–Ω —á–µ—Ä–µ–∑ API endpoint
              return `
                <img
                  src="/api/nft-preview?nft_link=${encodeURIComponent(normalizedLink)}"
                  alt="–ü—Ä–∏–∑ ${idx + 1}"
                  class="w-full h-full object-cover rounded-lg prize-image"
                  onerror="this.style.display='none'; this.nextElementSibling.classList.remove('hidden');"
                  loading="lazy"
                />
              `;
            }

            // –û–ø—Ä–µ–¥–µ–ª—è–µ–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∫–æ–ª–æ–Ω–æ–∫ –¥–ª—è grid
            const gridCols = prizesToShow.length === 1 ? 'grid-cols-1' : prizesToShow.length === 2 ? 'grid-cols-2' : 'grid-cols-3';

            prizesHtml = `
              <div class="mb-4">
                <div class="grid ${gridCols} gap-3 mb-3">
                  ${prizesToShow.map((prizeLink, idx) => {
                    const normalizedLink = normalizePrizeLink(prizeLink);
                    return `
                    <div class="relative rounded-xl overflow-hidden border-2 border-violet-400/40 bg-gradient-to-br from-violet-600/30 via-pink-600/30 to-purple-600/30 aspect-square group hover:scale-105 transition-transform shadow-lg cursor-pointer">
                      <div class="absolute inset-0 bg-[url('data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTAwIiBoZWlnaHQ9IjEwMCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48ZGVmcz48cGF0dGVybiBpZD0iZ3JpZCIgd2lkdGg9IjIwIiBoZWlnaHQ9IjIwIiBwYXR0ZXJuVW5pdHM9InVzZXJTcGFjZU9uVXNlIj48Y2lyY2xlIGN4PSIxMCIgY3k9IjEwIiByPSIxLjUiIGZpbGw9IiNmZmYiIG9wYWNpdHk9IjAuMSIvPjwvcGF0dGVybj48L2RlZnM+PHJlY3Qgd2lkdGg9IjEwMCIgaGVpZ2h0PSIxMDAiIGZpbGw9InVybCgjZ3JpZCkiLz48L3N2Zz4=')] opacity-20"></div>
                      <a href="${normalizedLink}" target="_blank" class="absolute inset-0 z-10 block">
                        <div class="w-full h-full relative">
                          ${getNFTImageHtml(prizeLink, idx)}
                          <div class="absolute inset-0 flex items-center justify-center bg-black/30 rounded-lg fallback-prize hidden">
                            <div class="text-5xl opacity-70">üéÅ</div>
                          </div>
                        </div>
                      </a>
                      <div class="absolute bottom-0 left-0 right-0 bg-gradient-to-t from-black/90 via-black/70 to-transparent p-2 z-20 pointer-events-none">
                        <div class="text-xs text-white font-semibold text-center">${idx + 1} –º–µ—Å—Ç–æ</div>
                      </div>
                    </div>
                  `;
                  }).join('')}
                </div>
                ${prizeLinks.length > 3 ? `<div class="text-xs text-gray-400 text-center">+${prizeLinks.length - 3} –µ—â–µ –ø—Ä–∏–∑–æ–≤</div>` : ''}
              </div>
            `;
          }

          card.innerHTML = `
            ${prizesHtml}

            <div class="flex items-center justify-between mb-3">
              <div class="font-bold text-xl text-white">${contestTitle}</div>
            </div>

            ${c.post_link ? `
              <div class="mt-3 pt-3 border-t border-violet-400/20">
                <div class="text-xs text-gray-500 mb-1">üîó –°—Å—ã–ª–∫–∞ –Ω–∞ –ø–æ—Å—Ç:</div>
                <a href="${c.post_link}" target="_blank" class="text-blue-400 hover:underline text-sm break-all">${c.post_link}</a>
              </div>
            ` : ''}

            ${c.conditions ? `
              <div class="mt-3 pt-3 border-t border-violet-400/20">
                <div class="text-xs text-gray-500 mb-1">üìã –£—Å–ª–æ–≤–∏—è —É—á–∞—Å—Ç–∏—è:</div>
                <div class="text-sm text-gray-300">${c.conditions}</div>
              </div>
            ` : ''}
          `;

          // –î–æ–±–∞–≤–ª—è–µ–º –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –ø–æ–±–µ–¥–∏—Ç–µ–ª–µ–π, –µ—Å–ª–∏ –æ–Ω–∏ –µ—Å—Ç—å
          let winnersHtml = '';
          try {
            const winners = winnersData?.winners || [];
            const isConfirmed = winnersData?.is_confirmed || false;

            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –ø–æ–±–µ–¥–∏—Ç–µ–ª–µ–π —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –æ–Ω–∏ –≤—ã–±—Ä–∞–Ω—ã (–¥–∞–∂–µ –µ—Å–ª–∏ –Ω–µ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω—ã)
            if (winners && winners.length > 0) {
              winnersHtml = `<div class="mt-3 pt-3 border-t border-violet-400/20">
                <div class="text-xs text-gray-500 mb-2">üèÜ –ü–æ–±–µ–¥–∏—Ç–µ–ª–∏ (${winners.length}):</div>
                <div class="space-y-2">
                  ${winners.map((w, idx) => {
                    const place = w.place || (idx + 1);
                    const userDisplay = w.user_username ? `@${w.user_username}` : (w.user_id ? `ID: ${w.user_id}` : '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ');
                    // –ù–æ—Ä–º–∞–ª–∏–∑—É–µ–º —Å—Å—ã–ª–∫—É –Ω–∞ –ø—Ä–∏–∑
                    let prizeLink = w.prize_link;
                    if (prizeLink && !prizeLink.startsWith('http://') && !prizeLink.startsWith('https://')) {
                      prizeLink = 'https://' + prizeLink;
                    }
                    const prizeDisplay = prizeLink ? `<a href="${prizeLink}" target="_blank" class="text-pink-400 hover:underline font-semibold">üéÅ –ü—Ä–∏–∑ ${place} –º–µ—Å—Ç–∞</a>` : '<span class="text-gray-500">–ù–µ—Ç –ø—Ä–∏–∑–∞</span>';
                    return `
                    <div class="flex flex-col gap-1 text-sm p-2 rounded-lg bg-black/20 border border-violet-400/20">
                      <div class="flex items-center gap-2">
                        <span class="text-violet-400 font-bold flex-shrink-0">${place} –º–µ—Å—Ç–æ</span>
                        <span class="text-gray-300">${userDisplay}</span>
                      </div>
                      <div class="flex items-center gap-2 text-xs">
                        <a href="${w.comment_link}" target="_blank" class="text-blue-400 hover:underline break-all flex-1 min-w-0">${w.comment_link}</a>
                      </div>
                      <div class="text-xs text-gray-400">
                        –ü—Ä–∏–∑: ${prizeDisplay}
                      </div>
                    </div>
                  `;
                  }).join('')}
                </div>
              </div>`;
            }
          } catch (e) {
            console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –ø–æ–±–µ–¥–∏—Ç–µ–ª–µ–π:', e);
          }

          // –î–æ–±–∞–≤–ª—è–µ–º –ø–æ–±–µ–¥–∏—Ç–µ–ª–µ–π –≤ –∫–∞—Ä—Ç–æ—á–∫—É
          if (winnersHtml) {
            const tempDiv = document.createElement('div');
            tempDiv.innerHTML = winnersHtml;
            card.appendChild(tempDiv.firstElementChild);
          }

          // –î–æ–±–∞–≤–ª—è–µ–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤ –¥–ª—è –≤—Å–µ—Ö –∫–æ–Ω–∫—É—Ä—Å–æ–≤
          const participantsCountHtml = `
            <div class="mt-3 pt-3 border-t border-violet-400/20">
              <div class="text-xs text-gray-500 mb-1">üë• –£—á–∞—Å—Ç–Ω–∏–∫–æ–≤: <span class="text-violet-400 font-semibold" id="participants-count-${c.id}">${participantsCount}</span></div>
            </div>
          `;
          const tempParticipantsDiv = document.createElement('div');
          tempParticipantsDiv.innerHTML = participantsCountHtml;
          card.appendChild(tempParticipantsDiv.firstElementChild);

          // –î–ª—è –∫–æ–Ω–∫—É—Ä—Å–æ–≤ —Ä–∏—Å—É–Ω–∫–æ–≤ –∏ –∫–æ–ª–ª–µ–∫—Ü–∏–π –¥–æ–±–∞–≤–ª—è–µ–º –∫–Ω–æ–ø–∫—É —É—á–∞—Å—Ç–∏—è
          // –ö–Ω–æ–ø–∫–∞ "–£—á–∞—Å—Ç–≤–æ–≤–∞—Ç—å" –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è –¢–û–õ–¨–ö–û –¥–ª—è –∫–æ–Ω–∫—É—Ä—Å–æ–≤ —Ä–∏—Å—É–Ω–∫–æ–≤/–∫–æ–ª–ª–µ–∫—Ü–∏–π –∏ –¢–û–õ–¨–ö–û –ø–æ–∫–∞ –Ω–µ –∏—Å—Ç–µ–∫–ª–æ –≤—Ä–µ–º—è –ø—Ä–∏–µ–º–∞ —Ä–∞–±–æ—Ç
          if (isDrawingContest || isCollectionContest) {
            const photoSection = document.createElement('div');
            photoSection.className = 'mt-3 pt-3 border-t border-violet-400/20';

            // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å—Ç–∞—Ç—É—Å —É—á–∞—Å—Ç–Ω–∏–∫–∞ –∏ –∑–∞–≥—Ä—É–∂–∞–µ–º UI
            (async () => {
              try {
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —É—á–∞—Å—Ç–≤—É–µ—Ç –ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∏ –∑–∞–≥—Ä—É–∂–µ–Ω–∞ –ª–∏ —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏—è/–∫–æ–ª–ª–µ–∫—Ü–∏—è
                let participantResponse = null;
                try {
                  participantResponse = await window.fetchJSON(`/api/contests/${c.id}/participant-status?user_id=${currentUserId}`);
                  console.log(`‚úÖ –°—Ç–∞—Ç—É—Å —É—á–∞—Å—Ç–Ω–∏–∫–∞ –¥–ª—è –∫–æ–Ω–∫—É—Ä—Å–∞ ${c.id}:`, participantResponse);
                } catch (error) {
                  console.error(`‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ —Å—Ç–∞—Ç—É—Å–∞ —É—á–∞—Å—Ç–Ω–∏–∫–∞ –¥–ª—è –∫–æ–Ω–∫—É—Ä—Å–∞ ${c.id}:`, error);
                  // –ï—Å–ª–∏ –∑–∞–ø—Ä–æ—Å –Ω–µ —É–¥–∞–ª—Å—è, –Ω–æ —ç—Ç–æ –Ω–µ –∫—Ä–∏—Ç–∏—á–Ω–æ, –ø—Ä–æ–¥–æ–ª–∂–∞–µ–º —Å –¥–µ—Ñ–æ–ª—Ç–Ω—ã–º–∏ –∑–Ω–∞—á–µ–Ω–∏—è–º–∏
                  // –≠—Ç–æ –º–æ–∂–µ—Ç –ø—Ä–æ–∏–∑–æ–π—Ç–∏, –µ—Å–ª–∏ –∫–æ–Ω–∫—É—Ä—Å –µ—â–µ –Ω–µ —Å–æ–∑–¥–∞–Ω –∏–ª–∏ –µ—Å—Ç—å –ø—Ä–æ–±–ª–µ–º—ã —Å —Å–µ—Ç—å—é
                  participantResponse = {
                    is_participating: false,
                    has_photo: false,
                    has_collection: false
                  };
                }

                const hasPhoto = isDrawingContest ? (participantResponse?.has_photo || false) : false;
                const hasCollection = isCollectionContest ? (participantResponse?.has_collection || false) : false;
                const isParticipating = participantResponse?.is_participating || false;
                const submissionEndDate = c.submission_end_date;
                const votingEndDate = c.end_at || c.end_date || c.voting_end_date;

                const now = new Date();
                const submissionEnd = submissionEndDate ? new Date(submissionEndDate) : null;
                const votingEnd = votingEndDate ? new Date(votingEndDate) : null;

                let canUpload = false;
                let canParticipate = false;
                let timeMessage = '';
                let isSubmissionPeriodActive = false;
                let isVotingPeriodActive = false;
                let hasVotingEnded = false;
                let votingMessage = '';

                if (submissionEnd) {
                  if (now.getTime() <= submissionEnd.getTime()) {
                    isSubmissionPeriodActive = true;
                    canUpload = true;
                    canParticipate = true;
                    timeMessage = `‚è∞ –ü—Ä–∏–µ–º —Ä–∞–±–æ—Ç –¥–æ: ${toMoscowDateTime(submissionEnd)}`;
                  } else {
                    timeMessage = `‚è∞ –ü—Ä–∏–µ–º —Ä–∞–±–æ—Ç –∑–∞–≤–µ—Ä—à–µ–Ω: ${toMoscowDateTime(submissionEnd)}`;
                  }
                } else {
                  timeMessage = '‚è∞ –î–∞—Ç–∞ –æ–∫–æ–Ω—á–∞–Ω–∏—è –ø—Ä–∏–µ–º–∞ —Ä–∞–±–æ—Ç –Ω–µ —É–∫–∞–∑–∞–Ω–∞';
                }

                if (votingEnd) {
                  const votingDisplay = toMoscowDateTime(votingEnd);
                  const afterSubmission = submissionEnd ? now.getTime() > submissionEnd.getTime() : true;
                  if (!afterSubmission) {
                    votingMessage = `üó≥Ô∏è –ì–æ–ª–æ—Å–æ–≤–∞–Ω–∏–µ –¥–æ: ${votingDisplay}`;
                  } else if (now.getTime() <= votingEnd.getTime()) {
                    isVotingPeriodActive = true;
                    votingMessage = `üó≥Ô∏è –ì–æ–ª–æ—Å–æ–≤–∞–Ω–∏–µ –¥–æ: ${votingDisplay}`;
                  } else {
                    hasVotingEnded = true;
                    votingMessage = `üó≥Ô∏è –ì–æ–ª–æ—Å–æ–≤–∞–Ω–∏–µ –∑–∞–≤–µ—Ä—à–µ–Ω–æ: ${votingDisplay}`;
                  }
                }

                if (!submissionEnd) {
                  canUpload = false;
                  canParticipate = false;
                  isSubmissionPeriodActive = false;
                } else if (!isSubmissionPeriodActive) {
                  canUpload = false;
                  canParticipate = false;
                }

                // –û–ø—Ä–µ–¥–µ–ª—è–µ–º, —á—Ç–æ –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å –Ω–∞ –æ—Å–Ω–æ–≤–µ —Å—Ç–∞—Ç—É—Å–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
                // –ö–Ω–æ–ø–∫–∞ "–£—á–∞—Å—Ç–≤–æ–≤–∞—Ç—å" –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è –¢–û–õ–¨–ö–û –µ—Å–ª–∏:
                // 1. –≠—Ç–æ –∫–æ–Ω–∫—É—Ä—Å —Ä–∏—Å—É–Ω–∫–æ–≤ –∏–ª–∏ –∫–æ–ª–ª–µ–∫—Ü–∏–π (—É–∂–µ –ø—Ä–æ–≤–µ—Ä–µ–Ω–æ –≤—ã—à–µ)
                // 2. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ù–ï —É—á–∞—Å—Ç–≤—É–µ—Ç
                // 3. –í—Ä–µ–º—è –ø—Ä–∏–µ–º–∞ —Ä–∞–±–æ—Ç –µ—â–µ –Ω–µ –∏—Å—Ç–µ–∫–ª–æ
                const hasSubmitted = isDrawingContest ? hasPhoto : hasCollection;

                console.log(`–ö–æ–Ω–∫—É—Ä—Å ${c.id}: canParticipate=${canParticipate}, canUpload=${canUpload}, isParticipating=${isParticipating}, hasPhoto=${hasPhoto}, hasCollection=${hasCollection}, hasSubmitted=${hasSubmitted}, isSubmissionPeriodActive=${isSubmissionPeriodActive}, isVotingPeriodActive=${isVotingPeriodActive}`);

                let photoHtml = '';

                if (hasSubmitted && isSubmissionPeriodActive) {
                  // –†–∞–±–æ—Ç–∞ —É–∂–µ –∑–∞–≥—Ä—É–∂–µ–Ω–∞, –Ω–æ –≤—Ä–µ–º—è –ø—Ä–∏–µ–º–∞ —Ä–∞–±–æ—Ç –µ—â–µ –Ω–µ –∏—Å—Ç–µ–∫–ª–æ
                  const submittedText = isDrawingContest ? '‚úÖ –§–æ—Ç–æ–≥—Ä–∞—Ñ–∏—è –∑–∞–≥—Ä—É–∂–µ–Ω–∞' : '‚úÖ –ö–æ–ª–ª–µ–∫—Ü–∏—è –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∞';
                  photoHtml = `
                    <div class="text-sm text-green-400 mb-2">${submittedText}</div>
                    ${timeMessage ? `<div class="text-xs text-gray-500 mb-2">${timeMessage}</div>` : ''}
                  `;
                } else if (hasSubmitted && !isSubmissionPeriodActive && isParticipating === true) {
                  // –†–∞–±–æ—Ç–∞ –∑–∞–≥—Ä—É–∂–µ–Ω–∞, –≤—Ä–µ–º—è –ø—Ä–∏–µ–º–∞ —Ä–∞–±–æ—Ç –∏—Å—Ç–µ–∫–ª–æ, –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —É—á–∞—Å—Ç–≤—É–µ—Ç
                  const submittedText = isDrawingContest ? '‚úÖ –§–æ—Ç–æ–≥—Ä–∞—Ñ–∏—è –∑–∞–≥—Ä—É–∂–µ–Ω–∞' : '‚úÖ –ö–æ–ª–ª–µ–∫—Ü–∏—è –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∞';
                  if (isVotingPeriodActive) {
                    photoHtml = `
                      <div class="text-sm text-green-400 mb-2">${submittedText}</div>
                      <div class="text-sm text-gray-400 mb-2">‚è∞ –í—Ä–µ–º—è –ø—Ä–∏–µ–º–∞ —Ä–∞–±–æ—Ç –∏—Å—Ç–µ–∫–ª–æ</div>
                      ${timeMessage ? `<div class="text-xs text-gray-500 mb-2">${timeMessage}</div>` : ''}
                      <button id="vote-btn-${c.id}" class="neon-button w-full py-2 rounded-lg text-sm font-semibold">
                        üó≥Ô∏è –ì–æ–ª–æ—Å–æ–≤–∞—Ç—å
                      </button>
                    `;
                  } else {
                    photoHtml = `
                      <div class="text-sm text-green-400 mb-2">${submittedText}</div>
                      <div class="text-sm text-gray-400 mb-2">‚è∞ –í—Ä–µ–º—è –ø—Ä–∏–µ–º–∞ —Ä–∞–±–æ—Ç –∏—Å—Ç–µ–∫–ª–æ</div>
                      ${timeMessage ? `<div class="text-xs text-gray-500 mb-2">${timeMessage}</div>` : ''}
                    `;
                  }
                } else if (isParticipating === true && canUpload && isSubmissionPeriodActive && !hasSubmitted) {
                  // –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —É—á–∞—Å—Ç–≤—É–µ—Ç, –Ω–æ –µ—â–µ –Ω–µ –∑–∞–≥—Ä—É–∑–∏–ª —Ä–∞–±–æ—Ç—É, –∏ –≤—Ä–µ–º—è –ø—Ä–∏–µ–º–∞ —Ä–∞–±–æ—Ç –µ—â–µ –Ω–µ –∏—Å—Ç–µ–∫–ª–æ
                  if (isDrawingContest) {
                    photoHtml = `
                      <div class="text-sm text-gray-300 mb-2">üì∏ –ó–∞–≥—Ä—É–∑–∏—Ç–µ —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏—é</div>
                      ${timeMessage ? `<div class="text-xs text-gray-500 mb-2">${timeMessage}</div>` : ''}
                      <input type="file" id="photo-input-${c.id}" accept="image/*" class="hidden" />
                      <button id="upload-photo-btn-${c.id}" class="neon-button w-full py-2 rounded-lg text-sm">
                        üì§ –ó–∞–≥—Ä—É–∑–∏—Ç—å —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏—é
                      </button>
                    `;
                  } else if (isCollectionContest) {
                    photoHtml = `
                      <div class="text-sm text-gray-300 mb-2">üñºÔ∏è –û—Ç–ø—Ä–∞–≤—å—Ç–µ –∫–æ–ª–ª–µ–∫—Ü–∏—é –∏–∑ 9 NFT</div>
                      ${timeMessage ? `<div class="text-xs text-gray-500 mb-2">${timeMessage}</div>` : ''}
                      <button id="submit-collection-btn-${c.id}" class="neon-button w-full py-2 rounded-lg text-sm">
                        üñºÔ∏è –û—Ç–ø—Ä–∞–≤–∏—Ç—å –∫–æ–ª–ª–µ–∫—Ü–∏—é
                      </button>
                    `;
                  }
                } else if (!isParticipating && canParticipate && isSubmissionPeriodActive) {
                  // –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ù–ï —É—á–∞—Å—Ç–≤—É–µ—Ç, –≤—Ä–µ–º—è –ø—Ä–∏–µ–º–∞ —Ä–∞–±–æ—Ç –µ—â–µ –Ω–µ –∏—Å—Ç–µ–∫–ª–æ - –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –∫–Ω–æ–ø–∫—É "–£—á–∞—Å—Ç–≤–æ–≤–∞—Ç—å"
                  // –≠–¢–ê –ö–ù–û–ü–ö–ê –ü–û–ö–ê–ó–´–í–ê–ï–¢–°–Ø –¢–û–õ–¨–ö–û –î–õ–Ø –ö–û–ù–ö–£–†–°–û–í –†–ò–°–£–ù–ö–û–í –ò –¢–û–õ–¨–ö–û –ü–û–ö–ê –ù–ï –ò–°–¢–ï–ö–õ–û –í–†–ï–ú–Ø –ü–†–ò–ï–ú–ê –†–ê–ë–û–¢
                  photoHtml = `
                    ${timeMessage ? `<div class="text-xs text-gray-500 mb-2">${timeMessage}</div>` : ''}
                    <button id="participate-btn-${c.id}" class="neon-button w-full py-2 rounded-lg text-sm font-semibold">
                      ‚ú® –£—á–∞—Å—Ç–≤–æ–≤–∞—Ç—å
                    </button>
                  `;
                } else if (!isSubmissionPeriodActive) {
                  // –í—Ä–µ–º—è –ø—Ä–∏–µ–º–∞ —Ä–∞–±–æ—Ç –∏—Å—Ç–µ–∫–ª–æ
                  if (isParticipating === true) {
                    // –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —É—á–∞—Å—Ç–≤—É–µ—Ç - –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –∫–Ω–æ–ø–∫—É "–ì–æ–ª–æ—Å–æ–≤–∞—Ç—å" –µ—Å–ª–∏ –ø–µ—Ä–∏–æ–¥ –≥–æ–ª–æ—Å–æ–≤–∞–Ω–∏—è –∞–∫—Ç–∏–≤–µ–Ω
                    if (isVotingPeriodActive) {
                      photoHtml = `
                        <div class="text-sm text-gray-400 mb-2">‚è∞ –í—Ä–µ–º—è –ø—Ä–∏–µ–º–∞ —Ä–∞–±–æ—Ç –∏—Å—Ç–µ–∫–ª–æ</div>
                        ${timeMessage ? `<div class="text-xs text-gray-500 mb-2">${timeMessage}</div>` : ''}
                        <button id="vote-btn-${c.id}" class="neon-button w-full py-2 rounded-lg text-sm font-semibold">
                          üó≥Ô∏è –ì–æ–ª–æ—Å–æ–≤–∞—Ç—å
                        </button>
                      `;
                    } else {
                      photoHtml = `
                        <div class="text-sm text-gray-400 mb-2">‚è∞ –í—Ä–µ–º—è –ø—Ä–∏–µ–º–∞ —Ä–∞–±–æ—Ç –∏—Å—Ç–µ–∫–ª–æ</div>
                        ${timeMessage ? `<div class="text-xs text-gray-500 mb-2">${timeMessage}</div>` : ''}
                      `;
                    }
                  } else {
                    // –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ù–ï —É—á–∞—Å—Ç–≤—É–µ—Ç - –Ω–µ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –∫–Ω–æ–ø–∫—É "–£—á–∞—Å—Ç–≤–æ–≤–∞—Ç—å", —Ç–æ–ª—å–∫–æ —Å–æ–æ–±—â–µ–Ω–∏–µ
                    photoHtml = `
                      <div class="text-sm text-gray-400 mb-2">‚è∞ –í—Ä–µ–º—è –ø—Ä–∏–µ–º–∞ —Ä–∞–±–æ—Ç –∏—Å—Ç–µ–∫–ª–æ</div>
                      ${timeMessage ? `<div class="text-xs text-gray-500 mb-2">${timeMessage}</div>` : ''}
                    `;
                  }
                } else {
                  // –î—Ä—É–≥–∏–µ —Å–ª—É—á–∞–∏ (–Ω–∞–ø—Ä–∏–º–µ—Ä, –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —É—á–∞—Å—Ç–≤—É–µ—Ç, –Ω–æ –≤—Ä–µ–º—è –∏—Å—Ç–µ–∫–ª–æ)
                  photoHtml = `
                    <div class="text-sm text-gray-400 mb-2">${timeMessage || '–ö–æ–Ω–∫—É—Ä—Å –∞–∫—Ç–∏–≤–µ–Ω'}</div>
                  `;
                }

                if (votingMessage && (!isSubmissionPeriodActive || isVotingPeriodActive || hasVotingEnded)) {
                  const votingClass = isVotingPeriodActive ? 'text-pink-400' : 'text-gray-500';
                  photoHtml += `
                    <div class="text-xs ${votingClass} mb-2">${votingMessage}</div>
                  `;
                }

                // –î–æ–±–∞–≤–ª—è–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–Ω–æ–ø–∫–∏ "–ì–æ–ª–æ—Å–æ–≤–∞—Ç—å" –¥–ª—è –≤—Å–µ—Ö —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤ –ø–æ—Å–ª–µ –æ–∫–æ–Ω—á–∞–Ω–∏—è –≤—Ä–µ–º–µ–Ω–∏ –ø—Ä–∏–µ–º–∞ —Ä–∞–±–æ—Ç
                if (isParticipating && isVotingPeriodActive && !isSubmissionPeriodActive) {
                  setTimeout(() => {
                    const voteBtn = document.getElementById(`vote-btn-${c.id}`);
                    if (voteBtn) {
                      voteBtn.addEventListener('click', () => {
                        window.openVotingModal(c.id);
                      });
                    }
                  }, 100);
                }

                // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å—Ç–∞—Ç—É—Å –∏—Ç–æ–≥–æ–≤ –¥–ª—è –∫–æ–Ω–∫—É—Ä—Å–æ–≤ —Ä–∏—Å—É–Ω–∫–æ–≤
                let resultsButtonHtml = '';
                if (hasVotingEnded || (!isSubmissionPeriodActive && !isVotingPeriodActive)) {
                  try {
                    const resultsResponse = await window.fetchJSON(`/api/contests/${c.id}/results`).catch(() => ({ results_calculated: false }));
                    const resultsCalculated = resultsResponse?.results_calculated || false;

                    if (!resultsCalculated) {
                      // –î–ª—è user –∫–Ω–æ–ø–∫–∞ "–ü–æ–¥—Å—á–µ—Ç –∏—Ç–æ–≥–æ–≤" –ù–ï –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è –≤–æ–æ–±—â–µ
                      // –û–Ω–∞ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –¥–ª—è —Å–æ–∑–¥–∞—Ç–µ–ª—è –≤ creator.html
                    } else {
                      // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∫–Ω–æ–ø–∫—É "–ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å –∏—Ç–æ–≥–∏" –¥–ª—è –≤—Å–µ—Ö –ø–æ—Å–ª–µ –ø–æ–¥—Å—á–µ—Ç–∞
                      resultsButtonHtml = `
                        <button id="view-results-btn-${c.id}" class="neon-button w-full py-2 rounded-lg text-sm font-semibold mt-2">
                          üèÜ –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å –∏—Ç–æ–≥–∏
                        </button>
                      `;
                    }
                  } catch (e) {
                    console.error('–û—à–∏–±–∫–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏ —Å—Ç–∞—Ç—É—Å–∞ –∏—Ç–æ–≥–æ–≤:', e);
                  }
                }

                photoSection.innerHTML = photoHtml + resultsButtonHtml;

                // –î–æ–±–∞–≤–ª—è–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –∫–Ω–æ–ø–æ–∫
                if (resultsButtonHtml) {
                  setTimeout(() => {
                    const viewResultsBtn = document.getElementById(`view-results-btn-${c.id}`);
                    if (viewResultsBtn) {
                      viewResultsBtn.addEventListener('click', () => {
                        window.showDrawingResults(c.id);
                      });
                    }

                    const calculateResultsBtn = document.getElementById(`calculate-results-btn-${c.id}`);
                    if (calculateResultsBtn) {
                      calculateResultsBtn.addEventListener('click', () => {
                        window.calculateDrawingResults(c.id);
                      });
                    }
                  }, 100);
                }

                // –î–æ–±–∞–≤–ª—è–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–Ω–æ–ø–∫–∏ "–£—á–∞—Å—Ç–≤–æ–≤–∞—Ç—å"
                // –ö–Ω–æ–ø–∫–∞ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏: !isParticipating && canParticipate && isSubmissionPeriodActive
                if (!isParticipating && canParticipate && isSubmissionPeriodActive) {
                  // –ù–µ–±–æ–ª—å—à–∞—è –∑–∞–¥–µ—Ä–∂–∫–∞ –¥–ª—è –≥–∞—Ä–∞–Ω—Ç–∏–∏, —á—Ç–æ —ç–ª–µ–º–µ–Ω—Ç –¥–æ–±–∞–≤–ª–µ–Ω –≤ DOM
                  setTimeout(() => {
                    const participateBtn = document.getElementById(`participate-btn-${c.id}`);
                    if (participateBtn) {
                      participateBtn.addEventListener('click', async () => {
                        // –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –≤—Ä–µ–º–µ–Ω–∏ –ø–µ—Ä–µ–¥ —É—á–∞—Å—Ç–∏–µ–º
                        const submissionEndDate = c.submission_end_date;
                        if (submissionEndDate) {
                          const now = new Date();
                          const endDate = new Date(submissionEndDate);

                          // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –Ω–µ –∏—Å—Ç–µ–∫–ª–æ –ª–∏ –≤—Ä–µ–º—è –ø—Ä–∏–µ–º–∞ —Ä–∞–±–æ—Ç
                          if (now.getTime() > endDate.getTime()) {
                            alert('‚ùå –í—Ä–µ–º—è –ø—Ä–∏–µ–º–∞ —Ä–∞–±–æ—Ç –∏—Å—Ç–µ–∫–ª–æ. –í—ã –Ω–µ –º–æ–∂–µ—Ç–µ –ø—Ä–∏—Å–æ–µ–¥–∏–Ω–∏—Ç—å—Å—è –∫ –∫–æ–Ω–∫—É—Ä—Å—É.');
                            // –û–±–Ω–æ–≤–ª—è–µ–º —Å–ø–∏—Å–æ–∫ –∫–æ–Ω–∫—É—Ä—Å–æ–≤, —á—Ç–æ–±—ã —Å–∫—Ä—ã—Ç—å –∫–Ω–æ–ø–∫—É
                            await window.loadContests(true);
                            return;
                          }
                        }

                        participateBtn.disabled = true;
                        participateBtn.textContent = '‚è≥ –ü—Ä–æ–≤–µ—Ä–∫–∞...';

                        try {
                          const username = 'TestUser';
                          const response = await window.fetchJSON(`/api/contests/${c.id}/participate`, {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify({
                              user_id: currentUserId,
                              username: username
                            })
                          });

                          if (response.success) {
                            // –£—Å–ø–µ—à–Ω–æ –ø—Ä–∏—Å–æ–µ–¥–∏–Ω–∏–ª–∏—Å—å –∫ –∫–æ–Ω–∫—É—Ä—Å—É —Ä–∏—Å—É–Ω–∫–æ–≤
                            // –ù–µ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º alert, —Å—Ä–∞–∑—É –æ–±–Ω–æ–≤–ª—è–µ–º UI, —á—Ç–æ–±—ã –ø–æ–∫–∞–∑–∞—Ç—å —Ñ–æ—Ä–º—É –∑–∞–≥—Ä—É–∑–∫–∏ —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–∏

                            // –û–±–Ω–æ–≤–ª—è–µ–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤
                            const participantsCountEl = document.getElementById(`participants-count-${c.id}`);
                            if (participantsCountEl) {
                              const newCount = parseInt(participantsCountEl.textContent) + 1;
                              participantsCountEl.textContent = newCount;
                            }

                            // –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∂–∞–µ–º —Å–ø–∏—Å–æ–∫ –∫–æ–Ω–∫—É—Ä—Å–æ–≤, —á—Ç–æ–±—ã –ø–æ–∫–∞–∑–∞—Ç—å —Ñ–æ—Ä–º—É –∑–∞–≥—Ä—É–∑–∫–∏ —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–∏
                            // –ò—Å–ø–æ–ª—å–∑—É–µ–º –ø–æ–ª–Ω—É—é –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫—É, —á—Ç–æ–±—ã –æ–±–Ω–æ–≤–∏—Ç—å —Å—Ç–∞—Ç—É—Å —É—á–∞—Å—Ç–Ω–∏–∫–∞
                            await window.loadContests();
                          } else if (response.requires_subscription && response.not_subscribed) {
                            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ —Å –Ω–µ–ø–æ–¥–ø–∏—Å–∞–Ω–Ω—ã–º–∏ –∫–∞–Ω–∞–ª–∞–º–∏/—á–∞—Ç–∞–º–∏
                            window.showSubscriptionModal(c.id, response.not_subscribed, currentUserId, username);
                            participateBtn.disabled = false;
                            participateBtn.textContent = '‚ú® –£—á–∞—Å—Ç–≤–æ–≤–∞—Ç—å';
                          } else {
                            alert('‚ùå ' + (response.message || '–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø—Ä–∏—Å–æ–µ–¥–∏–Ω–µ–Ω–∏–∏ –∫ –∫–æ–Ω–∫—É—Ä—Å—É'));
                            participateBtn.disabled = false;
                            participateBtn.textContent = '‚ú® –£—á–∞—Å—Ç–≤–æ–≤–∞—Ç—å';
                          }
                        } catch (error) {
                          console.error('–û—à–∏–±–∫–∞ —É—á–∞—Å—Ç–∏—è –≤ –∫–æ–Ω–∫—É—Ä—Å–µ:', error);
                          let errorMessage = '–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø—Ä–∏—Å–æ–µ–¥–∏–Ω–µ–Ω–∏–∏ –∫ –∫–æ–Ω–∫—É—Ä—Å—É';
                          let shouldReload = false;

                          try {
                            const errorResponse = await error.response?.json();
                            if (errorResponse?.detail) {
                              errorMessage = errorResponse.detail;
                              // –ï—Å–ª–∏ –æ—à–∏–±–∫–∞ —Å–≤—è–∑–∞–Ω–∞ —Å –∏—Å—Ç–µ–∫—à–∏–º deadline, –æ–±–Ω–æ–≤–ª—è–µ–º —Å–ø–∏—Å–æ–∫ –∫–æ–Ω–∫—É—Ä—Å–æ–≤
                              if (errorResponse.detail.includes('–í—Ä–µ–º—è –ø—Ä–∏–µ–º–∞ —Ä–∞–±–æ—Ç –∏—Å—Ç–µ–∫–ª–æ') ||
                                  errorResponse.detail.includes('–∏—Å—Ç–µ–∫–ª–æ')) {
                                shouldReload = true;
                              }
                            } else if (errorResponse?.message) {
                              errorMessage = errorResponse.message;
                            }
                          } catch (e) {
                            if (error.message) {
                              errorMessage = error.message;
                            }
                          }

                          alert('‚ùå ' + errorMessage);

                          // –ï—Å–ª–∏ deadline –∏—Å—Ç–µ–∫, –æ–±–Ω–æ–≤–ª—è–µ–º —Å–ø–∏—Å–æ–∫ –∫–æ–Ω–∫—É—Ä—Å–æ–≤, —á—Ç–æ–±—ã —Å–∫—Ä—ã—Ç—å –∫–Ω–æ–ø–∫—É
                          if (shouldReload) {
                            await window.loadContests();
                          } else {
                            participateBtn.disabled = false;
                            participateBtn.textContent = '‚ú® –£—á–∞—Å—Ç–≤–æ–≤–∞—Ç—å';
                          }
                        }
                      });
                    }
                  }, 100);
                }

                // –î–æ–±–∞–≤–ª—è–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –∑–∞–≥—Ä—É–∑–∫–∏ —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–∏ (–µ—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —É–∂–µ —É—á–∞—Å—Ç–≤—É–µ—Ç)
                // –ó–∞–≥—Ä—É–∑–∫–∞ –≤–æ–∑–º–æ–∂–Ω–∞ —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –≤—Ä–µ–º—è –ø—Ä–∏–µ–º–∞ —Ä–∞–±–æ—Ç –µ—â–µ –Ω–µ –∏—Å—Ç–µ–∫–ª–æ
                if (isParticipating === true && canUpload && !hasSubmitted && isSubmissionPeriodActive && isDrawingContest) {
                  // –ù–µ–±–æ–ª—å—à–∞—è –∑–∞–¥–µ—Ä–∂–∫–∞ –¥–ª—è –≥–∞—Ä–∞–Ω—Ç–∏–∏, —á—Ç–æ —ç–ª–µ–º–µ–Ω—Ç –¥–æ–±–∞–≤–ª–µ–Ω –≤ DOM
                  setTimeout(() => {
                    const photoInput = document.getElementById(`photo-input-${c.id}`);
                    const uploadBtn = document.getElementById(`upload-photo-btn-${c.id}`);

                    if (uploadBtn && photoInput) {
                      uploadBtn.addEventListener('click', () => {
                        photoInput.click();
                      });

                      photoInput.addEventListener('change', async (e) => {
                        const file = e.target.files[0];
                        if (!file) return;

                        if (!file.type.startsWith('image/')) {
                          alert('‚ö†Ô∏è –§–∞–π–ª –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ–º');
                          return;
                        }

                        if (file.size > 10 * 1024 * 1024) {
                          alert('‚ö†Ô∏è –†–∞–∑–º–µ—Ä —Ñ–∞–π–ª–∞ –Ω–µ –¥–æ–ª–∂–µ–Ω –ø—Ä–µ–≤—ã—à–∞—Ç—å 10 –ú–ë');
                          return;
                        }

                        uploadBtn.disabled = true;
                        uploadBtn.textContent = '‚è≥ –ó–∞–≥—Ä—É–∑–∫–∞...';

                        try {
                          const formData = new FormData();
                          formData.append('file', file);
                          formData.append('user_id', currentUserId);
                          formData.append('user_username', 'TestUser');

                          // –í —Ç–µ—Å—Ç–æ–≤–æ–º —Ä–µ–∂–∏–º–µ –∏—Å–ø–æ–ª—å–∑—É–µ–º –º–æ–∫-–æ—Ç–≤–µ—Ç
                          const result = { success: true, message: '–§–æ—Ç–æ–≥—Ä–∞—Ñ–∏—è –∑–∞–≥—Ä—É–∂–µ–Ω–∞ (—Ç–µ—Å—Ç–æ–≤—ã–π —Ä–µ–∂–∏–º)' };
                          
                          if (result.success) {
                            alert('‚úÖ ' + result.message);
                            await window.loadContests(); // –û–±–Ω–æ–≤–ª—è–µ–º —Å–ø–∏—Å–æ–∫ –∫–æ–Ω–∫—É—Ä—Å–æ–≤
                          } else {
                            alert('‚ùå ' + (result.detail || result.message || '–û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–∏'));
                          }
                        } catch (error) {
                          console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–∏:', error);
                          alert('‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–∏');
                        } finally {
                          uploadBtn.disabled = false;
                          uploadBtn.textContent = 'üì§ –ó–∞–≥—Ä—É–∑–∏—Ç—å —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏—é';
                          photoInput.value = '';
                        }
                      });
                    }
                  }, 100);
                }

                // –î–æ–±–∞–≤–ª—è–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–Ω–æ–ø–∫–∏ –æ—Ç–ø—Ä–∞–≤–∫–∏ –∫–æ–ª–ª–µ–∫—Ü–∏–∏ (–µ—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —É–∂–µ —É—á–∞—Å—Ç–≤—É–µ—Ç)
                // –û—Ç–ø—Ä–∞–≤–∫–∞ –≤–æ–∑–º–æ–∂–Ω–∞ —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –≤—Ä–µ–º—è –ø—Ä–∏–µ–º–∞ —Ä–∞–±–æ—Ç –µ—â–µ –Ω–µ –∏—Å—Ç–µ–∫–ª–æ
                if (isParticipating === true && canUpload && !hasCollection && isSubmissionPeriodActive && isCollectionContest) {
                  setTimeout(() => {
                    const submitCollectionBtn = document.getElementById(`submit-collection-btn-${c.id}`);
                    if (submitCollectionBtn) {
                      submitCollectionBtn.addEventListener('click', () => {
                        // –û—Ç–∫—Ä—ã–≤–∞–µ–º –º–æ–¥–∞–ª–∫—É –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ –∫–æ–ª–ª–µ–∫—Ü–∏–∏ (–±—É–¥–µ—Ç —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ –ø–æ–∑–∂–µ)
                        window.openCollectionSubmissionModal(c.id);
                      });
                    }
                  }, 100);
                }
              } catch (error) {
                console.error('–ö—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è –æ—à–∏–±–∫–∞ –ø—Ä–∏ –ø—Ä–æ–≤–µ—Ä–∫–µ —Å—Ç–∞—Ç—É—Å–∞ —É—á–∞—Å—Ç–Ω–∏–∫–∞:', error);
                // –í —Å–ª—É—á–∞–µ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–æ–π –æ—à–∏–±–∫–∏ (–Ω–µ —Å–≤—è–∑–∞–Ω–Ω–æ–π —Å API) –∏—Å–ø–æ–ª—å–∑—É–µ–º –¥–µ—Ñ–æ–ª—Ç–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è
                // –∏ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –∫–Ω–æ–ø–∫—É "–£—á–∞—Å—Ç–≤–æ–≤–∞—Ç—å", –µ—Å–ª–∏ –≤—Ä–µ–º—è –ø—Ä–∏–µ–º–∞ —Ä–∞–±–æ—Ç –µ—â–µ –Ω–µ –∏—Å—Ç–µ–∫–ª–æ
                try {
                  const submissionEndDate = c.submission_end_date;
                  const now = new Date();
                  let errorHtml = '';

                  if (submissionEndDate) {
                    const endDate = new Date(submissionEndDate);

                    if (now.getTime() <= endDate.getTime()) {
                      // –í—Ä–µ–º—è –ø—Ä–∏–µ–º–∞ —Ä–∞–±–æ—Ç –µ—â–µ –Ω–µ –∏—Å—Ç–µ–∫–ª–æ - –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –∫–Ω–æ–ø–∫—É –±–µ–∑ —Å–æ–æ–±—â–µ–Ω–∏—è –æ–± –æ—à–∏–±–∫–µ
                      // –ò—Å–ø–æ–ª—å–∑—É–µ–º –¥–µ—Ñ–æ–ª—Ç–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è: –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ —É—á–∞—Å—Ç–≤—É–µ—Ç
                      const timeMessage = `‚è∞ –ü—Ä–∏–µ–º —Ä–∞–±–æ—Ç –¥–æ: ${toMoscowDateTime(endDate)}`;
                      errorHtml = `
                        ${timeMessage ? `<div class="text-xs text-gray-500 mb-2">${timeMessage}</div>` : ''}
                        <button id="participate-btn-${c.id}" class="neon-button w-full py-2 rounded-lg text-sm font-semibold">
                          ‚ú® –£—á–∞—Å—Ç–≤–æ–≤–∞—Ç—å
                        </button>
                      `;
                    } else {
                      // –í—Ä–µ–º—è –ø—Ä–∏–µ–º–∞ —Ä–∞–±–æ—Ç –∏—Å—Ç–µ–∫–ª–æ
                      errorHtml = `
                        <div class="text-sm text-gray-400 mb-2">‚è∞ –í—Ä–µ–º—è –ø—Ä–∏–µ–º–∞ —Ä–∞–±–æ—Ç –∏—Å—Ç–µ–∫–ª–æ</div>
                        <div class="text-xs text-gray-500 mb-2">‚è∞ –ü—Ä–∏–µ–º —Ä–∞–±–æ—Ç –∑–∞–≤–µ—Ä—à–µ–Ω: ${toMoscowDateTime(endDate)}</div>
                      `;
                    }
                  } else {
                    // –ï—Å–ª–∏ deadline –Ω–µ —É–∫–∞–∑–∞–Ω, –Ω–µ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –∫–Ω–æ–ø–∫—É
                    errorHtml = `
                      <div class="text-sm text-gray-400 mb-2">‚è∞ –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –≤—Ä–µ–º–µ–Ω–∏ –ø—Ä–∏–µ–º–∞ —Ä–∞–±–æ—Ç –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞</div>
                    `;
                  }

                  photoSection.innerHTML = errorHtml;

                  // –ï—Å–ª–∏ –∫–Ω–æ–ø–∫–∞ –±—ã–ª–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∞, –¥–æ–±–∞–≤–ª—è–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫
                  if (submissionEndDate) {
                    const now = new Date();
                    const endDate = new Date(submissionEndDate);
                    if (now.getTime() <= endDate.getTime()) {
                      setTimeout(() => {
                        const participateBtn = document.getElementById(`participate-btn-${c.id}`);
                        if (participateBtn) {
                          participateBtn.addEventListener('click', async () => {
                            participateBtn.disabled = true;
                            participateBtn.textContent = '‚è≥ –ü—Ä–æ–≤–µ—Ä–∫–∞...';

                            try {
                              const username = 'TestUser';
                              const response = await window.fetchJSON(`/api/contests/${c.id}/participate`, {
                                method: 'POST',
                                headers: { 'Content-Type': 'application/json' },
                                body: JSON.stringify({
                                  user_id: currentUserId,
                                  username: username
                                })
                              });

                              if (response.success) {
                                // –£—Å–ø–µ—à–Ω–æ –ø—Ä–∏—Å–æ–µ–¥–∏–Ω–∏–ª–∏—Å—å –∫ –∫–æ–Ω–∫—É—Ä—Å—É —Ä–∏—Å—É–Ω–∫–æ–≤
                                // –ù–µ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º alert, —Å—Ä–∞–∑—É –æ–±–Ω–æ–≤–ª—è–µ–º UI, —á—Ç–æ–±—ã –ø–æ–∫–∞–∑–∞—Ç—å —Ñ–æ—Ä–º—É –∑–∞–≥—Ä—É–∑–∫–∏ —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–∏
                                const participantsCountEl = document.getElementById(`participants-count-${c.id}`);
                                if (participantsCountEl) {
                                  const newCount = parseInt(participantsCountEl.textContent) + 1;
                                  participantsCountEl.textContent = newCount;
                                }
                                // –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∂–∞–µ–º —Å–ø–∏—Å–æ–∫ –∫–æ–Ω–∫—É—Ä—Å–æ–≤, —á—Ç–æ–±—ã –ø–æ–∫–∞–∑–∞—Ç—å —Ñ–æ—Ä–º—É –∑–∞–≥—Ä—É–∑–∫–∏ —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–∏
                                await window.loadContests();
                              } else if (response.requires_subscription && response.not_subscribed) {
                                window.showSubscriptionModal(c.id, response.not_subscribed, currentUserId, username);
                                participateBtn.disabled = false;
                                participateBtn.textContent = '‚ú® –£—á–∞—Å—Ç–≤–æ–≤–∞—Ç—å';
                              } else {
                                alert('‚ùå ' + (response.message || '–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø—Ä–∏—Å–æ–µ–¥–∏–Ω–µ–Ω–∏–∏ –∫ –∫–æ–Ω–∫—É—Ä—Å—É'));
                                participateBtn.disabled = false;
                                participateBtn.textContent = '‚ú® –£—á–∞—Å—Ç–≤–æ–≤–∞—Ç—å';
                              }
                            } catch (error) {
                              console.error('–û—à–∏–±–∫–∞ —É—á–∞—Å—Ç–∏—è –≤ –∫–æ–Ω–∫—É—Ä—Å–µ:', error);
                              let errorMessage = '–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø—Ä–∏—Å–æ–µ–¥–∏–Ω–µ–Ω–∏–∏ –∫ –∫–æ–Ω–∫—É—Ä—Å—É';
                              let shouldReload = false;

                              try {
                                const errorResponse = await error.response?.json();
                                if (errorResponse?.detail) {
                                  errorMessage = errorResponse.detail;
                                  // –ï—Å–ª–∏ –æ—à–∏–±–∫–∞ —Å–≤—è–∑–∞–Ω–∞ —Å –∏—Å—Ç–µ–∫—à–∏–º deadline, –æ–±–Ω–æ–≤–ª—è–µ–º —Å–ø–∏—Å–æ–∫ –∫–æ–Ω–∫—É—Ä—Å–æ–≤
                                  if (errorResponse.detail.includes('–í—Ä–µ–º—è –ø—Ä–∏–µ–º–∞ —Ä–∞–±–æ—Ç –∏—Å—Ç–µ–∫–ª–æ') ||
                                      errorResponse.detail.includes('–∏—Å—Ç–µ–∫–ª–æ')) {
                                    shouldReload = true;
                                  }
                                } else if (errorResponse?.message) {
                                  errorMessage = errorResponse.message;
                                }
                              } catch (e) {
                                if (error.message) {
                                  errorMessage = error.message;
                                }
                              }

                              alert('‚ùå ' + errorMessage);

                              // –ï—Å–ª–∏ deadline –∏—Å—Ç–µ–∫, –æ–±–Ω–æ–≤–ª—è–µ–º —Å–ø–∏—Å–æ–∫ –∫–æ–Ω–∫—É—Ä—Å–æ–≤, —á—Ç–æ–±—ã —Å–∫—Ä—ã—Ç—å –∫–Ω–æ–ø–∫—É
                              if (shouldReload) {
                                await window.loadContests();
                              } else {
                                participateBtn.disabled = false;
                                participateBtn.textContent = '‚ú® –£—á–∞—Å—Ç–≤–æ–≤–∞—Ç—å';
                              }
                            }
                          });
                        }
                      }, 100);
                    }
                  }
                } catch (innerError) {
                  console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±—Ä–∞–±–æ—Ç–∫–µ –æ—à–∏–±–∫–∏:', innerError);
                  // –í —Å–ª—É—á–∞–µ –æ—à–∏–±–∫–∏ –ø—Ä–æ—Å—Ç–æ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –∫–Ω–æ–ø–∫—É –±–µ–∑ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–π –æ–±—Ä–∞–±–æ—Ç–∫–∏
                  photoSection.innerHTML = `
                    <button id="participate-btn-${c.id}" class="neon-button w-full py-2 rounded-lg text-sm font-semibold">
                      ‚ú® –£—á–∞—Å—Ç–≤–æ–≤–∞—Ç—å
                    </button>
                  `;
                }
              }
            })();

            card.appendChild(photoSection);
          }

          contestList.appendChild(card);

          // –ê–Ω–∏–º–∏—Ä—É–µ–º –ø–æ—è–≤–ª–µ–Ω–∏–µ –Ω–æ–≤–æ–π –∫–∞—Ä—Ç–æ—á–∫–∏
          setTimeout(() => {
            card.style.opacity = '1';
            card.style.transform = 'translateY(0)';
          }, 10);
        });
        } catch (e) {
          contestList.innerHTML = '<div class="text-red-400 text-center py-4">–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∫–æ–Ω–∫—É—Ä—Å–æ–≤</div>';
        }
      }

      // ‚≠ê –°–∏—Å—Ç–µ–º–∞ –æ–ø—ã—Ç–∞ –∏ —É—Ä–æ–≤–Ω–µ–π –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
      // –£—Ä–æ–≤–Ω–∏: 1 (0-100), 2 (100-300), 3 (300-600), 4 (600-1000), 5 (1000+)
      function getLevelInfo(experience) {
        const levels = [
          { level: 1, minExp: 0, maxExp: 100 },
          { level: 2, minExp: 100, maxExp: 300 },
          { level: 3, minExp: 300, maxExp: 600 },
          { level: 4, minExp: 600, maxExp: 1000 },
          { level: 5, minExp: 1000, maxExp: Infinity }
        ];

        for (const levelInfo of levels) {
          if (experience >= levelInfo.minExp && experience < levelInfo.maxExp) {
            return {
              level: levelInfo.level,
              currentExp: experience - levelInfo.minExp,
              maxExp: levelInfo.maxExp === Infinity ? experience : levelInfo.maxExp - levelInfo.minExp,
              nextLevelExp: levelInfo.maxExp
            };
          }
        }

        // –ï—Å–ª–∏ –æ–ø—ã—Ç –±–æ–ª—å—à–µ –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–≥–æ –¥–ª—è —É—Ä–æ–≤–Ω—è 5
        return {
          level: 5,
          currentExp: experience - 1000,
          maxExp: experience - 1000,
          nextLevelExp: experience
        };
      }

      // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –∞–Ω–∏–º–∞—Ü–∏–∏ —Å—á–µ—Ç—á–∏–∫–∞ —á–∏—Å–µ–ª
      function animateNumber(element, fromValue, toValue, duration = 1000) {
        if (!element) return;
        
        // –ï—Å–ª–∏ –∑–Ω–∞—á–µ–Ω–∏—è –æ–¥–∏–Ω–∞–∫–æ–≤—ã–µ, –ø—Ä–æ—Å—Ç–æ —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∑–Ω–∞—á–µ–Ω–∏–µ –±–µ–∑ –∞–Ω–∏–º–∞—Ü–∏–∏
        if (fromValue === toValue) {
          element.textContent = toValue;
          return;
        }
        
        const startTime = Date.now();
        const difference = toValue - fromValue;
        
        function update() {
          const elapsed = Date.now() - startTime;
          const progress = Math.min(elapsed / duration, 1);
          
          // –ò—Å–ø–æ–ª—å–∑—É–µ–º easing —Ñ—É–Ω–∫—Ü–∏—é –¥–ª—è –ø–ª–∞–≤–Ω–æ—Å—Ç–∏
          const easeOutQuart = 1 - Math.pow(1 - progress, 4);
          const currentValue = Math.floor(fromValue + difference * easeOutQuart);
          
          element.textContent = currentValue;
          
          if (progress < 1) {
            requestAnimationFrame(update);
          } else {
            element.textContent = toValue;
          }
        }
        
        update();
      }

      function updateUserExperienceUI(experience, contestsParticipated, contestsWon) {
        const levelInfo = getLevelInfo(experience);
        const progressPercent = levelInfo.maxExp > 0
          ? Math.min(100, (levelInfo.currentExp / levelInfo.maxExp) * 100)
          : 0;

        // –û–±–Ω–æ–≤–ª—è–µ–º –±–µ–π–¥–∂ —É—Ä–æ–≤–Ω—è
        const levelBadge = document.getElementById('level-badge');
        if (levelBadge) {
          levelBadge.textContent = `–£—Ä–æ–≤–µ–Ω—å ${levelInfo.level}`;
        }

        // –û–±–Ω–æ–≤–ª—è–µ–º —Ç–µ–∫—É—â–∏–π –æ–ø—ã—Ç —Å –∞–Ω–∏–º–∞—Ü–∏–µ–π —Å—á–µ—Ç—á–∏–∫–∞
        const currentExpEl = document.getElementById('current-experience');
        if (currentExpEl) {
          const oldExp = parseInt(currentExpEl.textContent) || 0;
          if (oldExp !== experience) {
            animateNumber(currentExpEl, oldExp, experience, 1000);
          }
        }

        // –û–±–Ω–æ–≤–ª—è–µ–º –ø–æ–ª–æ—Å–∫—É –ø—Ä–æ–≥—Ä–µ—Å—Å–∞
        const progressBar = document.getElementById('experience-progress-bar');
        if (progressBar) {
          progressBar.style.width = `${progressPercent}%`;
          
          // –û–±–Ω–æ–≤–ª—è–µ–º –ø–æ–∑–∏—Ü–∏—é –ª–∞–ø–æ–∫ –¥–ª—è —Ç–µ–º—ã kitty (–æ–Ω–∏ –¥–æ–ª–∂–Ω—ã —Å–ª–µ–¥–æ–≤–∞—Ç—å –∑–∞ –∫–æ–Ω—Ü–æ–º –ø—Ä–æ–≥—Ä–µ—Å—Å-–±–∞—Ä–∞)
          if (document.body.classList.contains('theme-kitty')) {
            setTimeout(() => {
              const progressContainer = document.getElementById('progress-bar-container');
              if (progressContainer) {
                // –í—ã—á–∏—Å–ª—è–µ–º –ø–æ–∑–∏—Ü–∏—é –ª–∞–ø–æ–∫ –Ω–∞ –æ—Å–Ω–æ–≤–µ —à–∏—Ä–∏–Ω—ã –ø—Ä–æ–≥—Ä–µ—Å—Å-–±–∞—Ä–∞
                const containerWidth = progressContainer.offsetWidth;
                const pawPosition = (containerWidth * progressPercent / 100) - 15; // -15px –¥–ª—è —Å–º–µ—â–µ–Ω–∏—è –≤–ª–µ–≤–æ
                
                // –û–±–Ω–æ–≤–ª—è–µ–º –ø–æ–∑–∏—Ü–∏—é —á–µ—Ä–µ–∑ CSS –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é, –Ω–µ –ø–æ–∑–≤–æ–ª—è—è –≤—ã–π—Ç–∏ –∑–∞ –≥—Ä–∞–Ω–∏—Ü—ã
                progressContainer.style.setProperty('--paw-position', `${Math.max(0, Math.min(pawPosition, containerWidth - 20))}px`);
              }
            }, 50);
          }
        }

        // –û–±–Ω–æ–≤–ª—è–µ–º –≥—Ä–∞–Ω–∏—Ü—ã —É—Ä–æ–≤–Ω—è
        const currentLevelExp = document.getElementById('current-level-exp');
        const nextLevelExp = document.getElementById('next-level-exp');
        if (currentLevelExp) {
          currentLevelExp.textContent = levelInfo.currentExp;
        }
        if (nextLevelExp) {
          nextLevelExp.textContent = levelInfo.nextLevelExp === Infinity ? '‚àû' : levelInfo.nextLevelExp;
        }

        // –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É —Å –∞–Ω–∏–º–∞—Ü–∏–µ–π —Å—á–µ—Ç—á–∏–∫–∞
        const contestsParticipatedEl = document.getElementById('contests-participated');
        const contestsWonEl = document.getElementById('contests-won');
        
        if (contestsParticipatedEl) {
          // –ü—Ä–æ—Å—Ç–æ –æ–±–Ω–æ–≤–ª—è–µ–º –∑–Ω–∞—á–µ–Ω–∏–µ –±–µ–∑ –∞–Ω–∏–º–∞—Ü–∏–∏
          contestsParticipatedEl.textContent = contestsParticipated;
        }
        
        if (contestsWonEl) {
          const oldValue = parseInt(contestsWonEl.textContent) || 0;
          const newValue = contestsWon;
          
          // –£–±–∏—Ä–∞–µ–º —Å—Ç–∞—Ä—ã–µ –∫–ª–∞—Å—Å—ã –∞–Ω–∏–º–∞—Ü–∏–∏
          contestsWonEl.classList.remove('number-spin-up', 'number-spin-down');
          
          // –î–æ–±–∞–≤–ª—è–µ–º –∫–ª–∞—Å—Å –∞–Ω–∏–º–∞—Ü–∏–∏ –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏—è
          if (newValue > oldValue) {
            contestsWonEl.classList.add('number-spin-up');
          } else if (newValue < oldValue) {
            contestsWonEl.classList.add('number-spin-down');
          }
          
          // –ê–Ω–∏–º–∏—Ä—É–µ–º —Å—á–µ—Ç—á–∏–∫ —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –∑–Ω–∞—á–µ–Ω–∏—è –∏–∑–º–µ–Ω–∏–ª–∏—Å—å
          if (oldValue !== newValue) {
            setTimeout(() => {
              animateNumber(contestsWonEl, oldValue, newValue, 800);
            }, 50);
          } else {
            // –ï—Å–ª–∏ –∑–Ω–∞—á–µ–Ω–∏—è –æ–¥–∏–Ω–∞–∫–æ–≤—ã–µ, –ø—Ä–æ—Å—Ç–æ —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∑–Ω–∞—á–µ–Ω–∏–µ
            contestsWonEl.textContent = newValue;
          }
          
          // –£–±–∏—Ä–∞–µ–º –∫–ª–∞—Å—Å –∞–Ω–∏–º–∞—Ü–∏–∏ –ø–æ—Å–ª–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è
          setTimeout(() => {
            contestsWonEl.classList.remove('number-spin-up', 'number-spin-down');
          }, 850);
        }
      }

      // –ó–∞–≥—Ä—É–∑–∫–∞ –æ–ø—ã—Ç–∞ –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏–∑ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
      async function loadUserExperience(userId) {
        try {
          // –ü–æ–ª—É—á–∞–µ–º –ø—Ä–æ—Ñ–∏–ª—å —Å –æ–ø—ã—Ç–æ–º –∏–∑ API
          const profile = await window.fetchJSON(`/api/profile?tg_id=${userId}`);
          
          const experience = profile.experience || 0;
          const contestsParticipated = profile.contests_participated || 0;
          const contestsWon = profile.contests_won || 0;
          
          updateUserExperienceUI(experience, contestsParticipated, contestsWon);
        } catch (e) {
          console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –æ–ø—ã—Ç–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:', e);
          updateUserExperienceUI(0, 0, 0);
        }
      }

      // Profile - –¥–µ–ª–∞–µ–º —Ñ—É–Ω–∫—Ü–∏—é –¥–æ—Å—Ç—É–ø–Ω–æ–π –≥–ª–æ–±–∞–ª—å–Ω–æ
      window.loadProfile = async function() {
        try {
          const p = await window.fetchJSON('/api/profile');
          
          const usernameEl = document.getElementById('profile-username');
          if (usernameEl) {
            if (p.username) {
              usernameEl.textContent = p.username;
            } else {
              usernameEl.textContent = 'TestUser';
            }
          }
          const profileIdEl = document.getElementById('profile-id');
          if (profileIdEl && p.id) profileIdEl.textContent = p.id;
          if (p.first_login) {
            const firstLoginEl = document.getElementById('profile-first-login');
            if (firstLoginEl) firstLoginEl.textContent = toMoscowDateTime(p.first_login);
          }
          if (p.status) {
            const statusEl = document.getElementById('profile-status');
            if (statusEl) statusEl.textContent = p.status;
          }
          
          // –ó–∞–≥—Ä—É–∂–∞–µ–º –æ–ø—ã—Ç –∏ —É—Ä–æ–≤–Ω–∏ –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
          await loadUserExperience(currentUserId || 123456789);
        } catch (e) {
          console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –ø—Ä–æ—Ñ–∏–ª—è:', e);
          // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –¥–µ—Ñ–æ–ª—Ç–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è
          const usernameEl = document.getElementById('profile-username');
          if (usernameEl) usernameEl.textContent = 'TestUser';
          const profileIdEl = document.getElementById('profile-id');
          if (profileIdEl) profileIdEl.textContent = currentUserId || '123456789';
          const statusEl = document.getElementById('profile-status');
          if (statusEl) statusEl.textContent = 'user';
        }
      }

      // Rating - –∑–∞–≥—Ä—É–∑–∫–∞ —Ä–µ–π—Ç–∏–Ω–≥–∞
      let currentRatingRole = 'user';

      window.loadRating = async function(role = 'user') {
        try {
          currentRatingRole = role;
          const ratingList = document.getElementById('rating-list');
          if (!ratingList) return;

          ratingList.innerHTML = '<div class="text-center text-gray-400 py-8">–ó–∞–≥—Ä—É–∑–∫–∞ —Ä–µ–π—Ç–∏–Ω–≥–∞...</div>';

          const response = await window.fetchJSON(`/api/rating?role=${role}`);

          if (!response.success || !response.ratings) {
            ratingList.innerHTML = '<div class="text-center text-red-400 py-8">–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Ä–µ–π—Ç–∏–Ω–≥–∞</div>';
            return;
          }

          const ratings = response.ratings;
          if (ratings.length === 0) {
            ratingList.innerHTML = '<div class="text-center text-gray-400 py-8">–†–µ–π—Ç–∏–Ω–≥ –ø—É—Å—Ç</div>';
            return;
          }

          let html = '';
          ratings.forEach((item) => {
            const avatarHtml = item.avatar_url
              ? `<img src="${item.avatar_url}" alt="${item.username}" class="w-10 h-10 rounded-full object-cover" />`
              : `<div class="w-10 h-10 rounded-full bg-gradient-to-br from-violet-500 to-pink-500 flex items-center justify-center text-lg font-bold">${item.username ? item.username.charAt(0).toUpperCase() : '?'}</div>`;

            html += `
              <div class="rounded-lg border border-violet-400/30 p-4 bg-black/30 flex items-center gap-4">
                <div class="text-2xl font-bold text-violet-400 w-12 text-center">${item.place}</div>
                ${avatarHtml}
                <div class="flex-1">
                  <div class="font-semibold text-white">${item.username || `User_${item.telegram_id}`}</div>
                  <div class="text-sm text-gray-400">–ü–æ–±–µ–¥: ${item.wins} | –£—á–∞—Å—Ç–∏–π: ${item.participations}</div>
                </div>
                <div class="text-right">
                  <div class="text-xl font-bold text-violet-400">${item.rating}</div>
                  <div class="text-xs text-gray-400">—Ä–µ–π—Ç–∏–Ω–≥</div>
                </div>
              </div>
            `;
          });

          ratingList.innerHTML = html;
        } catch (e) {
          console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Ä–µ–π—Ç–∏–Ω–≥–∞:', e);
          const ratingList = document.getElementById('rating-list');
          if (ratingList) {
            ratingList.innerHTML = '<div class="text-center text-red-400 py-8">–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Ä–µ–π—Ç–∏–Ω–≥–∞</div>';
          }
        }
      };

      // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è —Ä–µ–π—Ç–∏–Ω–≥–∞
      setTimeout(function() {
        const usersBtn = document.getElementById('rating-users-btn');
        const adminsBtn = document.getElementById('rating-admins-btn');

        if (usersBtn) {
          usersBtn.addEventListener('click', () => {
            usersBtn.classList.add('active');
            if (adminsBtn) adminsBtn.classList.remove('active');
            window.loadRating('user');
          });
        }

        if (adminsBtn) {
          adminsBtn.addEventListener('click', () => {
            adminsBtn.classList.add('active');
            if (usersBtn) usersBtn.classList.remove('active');
            window.loadRating('admin');
          });
        }
      }, 1000);

      // First-login marker
      try {
        if (!localStorage.getItem('first_login_ts')) {
          const ts = new Date().toISOString();
          localStorage.setItem('first_login_ts', ts);
          // –í —Ç–µ—Å—Ç–æ–≤–æ–º —Ä–µ–∂–∏–º–µ –ø—Ä–æ–ø—É—Å–∫–∞–µ–º –∑–∞–ø—Ä–æ—Å
          // fetch('/api/profile/first_login', { method: 'POST' }).catch(() => {});
        }
        const stored = localStorage.getItem('first_login_ts');
        if (stored) document.getElementById('profile-first-login').textContent = toMoscowDateTime(stored);
      } catch (e) {}

      // Contact owner functionality - —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –ø–æ—Å–ª–µ –ø–æ–∫–∞–∑–∞ –ø–∞–Ω–µ–ª–∏
      function setupContactOwnerHandlers() {
        const contactOwnerBtn = document.getElementById('contact-owner-btn');
        const contactOwnerModal = document.getElementById('contact-owner-modal');
        const closeContactModal = document.getElementById('close-contact-modal');
        const sendContactMessage = document.getElementById('send-contact-message');

        function openModal(el) {
          if (!el) return;
          el.classList.remove('hidden');
          // –£–±–µ–∂–¥–∞–µ–º—Å—è, —á—Ç–æ –º–æ–¥–∞–ª–∫–∞ –∫–ª–∏–∫–∞–±–µ–ª—å–Ω–∞
          el.style.pointerEvents = 'auto';
          el.style.zIndex = '30';
          // –£–±–µ–∂–¥–∞–µ–º—Å—è, —á—Ç–æ –≤—Å–µ —ç–ª–µ–º–µ–Ω—Ç—ã –≤–Ω—É—Ç—Ä–∏ –º–æ–¥–∞–ª–∫–∏ –∫–ª–∏–∫–∞–±–µ–ª—å–Ω—ã
          const clickableElements = el.querySelectorAll('button, input, textarea, a, select');
          clickableElements.forEach(elem => {
            elem.style.pointerEvents = 'auto';
            elem.style.zIndex = '1';
          });
          // –ë–ª–æ–∫–∏—Ä—É–µ–º —Å–∫—Ä–æ–ª–ª body
          document.body.classList.add('modal-open');
        }
        function closeModal(el) {
          if (!el) return;
          el.classList.add('hidden');
          // –†–∞–∑–±–ª–æ–∫–∏—Ä—É–µ–º —Å–∫—Ä–æ–ª–ª body
          document.body.classList.remove('modal-open');
        }

        if (contactOwnerBtn) {
          // –£–¥–∞–ª—è–µ–º —Å—Ç–∞—Ä—ã–π –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –µ—Å–ª–∏ –µ—Å—Ç—å
          const newBtn = contactOwnerBtn.cloneNode(true);
          contactOwnerBtn.parentNode.replaceChild(newBtn, contactOwnerBtn);

          newBtn.addEventListener('click', (e) => {
            e.preventDefault();
            e.stopPropagation();
            console.log('‚úÖ –ö–ª–∏–∫ –ø–æ –∫–Ω–æ–ø–∫–µ "–°–≤—è–∑—å —Å –≤–ª–∞–¥–µ–ª—å—Ü–µ–º"');
            if (contactOwnerModal) {
              openModal(contactOwnerModal);
            }
          });
        }

        if (closeContactModal) {
          // –£–¥–∞–ª—è–µ–º —Å—Ç–∞—Ä—ã–π –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –µ—Å–ª–∏ –µ—Å—Ç—å
          const newCloseBtn = closeContactModal.cloneNode(true);
          closeContactModal.parentNode.replaceChild(newCloseBtn, closeContactModal);

          newCloseBtn.addEventListener('click', (e) => {
            e.preventDefault();
            e.stopPropagation();
            closeModal(contactOwnerModal);
            const messageInput = document.getElementById('contact-message-text');
            if (messageInput) messageInput.value = '';
          });
        }

        if (sendContactMessage) {
          // –£–¥–∞–ª—è–µ–º —Å—Ç–∞—Ä—ã–π –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –µ—Å–ª–∏ –µ—Å—Ç—å
          const newSendBtn = sendContactMessage.cloneNode(true);
          sendContactMessage.parentNode.replaceChild(newSendBtn, sendContactMessage);

          newSendBtn.addEventListener('click', async (e) => {
            e.preventDefault();
            e.stopPropagation();
            const messageInput = document.getElementById('contact-message-text');
            if (!messageInput) return;

            const messageText = messageInput.value.trim();
            if (!messageText) {
              alert('‚ö†Ô∏è –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤–≤–µ–¥–∏—Ç–µ —Å–æ–æ–±—â–µ–Ω–∏–µ');
              return;
            }

            if (!currentUserId) {
              alert('‚ö†Ô∏è –û—à–∏–±–∫–∞: –Ω–µ —É–¥–∞–ª–æ—Å—å –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è');
              return;
            }

            try {
              await window.fetchJSON('/api/messages', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({
                  from_user_id: currentUserId,
                  message_text: messageText
                })
              });
              alert('‚úÖ –°–æ–æ–±—â–µ–Ω–∏–µ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ –≤–ª–∞–¥–µ–ª—å—Ü—É!');
              closeModal(contactOwnerModal);
              messageInput.value = '';
            } catch (e) {
              console.error('–û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ —Å–æ–æ–±—â–µ–Ω–∏—è:', e);
              alert('–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ —Å–æ–æ–±—â–µ–Ω–∏—è');
            }
          });
        }
      }

      // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–æ–∫–∞–∑–∞ –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞ —Å –Ω–µ–ø–æ–¥–ø–∏—Å–∞–Ω–Ω—ã–º–∏ –∫–∞–Ω–∞–ª–∞–º–∏/—á–∞—Ç–∞–º–∏
      // –î–µ–ª–∞–µ–º —Ñ—É–Ω–∫—Ü–∏—é –¥–æ—Å—Ç—É–ø–Ω–æ–π –≥–ª–æ–±–∞–ª—å–Ω–æ
      window.showSubscriptionModal = function(contestId, notSubscribed, userId, username) {
        const modalEl = document.getElementById('subscription-modal');
        const listEl = document.getElementById('subscription-list');
        const verifyBtn = document.getElementById('verify-subscription-btn');
        const closeBtn = document.getElementById('close-subscription-modal');

        if (!modalEl || !listEl || !verifyBtn || !closeBtn) {
          console.error('–ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ');
          return;
        }

        // –ó–∞–ø–æ–ª–Ω—è–µ–º —Å–ø–∏—Å–æ–∫ –∫–∞–Ω–∞–ª–æ–≤/—á–∞—Ç–æ–≤
        listEl.innerHTML = notSubscribed.map(sub => {
          const link = sub.link.startsWith('http') ? sub.link : `https://${sub.link}`;
          return `
            <div class="subscription-item p-3 rounded-lg border border-violet-400/30 bg-black/30" data-username="${sub.username}">
              <div class="flex items-center justify-between">
                <div>
                  <div class="text-white font-semibold">${sub.name}</div>
                  <div class="text-gray-400 text-sm">${sub.type === 'channel' ? 'üì¢ –ö–∞–Ω–∞–ª' : 'üí¨ –ß–∞—Ç'}</div>
                </div>
                <a href="${link}" target="_blank" class="neon-button px-4 py-2 rounded-lg text-sm font-semibold text-white">
                  –ü—Ä–∏—Å–æ–µ–¥–∏–Ω–∏—Ç—å—Å—è
                </a>
              </div>
            </div>
          `;
        }).join('');

        // –°–±—Ä–∞—Å—ã–≤–∞–µ–º –ø—Ä–µ–¥—ã–¥—É—â–∏–µ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏, –∑–∞–º–µ–Ω—è—è –∫–Ω–æ–ø–∫–∏
        const newVerifyBtn = verifyBtn.cloneNode(true);
        verifyBtn.parentNode.replaceChild(newVerifyBtn, verifyBtn);
        const newCloseBtn = closeBtn.cloneNode(true);
        closeBtn.parentNode.replaceChild(newCloseBtn, closeBtn);

        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–Ω–æ–ø–∫–∏ "–í—ã–ø–æ–ª–Ω–∏–ª"
        newVerifyBtn.onclick = async () => {
          newVerifyBtn.disabled = true;
          newVerifyBtn.textContent = '‚è≥ –ü—Ä–æ–≤–µ—Ä–∫–∞...';

          try {
            const response = await window.fetchJSON(`/api/contests/${contestId}/verify-subscription`, {
              method: 'POST',
              headers: { 'Content-Type': 'application/json' },
              body: JSON.stringify({
                user_id: userId,
                username: username
              })
            });

            if (response.success) {
              // –£—Å–ø–µ—à–Ω–æ –ø—Ä–∏—Å–æ–µ–¥–∏–Ω–∏–ª–∏—Å—å –∫ –∫–æ–Ω–∫—É—Ä—Å—É —Ä–∏—Å—É–Ω–∫–æ–≤
              // –ó–∞–∫—Ä—ã–≤–∞–µ–º –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ
              modalEl.classList.add('hidden');

              // –û–±–Ω–æ–≤–ª—è–µ–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤ –¥–ª—è –∫–æ–Ω–∫—É—Ä—Å–∞ —Ä–∏—Å—É–Ω–∫–æ–≤
              const participantsCountEl = document.getElementById(`participants-count-${contestId}`);
              if (participantsCountEl) {
                const currentCount = parseInt(participantsCountEl.textContent) || 0;
                participantsCountEl.textContent = currentCount + 1;
              }

              // –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∂–∞–µ–º —Å–ø–∏—Å–æ–∫ –∫–æ–Ω–∫—É—Ä—Å–æ–≤, —á—Ç–æ–±—ã –ø–æ–∫–∞–∑–∞—Ç—å —Ñ–æ—Ä–º—É –∑–∞–≥—Ä—É–∑–∫–∏ —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–∏
              // –ò—Å–ø–æ–ª—å–∑—É–µ–º –ø–æ–ª–Ω—É—é –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫—É, —á—Ç–æ–±—ã –æ–±–Ω–æ–≤–∏—Ç—å —Å—Ç–∞—Ç—É—Å —É—á–∞—Å—Ç–Ω–∏–∫–∞
              await window.loadContests();
            } else {
              // –û–±–Ω–æ–≤–ª—è–µ–º —Å–ø–∏—Å–æ–∫ –Ω–µ–ø–æ–¥–ø–∏—Å–∞–Ω–Ω—ã—Ö –∫–∞–Ω–∞–ª–æ–≤/—á–∞—Ç–æ–≤, –≤—ã–¥–µ–ª—è—è –∏—Ö –∫—Ä–∞—Å–Ω—ã–º
              const items = listEl.querySelectorAll('.subscription-item');
              items.forEach(item => {
                item.classList.remove('border-red-500', 'bg-red-900/20');
                const nameEl = item.querySelector('.text-white');
                if (nameEl) {
                  nameEl.classList.remove('text-red-400');
                }
              });

              if (response.not_subscribed && response.not_subscribed.length > 0) {
                response.not_subscribed.forEach(notSub => {
                  const item = Array.from(items).find(el => el.dataset.username === notSub.username);
                  if (item) {
                    item.classList.add('border-red-500', 'bg-red-900/20');
                    const nameEl = item.querySelector('.text-white');
                    if (nameEl) {
                      nameEl.classList.add('text-red-400');
                    }
                  }
                });
                alert('‚ùå –í—ã –Ω–µ –ø–æ–¥–ø–∏—Å–∞–Ω—ã –Ω–∞ –Ω–µ–∫–æ—Ç–æ—Ä—ã–µ –∫–∞–Ω–∞–ª—ã –∏ —á–∞—Ç—ã. –û–Ω–∏ –≤—ã–¥–µ–ª–µ–Ω—ã –∫—Ä–∞—Å–Ω—ã–º —Ü–≤–µ—Ç–æ–º.');
              } else {
                alert('‚ùå ' + (response.message || '–û—à–∏–±–∫–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø–æ–¥–ø–∏—Å–∫–∏'));
              }
            }
          } catch (e) {
            alert('‚ùå –û—à–∏–±–∫–∞: ' + (e.message || '–ù–µ —É–¥–∞–ª–æ—Å—å –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–æ–¥–ø–∏—Å–∫—É'));
          } finally {
            newVerifyBtn.disabled = false;
            newVerifyBtn.textContent = '‚úì –í—ã–ø–æ–ª–Ω–∏–ª';
          }
        };

        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–Ω–æ–ø–∫–∏ "–û—Ç–º–µ–Ω–∞"
        newCloseBtn.onclick = () => {
          modalEl.classList.add('hidden');
        };

        // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ
        modalEl.classList.remove('hidden');
      }

      // üñºÔ∏è –õ–æ–≥–∏–∫–∞ –¥–ª—è –º–æ–¥–∞–ª–æ–∫ –∫–æ–ª–ª–µ–∫—Ü–∏–π NFT
      let currentCollectionContestId = null;
      let collectionNftLinks = [];
      let collectionNftOrder = [0, 1, 2, 3, 4, 5, 6, 7, 8]; // –ü–æ—Ä—è–¥–æ–∫ NFT –≤ —Å–µ—Ç–∫–µ
      let draggedElement = null;
      let draggedIndex = null;

      // –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –¥–ª—è touch —Å–æ–±—ã—Ç–∏–π (–º–æ–±–∏–ª—å–Ω—ã–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞)
      let touchStartElement = null;
      let touchStartIndex = null;
      let touchStartX = null;
      let touchStartY = null;
      let touchCurrentElement = null;
      let touchGhostElement = null;

      // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ—Ç–∫—Ä—ã—Ç–∏—è –º–æ–¥–∞–ª–∫–∏ –≤–≤–æ–¥–∞ —Å—Å—ã–ª–æ–∫ –Ω–∞ NFT
      window.openCollectionSubmissionModal = function(contestId) {
        currentCollectionContestId = contestId;
        collectionNftLinks = [];
        collectionNftOrder = [0, 1, 2, 3, 4, 5, 6, 7, 8];

        const linksModal = document.getElementById('collection-links-modal');
        const inputsContainer = document.getElementById('collection-links-inputs');
        const continueBtn = document.getElementById('collection-links-continue');
        const enteredCount = document.getElementById('collection-links-entered');
        const errorEl = document.getElementById('collection-links-error');

        if (!linksModal || !inputsContainer) {
          console.error('–ú–æ–¥–∞–ª–∫–∞ –≤–≤–æ–¥–∞ —Å—Å—ã–ª–æ–∫ –Ω–µ –Ω–∞–π–¥–µ–Ω–∞');
          return;
        }

        // –û—á–∏—â–∞–µ–º –ø—Ä–µ–¥—ã–¥—É—â–∏–µ –ø–æ–ª—è –≤–≤–æ–¥–∞
        inputsContainer.innerHTML = '';
        errorEl.classList.add('hidden');
        errorEl.textContent = '';

        // –°–æ–∑–¥–∞–µ–º 9 –ø–æ–ª–µ–π –≤–≤–æ–¥–∞
        for (let i = 0; i < 9; i++) {
          const inputWrapper = document.createElement('div');
          inputWrapper.className = 'flex items-center gap-2';
          inputWrapper.innerHTML = `
            <label class="text-sm text-gray-400 w-8 flex-shrink-0">${i + 1}.</label>
            <input
              type="text"
              id="nft-link-${i}"
              class="flex-1 bg-black/40 border border-violet-400/30 rounded-lg px-4 py-2 text-white placeholder-gray-500 focus:border-violet-400 focus:outline-none"
              placeholder="t.me/nft/–Ω–∞–∑–≤–∞–Ω–∏–µ-–Ω–æ–º–µ—Ä"
              data-index="${i}"
            />
            <div id="nft-link-status-${i}" class="w-6 h-6 flex items-center justify-center"></div>
          `;
          inputsContainer.appendChild(inputWrapper);

          // –î–æ–±–∞–≤–ª—è–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –∏–∑–º–µ–Ω–µ–Ω–∏—è –¥–ª—è –≤–∞–ª–∏–¥–∞—Ü–∏–∏
          const input = inputWrapper.querySelector(`#nft-link-${i}`);
          const statusEl = inputWrapper.querySelector(`#nft-link-status-${i}`);

          input.addEventListener('input', function() {
            validateNftLink(i);
            updateContinueButton();
          });
        }

        // –û–±–Ω–æ–≤–ª—è–µ–º —Å—á–µ—Ç—á–∏–∫
        enteredCount.textContent = '0';
        continueBtn.disabled = true;

        // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –º–æ–¥–∞–ª–∫—É
        linksModal.classList.remove('hidden');
        document.body.classList.add('modal-open');
      };

      // –í–∞–ª–∏–¥–∞—Ü–∏—è —Å—Å—ã–ª–∫–∏ –Ω–∞ NFT
      function validateNftLink(index) {
        const input = document.getElementById(`nft-link-${index}`);
        const statusEl = document.getElementById(`nft-link-status-${index}`);
        const errorEl = document.getElementById('collection-links-error');

        if (!input || !statusEl) return;

        const link = input.value.trim();
        const nftLinkPattern = /^t\.me\/nft\/[a-zA-Z0-9_-]+$/;

        if (!link) {
          statusEl.innerHTML = '';
          collectionNftLinks[index] = null;
          errorEl.classList.add('hidden');
          return;
        }

        if (nftLinkPattern.test(link)) {
          statusEl.innerHTML = '<span class="text-green-400 text-xl">‚úì</span>';
          collectionNftLinks[index] = link;
          errorEl.classList.add('hidden');
          input.classList.remove('border-red-400');
          input.classList.add('border-green-400/50');
        } else {
          statusEl.innerHTML = '<span class="text-red-400 text-xl">‚úï</span>';
          collectionNftLinks[index] = null;
          errorEl.textContent = '–ù–µ–≤–µ—Ä–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç —Å—Å—ã–ª–∫–∏. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Ñ–æ—Ä–º–∞—Ç: t.me/nft/–Ω–∞–∑–≤–∞–Ω–∏–µ-–Ω–æ–º–µ—Ä';
          errorEl.classList.remove('hidden');
          input.classList.remove('border-green-400/50');
          input.classList.add('border-red-400');
        }

        updateLinkCount();
      }

      // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—á–µ—Ç—á–∏–∫–∞ –≤–≤–µ–¥–µ–Ω–Ω—ã—Ö —Å—Å—ã–ª–æ–∫
      function updateLinkCount() {
        const enteredCount = document.getElementById('collection-links-entered');
        const validLinks = collectionNftLinks.filter(link => link !== null && link !== undefined);
        if (enteredCount) {
          enteredCount.textContent = validLinks.length;
        }
      }

      // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–Ω–æ–ø–∫–∏ "–ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å"
      function updateContinueButton() {
        const continueBtn = document.getElementById('collection-links-continue');
        const validLinks = collectionNftLinks.filter(link => link !== null && link !== undefined);

        if (continueBtn) {
          if (validLinks.length === 9) {
            continueBtn.disabled = false;
          } else {
            continueBtn.disabled = true;
          }
        }
      }

      // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ—Ç–∫—Ä—ã—Ç–∏—è –º–æ–¥–∞–ª–∫–∏ —Ä–∞—Å—Å—Ç–∞–Ω–æ–≤–∫–∏ NFT
      function openCollectionArrangeModal() {
        const linksModal = document.getElementById('collection-links-modal');
        const arrangeModal = document.getElementById('collection-arrange-modal');
        const gridContainer = document.getElementById('collection-grid');

        if (!arrangeModal || !gridContainer) {
          console.error('–ú–æ–¥–∞–ª–∫–∞ —Ä–∞—Å—Å—Ç–∞–Ω–æ–≤–∫–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω–∞');
          return;
        }

        // –°–∫—Ä—ã–≤–∞–µ–º –º–æ–¥–∞–ª–∫—É –≤–≤–æ–¥–∞ —Å—Å—ã–ª–æ–∫
        if (linksModal) {
          linksModal.classList.add('hidden');
        }

        // –û—á–∏—â–∞–µ–º —Å–µ—Ç–∫—É
        gridContainer.innerHTML = '';

        // –°–æ–∑–¥–∞–µ–º —Å–µ—Ç–∫—É 3x3 —Å NFT
        const validLinks = collectionNftLinks.filter(link => link !== null && link !== undefined);
        if (validLinks.length !== 9) {
          alert('–û—à–∏–±–∫–∞: –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å 9 —Å—Å—ã–ª–æ–∫ –Ω–∞ NFT');
          return;
        }

        // –°–æ–∑–¥–∞–µ–º —ç–ª–µ–º–µ–Ω—Ç—ã –¥–ª—è —Å–µ—Ç–∫–∏
        for (let i = 0; i < 9; i++) {
          const gridItem = document.createElement('div');
          const linkIndex = collectionNftOrder[i];
          const nftLink = collectionNftLinks[linkIndex];

          gridItem.className = 'aspect-square rounded-lg overflow-hidden border-2 border-violet-400/30 bg-black/40 cursor-move relative group';
          gridItem.draggable = true;
          gridItem.dataset.index = i;
          gridItem.dataset.linkIndex = linkIndex;
          gridItem.style.width = '100%';
          gridItem.style.maxWidth = '100%';
          gridItem.style.boxSizing = 'border-box';
          gridItem.style.minWidth = '0';
          gridItem.style.overflow = 'hidden';

          // –ù–æ—Ä–º–∞–ª–∏–∑—É–µ–º —Å—Å—ã–ª–∫—É
          const normalizedLink = nftLink.startsWith('http') ? nftLink : (nftLink ? 'https://' + nftLink : '');
          const previewUrl = `/api/nft-preview?nft_link=${encodeURIComponent(normalizedLink)}`;

          gridItem.innerHTML = `
            <div class="w-full h-full flex items-center justify-center bg-black/50 relative" style="width: 100%; height: 100%; max-width: 100%; box-sizing: border-box; overflow: hidden;">
              <img
                src="${previewUrl}"
                alt="NFT ${i + 1}"
                class="w-full h-full object-cover"
                draggable="false"
                style="width: 100%; height: 100%; max-width: 100%; object-fit: cover; display: block;"
                onerror="this.style.display='none'; this.nextElementSibling.classList.remove('hidden');"
                onload="this.parentElement.querySelector('.nft-loading').classList.add('hidden');"
                oncontextmenu="return false;"
              />
              <div class="nft-loading absolute inset-0 flex items-center justify-center bg-black/70" style="width: 100%; height: 100%; box-sizing: border-box;">
                <div class="text-2xl opacity-70 animate-spin">‚è≥</div>
              </div>
              <div class="hidden w-full h-full flex items-center justify-center bg-black/50" style="width: 100%; height: 100%; box-sizing: border-box;">
                <div class="text-2xl opacity-70">üñºÔ∏è</div>
              </div>
              <div class="absolute top-2 left-2 bg-black/70 text-white text-xs px-2 py-1 rounded pointer-events-none" style="box-sizing: border-box;">
                ${i + 1}
              </div>
            </div>
          `;

          // –ó–∞–ø—Ä–µ—â–∞–µ–º –∫–æ–Ω—Ç–µ–∫—Å—Ç–Ω–æ–µ –º–µ–Ω—é (–ø—Ä–∞–≤—ã–π –∫–ª–∏–∫)
          gridItem.addEventListener('contextmenu', function(e) {
            e.preventDefault();
            return false;
          });

          // –ó–∞–ø—Ä–µ—â–∞–µ–º –≤—ã–¥–µ–ª–µ–Ω–∏–µ —Ç–µ–∫—Å—Ç–∞ –ø—Ä–∏ –¥–ª–∏—Ç–µ–ª—å–Ω–æ–º –Ω–∞–∂–∞—Ç–∏–∏
          gridItem.addEventListener('selectstart', function(e) {
            e.preventDefault();
            return false;
          });

          // –î–æ–±–∞–≤–ª—è–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ drag and drop (–¥–ª—è –ü–ö)
          gridItem.addEventListener('dragstart', handleDragStart);
          gridItem.addEventListener('dragover', handleDragOver);
          gridItem.addEventListener('dragleave', handleDragLeave);
          gridItem.addEventListener('drop', handleDrop);
          gridItem.addEventListener('dragend', handleDragEnd);

          // –î–æ–±–∞–≤–ª—è–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ touch —Å–æ–±—ã—Ç–∏–π (–¥–ª—è –º–æ–±–∏–ª—å–Ω—ã—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤)
          gridItem.addEventListener('touchstart', handleTouchStart, { passive: false });
          gridItem.addEventListener('touchmove', handleTouchMove, { passive: false });
          gridItem.addEventListener('touchend', handleTouchEnd, { passive: false });
          gridItem.addEventListener('touchcancel', handleTouchCancel, { passive: false });

          gridContainer.appendChild(gridItem);
        }

        // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –º–æ–¥–∞–ª–∫—É —Ä–∞—Å—Å—Ç–∞–Ω–æ–≤–∫–∏
        arrangeModal.classList.remove('hidden');
        document.body.classList.add('modal-open');
      }

      // –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –¥–ª—è –∑–∞–º–µ–Ω—ã –¥–≤—É—Ö —ç–ª–µ–º–µ–Ω—Ç–æ–≤ –º–µ—Å—Ç–∞–º–∏
      function swapElements(el1, el2) {
        const parent1 = el1.parentNode;
        const parent2 = el2.parentNode;

        if (parent1 !== parent2) return false; // –≠–ª–µ–º–µ–Ω—Ç—ã –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –≤ –æ–¥–Ω–æ–º —Ä–æ–¥–∏—Ç–µ–ª–µ

        const next1 = el1.nextSibling;
        const next2 = el2.nextSibling;

        // –í—Å—Ç–∞–≤–ª—è–µ–º el2 –Ω–∞ –º–µ—Å—Ç–æ el1
        parent1.insertBefore(el2, next1);

        // –í—Å—Ç–∞–≤–ª—è–µ–º el1 –Ω–∞ –º–µ—Å—Ç–æ el2
        // –ï—Å–ª–∏ el2 –±—ã–ª –ø–æ—Å–ª–µ el1, —Ç–æ next2 —É–∂–µ –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –∏–ª–∏ –∏–∑–º–µ–Ω–∏–ª—Å—è
        // –ü–æ—ç—Ç–æ–º—É –Ω—É–∂–Ω–æ –Ω–∞–π—Ç–∏ –ø—Ä–∞–≤–∏–ª—å–Ω—É—é –ø–æ–∑–∏—Ü–∏—é
        if (next2 && next2 !== el1) {
          parent2.insertBefore(el1, next2);
        } else {
          // –ï—Å–ª–∏ el2 –±—ã–ª –ø–æ—Å–ª–µ–¥–Ω–∏–º –∏–ª–∏ next2 —É–∫–∞–∑—ã–≤–∞–µ—Ç –Ω–∞ el1 (–∫–æ—Ç–æ—Ä—ã–π —É–∂–µ –ø–µ—Ä–µ–º–µ—â–µ–Ω)
          // –ù—É–∂–Ω–æ –Ω–∞–π—Ç–∏ –ø—Ä–∞–≤–∏–ª—å–Ω—É—é –ø–æ–∑–∏—Ü–∏—é
          const allChildren = Array.from(parent2.children);
          const el2Index = allChildren.indexOf(el2);
          if (el2Index < allChildren.length - 1) {
            parent2.insertBefore(el1, allChildren[el2Index + 1]);
          } else {
            parent2.appendChild(el1);
          }
        }

        return true;
      }

      // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ drag and drop
      function handleDragStart(e) {
        draggedElement = this;
        draggedIndex = parseInt(this.dataset.index);
        this.classList.add('dragging');
        e.dataTransfer.effectAllowed = 'move';
        // –ù–µ –ø–µ—Ä–µ–¥–∞–µ–º –¥–∞–Ω–Ω—ã–µ, —á—Ç–æ–±—ã –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—Ç–∏—Ç—å –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ
        e.dataTransfer.setData('text/plain', this.dataset.index);
        // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –ø—É—Å—Ç–æ–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –¥–ª—è drag preview
        const dragImage = document.createElement('div');
        dragImage.style.position = 'absolute';
        dragImage.style.top = '-1000px';
        dragImage.innerHTML = this.innerHTML;
        document.body.appendChild(dragImage);
        e.dataTransfer.setDragImage(dragImage, 0, 0);
        setTimeout(() => document.body.removeChild(dragImage), 0);
      }

      function handleDragOver(e) {
        if (e.preventDefault) {
          e.preventDefault();
        }
        e.dataTransfer.dropEffect = 'move';

        // –£–±–∏—Ä–∞–µ–º –ø–æ–¥—Å–≤–µ—Ç–∫—É —Å–æ –≤—Å–µ—Ö —ç–ª–µ–º–µ–Ω—Ç–æ–≤
        const gridItems = document.querySelectorAll('#collection-grid > div');
        gridItems.forEach(item => {
          if (item !== draggedElement) {
            item.classList.remove('drag-over');
          }
        });

        // –ü–æ–¥—Å–≤–µ—á–∏–≤–∞–µ–º —ç–ª–µ–º–µ–Ω—Ç, –Ω–∞–¥ –∫–æ—Ç–æ—Ä—ã–º –ø–µ—Ä–µ—Ç–∞—Å–∫–∏–≤–∞–µ–º
        if (this !== draggedElement) {
          this.classList.add('drag-over');
        }

        return false;
      }

      function handleDragLeave(e) {
        // –£–±–∏—Ä–∞–µ–º –ø–æ–¥—Å–≤–µ—Ç–∫—É –ø—Ä–∏ —É—Ö–æ–¥–µ —Å —ç–ª–µ–º–µ–Ω—Ç–∞
        this.classList.remove('drag-over');
      }

      function handleDrop(e) {
        if (e.stopPropagation) {
          e.stopPropagation();
        }

        e.preventDefault();

        if (draggedElement && draggedElement !== this) {
          const gridContainer = document.getElementById('collection-grid');
          if (!gridContainer) return false;

          const sourceElement = draggedElement;
          const targetElement = this;

          // –ü–æ–ª—É—á–∞–µ–º —Ç–µ–∫—É—â–∏–µ –∏–Ω–¥–µ–∫—Å—ã –¥–æ –ø–µ—Ä–µ—Å—Ç–∞–Ω–æ–≤–∫–∏
          const allItems = Array.from(gridContainer.children);
          const sourceIndex = allItems.indexOf(sourceElement);
          const targetIndex = allItems.indexOf(targetElement);

          if (sourceIndex === -1 || targetIndex === -1 || sourceIndex === targetIndex) return false;

          // –ü—Ä–æ—Å—Ç–∞—è –∏ –Ω–∞–¥–µ–∂–Ω–∞—è –∑–∞–º–µ–Ω–∞ –¥–≤—É—Ö —ç–ª–µ–º–µ–Ω—Ç–æ–≤
          // –°–æ—Ö—Ä–∞–Ω—è–µ–º —Å—Å—ã–ª–∫–∏ –Ω–∞ —Å–ª–µ–¥—É—é—â–∏–µ —ç–ª–µ–º–µ–Ω—Ç—ã –î–û –ø–µ—Ä–µ–º–µ—â–µ–Ω–∏—è
          const sourceNextSibling = sourceElement.nextSibling;
          const targetNextSibling = targetElement.nextSibling;

          // –ï—Å–ª–∏ —ç–ª–µ–º–µ–Ω—Ç—ã —Å–æ—Å–µ–¥–Ω–∏–µ (–∏–Ω–¥–µ–∫—Å –æ—Ç–ª–∏—á–∞–µ—Ç—Å—è –Ω–∞ 1)
          if (Math.abs(sourceIndex - targetIndex) === 1) {
            // –ü—Ä–æ—Å—Ç–∞—è –∑–∞–º–µ–Ω–∞ —Å–æ—Å–µ–¥–Ω–∏—Ö —ç–ª–µ–º–µ–Ω—Ç–æ–≤
            if (sourceIndex < targetIndex) {
              // source –ø–µ—Ä–µ–¥ target: target -> source, source -> –ø–æ—Å–ª–µ target
              gridContainer.insertBefore(targetElement, sourceElement);
              gridContainer.insertBefore(sourceElement, targetNextSibling);
            } else {
              // target –ø–µ—Ä–µ–¥ source: source -> target, target -> –ø–æ—Å–ª–µ source
              gridContainer.insertBefore(sourceElement, targetElement);
              gridContainer.insertBefore(targetElement, sourceNextSibling);
            }
          } else {
            // –≠–ª–µ–º–µ–Ω—Ç—ã –Ω–µ —Å–æ—Å–µ–¥–Ω–∏–µ - –∏—Å–ø–æ–ª—å–∑—É–µ–º –¥–≤–∞ —à–∞–≥–∞
            // –®–∞–≥ 1: –ü–µ—Ä–µ–º–µ—â–∞–µ–º target –Ω–∞ –º–µ—Å—Ç–æ source
            if (sourceNextSibling) {
              gridContainer.insertBefore(targetElement, sourceNextSibling);
            } else {
              gridContainer.appendChild(targetElement);
            }

            // –®–∞–≥ 2: –ü–µ—Ä–µ–º–µ—â–∞–µ–º source –Ω–∞ –º–µ—Å—Ç–æ target
            // –¢–µ–ø–µ—Ä—å target —É–∂–µ –ø–µ—Ä–µ–º–µ—â–µ–Ω, –Ω–∞—Ö–æ–¥–∏–º –µ–≥–æ –Ω–æ–≤—É—é –ø–æ–∑–∏—Ü–∏—é
            const allItemsAfterStep1 = Array.from(gridContainer.children);
            const targetNewIndex = allItemsAfterStep1.indexOf(targetElement);

            // –ù–∞—Ö–æ–¥–∏–º —ç–ª–µ–º–µ–Ω—Ç, –∫–æ—Ç–æ—Ä—ã–π –±—ã–ª –ø–æ—Å–ª–µ target –∏–∑–Ω–∞—á–∞–ª—å–Ω–æ
            const targetOriginalNext = allItems[targetIndex + 1];
            if (targetOriginalNext && targetOriginalNext !== sourceElement) {
              // –í—Å—Ç–∞–≤–ª—è–µ–º source –ø–µ—Ä–µ–¥ —ç–ª–µ–º–µ–Ω—Ç–æ–º, –∫–æ—Ç–æ—Ä—ã–π –±—ã–ª –ø–æ—Å–ª–µ target
              gridContainer.insertBefore(sourceElement, targetOriginalNext);
            } else if (targetNewIndex < allItemsAfterStep1.length - 1) {
              // target –Ω–µ –ø–æ—Å–ª–µ–¥–Ω–∏–π –ø–æ—Å–ª–µ –ø–µ—Ä–µ–º–µ—â–µ–Ω–∏—è, –≤—Å—Ç–∞–≤–ª—è–µ–º source –ø–æ—Å–ª–µ target
              const afterTarget = allItemsAfterStep1[targetNewIndex + 1];
              if (afterTarget && afterTarget !== sourceElement) {
                gridContainer.insertBefore(sourceElement, afterTarget);
              } else {
                gridContainer.appendChild(sourceElement);
              }
            } else {
              // target –ø–æ—Å–ª–µ–¥–Ω–∏–π, –¥–æ–±–∞–≤–ª—è–µ–º source –≤ –∫–æ–Ω–µ—Ü
              gridContainer.appendChild(sourceElement);
            }
          }

          // –û–±–Ω–æ–≤–ª—è–µ–º data-index –∞—Ç—Ä–∏–±—É—Ç—ã –∏ –Ω–æ–º–µ—Ä–∞ –ø–æ–∑–∏—Ü–∏–π
          const newItems = Array.from(gridContainer.children);
          newItems.forEach((item, idx) => {
            item.dataset.index = idx;
            // –û–±–Ω–æ–≤–ª—è–µ–º –Ω–æ–º–µ—Ä –ø–æ–∑–∏—Ü–∏–∏ –≤ –±–µ–π–¥–∂–µ
            const positionBadge = item.querySelector('.absolute.top-2.left-2');
            if (positionBadge) {
              positionBadge.textContent = idx + 1;
            }
          });

          // –ú–µ–Ω—è–µ–º –º–µ—Å—Ç–∞–º–∏ –≤ –º–∞—Å—Å–∏–≤–µ order –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –ø—Ä–∞–≤–∏–ª—å–Ω–æ–≥–æ –ø–æ—Ä—è–¥–∫–∞ —Å—Å—ã–ª–æ–∫
          const tempOrder = collectionNftOrder[sourceIndex];
          collectionNftOrder[sourceIndex] = collectionNftOrder[targetIndex];
          collectionNftOrder[targetIndex] = tempOrder;
        }

        // –£–±–∏—Ä–∞–µ–º –ø–æ–¥—Å–≤–µ—Ç–∫—É
        const gridItems = document.querySelectorAll('#collection-grid > div');
        gridItems.forEach(item => {
          item.classList.remove('drag-over');
        });

        return false;
      }

      function handleDragEnd(e) {
        // –£–±–∏—Ä–∞–µ–º –∫–ª–∞—Å—Å dragging
        if (this) {
          this.classList.remove('dragging');
        }

        // –£–±–∏—Ä–∞–µ–º –ø–æ–¥—Å–≤–µ—Ç–∫—É —Å–æ –≤—Å–µ—Ö —ç–ª–µ–º–µ–Ω—Ç–æ–≤
        const gridItems = document.querySelectorAll('#collection-grid > div');
        gridItems.forEach(item => {
          item.classList.remove('drag-over', 'dragging');
        });

        draggedElement = null;
        draggedIndex = null;
      }

      // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ touch —Å–æ–±—ã—Ç–∏–π –¥–ª—è –º–æ–±–∏–ª—å–Ω—ã—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤
      function handleTouchStart(e) {
        if (e.touches.length !== 1) return; // –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º —Ç–æ–ª—å–∫–æ –æ–¥–Ω–æ –∫–∞—Å–∞–Ω–∏–µ

        e.preventDefault();
        e.stopPropagation();

        touchStartElement = this;
        touchStartIndex = parseInt(this.dataset.index);
        touchStartX = e.touches[0].clientX;
        touchStartY = e.touches[0].clientY;
        touchCurrentElement = this;

        // –î–æ–±–∞–≤–ª—è–µ–º –≤–∏–∑—É–∞–ª—å–Ω—É—é –æ–±—Ä–∞—Ç–Ω—É—é —Å–≤—è–∑—å
        this.classList.add('dragging');
        this.style.opacity = '0.7';
        this.style.transform = 'scale(1.1)';
        this.style.zIndex = '1000';
        this.style.transition = 'none';

        // –°–æ–∑–¥–∞–µ–º "–ø—Ä–∏–∑—Ä–∞—á–Ω—ã–π" —ç–ª–µ–º–µ–Ω—Ç –¥–ª—è –≤–∏–∑—É–∞–ª—å–Ω–æ–π –æ–±—Ä–∞—Ç–Ω–æ–π —Å–≤—è–∑–∏
        const rect = this.getBoundingClientRect();
        touchGhostElement = this.cloneNode(true);
        touchGhostElement.style.position = 'fixed';
        touchGhostElement.style.left = rect.left + 'px';
        touchGhostElement.style.top = rect.top + 'px';
        touchGhostElement.style.width = rect.width + 'px';
        touchGhostElement.style.height = rect.height + 'px';
        touchGhostElement.style.pointerEvents = 'none';
        touchGhostElement.style.zIndex = '10000';
        touchGhostElement.style.opacity = '0.8';
        touchGhostElement.style.transform = 'scale(1.05) rotate(2deg)';
        touchGhostElement.style.boxShadow = '0 10px 40px rgba(124, 58, 237, 0.6), 0 0 60px rgba(236, 72, 153, 0.4)';
        touchGhostElement.style.transition = 'none';
        touchGhostElement.style.border = '2px solid rgba(167, 139, 250, 0.8)';
        // –£–¥–∞–ª—è–µ–º –≤—Å–µ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Å–æ–±—ã—Ç–∏–π –∏–∑ –∫–ª–æ–Ω–∞ –∏ –æ—Ç–∫–ª—é—á–∞–µ–º –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ
        const allChildren = touchGhostElement.querySelectorAll('*');
        allChildren.forEach(child => {
          child.style.pointerEvents = 'none';
        });
        document.body.appendChild(touchGhostElement);

        // –£–±–∏—Ä–∞–µ–º –ø–æ–¥—Å–≤–µ—Ç–∫—É —Å–æ –≤—Å–µ—Ö —ç–ª–µ–º–µ–Ω—Ç–æ–≤
        const gridItems = document.querySelectorAll('#collection-grid > div');
        gridItems.forEach(item => {
          if (item !== this) {
            item.classList.remove('drag-over');
          }
        });
      }

      function handleTouchMove(e) {
        if (!touchStartElement || e.touches.length !== 1) return;

        e.preventDefault();
        e.stopPropagation();

        const touch = e.touches[0];
        const currentX = touch.clientX;
        const currentY = touch.clientY;

        // –û–±–Ω–æ–≤–ª—è–µ–º –ø–æ–∑–∏—Ü–∏—é "–ø—Ä–∏–∑—Ä–∞—á–Ω–æ–≥–æ" —ç–ª–µ–º–µ–Ω—Ç–∞
        if (touchGhostElement) {
          const rect = touchStartElement.getBoundingClientRect();
          const offsetX = rect.width / 2;
          const offsetY = rect.height / 2;
          touchGhostElement.style.left = (currentX - offsetX) + 'px';
          touchGhostElement.style.top = (currentY - offsetY) + 'px';
        }

        // –û–ø—Ä–µ–¥–µ–ª—è–µ–º, –Ω–∞–¥ –∫–∞–∫–∏–º —ç–ª–µ–º–µ–Ω—Ç–æ–º –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –ø–∞–ª–µ—Ü
        // –í—Ä–µ–º–µ–Ω–Ω–æ —Å–∫—Ä—ã–≤–∞–µ–º –ø—Ä–∏–∑—Ä–∞—á–Ω—ã–π —ç–ª–µ–º–µ–Ω—Ç –¥–ª—è –ø—Ä–∞–≤–∏–ª—å–Ω–æ–≥–æ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è —ç–ª–µ–º–µ–Ω—Ç–∞ –ø–æ–¥ –ø–∞–ª—å—Ü–µ–º
        if (touchGhostElement) {
          touchGhostElement.style.pointerEvents = 'none';
          touchGhostElement.style.opacity = '0.5';
        }

        const elementBelow = document.elementFromPoint(currentX, currentY);
        let targetGridItem = null;

        if (elementBelow) {
          // –ò—â–µ–º —ç–ª–µ–º–µ–Ω—Ç —Å–µ—Ç–∫–∏, –ø–µ—Ä–µ–±–∏—Ä–∞—è —Ä–æ–¥–∏—Ç–µ–ª–µ–π –¥–æ —Ç–µ—Ö –ø–æ—Ä, –ø–æ–∫–∞ –Ω–µ –Ω–∞–π–¥–µ–º —ç–ª–µ–º–µ–Ω—Ç —Å –∫–ª–∞—Å—Å–æ–º 'group'
          let currentElement = elementBelow;
          let depth = 0;
          const maxDepth = 10; // –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –≥–ª—É–±–∏–Ω—ã –ø–æ–∏—Å–∫–∞

          while (currentElement && depth < maxDepth && !targetGridItem) {
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —è–≤–ª—è–µ—Ç—Å—è –ª–∏ —ç–ª–µ–º–µ–Ω—Ç —ç–ª–µ–º–µ–Ω—Ç–æ–º —Å–µ—Ç–∫–∏
            if (currentElement.id === 'collection-grid') {
              break;
            }

            // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —è–≤–ª—è–µ—Ç—Å—è –ª–∏ —ç–ª–µ–º–µ–Ω—Ç –ø—Ä—è–º—ã–º –¥–æ—á–µ—Ä–Ω–∏–º —ç–ª–µ–º–µ–Ω—Ç–æ–º —Å–µ—Ç–∫–∏
            if (currentElement.parentElement && currentElement.parentElement.id === 'collection-grid') {
              targetGridItem = currentElement;
              break;
            }

            // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –∏–º–µ–µ—Ç –ª–∏ —ç–ª–µ–º–µ–Ω—Ç –∫–ª–∞—Å—Å 'group' –∏ —è–≤–ª—è–µ—Ç—Å—è –ª–∏ –æ–Ω –¥–æ—á–µ—Ä–Ω–∏–º —ç–ª–µ–º–µ–Ω—Ç–æ–º —Å–µ—Ç–∫–∏
            if (currentElement.classList && currentElement.classList.contains('group')) {
              let parent = currentElement.parentElement;
              while (parent) {
                if (parent.id === 'collection-grid') {
                  targetGridItem = currentElement;
                  break;
                }
                parent = parent.parentElement;
              }
              if (targetGridItem) break;
            }

            currentElement = currentElement.parentElement;
            depth++;
          }

          // –ï—Å–ª–∏ –Ω–µ –Ω–∞—à–ª–∏ —á–µ—Ä–µ–∑ –ø–µ—Ä–µ–±–æ—Ä, –ø—ã—Ç–∞–µ–º—Å—è –Ω–∞–π—Ç–∏ —á–µ—Ä–µ–∑ closest
          if (!targetGridItem) {
            targetGridItem = elementBelow.closest('#collection-grid > div');
          }
        }

        // –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –≤–∏–¥–∏–º–æ—Å—Ç—å –ø—Ä–∏–∑—Ä–∞—á–Ω–æ–≥–æ —ç–ª–µ–º–µ–Ω—Ç–∞
        if (touchGhostElement) {
          touchGhostElement.style.pointerEvents = 'none';
          touchGhostElement.style.opacity = '0.8';
        }

        if (targetGridItem && targetGridItem !== touchStartElement) {
          // –ü–æ–¥—Å–≤–µ—á–∏–≤–∞–µ–º —ç–ª–µ–º–µ–Ω—Ç, –Ω–∞–¥ –∫–æ—Ç–æ—Ä—ã–º –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –ø–∞–ª–µ—Ü
          const gridItems = document.querySelectorAll('#collection-grid > div');
          gridItems.forEach(item => {
            if (item !== touchStartElement) {
              item.classList.remove('drag-over');
            }
          });
          targetGridItem.classList.add('drag-over');
          touchCurrentElement = targetGridItem;
        } else {
          // –£–±–∏—Ä–∞–µ–º –ø–æ–¥—Å–≤–µ—Ç–∫—É, –µ—Å–ª–∏ –ø–∞–ª–µ—Ü –Ω–µ –Ω–∞–¥ —ç–ª–µ–º–µ–Ω—Ç–æ–º —Å–µ—Ç–∫–∏
          const gridItems = document.querySelectorAll('#collection-grid > div');
          gridItems.forEach(item => {
            if (item !== touchStartElement) {
              item.classList.remove('drag-over');
            }
          });
          if (!targetGridItem || targetGridItem === touchStartElement) {
            touchCurrentElement = null;
          } else {
            touchCurrentElement = targetGridItem;
          }
        }
      }

      function handleTouchEnd(e) {
        if (!touchStartElement) return;

        e.preventDefault();
        e.stopPropagation();

        // –£–±–∏—Ä–∞–µ–º –≤–∏–∑—É–∞–ª—å–Ω—ã–µ —ç—Ñ—Ñ–µ–∫—Ç—ã
        touchStartElement.classList.remove('dragging');
        touchStartElement.style.opacity = '';
        touchStartElement.style.transform = '';
        touchStartElement.style.zIndex = '';
        touchStartElement.style.transition = '';

        // –£–¥–∞–ª—è–µ–º "–ø—Ä–∏–∑—Ä–∞—á–Ω—ã–π" —ç–ª–µ–º–µ–Ω—Ç
        if (touchGhostElement) {
          try {
            document.body.removeChild(touchGhostElement);
          } catch (err) {
            // –≠–ª–µ–º–µ–Ω—Ç —É–∂–µ —É–¥–∞–ª–µ–Ω
          }
          touchGhostElement = null;
        }

        // –ï—Å–ª–∏ –ø–∞–ª–µ—Ü –±—ã–ª –æ—Ç–ø—É—â–µ–Ω –Ω–∞–¥ –¥—Ä—É–≥–∏–º —ç–ª–µ–º–µ–Ω—Ç–æ–º, –º–µ–Ω—è–µ–º –∏—Ö –º–µ—Å—Ç–∞–º–∏
        if (touchCurrentElement && touchCurrentElement !== touchStartElement) {
          const gridContainer = document.getElementById('collection-grid');
          if (gridContainer) {
            const allItems = Array.from(gridContainer.children);
            const sourceIndex = allItems.indexOf(touchStartElement);
            const targetIndex = allItems.indexOf(touchCurrentElement);

            if (sourceIndex !== -1 && targetIndex !== -1 && sourceIndex !== targetIndex) {
              // –°–æ—Ö—Ä–∞–Ω—è–µ–º —Å—Å—ã–ª–∫–∏ –Ω–∞ —Å–ª–µ–¥—É—é—â–∏–µ —ç–ª–µ–º–µ–Ω—Ç—ã –î–û –ø–µ—Ä–µ—Å—Ç–∞–Ω–æ–≤–∫–∏
              const sourceNextSibling = touchStartElement.nextSibling;
              const targetNextSibling = touchCurrentElement.nextSibling;

              // –ï—Å–ª–∏ —ç–ª–µ–º–µ–Ω—Ç—ã —Å–æ—Å–µ–¥–Ω–∏–µ (–∏–Ω–¥–µ–∫—Å –æ—Ç–ª–∏—á–∞–µ—Ç—Å—è –Ω–∞ 1)
              if (Math.abs(sourceIndex - targetIndex) === 1) {
                // –ü—Ä–æ—Å—Ç–∞—è –∑–∞–º–µ–Ω–∞ —Å–æ—Å–µ–¥–Ω–∏—Ö —ç–ª–µ–º–µ–Ω—Ç–æ–≤
                if (sourceIndex < targetIndex) {
                  // source –ø–µ—Ä–µ–¥ target: target -> source, source -> –ø–æ—Å–ª–µ target
                  gridContainer.insertBefore(touchCurrentElement, touchStartElement);
                  gridContainer.insertBefore(touchStartElement, targetNextSibling);
                } else {
                  // target –ø–µ—Ä–µ–¥ source: source -> target, target -> –ø–æ—Å–ª–µ source
                  gridContainer.insertBefore(touchStartElement, touchCurrentElement);
                  gridContainer.insertBefore(touchCurrentElement, sourceNextSibling);
                }
              } else {
                // –≠–ª–µ–º–µ–Ω—Ç—ã –Ω–µ —Å–æ—Å–µ–¥–Ω–∏–µ - –∏—Å–ø–æ–ª—å–∑—É–µ–º –¥–≤–∞ —à–∞–≥–∞
                // –®–∞–≥ 1: –ü–µ—Ä–µ–º–µ—â–∞–µ–º target –Ω–∞ –º–µ—Å—Ç–æ source
                if (sourceNextSibling) {
                  gridContainer.insertBefore(touchCurrentElement, sourceNextSibling);
                } else {
                  gridContainer.appendChild(touchCurrentElement);
                }

                // –®–∞–≥ 2: –ü–µ—Ä–µ–º–µ—â–∞–µ–º source –Ω–∞ –º–µ—Å—Ç–æ target
                const allItemsAfterStep1 = Array.from(gridContainer.children);
                const targetNewIndex = allItemsAfterStep1.indexOf(touchCurrentElement);

                // –ù–∞—Ö–æ–¥–∏–º —ç–ª–µ–º–µ–Ω—Ç, –∫–æ—Ç–æ—Ä—ã–π –±—ã–ª –ø–æ—Å–ª–µ target –∏–∑–Ω–∞—á–∞–ª—å–Ω–æ
                const targetOriginalNext = allItems[targetIndex + 1];
                if (targetOriginalNext && targetOriginalNext !== touchStartElement) {
                  gridContainer.insertBefore(touchStartElement, targetOriginalNext);
                } else if (targetNewIndex < allItemsAfterStep1.length - 1) {
                  const afterTarget = allItemsAfterStep1[targetNewIndex + 1];
                  if (afterTarget && afterTarget !== touchStartElement) {
                    gridContainer.insertBefore(touchStartElement, afterTarget);
                  } else {
                    gridContainer.appendChild(touchStartElement);
                  }
                } else {
                  gridContainer.appendChild(touchStartElement);
                }
              }

              // –û–±–Ω–æ–≤–ª—è–µ–º data-index –∞—Ç—Ä–∏–±—É—Ç—ã –∏ –Ω–æ–º–µ—Ä–∞ –ø–æ–∑–∏—Ü–∏–π
              const newItems = Array.from(gridContainer.children);
              newItems.forEach((item, idx) => {
                item.dataset.index = idx;
                // –û–±–Ω–æ–≤–ª—è–µ–º –Ω–æ–º–µ—Ä –ø–æ–∑–∏—Ü–∏–∏ –≤ –±–µ–π–¥–∂–µ
                const positionBadge = item.querySelector('.absolute.top-2.left-2');
                if (positionBadge) {
                  positionBadge.textContent = idx + 1;
                }
              });

              // –ú–µ–Ω—è–µ–º –º–µ—Å—Ç–∞–º–∏ –≤ –º–∞—Å—Å–∏–≤–µ order –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –ø—Ä–∞–≤–∏–ª—å–Ω–æ–≥–æ –ø–æ—Ä—è–¥–∫–∞ —Å—Å—ã–ª–æ–∫
              const tempOrder = collectionNftOrder[sourceIndex];
              collectionNftOrder[sourceIndex] = collectionNftOrder[targetIndex];
              collectionNftOrder[targetIndex] = tempOrder;
            }
          }
        }

        // –£–±–∏—Ä–∞–µ–º –ø–æ–¥—Å–≤–µ—Ç–∫—É —Å–æ –≤—Å–µ—Ö —ç–ª–µ–º–µ–Ω—Ç–æ–≤
        const gridItems = document.querySelectorAll('#collection-grid > div');
        gridItems.forEach(item => {
          item.classList.remove('drag-over', 'dragging');
        });

        // –°–±—Ä–∞—Å—ã–≤–∞–µ–º –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ
        touchStartElement = null;
        touchStartIndex = null;
        touchStartX = null;
        touchStartY = null;
        touchCurrentElement = null;
      }

      function handleTouchCancel(e) {
        if (!touchStartElement) return;

        e.preventDefault();
        e.stopPropagation();

        // –£–±–∏—Ä–∞–µ–º –≤–∏–∑—É–∞–ª—å–Ω—ã–µ —ç—Ñ—Ñ–µ–∫—Ç—ã
        touchStartElement.classList.remove('dragging');
        touchStartElement.style.opacity = '';
        touchStartElement.style.transform = '';
        touchStartElement.style.zIndex = '';
        touchStartElement.style.transition = '';

        // –£–¥–∞–ª—è–µ–º "–ø—Ä–∏–∑—Ä–∞—á–Ω—ã–π" —ç–ª–µ–º–µ–Ω—Ç
        if (touchGhostElement) {
          try {
            document.body.removeChild(touchGhostElement);
          } catch (err) {
            // –≠–ª–µ–º–µ–Ω—Ç —É–∂–µ —É–¥–∞–ª–µ–Ω
          }
          touchGhostElement = null;
        }

        // –£–±–∏—Ä–∞–µ–º –ø–æ–¥—Å–≤–µ—Ç–∫—É —Å–æ –≤—Å–µ—Ö —ç–ª–µ–º–µ–Ω—Ç–æ–≤
        const gridItems = document.querySelectorAll('#collection-grid > div');
        gridItems.forEach(item => {
          item.classList.remove('drag-over', 'dragging');
        });

        // –°–±—Ä–∞—Å—ã–≤–∞–µ–º –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ
        touchStartElement = null;
        touchStartIndex = null;
        touchStartX = null;
        touchStartY = null;
        touchCurrentElement = null;
      }

      // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–µ—Ç–∫–∏ –ø–æ—Å–ª–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –ø–æ—Ä—è–¥–∫–∞
      function updateCollectionGrid() {
        const gridContainer = document.getElementById('collection-grid');
        if (!gridContainer) return;

        const validLinks = collectionNftLinks.filter(link => link !== null && link !== undefined);
        if (validLinks.length !== 9) return;

        // –ü–µ—Ä–µ—Å–æ–∑–¥–∞–µ–º —Å–µ—Ç–∫—É —Å –Ω–æ–≤—ã–º –ø–æ—Ä—è–¥–∫–æ–º
        gridContainer.innerHTML = '';

        for (let i = 0; i < 9; i++) {
          const gridItem = document.createElement('div');
          const linkIndex = collectionNftOrder[i];
          const nftLink = collectionNftLinks[linkIndex];

          gridItem.className = 'aspect-square rounded-lg overflow-hidden border-2 border-violet-400/30 bg-black/40 cursor-move relative group';
          gridItem.draggable = true;
          gridItem.dataset.index = i;
          gridItem.dataset.linkIndex = linkIndex;
          gridItem.style.width = '100%';
          gridItem.style.maxWidth = '100%';
          gridItem.style.boxSizing = 'border-box';
          gridItem.style.minWidth = '0';
          gridItem.style.overflow = 'hidden';

          const normalizedLink = nftLink.startsWith('http') ? nftLink : (nftLink ? 'https://' + nftLink : '');
          const previewUrl = `/api/nft-preview?nft_link=${encodeURIComponent(normalizedLink)}`;

          gridItem.innerHTML = `
            <div class="w-full h-full flex items-center justify-center bg-black/50 relative" style="width: 100%; height: 100%; max-width: 100%; box-sizing: border-box; overflow: hidden;">
              <img
                src="${previewUrl}"
                alt="NFT ${i + 1}"
                class="w-full h-full object-cover"
                draggable="false"
                style="width: 100%; height: 100%; max-width: 100%; object-fit: cover; display: block;"
                onerror="this.style.display='none'; this.nextElementSibling.classList.remove('hidden');"
                onload="this.parentElement.querySelector('.nft-loading').classList.add('hidden');"
                oncontextmenu="return false;"
              />
              <div class="nft-loading absolute inset-0 flex items-center justify-center bg-black/70" style="width: 100%; height: 100%; box-sizing: border-box;">
                <div class="text-2xl opacity-70 animate-spin">‚è≥</div>
              </div>
              <div class="hidden w-full h-full flex items-center justify-center bg-black/50" style="width: 100%; height: 100%; box-sizing: border-box;">
                <div class="text-2xl opacity-70">üñºÔ∏è</div>
              </div>
              <div class="absolute top-2 left-2 bg-black/70 text-white text-xs px-2 py-1 rounded pointer-events-none" style="box-sizing: border-box;">
                ${i + 1}
              </div>
            </div>
          `;

          // –ó–∞–ø—Ä–µ—â–∞–µ–º –∫–æ–Ω—Ç–µ–∫—Å—Ç–Ω–æ–µ –º–µ–Ω—é (–ø—Ä–∞–≤—ã–π –∫–ª–∏–∫)
          gridItem.addEventListener('contextmenu', function(e) {
            e.preventDefault();
            return false;
          });

          // –ó–∞–ø—Ä–µ—â–∞–µ–º –≤—ã–¥–µ–ª–µ–Ω–∏–µ —Ç–µ–∫—Å—Ç–∞ –ø—Ä–∏ –¥–ª–∏—Ç–µ–ª—å–Ω–æ–º –Ω–∞–∂–∞—Ç–∏–∏
          gridItem.addEventListener('selectstart', function(e) {
            e.preventDefault();
            return false;
          });

          // –î–æ–±–∞–≤–ª—è–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ drag and drop (–¥–ª—è –ü–ö)
          gridItem.addEventListener('dragstart', handleDragStart);
          gridItem.addEventListener('dragover', handleDragOver);
          gridItem.addEventListener('dragleave', handleDragLeave);
          gridItem.addEventListener('drop', handleDrop);
          gridItem.addEventListener('dragend', handleDragEnd);

          // –î–æ–±–∞–≤–ª—è–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ touch —Å–æ–±—ã—Ç–∏–π (–¥–ª—è –º–æ–±–∏–ª—å–Ω—ã—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤)
          gridItem.addEventListener('touchstart', handleTouchStart, { passive: false });
          gridItem.addEventListener('touchmove', handleTouchMove, { passive: false });
          gridItem.addEventListener('touchend', handleTouchEnd, { passive: false });
          gridItem.addEventListener('touchcancel', handleTouchCancel, { passive: false });

          gridContainer.appendChild(gridItem);
        }
      }

      // –û—Ç–ø—Ä–∞–≤–∫–∞ –∫–æ–ª–ª–µ–∫—Ü–∏–∏
      async function submitCollection() {
        if (!currentCollectionContestId) {
          alert('–û—à–∏–±–∫–∞: ID –∫–æ–Ω–∫—É—Ä—Å–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω');
          return;
        }

        const validLinks = collectionNftLinks.filter(link => link !== null && link !== undefined);
        if (validLinks.length !== 9) {
          alert('–û—à–∏–±–∫–∞: –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å 9 —Å—Å—ã–ª–æ–∫ –Ω–∞ NFT');
          return;
        }

        // –§–æ—Ä–º–∏—Ä—É–µ–º –º–∞—Å—Å–∏–≤ —Å—Å—ã–ª–æ–∫ –≤ –ø—Ä–∞–≤–∏–ª—å–Ω–æ–º –ø–æ—Ä—è–¥–∫–µ
        const orderedLinks = collectionNftOrder.map(index => collectionNftLinks[index]);

        const submitBtn = document.getElementById('collection-arrange-submit');
        if (submitBtn) {
          submitBtn.disabled = true;
          submitBtn.textContent = '‚è≥ –û—Ç–ø—Ä–∞–≤–∫–∞...';
        }

        try {
          const username = window.Telegram?.WebApp?.initDataUnsafe?.user?.username || '';
          const response = await window.fetchJSON(`/api/contests/${currentCollectionContestId}/submit-collection`, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({
              user_id: currentUserId,
              username: username,
              nft_links: orderedLinks
            })
          });

          if (response.success) {
            alert('‚úÖ –ö–æ–ª–ª–µ–∫—Ü–∏—è —É—Å–ø–µ—à–Ω–æ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∞!');

            // –ó–∞–∫—Ä—ã–≤–∞–µ–º –º–æ–¥–∞–ª–∫–∏
            const arrangeModal = document.getElementById('collection-arrange-modal');
            if (arrangeModal) {
              arrangeModal.classList.add('hidden');
            }
            document.body.classList.remove('modal-open');

            // –û–±–Ω–æ–≤–ª—è–µ–º —Å–ø–∏—Å–æ–∫ –∫–æ–Ω–∫—É—Ä—Å–æ–≤
            await loadContests();
          } else {
            alert('‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ –∫–æ–ª–ª–µ–∫—Ü–∏–∏: ' + (response.message || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞'));
            if (submitBtn) {
              submitBtn.disabled = false;
              submitBtn.textContent = '–û—Ç–ø—Ä–∞–≤–∏—Ç—å –∫–æ–ª–ª–µ–∫—Ü–∏—é';
            }
          }
        } catch (e) {
          console.error('–û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ –∫–æ–ª–ª–µ–∫—Ü–∏–∏:', e);
          alert('‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ –∫–æ–ª–ª–µ–∫—Ü–∏–∏: ' + (e.message || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞'));
          if (submitBtn) {
            submitBtn.disabled = false;
            submitBtn.textContent = '–û—Ç–ø—Ä–∞–≤–∏—Ç—å –∫–æ–ª–ª–µ–∫—Ü–∏—é';
          }
        }
      }

      // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤ —Å–æ–±—ã—Ç–∏–π –º–æ–¥–∞–ª–æ–∫
      function initCollectionModals() {
        // –ú–æ–¥–∞–ª–∫–∞ –≤–≤–æ–¥–∞ —Å—Å—ã–ª–æ–∫
        const linksModal = document.getElementById('collection-links-modal');
        const linksModalClose = document.getElementById('collection-links-modal-close');
        const linksCancel = document.getElementById('collection-links-cancel');
        const linksContinue = document.getElementById('collection-links-continue');

        // –ú–æ–¥–∞–ª–∫–∞ —Ä–∞—Å—Å—Ç–∞–Ω–æ–≤–∫–∏
        const arrangeModal = document.getElementById('collection-arrange-modal');
        const arrangeModalClose = document.getElementById('collection-arrange-modal-close');
        const arrangeBack = document.getElementById('collection-arrange-back');
        const arrangeSubmit = document.getElementById('collection-arrange-submit');

        // –ó–∞–∫—Ä—ã—Ç–∏–µ –º–æ–¥–∞–ª–∫–∏ –≤–≤–æ–¥–∞ —Å—Å—ã–ª–æ–∫
        if (linksModalClose) {
          linksModalClose.addEventListener('click', function() {
            if (linksModal) linksModal.classList.add('hidden');
            document.body.classList.remove('modal-open');
          });
        }

        if (linksCancel) {
          linksCancel.addEventListener('click', function() {
            if (linksModal) linksModal.classList.add('hidden');
            document.body.classList.remove('modal-open');
          });
        }

        // –ö–Ω–æ–ø–∫–∞ "–ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å" –≤ –º–æ–¥–∞–ª–∫–µ –≤–≤–æ–¥–∞ —Å—Å—ã–ª–æ–∫
        if (linksContinue) {
          linksContinue.addEventListener('click', function() {
            const validLinks = collectionNftLinks.filter(link => link !== null && link !== undefined);
            if (validLinks.length === 9) {
              openCollectionArrangeModal();
            }
          });
        }

        // –ó–∞–∫—Ä—ã—Ç–∏–µ –º–æ–¥–∞–ª–∫–∏ —Ä–∞—Å—Å—Ç–∞–Ω–æ–≤–∫–∏
        if (arrangeModalClose) {
          arrangeModalClose.addEventListener('click', function() {
            if (arrangeModal) arrangeModal.classList.add('hidden');
            document.body.classList.remove('modal-open');
          });
        }

        // –ö–Ω–æ–ø–∫–∞ "–ù–∞–∑–∞–¥" –≤ –º–æ–¥–∞–ª–∫–µ —Ä–∞—Å—Å—Ç–∞–Ω–æ–≤–∫–∏
        if (arrangeBack) {
          arrangeBack.addEventListener('click', function() {
            if (arrangeModal) arrangeModal.classList.add('hidden');
            if (linksModal) linksModal.classList.remove('hidden');
          });
        }

        // –ö–Ω–æ–ø–∫–∞ "–û—Ç–ø—Ä–∞–≤–∏—Ç—å –∫–æ–ª–ª–µ–∫—Ü–∏—é"
        if (arrangeSubmit) {
          arrangeSubmit.addEventListener('click', submitCollection);
        }

        // –ó–∞–∫—Ä—ã—Ç–∏–µ –ø–æ –∫–ª–∏–∫—É –≤–Ω–µ –º–æ–¥–∞–ª–∫–∏
        if (linksModal) {
          linksModal.addEventListener('click', function(e) {
            if (e.target === linksModal) {
              linksModal.classList.add('hidden');
              document.body.classList.remove('modal-open');
            }
          });
        }

        if (arrangeModal) {
          arrangeModal.addEventListener('click', function(e) {
            if (e.target === arrangeModal) {
              arrangeModal.classList.add('hidden');
              document.body.classList.remove('modal-open');
            }
          });
        }
      }

      // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –º–æ–¥–∞–ª–æ–∫ —Å—Ä–∞–∑—É
      if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', initCollectionModals);
      } else {
        initCollectionModals();
      }

      // –í–´–ó–´–í–ê–ï–ú –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Æ –ü–û–°–õ–ï –û–ü–†–ï–î–ï–õ–ï–ù–ò–Ø –í–°–ï–• –§–£–ù–ö–¶–ò–ô
      console.log('‚úÖ –í—Å–µ —Ñ—É–Ω–∫—Ü–∏–∏ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω—ã, –∑–∞–ø—É—Å–∫–∞–µ–º –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—é');
      startInit();
    })();
  </script>
</body>
</html>
